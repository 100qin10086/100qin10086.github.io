<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ç§¦å®¶å¤§èƒ–&#39;s Blog</title>
  
  <subtitle>ç”Ÿæ´»æœ—æœ—,ä¸‡ç‰©å¯çˆ±</subtitle>
  <link href="https://100qin10086.github.io/atom.xml" rel="self"/>
  
  <link href="https://100qin10086.github.io/"/>
  <updated>2024-05-06T14:13:59.606Z</updated>
  <id>https://100qin10086.github.io/</id>
  
  <author>
    <name>ç§¦ä¸‰é¡º</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title></title>
    <link href="https://100qin10086.github.io/posts/0.html"/>
    <id>https://100qin10086.github.io/posts/0.html</id>
    <published>2024-05-06T14:13:59.606Z</published>
    <updated>2024-05-06T14:13:59.606Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€-NIO-åŸºç¡€"><a href="#ä¸€-NIO-åŸºç¡€" class="headerlink" title="ä¸€. NIO åŸºç¡€"></a>ä¸€. NIO åŸºç¡€</h1><p>non-blocking io éé˜»å¡ IO</p><h2 id="1-ä¸‰å¤§ç»„ä»¶"><a href="#1-ä¸‰å¤§ç»„ä»¶" class="headerlink" title="1. ä¸‰å¤§ç»„ä»¶"></a>1. ä¸‰å¤§ç»„ä»¶</h2><h3 id="1-1-Channel-amp-Buffer"><a href="#1-1-Channel-amp-Buffer" class="headerlink" title="1.1 Channel &amp; Buffer"></a>1.1 Channel &amp; Buffer</h3><p>channel æœ‰ä¸€ç‚¹ç±»ä¼¼äº streamï¼Œå®ƒå°±æ˜¯è¯»å†™æ•°æ®çš„<strong>åŒå‘é€šé“</strong>ï¼Œå¯ä»¥ä» channel å°†æ•°æ®è¯»å…¥ bufferï¼Œä¹Ÿå¯ä»¥å°† buffer çš„æ•°æ®å†™å…¥ channelï¼Œè€Œä¹‹å‰çš„ stream è¦ä¹ˆæ˜¯è¾“å…¥ï¼Œè¦ä¹ˆæ˜¯è¾“å‡ºï¼Œchannel æ¯” stream æ›´ä¸ºåº•å±‚</p><pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid"><span class="token keyword">graph</span> LRchannel <span class="token arrow operator">--></span> bufferbuffer <span class="token arrow operator">--></span> channel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¸¸è§çš„ Channel æœ‰</p><ul><li>FileChannel</li><li>DatagramChannel</li><li>SocketChannel</li><li>ServerSocketChannel</li></ul><p>buffer åˆ™ç”¨æ¥ç¼“å†²è¯»å†™æ•°æ®ï¼Œå¸¸è§çš„ buffer æœ‰</p><ul><li>ByteBuffer<ul><li>MappedByteBuffer</li><li>DirectByteBuffer</li><li>HeapByteBuffer</li></ul></li><li>ShortBuffer</li><li>IntBuffer</li><li>LongBuffer</li><li>FloatBuffer</li><li>DoubleBuffer</li><li>CharBuffer</li></ul><h3 id="1-2-Selector"><a href="#1-2-Selector" class="headerlink" title="1.2 Selector"></a>1.2 Selector</h3><p>selector å•ä»å­—é¢æ„æ€ä¸å¥½ç†è§£ï¼Œéœ€è¦ç»“åˆæœåŠ¡å™¨çš„è®¾è®¡æ¼”åŒ–æ¥ç†è§£å®ƒçš„ç”¨é€”</p><h4 id="å¤šçº¿ç¨‹ç‰ˆè®¾è®¡"><a href="#å¤šçº¿ç¨‹ç‰ˆè®¾è®¡" class="headerlink" title="å¤šçº¿ç¨‹ç‰ˆè®¾è®¡"></a>å¤šçº¿ç¨‹ç‰ˆè®¾è®¡</h4><pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid"><span class="token keyword">graph</span> TD<span class="token keyword">subgraph</span> å¤šçº¿ç¨‹ç‰ˆt1<span class="token text string">(thread)</span> <span class="token arrow operator">--></span> s1<span class="token text string">(socket1)</span>t2<span class="token text string">(thread)</span> <span class="token arrow operator">--></span> s2<span class="token text string">(socket2)</span>t3<span class="token text string">(thread)</span> <span class="token arrow operator">--></span> s3<span class="token text string">(socket3)</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="âš ï¸-å¤šçº¿ç¨‹ç‰ˆç¼ºç‚¹"><a href="#âš ï¸-å¤šçº¿ç¨‹ç‰ˆç¼ºç‚¹" class="headerlink" title="âš ï¸ å¤šçº¿ç¨‹ç‰ˆç¼ºç‚¹"></a>âš ï¸ å¤šçº¿ç¨‹ç‰ˆç¼ºç‚¹</h4><ul><li>å†…å­˜å ç”¨é«˜</li><li>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬é«˜</li><li>åªé€‚åˆè¿æ¥æ•°å°‘çš„åœºæ™¯</li></ul><h4 id="çº¿ç¨‹æ± ç‰ˆè®¾è®¡"><a href="#çº¿ç¨‹æ± ç‰ˆè®¾è®¡" class="headerlink" title="çº¿ç¨‹æ± ç‰ˆè®¾è®¡"></a>çº¿ç¨‹æ± ç‰ˆè®¾è®¡</h4><pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid"><span class="token keyword">graph</span> TD<span class="token keyword">subgraph</span> çº¿ç¨‹æ± ç‰ˆt4<span class="token text string">(thread)</span> <span class="token arrow operator">--></span> s4<span class="token text string">(socket1)</span>t5<span class="token text string">(thread)</span> <span class="token arrow operator">--></span> s5<span class="token text string">(socket2)</span>t4<span class="token text string">(thread)</span> <span class="token arrow operator">-.-></span> s6<span class="token text string">(socket3)</span>t5<span class="token text string">(thread)</span> <span class="token arrow operator">-.-></span> s7<span class="token text string">(socket4)</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="âš ï¸-çº¿ç¨‹æ± ç‰ˆç¼ºç‚¹"><a href="#âš ï¸-çº¿ç¨‹æ± ç‰ˆç¼ºç‚¹" class="headerlink" title="âš ï¸ çº¿ç¨‹æ± ç‰ˆç¼ºç‚¹"></a>âš ï¸ çº¿ç¨‹æ± ç‰ˆç¼ºç‚¹</h4><ul><li>é˜»å¡æ¨¡å¼ä¸‹ï¼Œçº¿ç¨‹ä»…èƒ½å¤„ç†ä¸€ä¸ª socket è¿æ¥</li><li>ä»…é€‚åˆçŸ­è¿æ¥åœºæ™¯</li></ul><h4 id="selector-ç‰ˆè®¾è®¡"><a href="#selector-ç‰ˆè®¾è®¡" class="headerlink" title="selector ç‰ˆè®¾è®¡"></a>selector ç‰ˆè®¾è®¡</h4><p>selector çš„ä½œç”¨å°±æ˜¯é…åˆä¸€ä¸ªçº¿ç¨‹æ¥ç®¡ç†å¤šä¸ª channelï¼Œè·å–è¿™äº› channel ä¸Šå‘ç”Ÿçš„äº‹ä»¶ï¼Œè¿™äº› channel å·¥ä½œåœ¨éé˜»å¡æ¨¡å¼ä¸‹ï¼Œä¸ä¼šè®©çº¿ç¨‹åŠæ­»åœ¨ä¸€ä¸ª channel ä¸Šã€‚é€‚åˆè¿æ¥æ•°ç‰¹åˆ«å¤šï¼Œä½†æµé‡ä½çš„åœºæ™¯ï¼ˆlow trafficï¼‰</p><pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid"><span class="token keyword">graph</span> TD<span class="token keyword">subgraph</span> selector ç‰ˆthread <span class="token arrow operator">--></span> selectorselector <span class="token arrow operator">--></span> c1<span class="token text string">(channel)</span>selector <span class="token arrow operator">--></span> c2<span class="token text string">(channel)</span>selector <span class="token arrow operator">--></span> c3<span class="token text string">(channel)</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è°ƒç”¨ selector çš„ select() ä¼šé˜»å¡ç›´åˆ° channel å‘ç”Ÿäº†è¯»å†™å°±ç»ªäº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶å‘ç”Ÿï¼Œselect æ–¹æ³•å°±ä¼šè¿”å›è¿™äº›äº‹ä»¶äº¤ç»™ thread æ¥å¤„ç†</p><h2 id="2-ByteBuffer"><a href="#2-ByteBuffer" class="headerlink" title="2. ByteBuffer"></a>2. ByteBuffer</h2><p>æœ‰ä¸€æ™®é€šæ–‡æœ¬æ–‡ä»¶ data.txtï¼Œå†…å®¹ä¸º</p><pre class="line-numbers language-none"><code class="language-none">1234567890abcd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½¿ç”¨ FileChannel æ¥è¯»å–æ–‡ä»¶å†…å®¹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelDemo1</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">RandomAccessFile</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span><span class="token string">"helloword/data.txt"</span><span class="token punctuation">,</span> <span class="token string">"rw"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">FileChannel</span> channel <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// å‘ buffer å†™å…¥</span>                <span class="token keyword">int</span> len <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"è¯»åˆ°å­—èŠ‚æ•°ï¼š&#123;&#125;"</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token comment">// åˆ‡æ¢ buffer è¯»æ¨¡å¼</span>                buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">while</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>buffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token comment">// åˆ‡æ¢ buffer å†™æ¨¡å¼</span>                buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - è¯»åˆ°å­—èŠ‚æ•°ï¼š1010:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 110:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 210:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 310:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 410:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 510:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 610:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 710:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 810:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 910:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - 010:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - è¯»åˆ°å­—èŠ‚æ•°ï¼š410:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - a10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - b10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - c10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - d10:39:03 [DEBUG] [main] c.i.n.ChannelDemo1 - è¯»åˆ°å­—èŠ‚æ•°ï¼š-1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-1-ByteBuffer-æ­£ç¡®ä½¿ç”¨å§¿åŠ¿"><a href="#2-1-ByteBuffer-æ­£ç¡®ä½¿ç”¨å§¿åŠ¿" class="headerlink" title="2.1  ByteBuffer æ­£ç¡®ä½¿ç”¨å§¿åŠ¿"></a>2.1  ByteBuffer æ­£ç¡®ä½¿ç”¨å§¿åŠ¿</h3><ol><li>å‘ buffer å†™å…¥æ•°æ®ï¼Œä¾‹å¦‚è°ƒç”¨ channel.read(buffer)</li><li>è°ƒç”¨ flip() åˆ‡æ¢è‡³<strong>è¯»æ¨¡å¼</strong></li><li>ä» buffer è¯»å–æ•°æ®ï¼Œä¾‹å¦‚è°ƒç”¨ buffer.get()</li><li>è°ƒç”¨ clear() æˆ– compact() åˆ‡æ¢è‡³<strong>å†™æ¨¡å¼</strong></li><li>é‡å¤ 1~4 æ­¥éª¤</li></ol><h3 id="2-2-ByteBuffer-ç»“æ„"><a href="#2-2-ByteBuffer-ç»“æ„" class="headerlink" title="2.2 ByteBuffer ç»“æ„"></a>2.2 ByteBuffer ç»“æ„</h3><p>ByteBuffer æœ‰ä»¥ä¸‹é‡è¦å±æ€§</p><ul><li>capacity</li><li>position</li><li>limit</li></ul><p>ä¸€å¼€å§‹</p><p><img src="/posts/0.htm/0021.png" alt></p><p>å†™æ¨¡å¼ä¸‹ï¼Œposition æ˜¯å†™å…¥ä½ç½®ï¼Œlimit ç­‰äºå®¹é‡ï¼Œä¸‹å›¾è¡¨ç¤ºå†™å…¥äº† 4 ä¸ªå­—èŠ‚åçš„çŠ¶æ€</p><p><img src="/posts/0.htm/0018.png" alt></p><p>flip åŠ¨ä½œå‘ç”Ÿåï¼Œposition åˆ‡æ¢ä¸ºè¯»å–ä½ç½®ï¼Œlimit åˆ‡æ¢ä¸ºè¯»å–é™åˆ¶</p><p><img src="/posts/0.htm/0019.png" alt></p><p>è¯»å– 4 ä¸ªå­—èŠ‚åï¼ŒçŠ¶æ€</p><p><img src="/posts/0.htm/0020.png" alt></p><p>clear åŠ¨ä½œå‘ç”Ÿåï¼ŒçŠ¶æ€</p><p><img src="/posts/0.htm/0021.png" alt></p><p>compact æ–¹æ³•ï¼Œæ˜¯æŠŠæœªè¯»å®Œçš„éƒ¨åˆ†å‘å‰å‹ç¼©ï¼Œç„¶ååˆ‡æ¢è‡³å†™æ¨¡å¼</p><p><img src="/posts/0.htm/0022.png" alt></p><h4 id="ğŸ’¡-è°ƒè¯•å·¥å…·ç±»"><a href="#ğŸ’¡-è°ƒè¯•å·¥å…·ç±»" class="headerlink" title="ğŸ’¡ è°ƒè¯•å·¥å…·ç±»"></a>ğŸ’¡ è°ƒè¯•å·¥å…·ç±»</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ByteBufferUtil</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">BYTE2CHAR</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">HEXDUMP_TABLE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token number">256</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">HEXPADDING</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">HEXDUMP_ROWPREFIXES</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">65536</span> <span class="token operator">>>></span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">BYTE2HEX</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">BYTEPADDING</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">final</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">DIGITS</span> <span class="token operator">=</span> <span class="token string">"0123456789abcdef"</span><span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token constant">HEXDUMP_TABLE</span><span class="token punctuation">[</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">DIGITS</span><span class="token punctuation">[</span>i <span class="token operator">>>></span> <span class="token number">4</span> <span class="token operator">&amp;</span> <span class="token number">0x0F</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token constant">HEXDUMP_TABLE</span><span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">DIGITS</span><span class="token punctuation">[</span>i <span class="token operator">&amp;</span> <span class="token number">0x0F</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">int</span> i<span class="token punctuation">;</span>        <span class="token comment">// Generate the lookup table for hex dump paddings</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token constant">HEXPADDING</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">int</span> padding <span class="token operator">=</span> <span class="token constant">HEXPADDING</span><span class="token punctuation">.</span>length <span class="token operator">-</span> i<span class="token punctuation">;</span>            <span class="token class-name">StringBuilder</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span>padding <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> padding<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                buf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"   "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token constant">HEXPADDING</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// Generate the lookup table for the start-offset header in each row (up to 64KiB).</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token constant">HEXDUMP_ROWPREFIXES</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">StringBuilder</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            buf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token constant">NEWLINE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            buf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">4</span> <span class="token operator">&amp;</span> <span class="token number">0</span>xFFFFFFFFL <span class="token operator">|</span> <span class="token number">0</span>x100000000L<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            buf<span class="token punctuation">.</span><span class="token function">setCharAt</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token char">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            buf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token char">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token constant">HEXDUMP_ROWPREFIXES</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// Generate the lookup table for byte-to-hex-dump conversion</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token constant">BYTE2HEX</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token constant">BYTE2HEX</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">' '</span> <span class="token operator">+</span> <span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">byteToHexStringPadded</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// Generate the lookup table for byte dump paddings</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token constant">BYTEPADDING</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">int</span> padding <span class="token operator">=</span> <span class="token constant">BYTEPADDING</span><span class="token punctuation">.</span>length <span class="token operator">-</span> i<span class="token punctuation">;</span>            <span class="token class-name">StringBuilder</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span>padding<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> padding<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                buf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token char">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token constant">BYTEPADDING</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// Generate the lookup table for byte-to-char conversion</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token constant">BYTE2CHAR</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> <span class="token number">0x1f</span> <span class="token operator">||</span> i <span class="token operator">>=</span> <span class="token number">0x7f</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token constant">BYTE2CHAR</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'.'</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token constant">BYTE2CHAR</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> i<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * æ‰“å°æ‰€æœ‰å†…å®¹     * @param buffer     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">debugAll</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> oldlimit <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">StringBuilder</span> origin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">appendPrettyHexDump</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"+--------+-------------------- all ------------------------+----------------+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"position: [%d], limit: [%d]\n"</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> oldlimit<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>        buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>oldlimit<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * æ‰“å°å¯è¯»å–å†…å®¹     * @param buffer     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">debugRead</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">StringBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">appendPrettyHexDump</span><span class="token punctuation">(</span>builder<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> buffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"+--------+-------------------- read -----------------------+----------------+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"position: [%d], limit: [%d]\n"</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">appendPrettyHexDump</span><span class="token punctuation">(</span><span class="token class-name">StringBuilder</span> dump<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> buf<span class="token punctuation">,</span> <span class="token keyword">int</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isOutOfBounds</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span> length<span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IndexOutOfBoundsException</span><span class="token punctuation">(</span>                    <span class="token string">"expected: "</span> <span class="token operator">+</span> <span class="token string">"0 &lt;= offset("</span> <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token string">") &lt;= offset + length("</span> <span class="token operator">+</span> length                            <span class="token operator">+</span> <span class="token string">") &lt;= "</span> <span class="token operator">+</span> <span class="token string">"buf.capacity("</span> <span class="token operator">+</span> buf<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token char">')'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>                <span class="token string">"         +-------------------------------------------------+"</span> <span class="token operator">+</span>                        <span class="token constant">NEWLINE</span> <span class="token operator">+</span> <span class="token string">"         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |"</span> <span class="token operator">+</span>                        <span class="token constant">NEWLINE</span> <span class="token operator">+</span> <span class="token string">"+--------+-------------------------------------------------+----------------+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> <span class="token keyword">int</span> startIndex <span class="token operator">=</span> offset<span class="token punctuation">;</span>        <span class="token keyword">final</span> <span class="token keyword">int</span> fullRows <span class="token operator">=</span> length <span class="token operator">>>></span> <span class="token number">4</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> <span class="token keyword">int</span> remainder <span class="token operator">=</span> length <span class="token operator">&amp;</span> <span class="token number">0xF</span><span class="token punctuation">;</span>        <span class="token comment">// Dump the rows which have 16 bytes.</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> row <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> row <span class="token operator">&lt;</span> fullRows<span class="token punctuation">;</span> row<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">int</span> rowStartIndex <span class="token operator">=</span> <span class="token punctuation">(</span>row <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">+</span> startIndex<span class="token punctuation">;</span>            <span class="token comment">// Per-row prefix.</span>            <span class="token function">appendHexDumpRowPrefix</span><span class="token punctuation">(</span>dump<span class="token punctuation">,</span> row<span class="token punctuation">,</span> rowStartIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// Hex dump</span>            <span class="token keyword">int</span> rowEndIndex <span class="token operator">=</span> rowStartIndex <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> rowStartIndex<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> rowEndIndex<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token constant">BYTE2HEX</span><span class="token punctuation">[</span><span class="token function">getUnsignedByte</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" |"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// ASCII dump</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> rowStartIndex<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> rowEndIndex<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token constant">BYTE2CHAR</span><span class="token punctuation">[</span><span class="token function">getUnsignedByte</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token char">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// Dump the last row which has less than 16 bytes.</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>remainder <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">int</span> rowStartIndex <span class="token operator">=</span> <span class="token punctuation">(</span>fullRows <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">+</span> startIndex<span class="token punctuation">;</span>            <span class="token function">appendHexDumpRowPrefix</span><span class="token punctuation">(</span>dump<span class="token punctuation">,</span> fullRows<span class="token punctuation">,</span> rowStartIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// Hex dump</span>            <span class="token keyword">int</span> rowEndIndex <span class="token operator">=</span> rowStartIndex <span class="token operator">+</span> remainder<span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> rowStartIndex<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> rowEndIndex<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token constant">BYTE2HEX</span><span class="token punctuation">[</span><span class="token function">getUnsignedByte</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token constant">HEXPADDING</span><span class="token punctuation">[</span>remainder<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" |"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// Ascii dump</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> rowStartIndex<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> rowEndIndex<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token constant">BYTE2CHAR</span><span class="token punctuation">[</span><span class="token function">getUnsignedByte</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token constant">BYTEPADDING</span><span class="token punctuation">[</span>remainder<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token char">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token constant">NEWLINE</span> <span class="token operator">+</span>                <span class="token string">"+--------+-------------------------------------------------+----------------+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">appendHexDumpRowPrefix</span><span class="token punctuation">(</span><span class="token class-name">StringBuilder</span> dump<span class="token punctuation">,</span> <span class="token keyword">int</span> row<span class="token punctuation">,</span> <span class="token keyword">int</span> rowStartIndex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>row <span class="token operator">&lt;</span> <span class="token constant">HEXDUMP_ROWPREFIXES</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token constant">HEXDUMP_ROWPREFIXES</span><span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token constant">NEWLINE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>rowStartIndex <span class="token operator">&amp;</span> <span class="token number">0</span>xFFFFFFFFL <span class="token operator">|</span> <span class="token number">0</span>x100000000L<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            dump<span class="token punctuation">.</span><span class="token function">setCharAt</span><span class="token punctuation">(</span>dump<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token char">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            dump<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token char">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">short</span> <span class="token function">getUnsignedByte</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-3-ByteBuffer-å¸¸è§æ–¹æ³•"><a href="#2-3-ByteBuffer-å¸¸è§æ–¹æ³•" class="headerlink" title="2.3 ByteBuffer å¸¸è§æ–¹æ³•"></a>2.3 ByteBuffer å¸¸è§æ–¹æ³•</h3><h4 id="åˆ†é…ç©ºé—´"><a href="#åˆ†é…ç©ºé—´" class="headerlink" title="åˆ†é…ç©ºé—´"></a>åˆ†é…ç©ºé—´</h4><p>å¯ä»¥ä½¿ç”¨ allocate æ–¹æ³•ä¸º ByteBuffer åˆ†é…ç©ºé—´ï¼Œå…¶å®ƒ buffer ç±»ä¹Ÿæœ‰è¯¥æ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Bytebuffer</span> buf <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="å‘-buffer-å†™å…¥æ•°æ®"><a href="#å‘-buffer-å†™å…¥æ•°æ®" class="headerlink" title="å‘ buffer å†™å…¥æ•°æ®"></a>å‘ buffer å†™å…¥æ•°æ®</h4><p>æœ‰ä¸¤ç§åŠæ³•</p><ul><li>è°ƒç”¨ channel çš„ read æ–¹æ³•</li><li>è°ƒç”¨ buffer è‡ªå·±çš„ put æ–¹æ³•</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> readBytes <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å’Œ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">buf<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="ä»-buffer-è¯»å–æ•°æ®"><a href="#ä»-buffer-è¯»å–æ•°æ®" class="headerlink" title="ä» buffer è¯»å–æ•°æ®"></a>ä» buffer è¯»å–æ•°æ®</h4><p>åŒæ ·æœ‰ä¸¤ç§åŠæ³•</p><ul><li>è°ƒç”¨ channel çš„ write æ–¹æ³•</li><li>è°ƒç”¨ buffer è‡ªå·±çš„ get æ–¹æ³•</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> writeBytes <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å’Œ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">byte</span> b <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>get æ–¹æ³•ä¼šè®© position è¯»æŒ‡é’ˆå‘åèµ°ï¼Œå¦‚æœæƒ³é‡å¤è¯»å–æ•°æ®</p><ul><li>å¯ä»¥è°ƒç”¨ rewind æ–¹æ³•å°† position é‡æ–°ç½®ä¸º 0</li><li>æˆ–è€…è°ƒç”¨ get(int i) æ–¹æ³•è·å–ç´¢å¼• i çš„å†…å®¹ï¼Œå®ƒä¸ä¼šç§»åŠ¨è¯»æŒ‡é’ˆ</li></ul><h4 id="mark-å’Œ-reset"><a href="#mark-å’Œ-reset" class="headerlink" title="mark å’Œ reset"></a>mark å’Œ reset</h4><p>mark æ˜¯åœ¨è¯»å–æ—¶ï¼Œåšä¸€ä¸ªæ ‡è®°ï¼Œå³ä½¿ position æ”¹å˜ï¼Œåªè¦è°ƒç”¨ reset å°±èƒ½å›åˆ° mark çš„ä½ç½®</p><blockquote><p><strong>æ³¨æ„</strong></p><p>rewind å’Œ flip éƒ½ä¼šæ¸…é™¤ mark ä½ç½®</p></blockquote><h4 id="å­—ç¬¦ä¸²ä¸-ByteBuffer-äº’è½¬"><a href="#å­—ç¬¦ä¸²ä¸-ByteBuffer-äº’è½¬" class="headerlink" title="å­—ç¬¦ä¸²ä¸ ByteBuffer äº’è½¬"></a>å­—ç¬¦ä¸²ä¸ ByteBuffer äº’è½¬</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuffer</span> buffer1 <span class="token operator">=</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"ä½ å¥½"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">ByteBuffer</span> buffer2 <span class="token operator">=</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"ä½ å¥½"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">debug</span><span class="token punctuation">(</span>buffer1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">debug</span><span class="token punctuation">(</span>buffer2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">CharBuffer</span> buffer3 <span class="token operator">=</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>buffer1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer3<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer3<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| e4 bd a0 e5 a5 bd                               |......          |+--------+-------------------------------------------------+----------------+         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| e4 bd a0 e5 a5 bd                               |......          |+--------+-------------------------------------------------+----------------+class java.nio.HeapCharBufferä½ å¥½<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="âš ï¸-Buffer-çš„çº¿ç¨‹å®‰å…¨"><a href="#âš ï¸-Buffer-çš„çº¿ç¨‹å®‰å…¨" class="headerlink" title="âš ï¸ Buffer çš„çº¿ç¨‹å®‰å…¨"></a>âš ï¸ Buffer çš„çº¿ç¨‹å®‰å…¨</h4><blockquote><p>Buffer æ˜¯<strong>éçº¿ç¨‹å®‰å…¨çš„</strong></p></blockquote><h3 id="2-4-Scattering-Reads"><a href="#2-4-Scattering-Reads" class="headerlink" title="2.4 Scattering Reads"></a>2.4 Scattering Reads</h3><p>åˆ†æ•£è¯»å–ï¼Œæœ‰ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ 3parts.txt</p><pre class="line-numbers language-none"><code class="language-none">onetwothree<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¯»å–ï¼Œå¯ä»¥å°†æ•°æ®å¡«å……è‡³å¤šä¸ª buffer</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">RandomAccessFile</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span><span class="token string">"helloword/3parts.txt"</span><span class="token punctuation">,</span> <span class="token string">"rw"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">FileChannel</span> channel <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ByteBuffer</span> a <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ByteBuffer</span> b <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ByteBuffer</span> c <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    a<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    b<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    c<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">debug</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">debug</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">debug</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»“æœ</p><pre class="line-numbers language-none"><code class="language-none">         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 6f 6e 65                                        |one             |+--------+-------------------------------------------------+----------------+         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 74 77 6f                                        |two             |+--------+-------------------------------------------------+----------------+         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 74 68 72 65 65                                  |three           |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-5-Gathering-Writes"><a href="#2-5-Gathering-Writes" class="headerlink" title="2.5 Gathering Writes"></a>2.5 Gathering Writes</h3><p>ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å†™å…¥ï¼Œå¯ä»¥å°†å¤šä¸ª buffer çš„æ•°æ®å¡«å……è‡³ channel</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">RandomAccessFile</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span><span class="token string">"helloword/3parts.txt"</span><span class="token punctuation">,</span> <span class="token string">"rw"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">FileChannel</span> channel <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ByteBuffer</span> d <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ByteBuffer</span> e <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    channel<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    d<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token char">'f'</span><span class="token punctuation">,</span> <span class="token char">'o'</span><span class="token punctuation">,</span> <span class="token char">'u'</span><span class="token punctuation">,</span> <span class="token char">'r'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    e<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token char">'f'</span><span class="token punctuation">,</span> <span class="token char">'i'</span><span class="token punctuation">,</span> <span class="token char">'v'</span><span class="token punctuation">,</span> <span class="token char">'e'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    d<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    e<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">debug</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">debug</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>d<span class="token punctuation">,</span> e<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 66 6f 75 72                                     |four            |+--------+-------------------------------------------------+----------------+         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 66 69 76 65                                     |five            |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ–‡ä»¶å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">onetwothreefourfive<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-6-ç»ƒä¹ "><a href="#2-6-ç»ƒä¹ " class="headerlink" title="2.6 ç»ƒä¹ "></a>2.6 ç»ƒä¹ </h3><p>ç½‘ç»œä¸Šæœ‰å¤šæ¡æ•°æ®å‘é€ç»™æœåŠ¡ç«¯ï¼Œæ•°æ®ä¹‹é—´ä½¿ç”¨ \n è¿›è¡Œåˆ†éš”<br>ä½†ç”±äºæŸç§åŸå› è¿™äº›æ•°æ®åœ¨æ¥æ”¶æ—¶ï¼Œè¢«è¿›è¡Œäº†é‡æ–°ç»„åˆï¼Œä¾‹å¦‚åŸå§‹æ•°æ®æœ‰3æ¡ä¸º</p><ul><li>Hello,world\n</li><li>Iâ€™m zhangsan\n</li><li>How are you?\n</li></ul><p>å˜æˆäº†ä¸‹é¢çš„ä¸¤ä¸ª byteBuffer (é»åŒ…ï¼ŒåŠåŒ…)</p><ul><li>Hello,world\nIâ€™m zhangsan\nHo</li><li>w are you?\n</li></ul><p>ç°åœ¨è¦æ±‚ä½ ç¼–å†™ç¨‹åºï¼Œå°†é”™ä¹±çš„æ•°æ®æ¢å¤æˆåŸå§‹çš„æŒ‰ \n åˆ†éš”çš„æ•°æ®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">ByteBuffer</span> source <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//                     11            24</span>    source<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"Hello,world\nI'm zhangsan\nHo"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">split</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>    source<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"w are you?\nhaha!\n"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">split</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> source<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    source<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> oldLimit <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> oldLimit<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ByteBuffer</span> target <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">-</span> source<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 0 ~ limit</span>            source<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            target<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä»source è¯»ï¼Œå‘ target å†™</span>            <span class="token function">debugAll</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>            source<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>oldLimit<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    source<span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-æ–‡ä»¶ç¼–ç¨‹"><a href="#3-æ–‡ä»¶ç¼–ç¨‹" class="headerlink" title="3. æ–‡ä»¶ç¼–ç¨‹"></a>3. æ–‡ä»¶ç¼–ç¨‹</h2><h3 id="3-1-FileChannel"><a href="#3-1-FileChannel" class="headerlink" title="3.1 FileChannel"></a>3.1 FileChannel</h3><h4 id="âš ï¸-FileChannel-å·¥ä½œæ¨¡å¼"><a href="#âš ï¸-FileChannel-å·¥ä½œæ¨¡å¼" class="headerlink" title="âš ï¸ FileChannel å·¥ä½œæ¨¡å¼"></a>âš ï¸ FileChannel å·¥ä½œæ¨¡å¼</h4><blockquote><p>FileChannel åªèƒ½å·¥ä½œåœ¨é˜»å¡æ¨¡å¼ä¸‹</p></blockquote><h4 id="è·å–"><a href="#è·å–" class="headerlink" title="è·å–"></a>è·å–</h4><p>ä¸èƒ½ç›´æ¥æ‰“å¼€ FileChannelï¼Œå¿…é¡»é€šè¿‡ FileInputStreamã€FileOutputStream æˆ–è€… RandomAccessFile æ¥è·å– FileChannelï¼Œå®ƒä»¬éƒ½æœ‰ getChannel æ–¹æ³•</p><ul><li>é€šè¿‡ FileInputStream è·å–çš„ channel åªèƒ½è¯»</li><li>é€šè¿‡ FileOutputStream è·å–çš„ channel åªèƒ½å†™</li><li>é€šè¿‡ RandomAccessFile æ˜¯å¦èƒ½è¯»å†™æ ¹æ®æ„é€  RandomAccessFile æ—¶çš„è¯»å†™æ¨¡å¼å†³å®š</li></ul><h4 id="è¯»å–"><a href="#è¯»å–" class="headerlink" title="è¯»å–"></a>è¯»å–</h4><p>ä¼šä» channel è¯»å–æ•°æ®å¡«å…… ByteBufferï¼Œè¿”å›å€¼è¡¨ç¤ºè¯»åˆ°äº†å¤šå°‘å­—èŠ‚ï¼Œ-1 è¡¨ç¤ºåˆ°è¾¾äº†æ–‡ä»¶çš„æœ«å°¾</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> readBytes <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="å†™å…¥"><a href="#å†™å…¥" class="headerlink" title="å†™å…¥"></a>å†™å…¥</h4><p>å†™å…¥çš„æ­£ç¡®å§¿åŠ¿å¦‚ä¸‹ï¼Œ SocketChannel</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å­˜å…¥æ•°æ®</span>buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// åˆ‡æ¢è¯»æ¨¡å¼</span><span class="token keyword">while</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ while ä¸­è°ƒç”¨ channel.write æ˜¯å› ä¸º write æ–¹æ³•å¹¶ä¸èƒ½ä¿è¯ä¸€æ¬¡å°† buffer ä¸­çš„å†…å®¹å…¨éƒ¨å†™å…¥ channel</p><h4 id="å…³é—­"><a href="#å…³é—­" class="headerlink" title="å…³é—­"></a>å…³é—­</h4><p>channel å¿…é¡»å…³é—­ï¼Œä¸è¿‡è°ƒç”¨äº† FileInputStreamã€FileOutputStream æˆ–è€… RandomAccessFile çš„ close æ–¹æ³•ä¼šé—´æ¥åœ°è°ƒç”¨ channel çš„ close æ–¹æ³•</p><h4 id="ä½ç½®"><a href="#ä½ç½®" class="headerlink" title="ä½ç½®"></a>ä½ç½®</h4><p>è·å–å½“å‰ä½ç½®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">long</span> pos <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è®¾ç½®å½“å‰ä½ç½®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">long</span> newPos <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>channel<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span>newPos<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è®¾ç½®å½“å‰ä½ç½®æ—¶ï¼Œå¦‚æœè®¾ç½®ä¸ºæ–‡ä»¶çš„æœ«å°¾</p><ul><li>è¿™æ—¶è¯»å–ä¼šè¿”å› -1 </li><li>è¿™æ—¶å†™å…¥ï¼Œä¼šè¿½åŠ å†…å®¹ï¼Œä½†è¦æ³¨æ„å¦‚æœ position è¶…è¿‡äº†æ–‡ä»¶æœ«å°¾ï¼Œå†å†™å…¥æ—¶åœ¨æ–°å†…å®¹å’ŒåŸæœ«å°¾ä¹‹é—´ä¼šæœ‰ç©ºæ´ï¼ˆ00ï¼‰</li></ul><h4 id="å¤§å°"><a href="#å¤§å°" class="headerlink" title="å¤§å°"></a>å¤§å°</h4><p>ä½¿ç”¨ size æ–¹æ³•è·å–æ–‡ä»¶çš„å¤§å°</p><h4 id="å¼ºåˆ¶å†™å…¥"><a href="#å¼ºåˆ¶å†™å…¥" class="headerlink" title="å¼ºåˆ¶å†™å…¥"></a>å¼ºåˆ¶å†™å…¥</h4><p>æ“ä½œç³»ç»Ÿå‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œä¼šå°†æ•°æ®ç¼“å­˜ï¼Œä¸æ˜¯ç«‹åˆ»å†™å…¥ç£ç›˜ã€‚å¯ä»¥è°ƒç”¨ force(true)  æ–¹æ³•å°†æ–‡ä»¶å†…å®¹å’Œå…ƒæ•°æ®ï¼ˆæ–‡ä»¶çš„æƒé™ç­‰ä¿¡æ¯ï¼‰ç«‹åˆ»å†™å…¥ç£ç›˜</p><h3 id="3-2-ä¸¤ä¸ª-Channel-ä¼ è¾“æ•°æ®"><a href="#3-2-ä¸¤ä¸ª-Channel-ä¼ è¾“æ•°æ®" class="headerlink" title="3.2 ä¸¤ä¸ª Channel ä¼ è¾“æ•°æ®"></a>3.2 ä¸¤ä¸ª Channel ä¼ è¾“æ•°æ®</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> <span class="token constant">FROM</span> <span class="token operator">=</span> <span class="token string">"helloword/data.txt"</span><span class="token punctuation">;</span><span class="token class-name">String</span> <span class="token constant">TO</span> <span class="token operator">=</span> <span class="token string">"helloword/to.txt"</span><span class="token punctuation">;</span><span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">FileChannel</span> from <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token constant">FROM</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token class-name">FileChannel</span> <span class="token keyword">to</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token constant">TO</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    from<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> from<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"transferTo ç”¨æ—¶ï¼š"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000_000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">transferTo ç”¨æ—¶ï¼š8.2011<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¶…è¿‡ 2g å¤§å°çš„æ–‡ä»¶ä¼ è¾“</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestFileChannelTransferTo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span>                <span class="token class-name">FileChannel</span> from <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">FileChannel</span> <span class="token keyword">to</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"to.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// æ•ˆç‡é«˜ï¼Œåº•å±‚ä¼šåˆ©ç”¨æ“ä½œç³»ç»Ÿçš„é›¶æ‹·è´è¿›è¡Œä¼˜åŒ–</span>            <span class="token keyword">long</span> size <span class="token operator">=</span> from<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// left å˜é‡ä»£è¡¨è¿˜å‰©ä½™å¤šå°‘å­—èŠ‚</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> left <span class="token operator">=</span> size<span class="token punctuation">;</span> left <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"position:"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>size <span class="token operator">-</span> left<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" left:"</span> <span class="token operator">+</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>                left <span class="token operator">-=</span> from<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token punctuation">(</span>size <span class="token operator">-</span> left<span class="token punctuation">)</span><span class="token punctuation">,</span> left<span class="token punctuation">,</span> <span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®é™…ä¼ è¾“ä¸€ä¸ªè¶…å¤§æ–‡ä»¶</p><pre class="line-numbers language-none"><code class="language-none">position:0 left:7769948160position:2147483647 left:5622464513position:4294967294 left:3474980866position:6442450941 left:1327497219<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-3-Path"><a href="#3-3-Path" class="headerlink" title="3.3 Path"></a>3.3 Path</h3><p>jdk7 å¼•å…¥äº† Path å’Œ Paths ç±»</p><ul><li>Path ç”¨æ¥è¡¨ç¤ºæ–‡ä»¶è·¯å¾„</li><li>Paths æ˜¯å·¥å…·ç±»ï¼Œç”¨æ¥è·å– Path å®ä¾‹</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> source <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç›¸å¯¹è·¯å¾„ ä½¿ç”¨ user.dir ç¯å¢ƒå˜é‡æ¥å®šä½ 1.txt</span><span class="token class-name">Path</span> source <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"d:\\1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç»å¯¹è·¯å¾„ ä»£è¡¨äº†  d:\1.txt</span><span class="token class-name">Path</span> source <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"d:/1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç»å¯¹è·¯å¾„ åŒæ ·ä»£è¡¨äº†  d:\1.txt</span><span class="token class-name">Path</span> projects <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"d:\\data"</span><span class="token punctuation">,</span> <span class="token string">"projects"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä»£è¡¨äº†  d:\data\projects</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>.</code> ä»£è¡¨äº†å½“å‰è·¯å¾„</li><li><code>..</code> ä»£è¡¨äº†ä¸Šä¸€çº§è·¯å¾„</li></ul><p>ä¾‹å¦‚ç›®å½•ç»“æ„å¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">d:|- data|- projects|- a|- b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»£ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"d:\\data\\projects\\a\\..\\b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ­£å¸¸åŒ–è·¯å¾„</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¼šè¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">d:\data\projects\a\..\bd:\data\projects\b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="3-4-Files"><a href="#3-4-Files" class="headerlink" title="3.4 Files"></a>3.4 Files</h3><p>æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åˆ›å»ºä¸€çº§ç›®å½•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/d1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">createDirectory</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å¦‚æœç›®å½•å·²å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ FileAlreadyExistsException</li><li>ä¸èƒ½ä¸€æ¬¡åˆ›å»ºå¤šçº§ç›®å½•ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸ NoSuchFileException</li></ul><p>åˆ›å»ºå¤šçº§ç›®å½•ç”¨</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/d1/d2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">createDirectories</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ‹·è´æ–‡ä»¶</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> source <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Path</span> target <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/target.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ FileAlreadyExistsException</li></ul><p>å¦‚æœå¸Œæœ›ç”¨ source è¦†ç›–æ‰ targetï¼Œéœ€è¦ç”¨ StandardCopyOption æ¥æ§åˆ¶</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token class-name">StandardCopyOption</span><span class="token punctuation">.</span><span class="token constant">REPLACE_EXISTING</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç§»åŠ¨æ–‡ä»¶</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> source <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Path</span> target <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token class-name">StandardCopyOption</span><span class="token punctuation">.</span><span class="token constant">ATOMIC_MOVE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>StandardCopyOption.ATOMIC_MOVE ä¿è¯æ–‡ä»¶ç§»åŠ¨çš„åŸå­æ€§</li></ul><p>åˆ é™¤æ–‡ä»¶</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> target <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/target.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ NoSuchFileException</li></ul><p>åˆ é™¤ç›®å½•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> target <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/d1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å¦‚æœç›®å½•è¿˜æœ‰å†…å®¹ï¼Œä¼šæŠ›å¼‚å¸¸ DirectoryNotEmptyException</li></ul><p>éå†ç›®å½•æ–‡ä»¶</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"C:\\Program Files\\Java\\jdk1.8.0_91"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">AtomicInteger</span> dirCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">AtomicInteger</span> fileCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">walkFileTree</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SimpleFileVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Path</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token class-name">FileVisitResult</span> <span class="token function">preVisitDirectory</span><span class="token punctuation">(</span><span class="token class-name">Path</span> dir<span class="token punctuation">,</span> <span class="token class-name">BasicFileAttributes</span> attrs<span class="token punctuation">)</span>             <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>            dirCount<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">preVisitDirectory</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token class-name">FileVisitResult</span> <span class="token function">visitFile</span><span class="token punctuation">(</span><span class="token class-name">Path</span> file<span class="token punctuation">,</span> <span class="token class-name">BasicFileAttributes</span> attrs<span class="token punctuation">)</span>             <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>            fileCount<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dirCount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 133</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fileCount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1479</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»Ÿè®¡ jar çš„æ•°ç›®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"C:\\Program Files\\Java\\jdk1.8.0_91"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">AtomicInteger</span> fileCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">walkFileTree</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SimpleFileVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Path</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">FileVisitResult</span> <span class="token function">visitFile</span><span class="token punctuation">(</span><span class="token class-name">Path</span> file<span class="token punctuation">,</span> <span class="token class-name">BasicFileAttributes</span> attrs<span class="token punctuation">)</span>         <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">".jar"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            fileCount<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fileCount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 724</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ é™¤å¤šçº§ç›®å½•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"d:\\a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">walkFileTree</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SimpleFileVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Path</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">FileVisitResult</span> <span class="token function">visitFile</span><span class="token punctuation">(</span><span class="token class-name">Path</span> file<span class="token punctuation">,</span> <span class="token class-name">BasicFileAttributes</span> attrs<span class="token punctuation">)</span>         <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">FileVisitResult</span> <span class="token function">postVisitDirectory</span><span class="token punctuation">(</span><span class="token class-name">Path</span> dir<span class="token punctuation">,</span> <span class="token class-name">IOException</span> exc<span class="token punctuation">)</span>         <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">postVisitDirectory</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> exc<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="âš ï¸-åˆ é™¤å¾ˆå±é™©"><a href="#âš ï¸-åˆ é™¤å¾ˆå±é™©" class="headerlink" title="âš ï¸ åˆ é™¤å¾ˆå±é™©"></a>âš ï¸ åˆ é™¤å¾ˆå±é™©</h4><blockquote><p>åˆ é™¤æ˜¯å±é™©æ“ä½œï¼Œç¡®ä¿è¦é€’å½’åˆ é™¤çš„æ–‡ä»¶å¤¹æ²¡æœ‰é‡è¦å†…å®¹</p></blockquote><p>æ‹·è´å¤šçº§ç›®å½•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> source <span class="token operator">=</span> <span class="token string">"D:\\Snipaste-1.16.2-x64"</span><span class="token punctuation">;</span><span class="token class-name">String</span> target <span class="token operator">=</span> <span class="token string">"D:\\Snipaste-1.16.2-x64aaa"</span><span class="token punctuation">;</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>path <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> targetName <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ˜¯ç›®å½•</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">createDirectory</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>targetName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ˜¯æ™®é€šæ–‡ä»¶</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">isRegularFile</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>targetName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-ç½‘ç»œç¼–ç¨‹"><a href="#4-ç½‘ç»œç¼–ç¨‹" class="headerlink" title="4. ç½‘ç»œç¼–ç¨‹"></a>4. ç½‘ç»œç¼–ç¨‹</h2><h3 id="4-1-éé˜»å¡-vs-é˜»å¡"><a href="#4-1-éé˜»å¡-vs-é˜»å¡" class="headerlink" title="4.1 éé˜»å¡ vs é˜»å¡"></a>4.1 éé˜»å¡ vs é˜»å¡</h3><h4 id="é˜»å¡"><a href="#é˜»å¡" class="headerlink" title="é˜»å¡"></a>é˜»å¡</h4><ul><li>é˜»å¡æ¨¡å¼ä¸‹ï¼Œç›¸å…³æ–¹æ³•éƒ½ä¼šå¯¼è‡´çº¿ç¨‹æš‚åœ<ul><li>ServerSocketChannel.accept ä¼šåœ¨æ²¡æœ‰è¿æ¥å»ºç«‹æ—¶è®©çº¿ç¨‹æš‚åœ</li><li>SocketChannel.read ä¼šåœ¨æ²¡æœ‰æ•°æ®å¯è¯»æ—¶è®©çº¿ç¨‹æš‚åœ</li><li>é˜»å¡çš„è¡¨ç°å…¶å®å°±æ˜¯çº¿ç¨‹æš‚åœäº†ï¼Œæš‚åœæœŸé—´ä¸ä¼šå ç”¨ cpuï¼Œä½†çº¿ç¨‹ç›¸å½“äºé—²ç½®</li></ul></li><li>å•çº¿ç¨‹ä¸‹ï¼Œé˜»å¡æ–¹æ³•ä¹‹é—´ç›¸äº’å½±å“ï¼Œå‡ ä¹ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œéœ€è¦å¤šçº¿ç¨‹æ”¯æŒ</li><li>ä½†å¤šçº¿ç¨‹ä¸‹ï¼Œæœ‰æ–°çš„é—®é¢˜ï¼Œä½“ç°åœ¨ä»¥ä¸‹æ–¹é¢<ul><li>32 ä½ jvm ä¸€ä¸ªçº¿ç¨‹ 320kï¼Œ64 ä½ jvm ä¸€ä¸ªçº¿ç¨‹ 1024kï¼Œå¦‚æœè¿æ¥æ•°è¿‡å¤šï¼Œå¿…ç„¶å¯¼è‡´ OOMï¼Œå¹¶ä¸”çº¿ç¨‹å¤ªå¤šï¼Œåè€Œä¼šå› ä¸ºé¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´æ€§èƒ½é™ä½</li><li>å¯ä»¥é‡‡ç”¨çº¿ç¨‹æ± æŠ€æœ¯æ¥å‡å°‘çº¿ç¨‹æ•°å’Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä½†æ²»æ ‡ä¸æ²»æœ¬ï¼Œå¦‚æœæœ‰å¾ˆå¤šè¿æ¥å»ºç«‹ï¼Œä½†é•¿æ—¶é—´ inactiveï¼Œä¼šé˜»å¡çº¿ç¨‹æ± ä¸­æ‰€æœ‰çº¿ç¨‹ï¼Œå› æ­¤ä¸é€‚åˆé•¿è¿æ¥ï¼Œåªé€‚åˆçŸ­è¿æ¥</li></ul></li></ul><p>æœåŠ¡å™¨ç«¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ä½¿ç”¨ nio æ¥ç†è§£é˜»å¡æ¨¡å¼, å•çº¿ç¨‹</span><span class="token comment">// 0. ByteBuffer</span><span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1. åˆ›å»ºäº†æœåŠ¡å™¨</span><span class="token class-name">ServerSocketChannel</span> ssc <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2. ç»‘å®šç›‘å¬ç«¯å£</span>ssc<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 3. è¿æ¥é›†åˆ</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">></span></span> channels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 4. accept å»ºç«‹ä¸å®¢æˆ·ç«¯è¿æ¥ï¼Œ SocketChannel ç”¨æ¥ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡</span>    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"connecting..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> ssc<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é˜»å¡æ–¹æ³•ï¼Œçº¿ç¨‹åœæ­¢è¿è¡Œ</span>    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"connected... &#123;&#125;"</span><span class="token punctuation">,</span> sc<span class="token punctuation">)</span><span class="token punctuation">;</span>    channels<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel <span class="token operator">:</span> channels<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 5. æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"before read... &#123;&#125;"</span><span class="token punctuation">,</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>        channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é˜»å¡æ–¹æ³•ï¼Œçº¿ç¨‹åœæ­¢è¿è¡Œ</span>        buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">debugRead</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>        buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"after read...&#123;&#125;"</span><span class="token punctuation">,</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sc<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"waiting..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="éé˜»å¡"><a href="#éé˜»å¡" class="headerlink" title="éé˜»å¡"></a>éé˜»å¡</h4><ul><li>éé˜»å¡æ¨¡å¼ä¸‹ï¼Œç›¸å…³æ–¹æ³•éƒ½ä¼šä¸ä¼šè®©çº¿ç¨‹æš‚åœ<ul><li>åœ¨ ServerSocketChannel.accept åœ¨æ²¡æœ‰è¿æ¥å»ºç«‹æ—¶ï¼Œä¼šè¿”å› nullï¼Œç»§ç»­è¿è¡Œ</li><li>SocketChannel.read åœ¨æ²¡æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œä¼šè¿”å› 0ï¼Œä½†çº¿ç¨‹ä¸å¿…é˜»å¡ï¼Œå¯ä»¥å»æ‰§è¡Œå…¶å®ƒ SocketChannel çš„ read æˆ–æ˜¯å»æ‰§è¡Œ ServerSocketChannel.accept </li><li>å†™æ•°æ®æ—¶ï¼Œçº¿ç¨‹åªæ˜¯ç­‰å¾…æ•°æ®å†™å…¥ Channel å³å¯ï¼Œæ— éœ€ç­‰ Channel é€šè¿‡ç½‘ç»œæŠŠæ•°æ®å‘é€å‡ºå»</li></ul></li><li>ä½†éé˜»å¡æ¨¡å¼ä¸‹ï¼Œå³ä½¿æ²¡æœ‰è¿æ¥å»ºç«‹ï¼Œå’Œå¯è¯»æ•°æ®ï¼Œçº¿ç¨‹ä»ç„¶åœ¨ä¸æ–­è¿è¡Œï¼Œç™½ç™½æµªè´¹äº† cpu</li><li>æ•°æ®å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹å®é™…è¿˜æ˜¯é˜»å¡çš„ï¼ˆAIO æ”¹è¿›çš„åœ°æ–¹ï¼‰</li></ul><p>æœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯ä»£ç ä¸å˜</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ä½¿ç”¨ nio æ¥ç†è§£éé˜»å¡æ¨¡å¼, å•çº¿ç¨‹</span><span class="token comment">// 0. ByteBuffer</span><span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1. åˆ›å»ºäº†æœåŠ¡å™¨</span><span class="token class-name">ServerSocketChannel</span> ssc <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ssc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éé˜»å¡æ¨¡å¼</span><span class="token comment">// 2. ç»‘å®šç›‘å¬ç«¯å£</span>ssc<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 3. è¿æ¥é›†åˆ</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">></span></span> channels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 4. accept å»ºç«‹ä¸å®¢æˆ·ç«¯è¿æ¥ï¼Œ SocketChannel ç”¨æ¥ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡</span>    <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> ssc<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éé˜»å¡ï¼Œçº¿ç¨‹è¿˜ä¼šç»§ç»­è¿è¡Œï¼Œå¦‚æœæ²¡æœ‰è¿æ¥å»ºç«‹ï¼Œä½†scæ˜¯null</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>sc <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"connected... &#123;&#125;"</span><span class="token punctuation">,</span> sc<span class="token punctuation">)</span><span class="token punctuation">;</span>        sc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éé˜»å¡æ¨¡å¼</span>        channels<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel <span class="token operator">:</span> channels<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 5. æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®</span>        <span class="token keyword">int</span> read <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// éé˜»å¡ï¼Œçº¿ç¨‹ä»ç„¶ä¼šç»§ç»­è¿è¡Œï¼Œå¦‚æœæ²¡æœ‰è¯»åˆ°æ•°æ®ï¼Œread è¿”å› 0</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">debugRead</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>            buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"after read...&#123;&#125;"</span><span class="token punctuation">,</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å¤šè·¯å¤ç”¨"><a href="#å¤šè·¯å¤ç”¨" class="headerlink" title="å¤šè·¯å¤ç”¨"></a>å¤šè·¯å¤ç”¨</h4><p>å•çº¿ç¨‹å¯ä»¥é…åˆ Selector å®Œæˆå¯¹å¤šä¸ª Channel å¯è¯»å†™äº‹ä»¶çš„ç›‘æ§ï¼Œè¿™ç§°ä¹‹ä¸ºå¤šè·¯å¤ç”¨</p><ul><li>å¤šè·¯å¤ç”¨ä»…é’ˆå¯¹ç½‘ç»œ IOã€æ™®é€šæ–‡ä»¶ IO æ²¡æ³•åˆ©ç”¨å¤šè·¯å¤ç”¨</li><li>å¦‚æœä¸ç”¨ Selector çš„éé˜»å¡æ¨¡å¼ï¼Œçº¿ç¨‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨åšæ— ç”¨åŠŸï¼Œè€Œ Selector èƒ½å¤Ÿä¿è¯<ul><li>æœ‰å¯è¿æ¥äº‹ä»¶æ—¶æ‰å»è¿æ¥</li><li>æœ‰å¯è¯»äº‹ä»¶æ‰å»è¯»å–</li><li>æœ‰å¯å†™äº‹ä»¶æ‰å»å†™å…¥<ul><li>é™äºç½‘ç»œä¼ è¾“èƒ½åŠ›ï¼ŒChannel æœªå¿…æ—¶æ—¶å¯å†™ï¼Œä¸€æ—¦ Channel å¯å†™ï¼Œä¼šè§¦å‘ Selector çš„å¯å†™äº‹ä»¶</li></ul></li></ul></li></ul><h3 id="4-2-Selector"><a href="#4-2-Selector" class="headerlink" title="4.2 Selector"></a>4.2 Selector</h3><pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid"><span class="token keyword">graph</span> TD<span class="token keyword">subgraph</span> selector ç‰ˆthread <span class="token arrow operator">--></span> selectorselector <span class="token arrow operator">--></span> c1<span class="token text string">(channel)</span>selector <span class="token arrow operator">--></span> c2<span class="token text string">(channel)</span>selector <span class="token arrow operator">--></span> c3<span class="token text string">(channel)</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¥½å¤„</p><ul><li>ä¸€ä¸ªçº¿ç¨‹é…åˆ selector å°±å¯ä»¥ç›‘æ§å¤šä¸ª channel çš„äº‹ä»¶ï¼Œäº‹ä»¶å‘ç”Ÿçº¿ç¨‹æ‰å»å¤„ç†ã€‚é¿å…éé˜»å¡æ¨¡å¼ä¸‹æ‰€åšæ— ç”¨åŠŸ</li><li>è®©è¿™ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¢«å……åˆ†åˆ©ç”¨</li><li>èŠ‚çº¦äº†çº¿ç¨‹çš„æ•°é‡</li><li>å‡å°‘äº†çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</li></ul><h4 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="ç»‘å®š-Channel-äº‹ä»¶"><a href="#ç»‘å®š-Channel-äº‹ä»¶" class="headerlink" title="ç»‘å®š Channel äº‹ä»¶"></a>ç»‘å®š Channel äº‹ä»¶</h4><p>ä¹Ÿç§°ä¹‹ä¸ºæ³¨å†Œäº‹ä»¶ï¼Œç»‘å®šçš„äº‹ä»¶ selector æ‰ä¼šå…³å¿ƒ </p><pre class="line-numbers language-java" data-language="java"><code class="language-java">channel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> ç»‘å®šäº‹ä»¶<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>channel å¿…é¡»å·¥ä½œåœ¨éé˜»å¡æ¨¡å¼</li><li>FileChannel æ²¡æœ‰éé˜»å¡æ¨¡å¼ï¼Œå› æ­¤ä¸èƒ½é…åˆ selector ä¸€èµ·ä½¿ç”¨</li><li>ç»‘å®šçš„äº‹ä»¶ç±»å‹å¯ä»¥æœ‰<ul><li>connect - å®¢æˆ·ç«¯è¿æ¥æˆåŠŸæ—¶è§¦å‘</li><li>accept - æœåŠ¡å™¨ç«¯æˆåŠŸæ¥å—è¿æ¥æ—¶è§¦å‘</li><li>read - æ•°æ®å¯è¯»å…¥æ—¶è§¦å‘ï¼Œæœ‰å› ä¸ºæ¥æ”¶èƒ½åŠ›å¼±ï¼Œæ•°æ®æš‚ä¸èƒ½è¯»å…¥çš„æƒ…å†µ</li><li>write - æ•°æ®å¯å†™å‡ºæ—¶è§¦å‘ï¼Œæœ‰å› ä¸ºå‘é€èƒ½åŠ›å¼±ï¼Œæ•°æ®æš‚ä¸èƒ½å†™å‡ºçš„æƒ…å†µ</li></ul></li></ul><h4 id="ç›‘å¬-Channel-äº‹ä»¶"><a href="#ç›‘å¬-Channel-äº‹ä»¶" class="headerlink" title="ç›‘å¬ Channel äº‹ä»¶"></a>ç›‘å¬ Channel äº‹ä»¶</h4><p>å¯ä»¥é€šè¿‡ä¸‹é¢ä¸‰ç§æ–¹æ³•æ¥ç›‘å¬æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œæ–¹æ³•çš„è¿”å›å€¼ä»£è¡¨æœ‰å¤šå°‘ channel å‘ç”Ÿäº†äº‹ä»¶</p><p>æ–¹æ³•1ï¼Œé˜»å¡ç›´åˆ°ç»‘å®šäº‹ä»¶å‘ç”Ÿ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> count <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ–¹æ³•2ï¼Œé˜»å¡ç›´åˆ°ç»‘å®šäº‹ä»¶å‘ç”Ÿï¼Œæˆ–æ˜¯è¶…æ—¶ï¼ˆæ—¶é—´å•ä½ä¸º msï¼‰</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> count <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ–¹æ³•3ï¼Œä¸ä¼šé˜»å¡ï¼Œä¹Ÿå°±æ˜¯ä¸ç®¡æœ‰æ²¡æœ‰äº‹ä»¶ï¼Œç«‹åˆ»è¿”å›ï¼Œè‡ªå·±æ ¹æ®è¿”å›å€¼æ£€æŸ¥æ˜¯å¦æœ‰äº‹ä»¶</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> count <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="ğŸ’¡-select-ä½•æ—¶ä¸é˜»å¡"><a href="#ğŸ’¡-select-ä½•æ—¶ä¸é˜»å¡" class="headerlink" title="ğŸ’¡ select ä½•æ—¶ä¸é˜»å¡"></a>ğŸ’¡ select ä½•æ—¶ä¸é˜»å¡</h4><blockquote><ul><li>äº‹ä»¶å‘ç”Ÿæ—¶<ul><li>å®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚ï¼Œä¼šè§¦å‘ accept äº‹ä»¶</li><li>å®¢æˆ·ç«¯å‘é€æ•°æ®è¿‡æ¥ï¼Œå®¢æˆ·ç«¯æ­£å¸¸ã€å¼‚å¸¸å…³é—­æ—¶ï¼Œéƒ½ä¼šè§¦å‘ read äº‹ä»¶ï¼Œå¦å¤–å¦‚æœå‘é€çš„æ•°æ®å¤§äº buffer ç¼“å†²åŒºï¼Œä¼šè§¦å‘å¤šæ¬¡è¯»å–äº‹ä»¶</li><li>channel å¯å†™ï¼Œä¼šè§¦å‘ write äº‹ä»¶</li><li>åœ¨ linux ä¸‹ nio bug å‘ç”Ÿæ—¶</li></ul></li><li>è°ƒç”¨ selector.wakeup()</li><li>è°ƒç”¨ selector.close()</li><li>selector æ‰€åœ¨çº¿ç¨‹ interrupt</li></ul></blockquote><h3 id="4-3-å¤„ç†-accept-äº‹ä»¶"><a href="#4-3-å¤„ç†-accept-äº‹ä»¶" class="headerlink" title="4.3 å¤„ç† accept äº‹ä»¶"></a>4.3 å¤„ç† accept äº‹ä»¶</h3><p>å®¢æˆ·ç«¯ä»£ç ä¸º</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>            socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœåŠ¡å™¨ç«¯ä»£ç ä¸º</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelDemo6</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ServerSocketChannel</span> channel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            channel<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">int</span> count <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//                int count = selector.selectNow();</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"select count: &#123;&#125;"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//                if(count &lt;= 0) &#123;</span><span class="token comment">//                    continue;</span><span class="token comment">//                &#125;</span>                <span class="token comment">// è·å–æ‰€æœ‰äº‹ä»¶</span>                <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> keys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// éå†æ‰€æœ‰äº‹ä»¶ï¼Œé€ä¸€å¤„ç†</span>                <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> iter <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// åˆ¤æ–­äº‹ä»¶ç±»å‹</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">ServerSocketChannel</span> c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// å¿…é¡»å¤„ç†</span>                        <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> sc<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token comment">// å¤„ç†å®Œæ¯•ï¼Œå¿…é¡»å°†äº‹ä»¶ç§»é™¤</span>                    iter<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ğŸ’¡-äº‹ä»¶å‘ç”Ÿåèƒ½å¦ä¸å¤„ç†"><a href="#ğŸ’¡-äº‹ä»¶å‘ç”Ÿåèƒ½å¦ä¸å¤„ç†" class="headerlink" title="ğŸ’¡ äº‹ä»¶å‘ç”Ÿåèƒ½å¦ä¸å¤„ç†"></a>ğŸ’¡ äº‹ä»¶å‘ç”Ÿåèƒ½å¦ä¸å¤„ç†</h4><blockquote><p>äº‹ä»¶å‘ç”Ÿåï¼Œè¦ä¹ˆå¤„ç†ï¼Œè¦ä¹ˆå–æ¶ˆï¼ˆcancelï¼‰ï¼Œä¸èƒ½ä»€ä¹ˆéƒ½ä¸åšï¼Œå¦åˆ™ä¸‹æ¬¡è¯¥äº‹ä»¶ä»ä¼šè§¦å‘ï¼Œè¿™æ˜¯å› ä¸º nio åº•å±‚ä½¿ç”¨çš„æ˜¯æ°´å¹³è§¦å‘</p></blockquote><h3 id="4-4-å¤„ç†-read-äº‹ä»¶"><a href="#4-4-å¤„ç†-read-äº‹ä»¶" class="headerlink" title="4.4 å¤„ç† read äº‹ä»¶"></a>4.4 å¤„ç† read äº‹ä»¶</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelDemo6</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ServerSocketChannel</span> channel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            channel<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">int</span> count <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//                int count = selector.selectNow();</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"select count: &#123;&#125;"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//                if(count &lt;= 0) &#123;</span><span class="token comment">//                    continue;</span><span class="token comment">//                &#125;</span>                <span class="token comment">// è·å–æ‰€æœ‰äº‹ä»¶</span>                <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> keys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// éå†æ‰€æœ‰äº‹ä»¶ï¼Œé€ä¸€å¤„ç†</span>                <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> iter <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// åˆ¤æ–­äº‹ä»¶ç±»å‹</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">ServerSocketChannel</span> c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// å¿…é¡»å¤„ç†</span>                        <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        sc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        sc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"è¿æ¥å·²å»ºç«‹: &#123;&#125;"</span><span class="token punctuation">,</span> sc<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">int</span> read <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>read <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            key<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            sc<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                            buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token function">debug</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token comment">// å¤„ç†å®Œæ¯•ï¼Œå¿…é¡»å°†äº‹ä»¶ç§»é™¤</span>                    iter<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¼€å¯ä¸¤ä¸ªå®¢æˆ·ç«¯ï¼Œä¿®æ”¹ä¸€ä¸‹å‘é€æ–‡å­—ï¼Œè¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">sun.nio.ch.ServerSocketChannelImpl[&#x2F;0:0:0:0:0:0:0:0:8080]21:16:39 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 121:16:39 [DEBUG] [main] c.i.n.ChannelDemo6 - è¿æ¥å·²å»ºç«‹: java.nio.channels.SocketChannel[connected local&#x3D;&#x2F;127.0.0.1:8080 remote&#x3D;&#x2F;127.0.0.1:60367]21:16:39 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 1         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 68 65 6c 6c 6f                                  |hello           |+--------+-------------------------------------------------+----------------+21:16:59 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 121:16:59 [DEBUG] [main] c.i.n.ChannelDemo6 - è¿æ¥å·²å»ºç«‹: java.nio.channels.SocketChannel[connected local&#x3D;&#x2F;127.0.0.1:8080 remote&#x3D;&#x2F;127.0.0.1:60378]21:16:59 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 1         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 77 6f 72 6c 64                                  |world           |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ğŸ’¡-ä¸ºä½•è¦-iter-remove"><a href="#ğŸ’¡-ä¸ºä½•è¦-iter-remove" class="headerlink" title="ğŸ’¡ ä¸ºä½•è¦ iter.remove()"></a>ğŸ’¡ ä¸ºä½•è¦ iter.remove()</h4><blockquote><p>å› ä¸º select åœ¨äº‹ä»¶å‘ç”Ÿåï¼Œå°±ä¼šå°†ç›¸å…³çš„ key æ”¾å…¥ selectedKeys é›†åˆï¼Œä½†ä¸ä¼šåœ¨å¤„ç†å®Œåä» selectedKeys é›†åˆä¸­ç§»é™¤ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±ç¼–ç åˆ é™¤ã€‚ä¾‹å¦‚</p><ul><li>ç¬¬ä¸€æ¬¡è§¦å‘äº† ssckey ä¸Šçš„ accept äº‹ä»¶ï¼Œæ²¡æœ‰ç§»é™¤ ssckey </li><li>ç¬¬äºŒæ¬¡è§¦å‘äº† sckey ä¸Šçš„ read äº‹ä»¶ï¼Œä½†è¿™æ—¶ selectedKeys ä¸­è¿˜æœ‰ä¸Šæ¬¡çš„ ssckey ï¼Œåœ¨å¤„ç†æ—¶å› ä¸ºæ²¡æœ‰çœŸæ­£çš„ serverSocket è¿ä¸Šäº†ï¼Œå°±ä¼šå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸</li></ul></blockquote><h4 id="ğŸ’¡-cancel-çš„ä½œç”¨"><a href="#ğŸ’¡-cancel-çš„ä½œç”¨" class="headerlink" title="ğŸ’¡ cancel çš„ä½œç”¨"></a>ğŸ’¡ cancel çš„ä½œç”¨</h4><blockquote><p>cancel ä¼šå–æ¶ˆæ³¨å†Œåœ¨ selector ä¸Šçš„ channelï¼Œå¹¶ä» keys é›†åˆä¸­åˆ é™¤ key åç»­ä¸ä¼šå†ç›‘å¬äº‹ä»¶</p></blockquote><h4 id="âš ï¸-ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜"><a href="#âš ï¸-ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜" class="headerlink" title="âš ï¸  ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜"></a>âš ï¸  ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜</h4><p>ä»¥å‰æœ‰åŒå­¦å†™è¿‡è¿™æ ·çš„ä»£ç ï¼Œæ€è€ƒæ³¨é‡Šä¸­ä¸¤ä¸ªé—®é¢˜ï¼Œä»¥ bio ä¸ºä¾‹ï¼Œå…¶å® nio é“ç†æ˜¯ä¸€æ ·çš„</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServerSocket</span> ss<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Socket</span> s <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">InputStream</span> in <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è¿™é‡Œè¿™ä¹ˆå†™ï¼Œæœ‰æ²¡æœ‰é—®é¢˜</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">int</span> read <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// è¿™é‡Œè¿™ä¹ˆå†™ï¼Œæœ‰æ²¡æœ‰é—®é¢˜</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>read <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> read<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Socket</span> max <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> max<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"ä½ å¥½"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        max<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">helloworldï¿½ï¿½å¥½<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ºä»€ä¹ˆï¼Ÿ</p><h4 id="å¤„ç†æ¶ˆæ¯çš„è¾¹ç•Œ"><a href="#å¤„ç†æ¶ˆæ¯çš„è¾¹ç•Œ" class="headerlink" title="å¤„ç†æ¶ˆæ¯çš„è¾¹ç•Œ"></a>å¤„ç†æ¶ˆæ¯çš„è¾¹ç•Œ</h4><p><img src="/posts/0.htm/0023.png" alt></p><ul><li>ä¸€ç§æ€è·¯æ˜¯å›ºå®šæ¶ˆæ¯é•¿åº¦ï¼Œæ•°æ®åŒ…å¤§å°ä¸€æ ·ï¼ŒæœåŠ¡å™¨æŒ‰é¢„å®šé•¿åº¦è¯»å–ï¼Œç¼ºç‚¹æ˜¯æµªè´¹å¸¦å®½</li><li>å¦ä¸€ç§æ€è·¯æ˜¯æŒ‰åˆ†éš”ç¬¦æ‹†åˆ†ï¼Œç¼ºç‚¹æ˜¯æ•ˆç‡ä½</li><li>TLV æ ¼å¼ï¼Œå³ Type ç±»å‹ã€Length é•¿åº¦ã€Value æ•°æ®ï¼Œç±»å‹å’Œé•¿åº¦å·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥æ–¹ä¾¿è·å–æ¶ˆæ¯å¤§å°ï¼Œåˆ†é…åˆé€‚çš„ bufferï¼Œç¼ºç‚¹æ˜¯ buffer éœ€è¦æå‰åˆ†é…ï¼Œå¦‚æœå†…å®¹è¿‡å¤§ï¼Œåˆ™å½±å“ server ååé‡<ul><li>Http 1.1 æ˜¯ TLV æ ¼å¼</li><li>Http 2.0 æ˜¯ LTV æ ¼å¼</li></ul></li></ul><pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid"><span class="token keyword">sequenceDiagram</span> <span class="token keyword">participant</span> c1 as å®¢æˆ·ç«¯1<span class="token keyword">participant</span> s as æœåŠ¡å™¨<span class="token keyword">participant</span> b1 as ByteBuffer1<span class="token keyword">participant</span> b2 as ByteBuffer2c1 <span class="token arrow operator">->></span> s<span class="token operator">:</span> å‘é€ 01234567890abcdef3333\rs <span class="token arrow operator">->></span> b1<span class="token operator">:</span> ç¬¬ä¸€æ¬¡ read å­˜å…¥ 01234567890abcdefs <span class="token arrow operator">->></span> b2<span class="token operator">:</span> æ‰©å®¹b1 <span class="token arrow operator">->></span> b2<span class="token operator">:</span> æ‹·è´ 01234567890abcdefs <span class="token arrow operator">->></span> b2<span class="token operator">:</span> ç¬¬äºŒæ¬¡ read å­˜å…¥ 3333\rb2 <span class="token arrow operator">->></span> b2<span class="token operator">:</span> 01234567890abcdef3333\r<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœåŠ¡å™¨ç«¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> source<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    source<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> source<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// æ‰¾åˆ°ä¸€æ¡å®Œæ•´æ¶ˆæ¯</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">int</span> length <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">-</span> source<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// æŠŠè¿™æ¡å®Œæ•´æ¶ˆæ¯å­˜å…¥æ–°çš„ ByteBuffer</span>            <span class="token class-name">ByteBuffer</span> target <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// ä» source è¯»ï¼Œå‘ target å†™</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                target<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token function">debugAll</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    source<span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0123456789abcdef  position 16 limit 16</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 1. åˆ›å»º selector, ç®¡ç†å¤šä¸ª channel</span>    <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ServerSocketChannel</span> ssc <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ssc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 2. å»ºç«‹ selector å’Œ channel çš„è”ç³»ï¼ˆæ³¨å†Œï¼‰</span>    <span class="token comment">// SelectionKey å°±æ˜¯å°†æ¥äº‹ä»¶å‘ç”Ÿåï¼Œé€šè¿‡å®ƒå¯ä»¥çŸ¥é“äº‹ä»¶å’Œå“ªä¸ªchannelçš„äº‹ä»¶</span>    <span class="token class-name">SelectionKey</span> sscKey <span class="token operator">=</span> ssc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// key åªå…³æ³¨ accept äº‹ä»¶</span>    sscKey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"sscKey:&#123;&#125;"</span><span class="token punctuation">,</span> sscKey<span class="token punctuation">)</span><span class="token punctuation">;</span>    ssc<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 3. select æ–¹æ³•, æ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œçº¿ç¨‹é˜»å¡ï¼Œæœ‰äº‹ä»¶ï¼Œçº¿ç¨‹æ‰ä¼šæ¢å¤è¿è¡Œ</span>        <span class="token comment">// select åœ¨äº‹ä»¶æœªå¤„ç†æ—¶ï¼Œå®ƒä¸ä¼šé˜»å¡, äº‹ä»¶å‘ç”Ÿåè¦ä¹ˆå¤„ç†ï¼Œè¦ä¹ˆå–æ¶ˆï¼Œä¸èƒ½ç½®ä¹‹ä¸ç†</span>        selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 4. å¤„ç†äº‹ä»¶, selectedKeys å†…éƒ¨åŒ…å«äº†æ‰€æœ‰å‘ç”Ÿçš„äº‹ä»¶</span>        <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> iter <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// accept, read</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å¤„ç†key æ—¶ï¼Œè¦ä» selectedKeys é›†åˆä¸­åˆ é™¤ï¼Œå¦åˆ™ä¸‹æ¬¡å¤„ç†å°±ä¼šæœ‰é—®é¢˜</span>            iter<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"key: &#123;&#125;"</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 5. åŒºåˆ†äº‹ä»¶ç±»å‹</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// å¦‚æœæ˜¯ accept</span>                <span class="token class-name">ServerSocketChannel</span> channel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                sc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// attachment</span>                <span class="token comment">// å°†ä¸€ä¸ª byteBuffer ä½œä¸ºé™„ä»¶å…³è”åˆ° selectionKey ä¸Š</span>                <span class="token class-name">SelectionKey</span> scKey <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                scKey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> sc<span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"scKey:&#123;&#125;"</span><span class="token punctuation">,</span> scKey<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// å¦‚æœæ˜¯ read</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">SocketChannel</span> channel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‹¿åˆ°è§¦å‘äº‹ä»¶çš„channel</span>                    <span class="token comment">// è·å– selectionKey ä¸Šå…³è”çš„é™„ä»¶</span>                    <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">int</span> read <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¦‚æœæ˜¯æ­£å¸¸æ–­å¼€ï¼Œread çš„æ–¹æ³•çš„è¿”å›å€¼æ˜¯ -1</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>read <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        key<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                        <span class="token function">split</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// éœ€è¦æ‰©å®¹</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            <span class="token class-name">ByteBuffer</span> newBuffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            newBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0123456789abcdef3333\n</span>                            key<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>newBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    key<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å› ä¸ºå®¢æˆ·ç«¯æ–­å¼€äº†,å› æ­¤éœ€è¦å°† key å–æ¶ˆï¼ˆä» selector çš„ keys é›†åˆä¸­çœŸæ­£åˆ é™¤ keyï¼‰</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sc<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">SocketAddress</span> address <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">getLocalAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// sc.write(Charset.defaultCharset().encode("hello\nworld\n"));</span>sc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"0123\n456789abcdef"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"0123456789abcdef3333\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ByteBuffer-å¤§å°åˆ†é…"><a href="#ByteBuffer-å¤§å°åˆ†é…" class="headerlink" title="ByteBuffer å¤§å°åˆ†é…"></a>ByteBuffer å¤§å°åˆ†é…</h4><ul><li>æ¯ä¸ª channel éƒ½éœ€è¦è®°å½•å¯èƒ½è¢«åˆ‡åˆ†çš„æ¶ˆæ¯ï¼Œå› ä¸º ByteBuffer ä¸èƒ½è¢«å¤šä¸ª channel å…±åŒä½¿ç”¨ï¼Œå› æ­¤éœ€è¦ä¸ºæ¯ä¸ª channel ç»´æŠ¤ä¸€ä¸ªç‹¬ç«‹çš„ ByteBuffer</li><li>ByteBuffer ä¸èƒ½å¤ªå¤§ï¼Œæ¯”å¦‚ä¸€ä¸ª ByteBuffer 1Mb çš„è¯ï¼Œè¦æ”¯æŒç™¾ä¸‡è¿æ¥å°±è¦ 1Tb å†…å­˜ï¼Œå› æ­¤éœ€è¦è®¾è®¡å¤§å°å¯å˜çš„ ByteBuffer<ul><li>ä¸€ç§æ€è·¯æ˜¯é¦–å…ˆåˆ†é…ä¸€ä¸ªè¾ƒå°çš„ bufferï¼Œä¾‹å¦‚ 4kï¼Œå¦‚æœå‘ç°æ•°æ®ä¸å¤Ÿï¼Œå†åˆ†é… 8k çš„ bufferï¼Œå°† 4k buffer å†…å®¹æ‹·è´è‡³ 8k bufferï¼Œä¼˜ç‚¹æ˜¯æ¶ˆæ¯è¿ç»­å®¹æ˜“å¤„ç†ï¼Œç¼ºç‚¹æ˜¯æ•°æ®æ‹·è´è€—è´¹æ€§èƒ½ï¼Œå‚è€ƒå®ç° <a href="http://tutorials.jenkov.com/java-performance/resizable-array.html">http://tutorials.jenkov.com/java-performance/resizable-array.html</a></li><li>å¦ä¸€ç§æ€è·¯æ˜¯ç”¨å¤šä¸ªæ•°ç»„ç»„æˆ bufferï¼Œä¸€ä¸ªæ•°ç»„ä¸å¤Ÿï¼ŒæŠŠå¤šå‡ºæ¥çš„å†…å®¹å†™å…¥æ–°çš„æ•°ç»„ï¼Œä¸å‰é¢çš„åŒºåˆ«æ˜¯æ¶ˆæ¯å­˜å‚¨ä¸è¿ç»­è§£æå¤æ‚ï¼Œä¼˜ç‚¹æ˜¯é¿å…äº†æ‹·è´å¼•èµ·çš„æ€§èƒ½æŸè€—</li></ul></li></ul><h3 id="4-5-å¤„ç†-write-äº‹ä»¶"><a href="#4-5-å¤„ç†-write-äº‹ä»¶" class="headerlink" title="4.5 å¤„ç† write äº‹ä»¶"></a>4.5 å¤„ç† write äº‹ä»¶</h3><h4 id="ä¸€æ¬¡æ— æ³•å†™å®Œä¾‹å­"><a href="#ä¸€æ¬¡æ— æ³•å†™å®Œä¾‹å­" class="headerlink" title="ä¸€æ¬¡æ— æ³•å†™å®Œä¾‹å­"></a>ä¸€æ¬¡æ— æ³•å†™å®Œä¾‹å­</h4><ul><li>éé˜»å¡æ¨¡å¼ä¸‹ï¼Œæ— æ³•ä¿è¯æŠŠ buffer ä¸­æ‰€æœ‰æ•°æ®éƒ½å†™å…¥ channelï¼Œå› æ­¤éœ€è¦è¿½è¸ª write æ–¹æ³•çš„è¿”å›å€¼ï¼ˆä»£è¡¨å®é™…å†™å…¥å­—èŠ‚æ•°ï¼‰</li><li>ç”¨ selector ç›‘å¬æ‰€æœ‰ channel çš„å¯å†™äº‹ä»¶ï¼Œæ¯ä¸ª channel éƒ½éœ€è¦ä¸€ä¸ª key æ¥è·Ÿè¸ª bufferï¼Œä½†è¿™æ ·åˆä¼šå¯¼è‡´å ç”¨å†…å­˜è¿‡å¤šï¼Œå°±æœ‰ä¸¤é˜¶æ®µç­–ç•¥<ul><li>å½“æ¶ˆæ¯å¤„ç†å™¨ç¬¬ä¸€æ¬¡å†™å…¥æ¶ˆæ¯æ—¶ï¼Œæ‰å°† channel æ³¨å†Œåˆ° selector ä¸Š</li><li>selector æ£€æŸ¥ channel ä¸Šçš„å¯å†™äº‹ä»¶ï¼Œå¦‚æœæ‰€æœ‰çš„æ•°æ®å†™å®Œäº†ï¼Œå°±å–æ¶ˆ channel çš„æ³¨å†Œ</li><li>å¦‚æœä¸å–æ¶ˆï¼Œä¼šæ¯æ¬¡å¯å†™å‡ä¼šè§¦å‘ write äº‹ä»¶</li></ul></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WriteServer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServerSocketChannel</span> ssc <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> iter <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                iter<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> ssc<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    sc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">SelectionKey</span> sckey <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// 1. å‘å®¢æˆ·ç«¯å‘é€å†…å®¹</span>                    <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">int</span> write <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// 3. write è¡¨ç¤ºå®é™…å†™äº†å¤šå°‘å­—èŠ‚</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å®é™…å†™å…¥å­—èŠ‚:"</span> <span class="token operator">+</span> write<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// 4. å¦‚æœæœ‰å‰©ä½™æœªè¯»å­—èŠ‚ï¼Œæ‰éœ€è¦å…³æ³¨å†™äº‹ä»¶</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token comment">// read 1  write 4</span>                        <span class="token comment">// åœ¨åŸæœ‰å…³æ³¨äº‹ä»¶çš„åŸºç¡€ä¸Šï¼Œå¤šå…³æ³¨ å†™äº‹ä»¶</span>                        sckey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span>sckey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_WRITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// æŠŠ buffer ä½œä¸ºé™„ä»¶åŠ å…¥ sckey</span>                        sckey<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">int</span> write <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å®é™…å†™å…¥å­—èŠ‚:"</span> <span class="token operator">+</span> write<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>buffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// å†™å®Œäº†</span>                        key<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_WRITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        key<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WriteClient</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_CONNECT</span> <span class="token operator">|</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sc<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> iter <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                iter<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isConnectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sc<span class="token punctuation">.</span><span class="token function">finishConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    count <span class="token operator">+=</span> sc<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                    buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ğŸ’¡-write-ä¸ºä½•è¦å–æ¶ˆ"><a href="#ğŸ’¡-write-ä¸ºä½•è¦å–æ¶ˆ" class="headerlink" title="ğŸ’¡ write ä¸ºä½•è¦å–æ¶ˆ"></a>ğŸ’¡ write ä¸ºä½•è¦å–æ¶ˆ</h4><p>åªè¦å‘ channel å‘é€æ•°æ®æ—¶ï¼Œsocket ç¼“å†²å¯å†™ï¼Œè¿™ä¸ªäº‹ä»¶ä¼šé¢‘ç¹è§¦å‘ï¼Œå› æ­¤åº”å½“åªåœ¨ socket ç¼“å†²åŒºå†™ä¸ä¸‹æ—¶å†å…³æ³¨å¯å†™äº‹ä»¶ï¼Œæ•°æ®å†™å®Œä¹‹åå†å–æ¶ˆå…³æ³¨</p><h3 id="4-6-æ›´è¿›ä¸€æ­¥"><a href="#4-6-æ›´è¿›ä¸€æ­¥" class="headerlink" title="4.6 æ›´è¿›ä¸€æ­¥"></a>4.6 æ›´è¿›ä¸€æ­¥</h3><h4 id="ğŸ’¡-åˆ©ç”¨å¤šçº¿ç¨‹ä¼˜åŒ–"><a href="#ğŸ’¡-åˆ©ç”¨å¤šçº¿ç¨‹ä¼˜åŒ–" class="headerlink" title="ğŸ’¡ åˆ©ç”¨å¤šçº¿ç¨‹ä¼˜åŒ–"></a>ğŸ’¡ åˆ©ç”¨å¤šçº¿ç¨‹ä¼˜åŒ–</h4><blockquote><p>ç°åœ¨éƒ½æ˜¯å¤šæ ¸ cpuï¼Œè®¾è®¡æ—¶è¦å……åˆ†è€ƒè™‘åˆ«è®© cpu çš„åŠ›é‡è¢«ç™½ç™½æµªè´¹</p></blockquote><p>å‰é¢çš„ä»£ç åªæœ‰ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œæ²¡æœ‰å……åˆ†åˆ©ç”¨å¤šæ ¸ cpuï¼Œå¦‚ä½•æ”¹è¿›å‘¢ï¼Ÿ</p><p>åˆ†ä¸¤ç»„é€‰æ‹©å™¨</p><ul><li>å•çº¿ç¨‹é…ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œä¸“é—¨å¤„ç† accept äº‹ä»¶</li><li>åˆ›å»º cpu æ ¸å¿ƒæ•°çš„çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹é…ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œè½®æµå¤„ç† read äº‹ä»¶</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelDemo7</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">new</span> <span class="token class-name">BossEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Slf4j</span>    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">BossEventLoop</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token class-name">Selector</span> boss<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token class-name">WorkerEventLoop</span><span class="token punctuation">[</span><span class="token punctuation">]</span> workers<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> start <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token class-name">AtomicInteger</span> index <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>start<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">ServerSocketChannel</span> ssc <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                ssc<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                ssc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                boss <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">SelectionKey</span> ssckey <span class="token operator">=</span> ssc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>boss<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                ssckey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                workers <span class="token operator">=</span> <span class="token function">initEventLoops</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"boss"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"boss start..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                start <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token class-name">WorkerEventLoop</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">initEventLoops</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//        EventLoop[] eventLoops = new EventLoop[Runtime.getRuntime().availableProcessors()];</span>            <span class="token class-name">WorkerEventLoop</span><span class="token punctuation">[</span><span class="token punctuation">]</span> workerEventLoops <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WorkerEventLoop</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> workerEventLoops<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                workerEventLoops<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WorkerEventLoop</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> workerEventLoops<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    boss<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> iter <span class="token operator">=</span> boss<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        iter<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            <span class="token class-name">ServerSocketChannel</span> c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            sc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; connected"</span><span class="token punctuation">,</span> sc<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            workers<span class="token punctuation">[</span>index<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> workers<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Slf4j</span>    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WorkerEventLoop</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token class-name">Selector</span> worker<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> start <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">int</span> index<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ConcurrentLinkedQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span> tasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentLinkedQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">WorkerEventLoop</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">=</span> index<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> sc<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>start<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                worker <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"worker-"</span> <span class="token operator">+</span> index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                start <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            tasks<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">SelectionKey</span> sckey <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>worker<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    sckey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    worker<span class="token punctuation">.</span><span class="token function">selectNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            worker<span class="token punctuation">.</span><span class="token function">wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    worker<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">Runnable</span> task <span class="token operator">=</span> tasks<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>task <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        task<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> keys <span class="token operator">=</span> worker<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> iter <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                                <span class="token keyword">int</span> read <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                    key<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    sc<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                                    buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; message:"</span><span class="token punctuation">,</span> sc<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token function">debugAll</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token punctuation">&#125;</span>                            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                key<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                sc<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                        <span class="token punctuation">&#125;</span>                        iter<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ğŸ’¡-å¦‚ä½•æ‹¿åˆ°-cpu-ä¸ªæ•°"><a href="#ğŸ’¡-å¦‚ä½•æ‹¿åˆ°-cpu-ä¸ªæ•°" class="headerlink" title="ğŸ’¡ å¦‚ä½•æ‹¿åˆ° cpu ä¸ªæ•°"></a>ğŸ’¡ å¦‚ä½•æ‹¿åˆ° cpu ä¸ªæ•°</h4><blockquote><ul><li>Runtime.getRuntime().availableProcessors() å¦‚æœå·¥ä½œåœ¨ docker å®¹å™¨ä¸‹ï¼Œå› ä¸ºå®¹å™¨ä¸æ˜¯ç‰©ç†éš”ç¦»çš„ï¼Œä¼šæ‹¿åˆ°ç‰©ç† cpu ä¸ªæ•°ï¼Œè€Œä¸æ˜¯å®¹å™¨ç”³è¯·æ—¶çš„ä¸ªæ•°</li><li>è¿™ä¸ªé—®é¢˜ç›´åˆ° jdk 10 æ‰ä¿®å¤ï¼Œä½¿ç”¨ jvm å‚æ•° UseContainerSupport é…ç½®ï¼Œ é»˜è®¤å¼€å¯</li></ul></blockquote><h3 id="4-7-UDP"><a href="#4-7-UDP" class="headerlink" title="4.7 UDP"></a>4.7 UDP</h3><ul><li>UDP æ˜¯æ— è¿æ¥çš„ï¼Œclient å‘é€æ•°æ®ä¸ä¼šç®¡ server æ˜¯å¦å¼€å¯</li><li>server è¿™è¾¹çš„ receive æ–¹æ³•ä¼šå°†æ¥æ”¶åˆ°çš„æ•°æ®å­˜å…¥ byte bufferï¼Œä½†å¦‚æœæ•°æ®æŠ¥æ–‡è¶…è¿‡ buffer å¤§å°ï¼Œå¤šå‡ºæ¥çš„æ•°æ®ä¼šè¢«é»˜é»˜æŠ›å¼ƒ</li></ul><p>é¦–å…ˆå¯åŠ¨æœåŠ¡å™¨ç«¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UdpServer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">DatagramChannel</span> channel <span class="token operator">=</span> <span class="token class-name">DatagramChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            channel<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"waiting..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>            buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">debug</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">waiting...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿è¡Œå®¢æˆ·ç«¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UdpClient</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">DatagramChannel</span> channel <span class="token operator">=</span> <span class="token class-name">DatagramChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">InetSocketAddress</span> address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥æœåŠ¡å™¨ç«¯è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 68 65 6c 6c 6f                                  |hello           |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-NIO-vs-BIO"><a href="#5-NIO-vs-BIO" class="headerlink" title="5. NIO vs BIO"></a>5. NIO vs BIO</h2><h3 id="5-1-stream-vs-channel"><a href="#5-1-stream-vs-channel" class="headerlink" title="5.1 stream vs channel"></a>5.1 stream vs channel</h3><ul><li>stream ä¸ä¼šè‡ªåŠ¨ç¼“å†²æ•°æ®ï¼Œchannel ä¼šåˆ©ç”¨ç³»ç»Ÿæä¾›çš„å‘é€ç¼“å†²åŒºã€æ¥æ”¶ç¼“å†²åŒºï¼ˆæ›´ä¸ºåº•å±‚ï¼‰</li><li>stream ä»…æ”¯æŒé˜»å¡ APIï¼Œchannel åŒæ—¶æ”¯æŒé˜»å¡ã€éé˜»å¡ APIï¼Œç½‘ç»œ channel å¯é…åˆ selector å®ç°å¤šè·¯å¤ç”¨</li><li>äºŒè€…å‡ä¸ºå…¨åŒå·¥ï¼Œå³è¯»å†™å¯ä»¥åŒæ—¶è¿›è¡Œ</li></ul><h3 id="5-2-IO-æ¨¡å‹"><a href="#5-2-IO-æ¨¡å‹" class="headerlink" title="5.2 IO æ¨¡å‹"></a>5.2 IO æ¨¡å‹</h3><p>åŒæ­¥é˜»å¡ã€åŒæ­¥éé˜»å¡ã€åŒæ­¥å¤šè·¯å¤ç”¨ã€å¼‚æ­¥é˜»å¡ï¼ˆæ²¡æœ‰æ­¤æƒ…å†µï¼‰ã€å¼‚æ­¥éé˜»å¡</p><ul><li>åŒæ­¥ï¼šçº¿ç¨‹è‡ªå·±å»è·å–ç»“æœï¼ˆä¸€ä¸ªçº¿ç¨‹ï¼‰</li><li>å¼‚æ­¥ï¼šçº¿ç¨‹è‡ªå·±ä¸å»è·å–ç»“æœï¼Œè€Œæ˜¯ç”±å…¶å®ƒçº¿ç¨‹é€ç»“æœï¼ˆè‡³å°‘ä¸¤ä¸ªçº¿ç¨‹ï¼‰</li></ul><p>å½“è°ƒç”¨ä¸€æ¬¡ channel.read æˆ– stream.read åï¼Œä¼šåˆ‡æ¢è‡³æ“ä½œç³»ç»Ÿå†…æ ¸æ€æ¥å®ŒæˆçœŸæ­£æ•°æ®è¯»å–ï¼Œè€Œè¯»å–åˆåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«ä¸ºï¼š</p><ul><li>ç­‰å¾…æ•°æ®é˜¶æ®µ</li><li>å¤åˆ¶æ•°æ®é˜¶æ®µ</li></ul><p><img src="/posts/0.htm/0033.png" alt></p><ul><li><p>é˜»å¡ IO</p><p><img src="/posts/0.htm/0039.png" alt></p></li><li><p>éé˜»å¡  IO</p><p><img src="/posts/0.htm/0035.png" alt></p></li><li><p>å¤šè·¯å¤ç”¨</p><p><img src="/posts/0.htm/0038.png" alt></p></li><li><p>ä¿¡å·é©±åŠ¨</p></li><li><p>å¼‚æ­¥ IO</p><p><img src="/posts/0.htm/0037.png" alt></p></li><li><p>é˜»å¡ IO vs å¤šè·¯å¤ç”¨</p><p><img src="/posts/0.htm/0034.png" alt></p><p><img src="/posts/0.htm/0036.png" alt></p></li></ul><h4 id="ğŸ”–-å‚è€ƒ"><a href="#ğŸ”–-å‚è€ƒ" class="headerlink" title="ğŸ”– å‚è€ƒ"></a>ğŸ”– å‚è€ƒ</h4><p>UNIX ç½‘ç»œç¼–ç¨‹ - å· I</p><h3 id="5-3-é›¶æ‹·è´"><a href="#5-3-é›¶æ‹·è´" class="headerlink" title="5.3 é›¶æ‹·è´"></a>5.3 é›¶æ‹·è´</h3><h4 id="ä¼ ç»Ÿ-IO-é—®é¢˜"><a href="#ä¼ ç»Ÿ-IO-é—®é¢˜" class="headerlink" title="ä¼ ç»Ÿ IO é—®é¢˜"></a>ä¼ ç»Ÿ IO é—®é¢˜</h4><p>ä¼ ç»Ÿçš„ IO å°†ä¸€ä¸ªæ–‡ä»¶é€šè¿‡ socket å†™å‡º</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"helloword/data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">RandomAccessFile</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>file<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†…éƒ¨å·¥ä½œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/posts/0.htm/0024.png" alt></p><ol><li><p>java æœ¬èº«å¹¶ä¸å…·å¤‡ IO è¯»å†™èƒ½åŠ›ï¼Œå› æ­¤ read æ–¹æ³•è°ƒç”¨åï¼Œè¦ä» java ç¨‹åºçš„<strong>ç”¨æˆ·æ€</strong>åˆ‡æ¢è‡³<strong>å†…æ ¸æ€</strong>ï¼Œå»è°ƒç”¨æ“ä½œç³»ç»Ÿï¼ˆKernelï¼‰çš„è¯»èƒ½åŠ›ï¼Œå°†æ•°æ®è¯»å…¥<strong>å†…æ ¸ç¼“å†²åŒº</strong>ã€‚è¿™æœŸé—´ç”¨æˆ·çº¿ç¨‹é˜»å¡ï¼Œæ“ä½œç³»ç»Ÿä½¿ç”¨ DMAï¼ˆDirect Memory Accessï¼‰æ¥å®ç°æ–‡ä»¶è¯»ï¼Œå…¶é—´ä¹Ÿä¸ä¼šä½¿ç”¨ cpu</p><blockquote><p>DMA ä¹Ÿå¯ä»¥ç†è§£ä¸ºç¡¬ä»¶å•å…ƒï¼Œç”¨æ¥è§£æ”¾ cpu å®Œæˆæ–‡ä»¶ IO</p></blockquote></li><li><p>ä»<strong>å†…æ ¸æ€</strong>åˆ‡æ¢å›<strong>ç”¨æˆ·æ€</strong>ï¼Œå°†æ•°æ®ä»<strong>å†…æ ¸ç¼“å†²åŒº</strong>è¯»å…¥<strong>ç”¨æˆ·ç¼“å†²åŒº</strong>ï¼ˆå³ byte[] bufï¼‰ï¼Œè¿™æœŸé—´ cpu ä¼šå‚ä¸æ‹·è´ï¼Œæ— æ³•åˆ©ç”¨ DMA</p></li><li><p>è°ƒç”¨ write æ–¹æ³•ï¼Œè¿™æ—¶å°†æ•°æ®ä»<strong>ç”¨æˆ·ç¼“å†²åŒº</strong>ï¼ˆbyte[] bufï¼‰å†™å…¥ <strong>socket ç¼“å†²åŒº</strong>ï¼Œcpu ä¼šå‚ä¸æ‹·è´</p></li><li><p>æ¥ä¸‹æ¥è¦å‘ç½‘å¡å†™æ•°æ®ï¼Œè¿™é¡¹èƒ½åŠ› java åˆä¸å…·å¤‡ï¼Œå› æ­¤åˆå¾—ä»<strong>ç”¨æˆ·æ€</strong>åˆ‡æ¢è‡³<strong>å†…æ ¸æ€</strong>ï¼Œè°ƒç”¨æ“ä½œç³»ç»Ÿçš„å†™èƒ½åŠ›ï¼Œä½¿ç”¨ DMA å°† <strong>socket ç¼“å†²åŒº</strong>çš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œä¸ä¼šä½¿ç”¨ cpu</p></li></ol><p>å¯ä»¥çœ‹åˆ°ä¸­é—´ç¯èŠ‚è¾ƒå¤šï¼Œjava çš„ IO å®é™…ä¸æ˜¯ç‰©ç†è®¾å¤‡çº§åˆ«çš„è¯»å†™ï¼Œè€Œæ˜¯ç¼“å­˜çš„å¤åˆ¶ï¼Œåº•å±‚çš„çœŸæ­£è¯»å†™æ˜¯æ“ä½œç³»ç»Ÿæ¥å®Œæˆçš„</p><ul><li>ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢å‘ç”Ÿäº† 3 æ¬¡ï¼Œè¿™ä¸ªæ“ä½œæ¯”è¾ƒé‡é‡çº§</li><li>æ•°æ®æ‹·è´äº†å…± 4 æ¬¡</li></ul><h4 id="NIO-ä¼˜åŒ–"><a href="#NIO-ä¼˜åŒ–" class="headerlink" title="NIO ä¼˜åŒ–"></a>NIO ä¼˜åŒ–</h4><p>é€šè¿‡ DirectByteBuf </p><ul><li>ByteBuffer.allocate(10)  HeapByteBuffer ä½¿ç”¨çš„è¿˜æ˜¯ java å†…å­˜</li><li>ByteBuffer.allocateDirect(10)  DirectByteBuffer ä½¿ç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿå†…å­˜</li></ul><p><img src="/posts/0.htm/0025.png" alt></p><p>å¤§éƒ¨åˆ†æ­¥éª¤ä¸ä¼˜åŒ–å‰ç›¸åŒï¼Œä¸å†èµ˜è¿°ã€‚å”¯æœ‰ä¸€ç‚¹ï¼šjava å¯ä»¥ä½¿ç”¨ DirectByteBuf å°†å †å¤–å†…å­˜æ˜ å°„åˆ° jvm å†…å­˜ä¸­æ¥ç›´æ¥è®¿é—®ä½¿ç”¨</p><ul><li>è¿™å—å†…å­˜ä¸å— jvm åƒåœ¾å›æ”¶çš„å½±å“ï¼Œå› æ­¤å†…å­˜åœ°å€å›ºå®šï¼Œæœ‰åŠ©äº IO è¯»å†™</li><li>java ä¸­çš„ DirectByteBuf å¯¹è±¡ä»…ç»´æŠ¤äº†æ­¤å†…å­˜çš„è™šå¼•ç”¨ï¼Œå†…å­˜å›æ”¶åˆ†æˆä¸¤æ­¥<ul><li>DirectByteBuf å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼Œå°†è™šå¼•ç”¨åŠ å…¥å¼•ç”¨é˜Ÿåˆ—</li><li>é€šè¿‡ä¸“é—¨çº¿ç¨‹è®¿é—®å¼•ç”¨é˜Ÿåˆ—ï¼Œæ ¹æ®è™šå¼•ç”¨é‡Šæ”¾å †å¤–å†…å­˜</li></ul></li><li>å‡å°‘äº†ä¸€æ¬¡æ•°æ®æ‹·è´ï¼Œç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢æ¬¡æ•°æ²¡æœ‰å‡å°‘</li></ul><p>è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆåº•å±‚é‡‡ç”¨äº† linux 2.1 åæä¾›çš„ sendFile æ–¹æ³•ï¼‰ï¼Œjava ä¸­å¯¹åº”ç€ä¸¤ä¸ª channel è°ƒç”¨ transferTo/transferFrom æ–¹æ³•æ‹·è´æ•°æ®</p><p><img src="/posts/0.htm/0026.png" alt></p><ol><li>java è°ƒç”¨ transferTo æ–¹æ³•åï¼Œè¦ä» java ç¨‹åºçš„<strong>ç”¨æˆ·æ€</strong>åˆ‡æ¢è‡³<strong>å†…æ ¸æ€</strong>ï¼Œä½¿ç”¨ DMAå°†æ•°æ®è¯»å…¥<strong>å†…æ ¸ç¼“å†²åŒº</strong>ï¼Œä¸ä¼šä½¿ç”¨ cpu</li><li>æ•°æ®ä»<strong>å†…æ ¸ç¼“å†²åŒº</strong>ä¼ è¾“åˆ° <strong>socket ç¼“å†²åŒº</strong>ï¼Œcpu ä¼šå‚ä¸æ‹·è´</li><li>æœ€åä½¿ç”¨ DMA å°† <strong>socket ç¼“å†²åŒº</strong>çš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œä¸ä¼šä½¿ç”¨ cpu</li></ol><p>å¯ä»¥çœ‹åˆ°</p><ul><li>åªå‘ç”Ÿäº†ä¸€æ¬¡ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢</li><li>æ•°æ®æ‹·è´äº† 3 æ¬¡</li></ul><p>è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆlinux 2.4ï¼‰</p><p><img src="/posts/0.htm/0027.png" alt></p><ol><li>java è°ƒç”¨ transferTo æ–¹æ³•åï¼Œè¦ä» java ç¨‹åºçš„<strong>ç”¨æˆ·æ€</strong>åˆ‡æ¢è‡³<strong>å†…æ ¸æ€</strong>ï¼Œä½¿ç”¨ DMAå°†æ•°æ®è¯»å…¥<strong>å†…æ ¸ç¼“å†²åŒº</strong>ï¼Œä¸ä¼šä½¿ç”¨ cpu</li><li>åªä¼šå°†ä¸€äº› offset å’Œ length ä¿¡æ¯æ‹·å…¥ <strong>socket ç¼“å†²åŒº</strong>ï¼Œå‡ ä¹æ— æ¶ˆè€—</li><li>ä½¿ç”¨ DMA å°† <strong>å†…æ ¸ç¼“å†²åŒº</strong>çš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œä¸ä¼šä½¿ç”¨ cpu</li></ol><p>æ•´ä¸ªè¿‡ç¨‹ä»…åªå‘ç”Ÿäº†ä¸€æ¬¡ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢ï¼Œæ•°æ®æ‹·è´äº† 2 æ¬¡ã€‚æ‰€è°“çš„ã€é›¶æ‹·è´ã€‘ï¼Œå¹¶ä¸æ˜¯çœŸæ­£æ— æ‹·è´ï¼Œè€Œæ˜¯åœ¨ä¸ä¼šæ‹·è´é‡å¤æ•°æ®åˆ° jvm å†…å­˜ä¸­ï¼Œé›¶æ‹·è´çš„ä¼˜ç‚¹æœ‰</p><ul><li>æ›´å°‘çš„ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢</li><li>ä¸åˆ©ç”¨ cpu è®¡ç®—ï¼Œå‡å°‘ cpu ç¼“å­˜ä¼ªå…±äº«</li><li>é›¶æ‹·è´é€‚åˆå°æ–‡ä»¶ä¼ è¾“</li></ul><h3 id="5-3-AIO"><a href="#5-3-AIO" class="headerlink" title="5.3 AIO"></a>5.3 AIO</h3><p>AIO ç”¨æ¥è§£å†³æ•°æ®å¤åˆ¶é˜¶æ®µçš„é˜»å¡é—®é¢˜</p><ul><li>åŒæ­¥æ„å‘³ç€ï¼Œåœ¨è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œçº¿ç¨‹éœ€è¦ç­‰å¾…ç»“æœï¼Œè¿˜æ˜¯ç›¸å½“äºé—²ç½®</li><li>å¼‚æ­¥æ„å‘³ç€ï¼Œåœ¨è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œçº¿ç¨‹ä¸å¿…ç­‰å¾…ç»“æœï¼Œè€Œæ˜¯å°†æ¥ç”±æ“ä½œç³»ç»Ÿæ¥é€šè¿‡å›è°ƒæ–¹å¼ç”±å¦å¤–çš„çº¿ç¨‹æ¥è·å¾—ç»“æœ</li></ul><blockquote><p>å¼‚æ­¥æ¨¡å‹éœ€è¦åº•å±‚æ“ä½œç³»ç»Ÿï¼ˆKernelï¼‰æä¾›æ”¯æŒ</p><ul><li>Windows ç³»ç»Ÿé€šè¿‡ IOCP å®ç°äº†çœŸæ­£çš„å¼‚æ­¥ IO</li><li>Linux ç³»ç»Ÿå¼‚æ­¥ IO åœ¨ 2.6 ç‰ˆæœ¬å¼•å…¥ï¼Œä½†å…¶åº•å±‚å®ç°è¿˜æ˜¯ç”¨å¤šè·¯å¤ç”¨æ¨¡æ‹Ÿäº†å¼‚æ­¥ IOï¼Œæ€§èƒ½æ²¡æœ‰ä¼˜åŠ¿</li></ul></blockquote><h4 id="æ–‡ä»¶-AIO"><a href="#æ–‡ä»¶-AIO" class="headerlink" title="æ–‡ä»¶ AIO"></a>æ–‡ä»¶ AIO</h4><p>å…ˆæ¥çœ‹çœ‹ AsynchronousFileChannel</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AioDemo1</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>            <span class="token class-name">AsynchronousFileChannel</span> s <span class="token operator">=</span>                 <span class="token class-name">AsynchronousFileChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span>                <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StandardOpenOption</span><span class="token punctuation">.</span><span class="token constant">READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"begin..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            s<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CompletionHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completed</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> result<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> attachment<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"read completed...&#123;&#125;"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>                    buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token function">debug</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">failed</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> exc<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> attachment<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"read failed..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"do other things..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">13:44:56 [DEBUG] [main] c.i.aio.AioDemo1 - begin...13:44:56 [DEBUG] [main] c.i.aio.AioDemo1 - do other things...13:44:56 [DEBUG] [Thread-5] c.i.aio.AioDemo1 - read completed...2         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 61 0d                                           |a.              |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°</p><ul><li>å“åº”æ–‡ä»¶è¯»å–æˆåŠŸçš„æ˜¯å¦ä¸€ä¸ªçº¿ç¨‹ Thread-5</li><li>ä¸»çº¿ç¨‹å¹¶æ²¡æœ‰ IO æ“ä½œé˜»å¡</li></ul><h4 id="ğŸ’¡-å®ˆæŠ¤çº¿ç¨‹"><a href="#ğŸ’¡-å®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="ğŸ’¡ å®ˆæŠ¤çº¿ç¨‹"></a>ğŸ’¡ å®ˆæŠ¤çº¿ç¨‹</h4><p>é»˜è®¤æ–‡ä»¶ AIO ä½¿ç”¨çš„çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œæ‰€ä»¥æœ€åè¦æ‰§è¡Œ <code>System.in.read()</code> ä»¥é¿å…å®ˆæŠ¤çº¿ç¨‹æ„å¤–ç»“æŸ</p><h4 id="ç½‘ç»œ-AIO"><a href="#ç½‘ç»œ-AIO" class="headerlink" title="ç½‘ç»œ AIO"></a>ç½‘ç»œ AIO</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AioServer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">AsynchronousServerSocketChannel</span> ssc <span class="token operator">=</span> <span class="token class-name">AsynchronousServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AcceptHandler</span><span class="token punctuation">(</span>ssc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">closeChannel</span><span class="token punctuation">(</span><span class="token class-name">AsynchronousSocketChannel</span> sc<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[%s] %s close\n"</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sc<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            sc<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ReadHandler</span> <span class="token keyword">implements</span> <span class="token class-name">CompletionHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AsynchronousSocketChannel</span> sc<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">ReadHandler</span><span class="token punctuation">(</span><span class="token class-name">AsynchronousSocketChannel</span> sc<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>sc <span class="token operator">=</span> sc<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completed</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> result<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> attachment<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token function">closeChannel</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">return</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[%s] %s read\n"</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sc<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                attachment<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>attachment<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                attachment<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// å¤„ç†å®Œç¬¬ä¸€ä¸ª read æ—¶ï¼Œéœ€è¦å†æ¬¡è°ƒç”¨ read æ–¹æ³•æ¥å¤„ç†ä¸‹ä¸€ä¸ª read äº‹ä»¶</span>                sc<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>attachment<span class="token punctuation">,</span> attachment<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">failed</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> exc<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> attachment<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">closeChannel</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>            exc<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WriteHandler</span> <span class="token keyword">implements</span> <span class="token class-name">CompletionHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AsynchronousSocketChannel</span> sc<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token class-name">WriteHandler</span><span class="token punctuation">(</span><span class="token class-name">AsynchronousSocketChannel</span> sc<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>sc <span class="token operator">=</span> sc<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completed</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> result<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> attachment<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// å¦‚æœä½œä¸ºé™„ä»¶çš„ buffer è¿˜æœ‰å†…å®¹ï¼Œéœ€è¦å†æ¬¡ write å†™å‡ºå‰©ä½™å†…å®¹</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>attachment<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                sc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>attachment<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">failed</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> exc<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> attachment<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            exc<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">closeChannel</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">AcceptHandler</span> <span class="token keyword">implements</span> <span class="token class-name">CompletionHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AsynchronousSocketChannel</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AsynchronousServerSocketChannel</span> ssc<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">AcceptHandler</span><span class="token punctuation">(</span><span class="token class-name">AsynchronousServerSocketChannel</span> ssc<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>ssc <span class="token operator">=</span> ssc<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completed</span><span class="token punctuation">(</span><span class="token class-name">AsynchronousSocketChannel</span> sc<span class="token punctuation">,</span> <span class="token class-name">Object</span> attachment<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[%s] %s connected\n"</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sc<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è¯»äº‹ä»¶ç”± ReadHandler å¤„ç†</span>            sc<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ReadHandler</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å†™äº‹ä»¶ç”± WriteHandler å¤„ç†</span>            sc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"server hello!"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">WriteHandler</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å¤„ç†å®Œç¬¬ä¸€ä¸ª accpet æ—¶ï¼Œéœ€è¦å†æ¬¡è°ƒç”¨ accept æ–¹æ³•æ¥å¤„ç†ä¸‹ä¸€ä¸ª accept äº‹ä»¶</span>            ssc<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">failed</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> exc<span class="token punctuation">,</span> <span class="token class-name">Object</span> attachment<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            exc<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä¸€-NIO-åŸºç¡€&quot;&gt;&lt;a href=&quot;#ä¸€-NIO-åŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;ä¸€. NIO åŸºç¡€&quot;&gt;&lt;/a&gt;ä¸€. NIO åŸºç¡€&lt;/h1&gt;&lt;p&gt;non-blocking io éé˜»å¡ IO&lt;/p&gt;
&lt;h2 id=&quot;1-ä¸‰å¤§ç»„ä»¶&quot;&gt;&lt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://100qin10086.github.io/posts/0.html"/>
    <id>https://100qin10086.github.io/posts/0.html</id>
    <published>2024-05-06T14:13:59.606Z</published>
    <updated>2024-05-06T14:13:59.606Z</updated>
    
    <content type="html"><![CDATA[<h1 id="äºŒ-Netty-å…¥é—¨"><a href="#äºŒ-Netty-å…¥é—¨" class="headerlink" title="äºŒ. Netty å…¥é—¨"></a>äºŒ. Netty å…¥é—¨</h1><h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><h3 id="1-1-Netty-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-1-Netty-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.1 Netty æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.1 Netty æ˜¯ä»€ä¹ˆï¼Ÿ</h3><pre class="line-numbers language-none"><code class="language-none">Netty is an asynchronous event-driven network application frameworkfor rapid development of maintainable high performance protocol servers &amp; clients.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Netty æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€åŸºäºäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</p><h3 id="1-2-Netty-çš„ä½œè€…"><a href="#1-2-Netty-çš„ä½œè€…" class="headerlink" title="1.2 Netty çš„ä½œè€…"></a>1.2 Netty çš„ä½œè€…</h3><p><img src="/posts/0.htm/0005.png" alt></p><p>ä»–è¿˜æ˜¯å¦ä¸€ä¸ªè‘—åç½‘ç»œåº”ç”¨æ¡†æ¶ Mina çš„é‡è¦è´¡çŒ®è€…</p><h3 id="1-3-Netty-çš„åœ°ä½"><a href="#1-3-Netty-çš„åœ°ä½" class="headerlink" title="1.3 Netty çš„åœ°ä½"></a>1.3 Netty çš„åœ°ä½</h3><p>Netty åœ¨ Java ç½‘ç»œåº”ç”¨æ¡†æ¶ä¸­çš„åœ°ä½å°±å¥½æ¯”ï¼šSpring æ¡†æ¶åœ¨ JavaEE å¼€å‘ä¸­çš„åœ°ä½</p><p>ä»¥ä¸‹çš„æ¡†æ¶éƒ½ä½¿ç”¨äº† Nettyï¼Œå› ä¸ºå®ƒä»¬æœ‰ç½‘ç»œé€šä¿¡éœ€æ±‚ï¼</p><ul><li>Cassandra - nosql æ•°æ®åº“</li><li>Spark - å¤§æ•°æ®åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶</li><li>Hadoop - å¤§æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨æ¡†æ¶</li><li>RocketMQ - ali å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—</li><li>ElasticSearch - æœç´¢å¼•æ“</li><li>gRPC - rpc æ¡†æ¶</li><li>Dubbo - rpc æ¡†æ¶</li><li>Spring 5.x - flux api å®Œå…¨æŠ›å¼ƒäº† tomcat ï¼Œä½¿ç”¨ netty ä½œä¸ºæœåŠ¡å™¨ç«¯</li><li>Zookeeper - åˆ†å¸ƒå¼åè°ƒæ¡†æ¶</li></ul><h3 id="1-4-Netty-çš„ä¼˜åŠ¿"><a href="#1-4-Netty-çš„ä¼˜åŠ¿" class="headerlink" title="1.4 Netty çš„ä¼˜åŠ¿"></a>1.4 Netty çš„ä¼˜åŠ¿</h3><ul><li>Netty vs NIOï¼Œå·¥ä½œé‡å¤§ï¼Œbug å¤š<ul><li>éœ€è¦è‡ªå·±æ„å»ºåè®®</li><li>è§£å†³ TCP ä¼ è¾“é—®é¢˜ï¼Œå¦‚ç²˜åŒ…ã€åŠåŒ…</li><li>epoll ç©ºè½®è¯¢å¯¼è‡´ CPU 100%</li><li>å¯¹ API è¿›è¡Œå¢å¼ºï¼Œä½¿ä¹‹æ›´æ˜“ç”¨ï¼Œå¦‚ FastThreadLocal =&gt; ThreadLocalï¼ŒByteBuf =&gt; ByteBuffer</li></ul></li><li>Netty vs å…¶å®ƒç½‘ç»œåº”ç”¨æ¡†æ¶<ul><li>Mina ç”± apache ç»´æŠ¤ï¼Œå°†æ¥ 3.x ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰è¾ƒå¤§é‡æ„ï¼Œç ´å API å‘ä¸‹å…¼å®¹æ€§ï¼ŒNetty çš„å¼€å‘è¿­ä»£æ›´è¿…é€Ÿï¼ŒAPI æ›´ç®€æ´ã€æ–‡æ¡£æ›´ä¼˜ç§€</li><li>ä¹…ç»è€ƒéªŒï¼Œ16å¹´ï¼ŒNetty ç‰ˆæœ¬<ul><li>2.x 2004</li><li>3.x 2008</li><li>4.x 2013</li><li>5.x å·²åºŸå¼ƒï¼ˆæ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼‰</li></ul></li></ul></li></ul><h2 id="2-Hello-World"><a href="#2-Hello-World" class="headerlink" title="2. Hello World"></a>2. Hello World</h2><h3 id="2-1-ç›®æ ‡"><a href="#2-1-ç›®æ ‡" class="headerlink" title="2.1 ç›®æ ‡"></a>2.1 ç›®æ ‡</h3><p>å¼€å‘ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯</p><ul><li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€ hello, world</li><li>æœåŠ¡å™¨ä»…æ¥æ”¶ï¼Œä¸è¿”å›</li></ul><p>åŠ å…¥ä¾èµ–</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>io.netty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>netty-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>4.1.39.Final<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-2-æœåŠ¡å™¨ç«¯"><a href="#2-2-æœåŠ¡å™¨ç«¯" class="headerlink" title="2.2 æœåŠ¡å™¨ç«¯"></a>2.2 æœåŠ¡å™¨ç«¯</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>    <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 3</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 6</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»£ç è§£è¯»</p><ul><li><p>1 å¤„ï¼Œåˆ›å»º NioEventLoopGroupï¼Œå¯ä»¥ç®€å•ç†è§£ä¸º <code>çº¿ç¨‹æ±  + Selector</code> åé¢ä¼šè¯¦ç»†å±•å¼€</p></li><li><p>2 å¤„ï¼Œé€‰æ‹©æœåŠ¡ Scoket å®ç°ç±»ï¼Œå…¶ä¸­ NioServerSocketChannel è¡¨ç¤ºåŸºäº NIO çš„æœåŠ¡å™¨ç«¯å®ç°ï¼Œå…¶å®ƒå®ç°è¿˜æœ‰</p><p><img src="/posts/0.htm/0006.png" alt></p></li><li><p>3 å¤„ï¼Œä¸ºå•¥æ–¹æ³•å« childHandlerï¼Œæ˜¯æ¥ä¸‹æ¥æ·»åŠ çš„å¤„ç†å™¨éƒ½æ˜¯ç»™ SocketChannel ç”¨çš„ï¼Œè€Œä¸æ˜¯ç»™ ServerSocketChannelã€‚ChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨</p></li><li><p>4 å¤„ï¼ŒServerSocketChannel ç»‘å®šçš„ç›‘å¬ç«¯å£</p></li><li><p>5 å¤„ï¼ŒSocketChannel çš„å¤„ç†å™¨ï¼Œè§£ç  ByteBuf =&gt; String</p></li><li><p>6 å¤„ï¼ŒSocketChannel çš„ä¸šåŠ¡å¤„ç†å™¨ï¼Œä½¿ç”¨ä¸Šä¸€ä¸ªå¤„ç†å™¨çš„å¤„ç†ç»“æœ</p></li></ul><h3 id="2-3-å®¢æˆ·ç«¯"><a href="#2-3-å®¢æˆ·ç«¯" class="headerlink" title="2.3 å®¢æˆ·ç«¯"></a>2.3 å®¢æˆ·ç«¯</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 3</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 8</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span> <span class="token comment">// 4</span>    <span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 5</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 6</span>    <span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 7</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»£ç è§£è¯»</p><ul><li><p>1 å¤„ï¼Œåˆ›å»º NioEventLoopGroupï¼ŒåŒ Server</p></li><li><p>2 å¤„ï¼Œé€‰æ‹©å®¢æˆ· Socket å®ç°ç±»ï¼ŒNioSocketChannel è¡¨ç¤ºåŸºäº NIO çš„å®¢æˆ·ç«¯å®ç°ï¼Œå…¶å®ƒå®ç°è¿˜æœ‰</p><p><img src="/posts/0.htm/0007.png" alt></p></li><li><p>3 å¤„ï¼Œæ·»åŠ  SocketChannel çš„å¤„ç†å™¨ï¼ŒChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨</p></li><li>4 å¤„ï¼ŒæŒ‡å®šè¦è¿æ¥çš„æœåŠ¡å™¨å’Œç«¯å£</li><li>5 å¤„ï¼ŒNetty ä¸­å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå¦‚ connectï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨ sync æ–¹æ³•ç­‰å¾… connect å»ºç«‹è¿æ¥å®Œæ¯•</li><li>6 å¤„ï¼Œè·å– channel å¯¹è±¡ï¼Œå®ƒå³ä¸ºé€šé“æŠ½è±¡ï¼Œå¯ä»¥è¿›è¡Œæ•°æ®è¯»å†™æ“ä½œ</li><li>7 å¤„ï¼Œå†™å…¥æ¶ˆæ¯å¹¶æ¸…ç©ºç¼“å†²åŒº</li><li>8 å¤„ï¼Œæ¶ˆæ¯ä¼šç»è¿‡é€šé“ handler å¤„ç†ï¼Œè¿™é‡Œæ˜¯å°† String =&gt; ByteBuf å‘å‡º</li><li>æ•°æ®ç»è¿‡ç½‘ç»œä¼ è¾“ï¼Œåˆ°è¾¾æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯ 5 å’Œ 6 å¤„çš„ handler å…ˆåè¢«è§¦å‘ï¼Œèµ°å®Œä¸€ä¸ªæµç¨‹</li></ul><h3 id="2-4-æµç¨‹æ¢³ç†"><a href="#2-4-æµç¨‹æ¢³ç†" class="headerlink" title="2.4 æµç¨‹æ¢³ç†"></a>2.4 æµç¨‹æ¢³ç†</h3><p><img src="/posts/0.htm/0040.png" alt></p><h4 id="ğŸ’¡-æç¤º"><a href="#ğŸ’¡-æç¤º" class="headerlink" title="ğŸ’¡ æç¤º"></a>ğŸ’¡ æç¤º</h4><blockquote><p>ä¸€å¼€å§‹éœ€è¦æ ‘ç«‹æ­£ç¡®çš„è§‚å¿µ</p><ul><li>æŠŠ channel ç†è§£ä¸ºæ•°æ®çš„é€šé“</li><li>æŠŠ msg ç†è§£ä¸ºæµåŠ¨çš„æ•°æ®ï¼Œæœ€å¼€å§‹è¾“å…¥æ˜¯ ByteBufï¼Œä½†ç»è¿‡ pipeline çš„åŠ å·¥ï¼Œä¼šå˜æˆå…¶å®ƒç±»å‹å¯¹è±¡ï¼Œæœ€åè¾“å‡ºåˆå˜æˆ ByteBuf</li><li>æŠŠ handler ç†è§£ä¸ºæ•°æ®çš„å¤„ç†å·¥åº<ul><li>å·¥åºæœ‰å¤šé“ï¼Œåˆåœ¨ä¸€èµ·å°±æ˜¯ pipelineï¼Œpipeline è´Ÿè´£å‘å¸ƒäº‹ä»¶ï¼ˆè¯»ã€è¯»å–å®Œæˆâ€¦ï¼‰ä¼ æ’­ç»™æ¯ä¸ª handlerï¼Œ handler å¯¹è‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶è¿›è¡Œå¤„ç†ï¼ˆé‡å†™äº†ç›¸åº”äº‹ä»¶å¤„ç†æ–¹æ³•ï¼‰</li><li>handler åˆ† Inbound å’Œ Outbound ä¸¤ç±»</li></ul></li><li>æŠŠ eventLoop ç†è§£ä¸ºå¤„ç†æ•°æ®çš„å·¥äºº<ul><li>å·¥äººå¯ä»¥ç®¡ç†å¤šä¸ª channel çš„ io æ“ä½œï¼Œå¹¶ä¸”ä¸€æ—¦å·¥äººè´Ÿè´£äº†æŸä¸ª channelï¼Œå°±è¦è´Ÿè´£åˆ°åº•ï¼ˆç»‘å®šï¼‰</li><li>å·¥äººæ—¢å¯ä»¥æ‰§è¡Œ io æ“ä½œï¼Œä¹Ÿå¯ä»¥è¿›è¡Œä»»åŠ¡å¤„ç†ï¼Œæ¯ä½å·¥äººæœ‰ä»»åŠ¡é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—é‡Œå¯ä»¥å †æ”¾å¤šä¸ª channel çš„å¾…å¤„ç†ä»»åŠ¡ï¼Œä»»åŠ¡åˆ†ä¸ºæ™®é€šä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡</li><li>å·¥äººæŒ‰ç…§ pipeline é¡ºåºï¼Œä¾æ¬¡æŒ‰ç…§ handler çš„è§„åˆ’ï¼ˆä»£ç ï¼‰å¤„ç†æ•°æ®ï¼Œå¯ä»¥ä¸ºæ¯é“å·¥åºæŒ‡å®šä¸åŒçš„å·¥äºº</li></ul></li></ul></blockquote><h2 id="3-ç»„ä»¶"><a href="#3-ç»„ä»¶" class="headerlink" title="3. ç»„ä»¶"></a>3. ç»„ä»¶</h2><h3 id="3-1-EventLoop"><a href="#3-1-EventLoop" class="headerlink" title="3.1 EventLoop"></a>3.1 EventLoop</h3><p>äº‹ä»¶å¾ªç¯å¯¹è±¡</p><p>EventLoop æœ¬è´¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œå™¨ï¼ˆåŒæ—¶ç»´æŠ¤äº†ä¸€ä¸ª Selectorï¼‰ï¼Œé‡Œé¢æœ‰ run æ–¹æ³•å¤„ç† Channel ä¸Šæºæºä¸æ–­çš„ io äº‹ä»¶ã€‚</p><p>å®ƒçš„ç»§æ‰¿å…³ç³»æ¯”è¾ƒå¤æ‚</p><ul><li>ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª j.u.c.ScheduledExecutorService å› æ­¤åŒ…å«äº†çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„æ–¹æ³•</li><li>å¦ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª netty è‡ªå·±çš„ OrderedEventExecutorï¼Œ<ul><li>æä¾›äº† boolean inEventLoop(Thread thread) æ–¹æ³•åˆ¤æ–­ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦å±äºæ­¤ EventLoop</li><li>æä¾›äº† parent æ–¹æ³•æ¥çœ‹çœ‹è‡ªå·±å±äºå“ªä¸ª EventLoopGroup</li></ul></li></ul><p>äº‹ä»¶å¾ªç¯ç»„</p><p>EventLoopGroup æ˜¯ä¸€ç»„ EventLoopï¼ŒChannel ä¸€èˆ¬ä¼šè°ƒç”¨ EventLoopGroup çš„ register æ–¹æ³•æ¥ç»‘å®šå…¶ä¸­ä¸€ä¸ª EventLoopï¼Œåç»­è¿™ä¸ª Channel ä¸Šçš„ io äº‹ä»¶éƒ½ç”±æ­¤ EventLoop æ¥å¤„ç†ï¼ˆä¿è¯äº† io äº‹ä»¶å¤„ç†æ—¶çš„çº¿ç¨‹å®‰å…¨ï¼‰</p><ul><li>ç»§æ‰¿è‡ª netty è‡ªå·±çš„ EventExecutorGroup<ul><li>å®ç°äº† Iterable æ¥å£æä¾›éå† EventLoop çš„èƒ½åŠ›</li><li>å¦æœ‰ next æ–¹æ³•è·å–é›†åˆä¸­ä¸‹ä¸€ä¸ª EventLoop</li></ul></li></ul><p>ä»¥ä¸€ä¸ªç®€å•çš„å®ç°ä¸ºä¾‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// å†…éƒ¨åˆ›å»ºäº†ä¸¤ä¸ª EventLoop, æ¯ä¸ª EventLoop ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹</span><span class="token class-name">DefaultEventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>group<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>group<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>group<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">io.netty.channel.DefaultEventLoop@60f82f98io.netty.channel.DefaultEventLoop@35f983a6io.netty.channel.DefaultEventLoop@60f82f98<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ for å¾ªç¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DefaultEventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">EventExecutor</span> eventLoop <span class="token operator">:</span> group<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>eventLoop<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">io.netty.channel.DefaultEventLoop@60f82f98io.netty.channel.DefaultEventLoop@35f983a6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="ğŸ’¡-ä¼˜é›…å…³é—­"><a href="#ğŸ’¡-ä¼˜é›…å…³é—­" class="headerlink" title="ğŸ’¡ ä¼˜é›…å…³é—­"></a>ğŸ’¡ ä¼˜é›…å…³é—­</h4><p>ä¼˜é›…å…³é—­ <code>shutdownGracefully</code> æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šé¦–å…ˆåˆ‡æ¢ <code>EventLoopGroup</code> åˆ°å…³é—­çŠ¶æ€ä»è€Œæ‹’ç»æ–°çš„ä»»åŠ¡çš„åŠ å…¥ï¼Œç„¶ååœ¨ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡éƒ½å¤„ç†å®Œæˆåï¼Œåœæ­¢çº¿ç¨‹çš„è¿è¡Œã€‚ä»è€Œç¡®ä¿æ•´ä½“åº”ç”¨æ˜¯åœ¨æ­£å¸¸æœ‰åºçš„çŠ¶æ€ä¸‹é€€å‡ºçš„</p><h4 id="æ¼”ç¤º-NioEventLoop-å¤„ç†-io-äº‹ä»¶"><a href="#æ¼”ç¤º-NioEventLoop-å¤„ç†-io-äº‹ä»¶" class="headerlink" title="æ¼”ç¤º NioEventLoop å¤„ç† io äº‹ä»¶"></a>æ¼”ç¤º NioEventLoop å¤„ç† io äº‹ä»¶</h4><p>æœåŠ¡å™¨ç«¯ä¸¤ä¸ª nio worker å·¥äºº</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">ByteBuf</span> byteBuf <span class="token operator">=</span> msg <span class="token keyword">instanceof</span> <span class="token class-name">ByteBuf</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>byteBuf <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token class-name">ByteBuf</span> len <span class="token operator">=</span> byteBuf<span class="token punctuation">.</span><span class="token function">readBytes</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> byteBuf<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯ï¼Œå¯åŠ¨ä¸‰æ¬¡ï¼Œåˆ†åˆ«ä¿®æ”¹å‘é€å­—ç¬¦ä¸²ä¸º zhangsanï¼ˆç¬¬ä¸€æ¬¡ï¼‰ï¼Œlisiï¼ˆç¬¬äºŒæ¬¡ï¼‰ï¼Œwangwuï¼ˆç¬¬ä¸‰æ¬¡ï¼‰</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"init..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">ByteBufAllocator</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token string">"wangwu"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">ByteBufAllocator</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token string">"wangwu"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€åè¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">22:03:34 [DEBUG] [nioEventLoopGroup-3-1] c.i.o.EventLoopTest - zhangsan       22:03:36 [DEBUG] [nioEventLoopGroup-3-1] c.i.o.EventLoopTest - zhangsan       22:05:36 [DEBUG] [nioEventLoopGroup-3-2] c.i.o.EventLoopTest - lisi           22:05:38 [DEBUG] [nioEventLoopGroup-3-2] c.i.o.EventLoopTest - lisi           22:06:09 [DEBUG] [nioEventLoopGroup-3-1] c.i.o.EventLoopTest - wangwu        22:06:11 [DEBUG] [nioEventLoopGroup-3-1] c.i.o.EventLoopTest - wangwu         <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå·¥äººè½®æµå¤„ç† channelï¼Œä½†å·¥äººä¸ channel ä¹‹é—´è¿›è¡Œäº†ç»‘å®š</p><p><img src="/posts/0.htm/0042.png" alt></p><p>å†å¢åŠ ä¸¤ä¸ªé nio å·¥äºº</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DefaultEventLoopGroup</span> normalWorkers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>normalWorkers<span class="token punctuation">,</span><span class="token string">"myhandler"</span><span class="token punctuation">,</span>              <span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">ByteBuf</span> byteBuf <span class="token operator">=</span> msg <span class="token keyword">instanceof</span> <span class="token class-name">ByteBuf</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>byteBuf <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token class-name">ByteBuf</span> len <span class="token operator">=</span> byteBuf<span class="token punctuation">.</span><span class="token function">readBytes</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> byteBuf<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯ä»£ç ä¸å˜ï¼Œå¯åŠ¨ä¸‰æ¬¡ï¼Œåˆ†åˆ«ä¿®æ”¹å‘é€å­—ç¬¦ä¸²ä¸º zhangsanï¼ˆç¬¬ä¸€æ¬¡ï¼‰ï¼Œlisiï¼ˆç¬¬äºŒæ¬¡ï¼‰ï¼Œwangwuï¼ˆç¬¬ä¸‰æ¬¡ï¼‰</p><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:52588] REGISTERED22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:52588] ACTIVE22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:52588] READ: 8B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 7a 68 61 6e 67 73 61 6e                         |zhangsan        |+--------+-------------------------------------------------+----------------+22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:52588] READ COMPLETE22:19:48 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - zhangsan        22:19:50 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:52588] READ: 8B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 7a 68 61 6e 67 73 61 6e                         |zhangsan        |+--------+-------------------------------------------------+----------------+22:19:50 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:52588] READ COMPLETE22:19:50 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - zhangsan        22:20:24 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:52612] REGISTERED22:20:24 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:52612] ACTIVE22:20:25 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:52612] READ: 4B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 6c 69 73 69                                     |lisi            |+--------+-------------------------------------------------+----------------+22:20:25 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:52612] READ COMPLETE22:20:25 [DEBUG] [defaultEventLoopGroup-2-2] c.i.o.EventLoopTest - lisi            22:20:27 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:52612] READ: 4B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 6c 69 73 69                                     |lisi            |+--------+-------------------------------------------------+----------------+22:20:27 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:52612] READ COMPLETE22:20:27 [DEBUG] [defaultEventLoopGroup-2-2] c.i.o.EventLoopTest - lisi            22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:52625] REGISTERED22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:52625] ACTIVE22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:52625] READ: 6B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 77 61 6e 67 77 75                               |wangwu          |+--------+-------------------------------------------------+----------------+22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:52625] READ COMPLETE22:20:38 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - wangwu          22:20:40 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:52625] READ: 6B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 77 61 6e 67 77 75                               |wangwu          |+--------+-------------------------------------------------+----------------+22:20:40 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:52625] READ COMPLETE22:20:40 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - wangwu          <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œnio å·¥äººå’Œ é nio å·¥äººä¹Ÿåˆ†åˆ«ç»‘å®šäº† channelï¼ˆLoggingHandler ç”± nio å·¥äººæ‰§è¡Œï¼Œè€Œæˆ‘ä»¬è‡ªå·±çš„ handler ç”±é nio å·¥äººæ‰§è¡Œï¼‰</p><p><img src="/posts/0.htm/0041.png" alt></p><h4 id="ğŸ’¡-handler-æ‰§è¡Œä¸­å¦‚ä½•æ¢äººï¼Ÿ"><a href="#ğŸ’¡-handler-æ‰§è¡Œä¸­å¦‚ä½•æ¢äººï¼Ÿ" class="headerlink" title="ğŸ’¡ handler æ‰§è¡Œä¸­å¦‚ä½•æ¢äººï¼Ÿ"></a>ğŸ’¡ handler æ‰§è¡Œä¸­å¦‚ä½•æ¢äººï¼Ÿ</h4><p>å…³é”®ä»£ç  <code>io.netty.channel.AbstractChannelHandlerContext#invokeChannelRead()</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">invokeChannelRead</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">AbstractChannelHandlerContext</span> next<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">final</span> <span class="token class-name">Object</span> m <span class="token operator">=</span> next<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span><span class="token function">touch</span><span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token string">"msg"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ä¸‹ä¸€ä¸ª handler çš„äº‹ä»¶å¾ªç¯æ˜¯å¦ä¸å½“å‰çš„äº‹ä»¶å¾ªç¯æ˜¯åŒä¸€ä¸ªçº¿ç¨‹</span>    <span class="token class-name">EventExecutor</span> executor <span class="token operator">=</span> next<span class="token punctuation">.</span><span class="token function">executor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ˜¯ï¼Œç›´æ¥è°ƒç”¨</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>executor<span class="token punctuation">.</span><span class="token function">inEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        next<span class="token punctuation">.</span><span class="token function">invokeChannelRead</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token comment">// ä¸æ˜¯ï¼Œå°†è¦æ‰§è¡Œçš„ä»£ç ä½œä¸ºä»»åŠ¡æäº¤ç»™ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯å¤„ç†ï¼ˆæ¢äººï¼‰</span>    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                next<span class="token punctuation">.</span><span class="token function">invokeChannelRead</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¦‚æœä¸¤ä¸ª handler ç»‘å®šçš„æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ç›´æ¥è°ƒç”¨</li><li>å¦åˆ™ï¼ŒæŠŠè¦è°ƒç”¨çš„ä»£ç å°è£…ä¸ºä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼Œç”±ä¸‹ä¸€ä¸ª handler çš„çº¿ç¨‹æ¥è°ƒç”¨</li></ul><h4 id="æ¼”ç¤º-NioEventLoop-å¤„ç†æ™®é€šä»»åŠ¡"><a href="#æ¼”ç¤º-NioEventLoop-å¤„ç†æ™®é€šä»»åŠ¡" class="headerlink" title="æ¼”ç¤º NioEventLoop å¤„ç†æ™®é€šä»»åŠ¡"></a>æ¼”ç¤º NioEventLoop å¤„ç†æ™®é€šä»»åŠ¡</h4><p>NioEventLoop é™¤äº†å¯ä»¥å¤„ç† io äº‹ä»¶ï¼ŒåŒæ ·å¯ä»¥å‘å®ƒæäº¤æ™®é€šä»»åŠ¡</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">NioEventLoopGroup</span> nioWorkers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"server start..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>nioWorkers<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"normal task..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">22:30:36 [DEBUG] [main] c.i.o.EventLoopTest2 - server start...22:30:38 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - normal task...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>å¯ä»¥ç”¨æ¥æ‰§è¡Œè€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡</p></blockquote><h4 id="æ¼”ç¤º-NioEventLoop-å¤„ç†å®šæ—¶ä»»åŠ¡"><a href="#æ¼”ç¤º-NioEventLoop-å¤„ç†å®šæ—¶ä»»åŠ¡" class="headerlink" title="æ¼”ç¤º NioEventLoop å¤„ç†å®šæ—¶ä»»åŠ¡"></a>æ¼”ç¤º NioEventLoop å¤„ç†å®šæ—¶ä»»åŠ¡</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">NioEventLoopGroup</span> nioWorkers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"server start..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>nioWorkers<span class="token punctuation">.</span><span class="token function">scheduleAtFixedRate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"running..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">22:35:15 [DEBUG] [main] c.i.o.EventLoopTest2 - server start...22:35:17 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running...22:35:18 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running...22:35:19 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running...22:35:20 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running......<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å¯ä»¥ç”¨æ¥æ‰§è¡Œå®šæ—¶ä»»åŠ¡</p></blockquote><h3 id="3-2-Channel"><a href="#3-2-Channel" class="headerlink" title="3.2 Channel"></a>3.2 Channel</h3><p>channel çš„ä¸»è¦ä½œç”¨</p><ul><li>close() å¯ä»¥ç”¨æ¥å…³é—­ channel</li><li>closeFuture() ç”¨æ¥å¤„ç† channel çš„å…³é—­<ul><li>sync æ–¹æ³•ä½œç”¨æ˜¯åŒæ­¥ç­‰å¾… channel å…³é—­</li><li>è€Œ addListener æ–¹æ³•æ˜¯å¼‚æ­¥ç­‰å¾… channel å…³é—­</li></ul></li><li>pipeline() æ–¹æ³•æ·»åŠ å¤„ç†å™¨</li><li>write() æ–¹æ³•å°†æ•°æ®å†™å…¥</li><li>writeAndFlush() æ–¹æ³•å°†æ•°æ®å†™å…¥å¹¶åˆ·å‡º</li></ul><h4 id="ChannelFuture"><a href="#ChannelFuture" class="headerlink" title="ChannelFuture"></a>ChannelFuture</h4><p>è¿™æ—¶åˆšæ‰çš„å®¢æˆ·ç«¯ä»£ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨æŠŠå®ƒæ‹†å¼€æ¥çœ‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>channelFuture<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>1 å¤„è¿”å›çš„æ˜¯ ChannelFuture å¯¹è±¡ï¼Œå®ƒçš„ä½œç”¨æ˜¯åˆ©ç”¨ channel() æ–¹æ³•æ¥è·å– Channel å¯¹è±¡</li></ul><p><strong>æ³¨æ„</strong> connect æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œæ„å‘³ç€ä¸ç­‰è¿æ¥å»ºç«‹ï¼Œæ–¹æ³•æ‰§è¡Œå°±è¿”å›äº†ã€‚å› æ­¤ channelFuture å¯¹è±¡ä¸­ä¸èƒ½ã€ç«‹åˆ»ã€‘è·å¾—åˆ°æ­£ç¡®çš„ Channel å¯¹è±¡</p><p>å®éªŒå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>channelFuture<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ‰§è¡Œåˆ° 1 æ—¶ï¼Œè¿æ¥æœªå»ºç«‹ï¼Œæ‰“å° <code>[id: 0x2e1884dd]</code></li><li>æ‰§è¡Œåˆ° 2 æ—¶ï¼Œsync æ–¹æ³•æ˜¯åŒæ­¥ç­‰å¾…è¿æ¥å»ºç«‹å®Œæˆ</li><li>æ‰§è¡Œåˆ° 3 æ—¶ï¼Œè¿æ¥è‚¯å®šå»ºç«‹äº†ï¼Œæ‰“å° <code>[id: 0x2e1884dd, L:/127.0.0.1:57191 - R:/127.0.0.1:8080]</code></li></ul><p>é™¤äº†ç”¨ sync æ–¹æ³•å¯ä»¥è®©å¼‚æ­¥æ“ä½œåŒæ­¥ä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å›è°ƒçš„æ–¹å¼ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>channelFuture<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ChannelFutureListener</span><span class="token punctuation">)</span> future <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>future<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ‰§è¡Œåˆ° 1 æ—¶ï¼Œè¿æ¥æœªå»ºç«‹ï¼Œæ‰“å° <code>[id: 0x749124ba]</code></li><li>ChannelFutureListener ä¼šåœ¨è¿æ¥å»ºç«‹æ—¶è¢«è°ƒç”¨ï¼ˆå…¶ä¸­ operationComplete æ–¹æ³•ï¼‰ï¼Œå› æ­¤æ‰§è¡Œåˆ° 2 æ—¶ï¼Œè¿æ¥è‚¯å®šå»ºç«‹äº†ï¼Œæ‰“å° <code>[id: 0x749124ba, L:/127.0.0.1:57351 - R:/127.0.0.1:8080]</code></li></ul><h4 id="CloseFuture"><a href="#CloseFuture" class="headerlink" title="CloseFuture"></a>CloseFuture</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CloseFutureClient</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">NioEventLoopGroup</span> group <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token annotation punctuation">@Override</span> <span class="token comment">// åœ¨è¿æ¥å»ºç«‹åè¢«è°ƒç”¨</span>                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                        ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> channelFuture<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>            <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">String</span> line <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"q"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// close å¼‚æ­¥æ“ä½œ 1s ä¹‹å</span><span class="token comment">//                    log.debug("å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ"); // ä¸èƒ½åœ¨è¿™é‡Œå–„å</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">"input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·å– CloseFuture å¯¹è±¡ï¼Œ 1) åŒæ­¥å¤„ç†å…³é—­ï¼Œ 2) å¼‚æ­¥å¤„ç†å…³é—­</span>        <span class="token class-name">ChannelFuture</span> closeFuture <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/*log.debug("waiting close...");        closeFuture.sync();        log.debug("å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ");*/</span>        closeFuture<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelFutureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelFuture</span> future<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                group<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ğŸ’¡-å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ"><a href="#ğŸ’¡-å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ" class="headerlink" title="ğŸ’¡ å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ"></a>ğŸ’¡ å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ</h4><ul><li><p>æœ‰äº›åŒå­¦çœ‹åˆ°è¿™é‡Œä¼šæœ‰ç–‘é—®ï¼šä¸ºä»€ä¹ˆä¸åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å»æ‰§è¡Œå»ºç«‹è¿æ¥ã€å»æ‰§è¡Œå…³é—­ channelï¼Œé‚£æ ·ä¸æ˜¯ä¹Ÿå¯ä»¥å—ï¼Ÿéè¦ç”¨è¿™ä¹ˆå¤æ‚çš„å¼‚æ­¥æ–¹å¼ï¼šæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹å‘èµ·å»ºç«‹è¿æ¥ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å»çœŸæ­£å»ºç«‹è¿æ¥</p></li><li><p>è¿˜æœ‰åŒå­¦ä¼šç¬¼ç»Ÿåœ°å›ç­”ï¼Œå› ä¸º netty å¼‚æ­¥æ–¹å¼ç”¨äº†å¤šçº¿ç¨‹ã€å¤šçº¿ç¨‹å°±æ•ˆç‡é«˜ã€‚å…¶å®è¿™äº›è®¤è¯†éƒ½æ¯”è¾ƒç‰‡é¢ï¼Œå¤šçº¿ç¨‹å’Œå¼‚æ­¥æ‰€æå‡çš„æ•ˆç‡å¹¶ä¸æ˜¯æ‰€è®¤ä¸ºçš„</p></li></ul><p>æ€è€ƒä¸‹é¢çš„åœºæ™¯ï¼Œ4 ä¸ªåŒ»ç”Ÿç»™äººçœ‹ç—…ï¼Œæ¯ä¸ªç—…äººèŠ±è´¹ 20 åˆ†é’Ÿï¼Œè€Œä¸”åŒ»ç”Ÿçœ‹ç—…çš„è¿‡ç¨‹ä¸­æ˜¯ä»¥ç—…äººä¸ºå•ä½çš„ï¼Œä¸€ä¸ªç—…äººçœ‹å®Œäº†ï¼Œæ‰èƒ½çœ‹ä¸‹ä¸€ä¸ªç—…äººã€‚å‡è®¾ç—…äººæºæºä¸æ–­åœ°æ¥ï¼Œå¯ä»¥è®¡ç®—ä¸€ä¸‹ 4 ä¸ªåŒ»ç”Ÿä¸€å¤©å·¥ä½œ 8 å°æ—¶ï¼Œå¤„ç†çš„ç—…äººæ€»æ•°æ˜¯ï¼š<code>4 * 8 * 3 = 96</code></p><p><img src="/posts/0.htm/0044.png" alt></p><p>ç»ç ”ç©¶å‘ç°ï¼Œçœ‹ç—…å¯ä»¥ç»†åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼Œç»æ‹†åˆ†åæ¯ä¸ªæ­¥éª¤éœ€è¦ 5 åˆ†é’Ÿï¼Œå¦‚ä¸‹</p><p><img src="/posts/0.htm/0048.png" alt></p><p>å› æ­¤å¯ä»¥åšå¦‚ä¸‹ä¼˜åŒ–ï¼Œåªæœ‰ä¸€å¼€å§‹ï¼ŒåŒ»ç”Ÿ 2ã€3ã€4 åˆ†åˆ«è¦ç­‰å¾… 5ã€10ã€15 åˆ†é’Ÿæ‰èƒ½æ‰§è¡Œå·¥ä½œï¼Œä½†åªè¦åç»­ç—…äººæºæºä¸æ–­åœ°æ¥ï¼Œä»–ä»¬å°±èƒ½å¤Ÿæ»¡è´Ÿè·å·¥ä½œï¼Œå¹¶ä¸”å¤„ç†ç—…äººçš„èƒ½åŠ›æé«˜åˆ°äº† <code>4 * 8 * 12</code> æ•ˆç‡å‡ ä¹æ˜¯åŸæ¥çš„å››å€</p><p><img src="/posts/0.htm/0047.png" alt></p><p>è¦ç‚¹</p><ul><li>å•çº¿ç¨‹æ²¡æ³•å¼‚æ­¥æé«˜æ•ˆç‡ï¼Œå¿…é¡»é…åˆå¤šçº¿ç¨‹ã€å¤šæ ¸ cpu æ‰èƒ½å‘æŒ¥å¼‚æ­¥çš„ä¼˜åŠ¿</li><li>å¼‚æ­¥å¹¶æ²¡æœ‰ç¼©çŸ­å“åº”æ—¶é—´ï¼Œåè€Œæœ‰æ‰€å¢åŠ </li><li>åˆç†è¿›è¡Œä»»åŠ¡æ‹†åˆ†ï¼Œä¹Ÿæ˜¯åˆ©ç”¨å¼‚æ­¥çš„å…³é”®</li></ul><h3 id="3-3-Future-amp-Promise"><a href="#3-3-Future-amp-Promise" class="headerlink" title="3.3 Future &amp; Promise"></a>3.3 Future &amp; Promise</h3><p>åœ¨å¼‚æ­¥å¤„ç†æ—¶ï¼Œç»å¸¸ç”¨åˆ°è¿™ä¸¤ä¸ªæ¥å£</p><p>é¦–å…ˆè¦è¯´æ˜ netty ä¸­çš„ Future ä¸ jdk ä¸­çš„ Future åŒåï¼Œä½†æ˜¯æ˜¯ä¸¤ä¸ªæ¥å£ï¼Œnetty çš„ Future ç»§æ‰¿è‡ª jdk çš„ Futureï¼Œè€Œ Promise åˆå¯¹ netty Future è¿›è¡Œäº†æ‰©å±•</p><ul><li>jdk Future åªèƒ½åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸï¼ˆæˆ–æˆåŠŸã€æˆ–å¤±è´¥ï¼‰æ‰èƒ½å¾—åˆ°ç»“æœ</li><li>netty Future å¯ä»¥åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸå¾—åˆ°ç»“æœï¼Œä¹Ÿå¯ä»¥å¼‚æ­¥æ–¹å¼å¾—åˆ°ç»“æœï¼Œä½†éƒ½æ˜¯è¦ç­‰ä»»åŠ¡ç»“æŸ</li><li>netty Promise ä¸ä»…æœ‰ netty Future çš„åŠŸèƒ½ï¼Œè€Œä¸”è„±ç¦»äº†ä»»åŠ¡ç‹¬ç«‹å­˜åœ¨ï¼Œåªä½œä¸ºä¸¤ä¸ªçº¿ç¨‹é—´ä¼ é€’ç»“æœçš„å®¹å™¨</li></ul><div class="table-container"><table><thead><tr><th>åŠŸèƒ½/åç§°</th><th>jdk Future</th><th>netty Future</th><th>Promise</th></tr></thead><tbody><tr><td>cancel</td><td>å–æ¶ˆä»»åŠ¡</td><td>-</td><td>-</td></tr><tr><td>isCanceled</td><td>ä»»åŠ¡æ˜¯å¦å–æ¶ˆ</td><td>-</td><td>-</td></tr><tr><td>isDone</td><td>ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œä¸èƒ½åŒºåˆ†æˆåŠŸå¤±è´¥</td><td>-</td><td>-</td></tr><tr><td>get</td><td>è·å–ä»»åŠ¡ç»“æœï¼Œé˜»å¡ç­‰å¾…</td><td>-</td><td>-</td></tr><tr><td>getNow</td><td>-</td><td>è·å–ä»»åŠ¡ç»“æœï¼Œéé˜»å¡ï¼Œè¿˜æœªäº§ç”Ÿç»“æœæ—¶è¿”å› null</td><td>-</td></tr><tr><td>await</td><td>-</td><td>ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼Œä¸ä¼šæŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯é€šè¿‡ isSuccess åˆ¤æ–­</td><td>-</td></tr><tr><td>sync</td><td>-</td><td>ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸</td><td>-</td></tr><tr><td>isSuccess</td><td>-</td><td>åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æˆåŠŸ</td><td>-</td></tr><tr><td>cause</td><td>-</td><td>è·å–å¤±è´¥ä¿¡æ¯ï¼Œéé˜»å¡ï¼Œå¦‚æœæ²¡æœ‰å¤±è´¥ï¼Œè¿”å›null</td><td>-</td></tr><tr><td>addLinstener</td><td>-</td><td>æ·»åŠ å›è°ƒï¼Œå¼‚æ­¥æ¥æ”¶ç»“æœ</td><td>-</td></tr><tr><td>setSuccess</td><td>-</td><td>-</td><td>è®¾ç½®æˆåŠŸç»“æœ</td></tr><tr><td>setFailure</td><td>-</td><td>-</td><td>è®¾ç½®å¤±è´¥ç»“æœ</td></tr></tbody></table></div><h4 id="ä¾‹1"><a href="#ä¾‹1" class="headerlink" title="ä¾‹1"></a>ä¾‹1</h4><p>åŒæ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DefaultEventLoop</span> eventExecutors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>eventExecutors<span class="token punctuation">)</span><span class="token punctuation">;</span>eventExecutors<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"set success, &#123;&#125;"</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    promise<span class="token punctuation">.</span><span class="token function">setSuccess</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"start..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span>promise<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿˜æ²¡æœ‰ç»“æœ</span>log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span>promise<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">11:51:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...11:51:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - null11:51:54 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set success, 1011:51:54 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - 10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ä¾‹2"><a href="#ä¾‹2" class="headerlink" title="ä¾‹2"></a>ä¾‹2</h4><p>å¼‚æ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DefaultEventLoop</span> eventExecutors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>eventExecutors<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è®¾ç½®å›è°ƒï¼Œå¼‚æ­¥æ¥æ”¶ç»“æœ</span>promise<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>future <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è¿™é‡Œçš„ future å°±æ˜¯ä¸Šé¢çš„ promise</span>    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span>future<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ç­‰å¾… 1000 åè®¾ç½®æˆåŠŸç»“æœ</span>eventExecutors<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"set success, &#123;&#125;"</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    promise<span class="token punctuation">.</span><span class="token function">setSuccess</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"start..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">11:49:30 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...11:49:31 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set success, 1011:49:31 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - 10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="ä¾‹3"><a href="#ä¾‹3" class="headerlink" title="ä¾‹3"></a>ä¾‹3</h4><p>åŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥ - sync &amp; get</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DefaultEventLoop</span> eventExecutors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>eventExecutors<span class="token punctuation">)</span><span class="token punctuation">;</span>        eventExecutors<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">RuntimeException</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"error..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"set failure, &#123;&#125;"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            promise<span class="token punctuation">.</span><span class="token function">setFailure</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"start..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> promise<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        promise<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sync() ä¹Ÿä¼šå‡ºç°å¼‚å¸¸ï¼Œåªæ˜¯ get ä¼šå†ç”¨ ExecutionException åŒ…ä¸€å±‚å¼‚å¸¸</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">12:11:07 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...12:11:07 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - null12:11:08 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set failure, java.lang.RuntimeException: error...Exception in thread &quot;main&quot; java.util.concurrent.ExecutionException: java.lang.RuntimeException: error...at io.netty.util.concurrent.AbstractFuture.get(AbstractFuture.java:41)at com.itcast.oio.DefaultPromiseTest2.main(DefaultPromiseTest2.java:34)Caused by: java.lang.RuntimeException: error...at com.itcast.oio.DefaultPromiseTest2.lambda$main$0(DefaultPromiseTest2.java:27)at io.netty.channel.DefaultEventLoop.run(DefaultEventLoop.java:54)at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:918)at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)at java.lang.Thread.run(Thread.java:745)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ä¾‹4"><a href="#ä¾‹4" class="headerlink" title="ä¾‹4"></a>ä¾‹4</h4><p>åŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥ - await</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DefaultEventLoop</span> eventExecutors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>eventExecutors<span class="token punctuation">)</span><span class="token punctuation">;</span>eventExecutors<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">RuntimeException</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"error..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"set failure, &#123;&#125;"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    promise<span class="token punctuation">.</span><span class="token function">setFailure</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"start..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> promise<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>promise<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸ sync å’Œ get åŒºåˆ«åœ¨äºï¼Œä¸ä¼šæŠ›å¼‚å¸¸</span>log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"result &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>promise<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> promise<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> promise<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">12:18:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...12:18:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - null12:18:54 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set failure, java.lang.RuntimeException: error...12:18:54 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - result java.lang.RuntimeException: error...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ä¾‹5"><a href="#ä¾‹5" class="headerlink" title="ä¾‹5"></a>ä¾‹5</h4><p>å¼‚æ­¥å¤„ç†ä»»åŠ¡å¤±è´¥</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DefaultEventLoop</span> eventExecutors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>eventExecutors<span class="token punctuation">)</span><span class="token punctuation">;</span>promise<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>future <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"result &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>promise<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> promise<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> promise<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>eventExecutors<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">RuntimeException</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"error..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"set failure, &#123;&#125;"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    promise<span class="token punctuation">.</span><span class="token function">setFailure</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"start..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">12:04:57 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...12:04:58 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set failure, java.lang.RuntimeException: error...12:04:58 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - result java.lang.RuntimeException: error...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="ä¾‹6"><a href="#ä¾‹6" class="headerlink" title="ä¾‹6"></a>ä¾‹6</h4><p>await æ­»é”æ£€æŸ¥</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DefaultEventLoop</span> eventExecutors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>eventExecutors<span class="token punctuation">)</span><span class="token punctuation">;</span>eventExecutors<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        promise<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ³¨æ„ä¸èƒ½ä»…æ•è· InterruptedException å¼‚å¸¸</span>        <span class="token comment">// å¦åˆ™ æ­»é”æ£€æŸ¥æŠ›å‡ºçš„ BlockingOperationException ä¼šç»§ç»­å‘ä¸Šä¼ æ’­</span>        <span class="token comment">// è€Œæäº¤çš„ä»»åŠ¡ä¼šè¢«åŒ…è£…ä¸º PromiseTaskï¼Œå®ƒçš„ run æ–¹æ³•ä¸­ä¼š catch æ‰€æœ‰å¼‚å¸¸ç„¶åè®¾ç½®ä¸º Promise çš„å¤±è´¥ç»“æœè€Œä¸ä¼šæŠ›å‡º</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>eventExecutors<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        promise<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">1234io.netty.util.concurrent.BlockingOperationException: DefaultPromise@47499c2a(incomplete)at io.netty.util.concurrent.DefaultPromise.checkDeadLock(DefaultPromise.java:384)at io.netty.util.concurrent.DefaultPromise.await(DefaultPromise.java:212)at com.itcast.oio.DefaultPromiseTest.lambda$main$0(DefaultPromiseTest.java:27)at io.netty.util.concurrent.PromiseTask$RunnableAdapter.call(PromiseTask.java:38)at io.netty.util.concurrent.PromiseTask.run(PromiseTask.java:73)at io.netty.channel.DefaultEventLoop.run(DefaultEventLoop.java:54)at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:918)at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)at java.lang.Thread.run(Thread.java:745)io.netty.util.concurrent.BlockingOperationException: DefaultPromise@47499c2a(incomplete)at io.netty.util.concurrent.DefaultPromise.checkDeadLock(DefaultPromise.java:384)at io.netty.util.concurrent.DefaultPromise.await(DefaultPromise.java:212)at com.itcast.oio.DefaultPromiseTest.lambda$main$1(DefaultPromiseTest.java:36)at io.netty.util.concurrent.PromiseTask$RunnableAdapter.call(PromiseTask.java:38)at io.netty.util.concurrent.PromiseTask.run(PromiseTask.java:73)at io.netty.channel.DefaultEventLoop.run(DefaultEventLoop.java:54)at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:918)at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)at java.lang.Thread.run(Thread.java:745)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-4-Handler-amp-Pipeline"><a href="#3-4-Handler-amp-Pipeline" class="headerlink" title="3.4 Handler &amp; Pipeline"></a>3.4 Handler &amp; Pipeline</h3><p>ChannelHandler ç”¨æ¥å¤„ç† Channel ä¸Šçš„å„ç§äº‹ä»¶ï¼Œåˆ†ä¸ºå…¥ç«™ã€å‡ºç«™ä¸¤ç§ã€‚æ‰€æœ‰ ChannelHandler è¢«è¿æˆä¸€ä¸²ï¼Œå°±æ˜¯ Pipeline</p><ul><li>å…¥ç«™å¤„ç†å™¨é€šå¸¸æ˜¯ ChannelInboundHandlerAdapter çš„å­ç±»ï¼Œä¸»è¦ç”¨æ¥è¯»å–å®¢æˆ·ç«¯æ•°æ®ï¼Œå†™å›ç»“æœ</li><li>å‡ºç«™å¤„ç†å™¨é€šå¸¸æ˜¯ ChannelOutboundHandlerAdapter çš„å­ç±»ï¼Œä¸»è¦å¯¹å†™å›ç»“æœè¿›è¡ŒåŠ å·¥</li></ul><p>æ‰“ä¸ªæ¯”å–»ï¼Œæ¯ä¸ª Channel æ˜¯ä¸€ä¸ªäº§å“çš„åŠ å·¥è½¦é—´ï¼ŒPipeline æ˜¯è½¦é—´ä¸­çš„æµæ°´çº¿ï¼ŒChannelHandler å°±æ˜¯æµæ°´çº¿ä¸Šçš„å„é“å·¥åºï¼Œè€Œåé¢è¦è®²çš„ ByteBuf æ˜¯åŸææ–™ï¼Œç»è¿‡å¾ˆå¤šå·¥åºçš„åŠ å·¥ï¼šå…ˆç»è¿‡ä¸€é“é“å…¥ç«™å·¥åºï¼Œå†ç»è¿‡ä¸€é“é“å‡ºç«™å·¥åºæœ€ç»ˆå˜æˆäº§å“</p><p>å…ˆææ¸…æ¥šé¡ºåºï¼ŒæœåŠ¡ç«¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ctx<span class="token punctuation">.</span><span class="token function">fireChannelRead</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ctx<span class="token punctuation">.</span><span class="token function">fireChannelRead</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelOutboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">,</span>                                   <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ctx<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelOutboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">,</span>                                   <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ctx<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelOutboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">,</span>                                   <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ctx<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ChannelFutureListener</span><span class="token punctuation">)</span> future <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        future<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">"hello,world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœåŠ¡å™¨ç«¯æ‰“å°ï¼š</p><pre class="line-numbers language-none"><code class="language-none">123654<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒChannelInboundHandlerAdapter æ˜¯æŒ‰ç…§ addLast çš„é¡ºåºæ‰§è¡Œçš„ï¼Œè€Œ ChannelOutboundHandlerAdapter æ˜¯æŒ‰ç…§ addLast çš„é€†åºæ‰§è¡Œçš„ã€‚ChannelPipeline çš„å®ç°æ˜¯ä¸€ä¸ª ChannelHandlerContextï¼ˆåŒ…è£…äº† ChannelHandlerï¼‰ ç»„æˆçš„åŒå‘é“¾è¡¨</p><p><img src="/posts/0.htm/0008.png" alt></p><ul><li>å…¥ç«™å¤„ç†å™¨ä¸­ï¼Œctx.fireChannelRead(msg) æ˜¯ <strong>è°ƒç”¨ä¸‹ä¸€ä¸ªå…¥ç«™å¤„ç†å™¨</strong><ul><li>å¦‚æœæ³¨é‡Šæ‰ 1 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1</li><li>å¦‚æœæ³¨é‡Šæ‰ 2 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1 2</li></ul></li><li>3 å¤„çš„ ctx.channel().write(msg) ä¼š <strong>ä»å°¾éƒ¨å¼€å§‹è§¦å‘</strong> åç»­å‡ºç«™å¤„ç†å™¨çš„æ‰§è¡Œ<ul><li>å¦‚æœæ³¨é‡Šæ‰ 3 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1 2 3</li></ul></li><li>ç±»ä¼¼çš„ï¼Œå‡ºç«™å¤„ç†å™¨ä¸­ï¼Œctx.write(msg, promise) çš„è°ƒç”¨ä¹Ÿä¼š <strong>è§¦å‘ä¸Šä¸€ä¸ªå‡ºç«™å¤„ç†å™¨</strong><ul><li>å¦‚æœæ³¨é‡Šæ‰ 6 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1 2 3 6</li></ul></li><li>ctx.channel().write(msg) vs ctx.write(msg)<ul><li>éƒ½æ˜¯è§¦å‘å‡ºç«™å¤„ç†å™¨çš„æ‰§è¡Œ</li><li>ctx.channel().write(msg) ä»å°¾éƒ¨å¼€å§‹æŸ¥æ‰¾å‡ºç«™å¤„ç†å™¨</li><li>ctx.write(msg) æ˜¯ä»å½“å‰èŠ‚ç‚¹æ‰¾ä¸Šä¸€ä¸ªå‡ºç«™å¤„ç†å™¨</li><li>3 å¤„çš„ ctx.channel().write(msg) å¦‚æœæ”¹ä¸º ctx.write(msg) ä»…ä¼šæ‰“å° 1 2 3ï¼Œå› ä¸ºèŠ‚ç‚¹3 ä¹‹å‰æ²¡æœ‰å…¶å®ƒå‡ºç«™å¤„ç†å™¨äº†</li><li>6 å¤„çš„ ctx.write(msg, promise) å¦‚æœæ”¹ä¸º ctx.channel().write(msg) ä¼šæ‰“å° 1 2 3 6 6 6â€¦ å› ä¸º ctx.channel().write() æ˜¯ä»å°¾éƒ¨å¼€å§‹æŸ¥æ‰¾ï¼Œç»“æœåˆæ˜¯èŠ‚ç‚¹6 è‡ªå·±</li></ul></li></ul><p>å›¾1 - æœåŠ¡ç«¯ pipeline è§¦å‘çš„åŸå§‹æµç¨‹ï¼Œå›¾ä¸­æ•°å­—ä»£è¡¨äº†å¤„ç†æ­¥éª¤çš„å…ˆåæ¬¡åº</p><p><img src="/posts/0.htm/0009.png" alt></p><h3 id="3-5-ByteBuf"><a href="#3-5-ByteBuf" class="headerlink" title="3.5 ByteBuf"></a>3.5 ByteBuf</h3><p>æ˜¯å¯¹å­—èŠ‚æ•°æ®çš„å°è£…</p><h4 id="1ï¼‰åˆ›å»º"><a href="#1ï¼‰åˆ›å»º" class="headerlink" title="1ï¼‰åˆ›å»º"></a>1ï¼‰åˆ›å»º</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuf</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBufAllocator</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸Šé¢ä»£ç åˆ›å»ºäº†ä¸€ä¸ªé»˜è®¤çš„ ByteBufï¼ˆæ± åŒ–åŸºäºç›´æ¥å†…å­˜çš„ ByteBufï¼‰ï¼Œåˆå§‹å®¹é‡æ˜¯ 10</p><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">read index:0 write index:0 capacity:10<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å…¶ä¸­ log æ–¹æ³•å‚è€ƒå¦‚ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">ByteBuf</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> length <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> rows <span class="token operator">=</span> length <span class="token operator">/</span> <span class="token number">16</span> <span class="token operator">+</span> <span class="token punctuation">(</span>length <span class="token operator">%</span> <span class="token number">15</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">;</span>    <span class="token class-name">StringBuilder</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span>rows <span class="token operator">*</span> <span class="token number">80</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"read index:"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">readerIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" write index:"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">writerIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" capacity:"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token constant">NEWLINE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">appendPrettyHexDump</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ï¼‰ç›´æ¥å†…å­˜-vs-å †å†…å­˜"><a href="#2ï¼‰ç›´æ¥å†…å­˜-vs-å †å†…å­˜" class="headerlink" title="2ï¼‰ç›´æ¥å†…å­˜ vs å †å†…å­˜"></a>2ï¼‰ç›´æ¥å†…å­˜ vs å †å†…å­˜</h4><p>å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ¥åˆ›å»ºæ± åŒ–åŸºäºå †çš„ ByteBuf</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuf</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBufAllocator</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">.</span><span class="token function">heapBuffer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ¥åˆ›å»ºæ± åŒ–åŸºäºç›´æ¥å†…å­˜çš„ ByteBuf</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuf</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBufAllocator</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">.</span><span class="token function">directBuffer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>ç›´æ¥å†…å­˜åˆ›å»ºå’Œé”€æ¯çš„ä»£ä»·æ˜‚è´µï¼Œä½†è¯»å†™æ€§èƒ½é«˜ï¼ˆå°‘ä¸€æ¬¡å†…å­˜å¤åˆ¶ï¼‰ï¼Œé€‚åˆé…åˆæ± åŒ–åŠŸèƒ½ä¸€èµ·ç”¨</li><li>ç›´æ¥å†…å­˜å¯¹ GC å‹åŠ›å°ï¼Œå› ä¸ºè¿™éƒ¨åˆ†å†…å­˜ä¸å— JVM åƒåœ¾å›æ”¶çš„ç®¡ç†ï¼Œä½†ä¹Ÿè¦æ³¨æ„åŠæ—¶ä¸»åŠ¨é‡Šæ”¾</li></ul><h4 id="3ï¼‰æ± åŒ–-vs-éæ± åŒ–"><a href="#3ï¼‰æ± åŒ–-vs-éæ± åŒ–" class="headerlink" title="3ï¼‰æ± åŒ– vs éæ± åŒ–"></a>3ï¼‰æ± åŒ– vs éæ± åŒ–</h4><p>æ± åŒ–çš„æœ€å¤§æ„ä¹‰åœ¨äºå¯ä»¥é‡ç”¨ ByteBufï¼Œä¼˜ç‚¹æœ‰</p><ul><li>æ²¡æœ‰æ± åŒ–ï¼Œåˆ™æ¯æ¬¡éƒ½å¾—åˆ›å»ºæ–°çš„ ByteBuf å®ä¾‹ï¼Œè¿™ä¸ªæ“ä½œå¯¹ç›´æ¥å†…å­˜ä»£ä»·æ˜‚è´µï¼Œå°±ç®—æ˜¯å †å†…å­˜ï¼Œä¹Ÿä¼šå¢åŠ  GC å‹åŠ›</li><li>æœ‰äº†æ± åŒ–ï¼Œåˆ™å¯ä»¥é‡ç”¨æ± ä¸­ ByteBuf å®ä¾‹ï¼Œå¹¶ä¸”é‡‡ç”¨äº†ä¸ jemalloc ç±»ä¼¼çš„å†…å­˜åˆ†é…ç®—æ³•æå‡åˆ†é…æ•ˆç‡</li><li>é«˜å¹¶å‘æ—¶ï¼Œæ± åŒ–åŠŸèƒ½æ›´èŠ‚çº¦å†…å­˜ï¼Œå‡å°‘å†…å­˜æº¢å‡ºçš„å¯èƒ½</li></ul><p>æ± åŒ–åŠŸèƒ½æ˜¯å¦å¼€å¯ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„ç³»ç»Ÿç¯å¢ƒå˜é‡æ¥è®¾ç½®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">-</span><span class="token class-name">Dio</span><span class="token punctuation">.</span>netty<span class="token punctuation">.</span>allocator<span class="token punctuation">.</span>type<span class="token operator">=</span><span class="token punctuation">&#123;</span>unpooled<span class="token operator">|</span>pooled<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>4.1 ä»¥åï¼Œé Android å¹³å°é»˜è®¤å¯ç”¨æ± åŒ–å®ç°ï¼ŒAndroid å¹³å°å¯ç”¨éæ± åŒ–å®ç°</li><li>4.1 ä¹‹å‰ï¼Œæ± åŒ–åŠŸèƒ½è¿˜ä¸æˆç†Ÿï¼Œé»˜è®¤æ˜¯éæ± åŒ–å®ç°</li></ul><h4 id="4ï¼‰ç»„æˆ"><a href="#4ï¼‰ç»„æˆ" class="headerlink" title="4ï¼‰ç»„æˆ"></a>4ï¼‰ç»„æˆ</h4><p>ByteBuf ç”±å››éƒ¨åˆ†ç»„æˆ</p><p><img src="/posts/0.htm/0010.png" alt></p><p>æœ€å¼€å§‹è¯»å†™æŒ‡é’ˆéƒ½åœ¨ 0 ä½ç½®</p><h4 id="5ï¼‰å†™å…¥"><a href="#5ï¼‰å†™å…¥" class="headerlink" title="5ï¼‰å†™å…¥"></a>5ï¼‰å†™å…¥</h4><p>æ–¹æ³•åˆ—è¡¨ï¼Œçœç•¥ä¸€äº›ä¸é‡è¦çš„æ–¹æ³•</p><div class="table-container"><table><thead><tr><th>æ–¹æ³•ç­¾å</th><th>å«ä¹‰</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>writeBoolean(boolean value)</td><td>å†™å…¥ boolean å€¼</td><td>ç”¨ä¸€å­—èŠ‚ 01\</td><td>00 ä»£è¡¨ true\</td><td>false</td></tr><tr><td>writeByte(int value)</td><td>å†™å…¥ byte å€¼</td><td></td></tr><tr><td>writeShort(int value)</td><td>å†™å…¥ short å€¼</td><td></td></tr><tr><td>writeInt(int value)</td><td>å†™å…¥ int å€¼</td><td>Big Endianï¼Œå³ 0x250ï¼Œå†™å…¥å 00 00 02 50</td></tr><tr><td>writeIntLE(int value)</td><td>å†™å…¥ int å€¼</td><td>Little Endianï¼Œå³ 0x250ï¼Œå†™å…¥å 50 02 00 00</td></tr><tr><td>writeLong(long value)</td><td>å†™å…¥ long å€¼</td><td></td></tr><tr><td>writeChar(int value)</td><td>å†™å…¥ char å€¼</td><td></td></tr><tr><td>writeFloat(float value)</td><td>å†™å…¥ float å€¼</td><td></td></tr><tr><td>writeDouble(double value)</td><td>å†™å…¥ double å€¼</td><td></td></tr><tr><td>writeBytes(ByteBuf src)</td><td>å†™å…¥ netty çš„ ByteBuf</td><td></td></tr><tr><td>writeBytes(byte[] src)</td><td>å†™å…¥ byte[]</td><td></td></tr><tr><td>writeBytes(ByteBuffer src)</td><td>å†™å…¥ nio çš„ ByteBuffer</td><td></td></tr><tr><td>int writeCharSequence(CharSequence sequence, Charset charset)</td><td>å†™å…¥å­—ç¬¦ä¸²</td></tr></tbody></table></div><blockquote><p>æ³¨æ„</p><ul><li>è¿™äº›æ–¹æ³•çš„æœªæŒ‡æ˜è¿”å›å€¼çš„ï¼Œå…¶è¿”å›å€¼éƒ½æ˜¯ ByteBufï¼Œæ„å‘³ç€å¯ä»¥é“¾å¼è°ƒç”¨</li><li>ç½‘ç»œä¼ è¾“ï¼Œé»˜è®¤ä¹ æƒ¯æ˜¯ Big Endian</li></ul></blockquote><p>å…ˆå†™å…¥ 4 ä¸ªå­—èŠ‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">buffer<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç»“æœæ˜¯</p><pre class="line-numbers language-none"><code class="language-none">read index:0 write index:4 capacity:10         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 01 02 03 04                                     |....            |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†å†™å…¥ä¸€ä¸ª int æ•´æ•°ï¼Œä¹Ÿæ˜¯ 4 ä¸ªå­—èŠ‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">buffer<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç»“æœæ˜¯</p><pre class="line-numbers language-none"><code class="language-none">read index:0 write index:8 capacity:10         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 01 02 03 04 00 00 00 05                         |........        |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿˜æœ‰ä¸€ç±»æ–¹æ³•æ˜¯ set å¼€å¤´çš„ä¸€ç³»åˆ—æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å†™å…¥æ•°æ®ï¼Œä½†ä¸ä¼šæ”¹å˜å†™æŒ‡é’ˆä½ç½®</p><h4 id="6ï¼‰æ‰©å®¹"><a href="#6ï¼‰æ‰©å®¹" class="headerlink" title="6ï¼‰æ‰©å®¹"></a>6ï¼‰æ‰©å®¹</h4><p>å†å†™å…¥ä¸€ä¸ª int æ•´æ•°æ—¶ï¼Œå®¹é‡ä¸å¤Ÿäº†ï¼ˆåˆå§‹å®¹é‡æ˜¯ 10ï¼‰ï¼Œè¿™æ—¶ä¼šå¼•å‘æ‰©å®¹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">buffer<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ‰©å®¹è§„åˆ™æ˜¯</p><ul><li>å¦‚ä½•å†™å…¥åæ•°æ®å¤§å°æœªè¶…è¿‡ 512ï¼Œåˆ™é€‰æ‹©ä¸‹ä¸€ä¸ª 16 çš„æ•´æ•°å€ï¼Œä¾‹å¦‚å†™å…¥åå¤§å°ä¸º 12 ï¼Œåˆ™æ‰©å®¹å capacity æ˜¯ 16</li><li>å¦‚æœå†™å…¥åæ•°æ®å¤§å°è¶…è¿‡ 512ï¼Œåˆ™é€‰æ‹©ä¸‹ä¸€ä¸ª 2^nï¼Œä¾‹å¦‚å†™å…¥åå¤§å°ä¸º 513ï¼Œåˆ™æ‰©å®¹å capacity æ˜¯ 2^10=1024ï¼ˆ2^9=512 å·²ç»ä¸å¤Ÿäº†ï¼‰</li><li>æ‰©å®¹ä¸èƒ½è¶…è¿‡ max capacity ä¼šæŠ¥é”™</li></ul><p>ç»“æœæ˜¯</p><pre class="line-numbers language-none"><code class="language-none">read index:0 write index:12 capacity:16         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 01 02 03 04 00 00 00 05 00 00 00 06             |............    |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="7ï¼‰è¯»å–"><a href="#7ï¼‰è¯»å–" class="headerlink" title="7ï¼‰è¯»å–"></a>7ï¼‰è¯»å–</h4><p>ä¾‹å¦‚è¯»äº† 4 æ¬¡ï¼Œæ¯æ¬¡ä¸€ä¸ªå­—èŠ‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯»è¿‡çš„å†…å®¹ï¼Œå°±å±äºåºŸå¼ƒéƒ¨åˆ†äº†ï¼Œå†è¯»åªèƒ½è¯»é‚£äº›å°šæœªè¯»å–çš„éƒ¨åˆ†</p><pre class="line-numbers language-none"><code class="language-none">1234read index:4 write index:12 capacity:16         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 00 00 00 05 00 00 00 06                         |........        |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœéœ€è¦é‡å¤è¯»å– int æ•´æ•° 5ï¼Œæ€ä¹ˆåŠï¼Ÿ</p><p>å¯ä»¥åœ¨ read å‰å…ˆåšä¸ªæ ‡è®° mark</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">buffer<span class="token punctuation">.</span><span class="token function">markReaderIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç»“æœ</p><pre class="line-numbers language-none"><code class="language-none">5read index:8 write index:12 capacity:16         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 00 00 00 06                                     |....            |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ—¶è¦é‡å¤è¯»å–çš„è¯ï¼Œé‡ç½®åˆ°æ ‡è®°ä½ç½® reset</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">buffer<span class="token punctuation">.</span><span class="token function">resetReaderIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™æ—¶</p><pre class="line-numbers language-none"><code class="language-none">read index:4 write index:12 capacity:16         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 00 00 00 05 00 00 00 06                         |........        |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿˜æœ‰ç§åŠæ³•æ˜¯é‡‡ç”¨ get å¼€å¤´çš„ä¸€ç³»åˆ—æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¸ä¼šæ”¹å˜ read index</p><h4 id="8ï¼‰retain-amp-release"><a href="#8ï¼‰retain-amp-release" class="headerlink" title="8ï¼‰retain &amp; release"></a>8ï¼‰retain &amp; release</h4><p>ç”±äº Netty ä¸­æœ‰å †å¤–å†…å­˜çš„ ByteBuf å®ç°ï¼Œå †å¤–å†…å­˜æœ€å¥½æ˜¯æ‰‹åŠ¨æ¥é‡Šæ”¾ï¼Œè€Œä¸æ˜¯ç­‰ GC åƒåœ¾å›æ”¶ã€‚</p><ul><li>UnpooledHeapByteBuf ä½¿ç”¨çš„æ˜¯ JVM å†…å­˜ï¼Œåªéœ€ç­‰ GC å›æ”¶å†…å­˜å³å¯</li><li>UnpooledDirectByteBuf ä½¿ç”¨çš„å°±æ˜¯ç›´æ¥å†…å­˜äº†ï¼Œéœ€è¦ç‰¹æ®Šçš„æ–¹æ³•æ¥å›æ”¶å†…å­˜</li><li>PooledByteBuf å’Œå®ƒçš„å­ç±»ä½¿ç”¨äº†æ± åŒ–æœºåˆ¶ï¼Œéœ€è¦æ›´å¤æ‚çš„è§„åˆ™æ¥å›æ”¶å†…å­˜</li></ul><blockquote><p>å›æ”¶å†…å­˜çš„æºç å®ç°ï¼Œè¯·å…³æ³¨ä¸‹é¢æ–¹æ³•çš„ä¸åŒå®ç°</p><p><code>protected abstract void deallocate()</code></p></blockquote><p>Netty è¿™é‡Œé‡‡ç”¨äº†å¼•ç”¨è®¡æ•°æ³•æ¥æ§åˆ¶å›æ”¶å†…å­˜ï¼Œæ¯ä¸ª ByteBuf éƒ½å®ç°äº† ReferenceCounted æ¥å£</p><ul><li>æ¯ä¸ª ByteBuf å¯¹è±¡çš„åˆå§‹è®¡æ•°ä¸º 1</li><li>è°ƒç”¨ release æ–¹æ³•è®¡æ•°å‡ 1ï¼Œå¦‚æœè®¡æ•°ä¸º 0ï¼ŒByteBuf å†…å­˜è¢«å›æ”¶</li><li>è°ƒç”¨ retain æ–¹æ³•è®¡æ•°åŠ  1ï¼Œè¡¨ç¤ºè°ƒç”¨è€…æ²¡ç”¨å®Œä¹‹å‰ï¼Œå…¶å®ƒ handler å³ä½¿è°ƒç”¨äº† release ä¹Ÿä¸ä¼šé€ æˆå›æ”¶</li><li>å½“è®¡æ•°ä¸º 0 æ—¶ï¼Œåº•å±‚å†…å­˜ä¼šè¢«å›æ”¶ï¼Œè¿™æ—¶å³ä½¿ ByteBuf å¯¹è±¡è¿˜åœ¨ï¼Œå…¶å„ä¸ªæ–¹æ³•å‡æ— æ³•æ­£å¸¸ä½¿ç”¨</li></ul><p>è°æ¥è´Ÿè´£ release å‘¢ï¼Ÿ</p><p>ä¸æ˜¯æˆ‘ä»¬æƒ³è±¡çš„ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼‰</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>    buf<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯·æ€è€ƒï¼Œå› ä¸º pipeline çš„å­˜åœ¨ï¼Œä¸€èˆ¬éœ€è¦å°† ByteBuf ä¼ é€’ç»™ä¸‹ä¸€ä¸ª ChannelHandlerï¼Œå¦‚æœåœ¨ finally ä¸­ release äº†ï¼Œå°±å¤±å»äº†ä¼ é€’æ€§ï¼ˆå½“ç„¶ï¼Œå¦‚æœåœ¨è¿™ä¸ª ChannelHandler å†…è¿™ä¸ª ByteBuf å·²å®Œæˆäº†å®ƒçš„ä½¿å‘½ï¼Œé‚£ä¹ˆä¾¿æ— é¡»å†ä¼ é€’ï¼‰</p><p>åŸºæœ¬è§„åˆ™æ˜¯ï¼Œ<strong>è°æ˜¯æœ€åä½¿ç”¨è€…ï¼Œè°è´Ÿè´£ release</strong>ï¼Œè¯¦ç»†åˆ†æå¦‚ä¸‹</p><ul><li>èµ·ç‚¹ï¼Œå¯¹äº NIO å®ç°æ¥è®²ï¼Œåœ¨ io.netty.channel.nio.AbstractNioByteChannel.NioByteUnsafe#read æ–¹æ³•ä¸­é¦–æ¬¡åˆ›å»º ByteBuf æ”¾å…¥ pipelineï¼ˆline 163 pipeline.fireChannelRead(byteBuf)ï¼‰</li><li>å…¥ç«™ ByteBuf å¤„ç†åŸåˆ™<ul><li>å¯¹åŸå§‹ ByteBuf ä¸åšå¤„ç†ï¼Œè°ƒç”¨ ctx.fireChannelRead(msg) å‘åä¼ é€’ï¼Œè¿™æ—¶æ— é¡» release</li><li>å°†åŸå§‹ ByteBuf è½¬æ¢ä¸ºå…¶å®ƒç±»å‹çš„ Java å¯¹è±¡ï¼Œè¿™æ—¶ ByteBuf å°±æ²¡ç”¨äº†ï¼Œå¿…é¡» release</li><li>å¦‚æœä¸è°ƒç”¨ ctx.fireChannelRead(msg) å‘åä¼ é€’ï¼Œé‚£ä¹ˆä¹Ÿå¿…é¡» release</li><li>æ³¨æ„å„ç§å¼‚å¸¸ï¼Œå¦‚æœ ByteBuf æ²¡æœ‰æˆåŠŸä¼ é€’åˆ°ä¸‹ä¸€ä¸ª ChannelHandlerï¼Œå¿…é¡» release</li><li>å‡è®¾æ¶ˆæ¯ä¸€ç›´å‘åä¼ ï¼Œé‚£ä¹ˆ TailContext ä¼šè´Ÿè´£é‡Šæ”¾æœªå¤„ç†æ¶ˆæ¯ï¼ˆåŸå§‹çš„ ByteBufï¼‰</li></ul></li><li>å‡ºç«™ ByteBuf å¤„ç†åŸåˆ™<ul><li>å‡ºç«™æ¶ˆæ¯æœ€ç»ˆéƒ½ä¼šè½¬ä¸º ByteBuf è¾“å‡ºï¼Œä¸€ç›´å‘å‰ä¼ ï¼Œç”± HeadContext flush å release</li></ul></li><li>å¼‚å¸¸å¤„ç†åŸåˆ™<ul><li>æœ‰æ—¶å€™ä¸æ¸…æ¥š ByteBuf è¢«å¼•ç”¨äº†å¤šå°‘æ¬¡ï¼Œä½†åˆå¿…é¡»å½»åº•é‡Šæ”¾ï¼Œå¯ä»¥å¾ªç¯è°ƒç”¨ release ç›´åˆ°è¿”å› true</li></ul></li></ul><p>TailContext é‡Šæ”¾æœªå¤„ç†æ¶ˆæ¯é€»è¾‘</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// io.netty.channel.DefaultChannelPipeline#onUnhandledInboundMessage(java.lang.Object)</span><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onUnhandledInboundMessage</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>            <span class="token string">"Discarded inbound message &#123;&#125; that reached at the tail of the pipeline. "</span> <span class="token operator">+</span>            <span class="token string">"Please check your pipeline configuration."</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ReferenceCountUtil</span><span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…·ä½“ä»£ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// io.netty.util.ReferenceCountUtil#release(java.lang.Object)</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">release</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">ReferenceCounted</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ReferenceCounted</span><span class="token punctuation">)</span> msg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="9ï¼‰slice"><a href="#9ï¼‰slice" class="headerlink" title="9ï¼‰slice"></a>9ï¼‰slice</h4><p>ã€é›¶æ‹·è´ã€‘çš„ä½“ç°ä¹‹ä¸€ï¼Œå¯¹åŸå§‹ ByteBuf è¿›è¡Œåˆ‡ç‰‡æˆå¤šä¸ª ByteBufï¼Œåˆ‡ç‰‡åçš„ ByteBuf å¹¶æ²¡æœ‰å‘ç”Ÿå†…å­˜å¤åˆ¶ï¼Œè¿˜æ˜¯ä½¿ç”¨åŸå§‹ ByteBuf çš„å†…å­˜ï¼Œåˆ‡ç‰‡åçš„ ByteBuf ç»´æŠ¤ç‹¬ç«‹çš„ readï¼Œwrite æŒ‡é’ˆ</p><p><img src="/posts/0.htm/0011.png" alt></p><p>ä¾‹ï¼ŒåŸå§‹ ByteBuf è¿›è¡Œä¸€äº›åˆå§‹æ“ä½œ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuf</span> origin <span class="token operator">=</span> <span class="token class-name">ByteBufAllocator</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>origin<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>origin<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ByteBufUtil</span><span class="token punctuation">.</span><span class="token function">prettyHexDump</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 02 03 04                                        |...             |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ—¶è°ƒç”¨ slice è¿›è¡Œåˆ‡ç‰‡ï¼Œæ— å‚ slice æ˜¯ä»åŸå§‹ ByteBuf çš„ read index åˆ° write index ä¹‹é—´çš„å†…å®¹è¿›è¡Œåˆ‡ç‰‡ï¼Œåˆ‡ç‰‡åçš„ max capacity è¢«å›ºå®šä¸ºè¿™ä¸ªåŒºé—´çš„å¤§å°ï¼Œå› æ­¤ä¸èƒ½è¿½åŠ  write</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuf</span> slice <span class="token operator">=</span> origin<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ByteBufUtil</span><span class="token punctuation">.</span><span class="token function">prettyHexDump</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// slice.writeByte(5); å¦‚æœæ‰§è¡Œï¼Œä¼šæŠ¥ IndexOutOfBoundsException å¼‚å¸¸</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 02 03 04                                        |...             |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœåŸå§‹ ByteBuf å†æ¬¡è¯»æ“ä½œï¼ˆåˆè¯»äº†ä¸€ä¸ªå­—èŠ‚ï¼‰</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">origin<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ByteBufUtil</span><span class="token punctuation">.</span><span class="token function">prettyHexDump</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 03 04                                           |..              |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ—¶çš„ slice ä¸å—å½±å“ï¼Œå› ä¸ºå®ƒæœ‰ç‹¬ç«‹çš„è¯»å†™æŒ‡é’ˆ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ByteBufUtil</span><span class="token punctuation">.</span><span class="token function">prettyHexDump</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 02 03 04                                        |...             |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœ slice çš„å†…å®¹å‘ç”Ÿäº†æ›´æ”¹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">slice<span class="token punctuation">.</span><span class="token function">setByte</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ByteBufUtil</span><span class="token punctuation">.</span><span class="token function">prettyHexDump</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 02 03 05                                        |...             |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ—¶ï¼ŒåŸå§‹ ByteBuf ä¹Ÿä¼šå—å½±å“ï¼Œå› ä¸ºåº•å±‚éƒ½æ˜¯åŒä¸€å—å†…å­˜</p><pre class="line-numbers language-none"><code class="language-none">System.out.println(ByteBufUtil.prettyHexDump(origin));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 03 05                                           |..              |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="10ï¼‰duplicate"><a href="#10ï¼‰duplicate" class="headerlink" title="10ï¼‰duplicate"></a>10ï¼‰duplicate</h4><p>ã€é›¶æ‹·è´ã€‘çš„ä½“ç°ä¹‹ä¸€ï¼Œå°±å¥½æ¯”æˆªå–äº†åŸå§‹ ByteBuf æ‰€æœ‰å†…å®¹ï¼Œå¹¶ä¸”æ²¡æœ‰ max capacity çš„é™åˆ¶ï¼Œä¹Ÿæ˜¯ä¸åŸå§‹ ByteBuf ä½¿ç”¨åŒä¸€å—åº•å±‚å†…å­˜ï¼Œåªæ˜¯è¯»å†™æŒ‡é’ˆæ˜¯ç‹¬ç«‹çš„</p><p><img src="/posts/0.htm/0012.png" alt></p><h4 id="11ï¼‰copy"><a href="#11ï¼‰copy" class="headerlink" title="11ï¼‰copy"></a>11ï¼‰copy</h4><p>ä¼šå°†åº•å±‚å†…å­˜æ•°æ®è¿›è¡Œæ·±æ‹·è´ï¼Œå› æ­¤æ— è®ºè¯»å†™ï¼Œéƒ½ä¸åŸå§‹ ByteBuf æ— å…³</p><h4 id="12ï¼‰CompositeByteBuf"><a href="#12ï¼‰CompositeByteBuf" class="headerlink" title="12ï¼‰CompositeByteBuf"></a>12ï¼‰CompositeByteBuf</h4><p>ã€é›¶æ‹·è´ã€‘çš„ä½“ç°ä¹‹ä¸€ï¼Œå¯ä»¥å°†å¤šä¸ª ByteBuf åˆå¹¶ä¸ºä¸€ä¸ªé€»è¾‘ä¸Šçš„ ByteBufï¼Œé¿å…æ‹·è´</p><p>æœ‰ä¸¤ä¸ª ByteBuf å¦‚ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuf</span> buf1 <span class="token operator">=</span> <span class="token class-name">ByteBufAllocator</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>buf1<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">ByteBuf</span> buf2 <span class="token operator">=</span> <span class="token class-name">ByteBufAllocator</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>buf2<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ByteBufUtil</span><span class="token punctuation">.</span><span class="token function">prettyHexDump</span><span class="token punctuation">(</span>buf1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ByteBufUtil</span><span class="token punctuation">.</span><span class="token function">prettyHexDump</span><span class="token punctuation">(</span>buf2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 01 02 03 04 05                                  |.....           |+--------+-------------------------------------------------+----------------+         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 06 07 08 09 0a                                  |.....           |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨éœ€è¦ä¸€ä¸ªæ–°çš„ ByteBufï¼Œå†…å®¹æ¥è‡ªäºåˆšæ‰çš„ buf1 å’Œ buf2ï¼Œå¦‚ä½•å®ç°ï¼Ÿ</p><p>æ–¹æ³•1ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuf</span> buf3 <span class="token operator">=</span> <span class="token class-name">ByteBufAllocator</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span>    <span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span>buf1<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>buf2<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>buf3<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>buf1<span class="token punctuation">)</span><span class="token punctuation">;</span>buf3<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>buf2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ByteBufUtil</span><span class="token punctuation">.</span><span class="token function">prettyHexDump</span><span class="token punctuation">(</span>buf3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»“æœ</p><pre class="line-numbers language-none"><code class="language-none">         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ç§æ–¹æ³•å¥½ä¸å¥½ï¼Ÿå›ç­”æ˜¯ä¸å¤ªå¥½ï¼Œå› ä¸ºè¿›è¡Œäº†æ•°æ®çš„å†…å­˜å¤åˆ¶æ“ä½œ</p><p>æ–¹æ³•2ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">CompositeByteBuf</span> buf3 <span class="token operator">=</span> <span class="token class-name">ByteBufAllocator</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">.</span><span class="token function">compositeBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true è¡¨ç¤ºå¢åŠ æ–°çš„ ByteBuf è‡ªåŠ¨é€’å¢ write index, å¦åˆ™ write index ä¼šå§‹ç»ˆä¸º 0</span>buf3<span class="token punctuation">.</span><span class="token function">addComponents</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> buf1<span class="token punctuation">,</span> buf2<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç»“æœæ˜¯ä¸€æ ·çš„</p><pre class="line-numbers language-none"><code class="language-none">         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>CompositeByteBuf æ˜¯ä¸€ä¸ªç»„åˆçš„ ByteBufï¼Œå®ƒå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª Component æ•°ç»„ï¼Œæ¯ä¸ª Component ç®¡ç†ä¸€ä¸ª ByteBufï¼Œè®°å½•äº†è¿™ä¸ª ByteBuf ç›¸å¯¹äºæ•´ä½“åç§»é‡ç­‰ä¿¡æ¯ï¼Œä»£è¡¨ç€æ•´ä½“ä¸­æŸä¸€æ®µçš„æ•°æ®ã€‚</p><ul><li>ä¼˜ç‚¹ï¼Œå¯¹å¤–æ˜¯ä¸€ä¸ªè™šæ‹Ÿè§†å›¾ï¼Œç»„åˆè¿™äº› ByteBuf ä¸ä¼šäº§ç”Ÿå†…å­˜å¤åˆ¶</li><li>ç¼ºç‚¹ï¼Œå¤æ‚äº†å¾ˆå¤šï¼Œå¤šæ¬¡æ“ä½œä¼šå¸¦æ¥æ€§èƒ½çš„æŸè€—</li></ul><h4 id="13ï¼‰Unpooled"><a href="#13ï¼‰Unpooled" class="headerlink" title="13ï¼‰Unpooled"></a>13ï¼‰Unpooled</h4><p>Unpooled æ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œç±»å¦‚å…¶åï¼Œæä¾›äº†éæ± åŒ–çš„ ByteBuf åˆ›å»ºã€ç»„åˆã€å¤åˆ¶ç­‰æ“ä½œ</p><p>è¿™é‡Œä»…ä»‹ç»å…¶è·Ÿã€é›¶æ‹·è´ã€‘ç›¸å…³çš„ wrappedBuffer æ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥åŒ…è£… ByteBuf</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuf</span> buf1 <span class="token operator">=</span> <span class="token class-name">ByteBufAllocator</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>buf1<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">ByteBuf</span> buf2 <span class="token operator">=</span> <span class="token class-name">ByteBufAllocator</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>buf2<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å½“åŒ…è£… ByteBuf ä¸ªæ•°è¶…è¿‡ä¸€ä¸ªæ—¶, åº•å±‚ä½¿ç”¨äº† CompositeByteBuf</span><span class="token class-name">ByteBuf</span> buf3 <span class="token operator">=</span> <span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">wrappedBuffer</span><span class="token punctuation">(</span>buf1<span class="token punctuation">,</span> buf2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ByteBufUtil</span><span class="token punctuation">.</span><span class="token function">prettyHexDump</span><span class="token punctuation">(</span>buf3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥ç”¨æ¥åŒ…è£…æ™®é€šå­—èŠ‚æ•°ç»„ï¼Œåº•å±‚ä¹Ÿä¸ä¼šæœ‰æ‹·è´æ“ä½œ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuf</span> buf4 <span class="token operator">=</span> <span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">wrappedBuffer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buf4<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ByteBufUtil</span><span class="token punctuation">.</span><span class="token function">prettyHexDump</span><span class="token punctuation">(</span>buf4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">class io.netty.buffer.CompositeByteBuf         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 01 02 03 04 05 06                               |......          |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ğŸ’¡-ByteBuf-ä¼˜åŠ¿"><a href="#ğŸ’¡-ByteBuf-ä¼˜åŠ¿" class="headerlink" title="ğŸ’¡ ByteBuf ä¼˜åŠ¿"></a>ğŸ’¡ ByteBuf ä¼˜åŠ¿</h4><ul><li>æ± åŒ– - å¯ä»¥é‡ç”¨æ± ä¸­ ByteBuf å®ä¾‹ï¼Œæ›´èŠ‚çº¦å†…å­˜ï¼Œå‡å°‘å†…å­˜æº¢å‡ºçš„å¯èƒ½</li><li>è¯»å†™æŒ‡é’ˆåˆ†ç¦»ï¼Œä¸éœ€è¦åƒ ByteBuffer ä¸€æ ·åˆ‡æ¢è¯»å†™æ¨¡å¼</li><li>å¯ä»¥è‡ªåŠ¨æ‰©å®¹</li><li>æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œä½¿ç”¨æ›´æµç•…</li><li>å¾ˆå¤šåœ°æ–¹ä½“ç°é›¶æ‹·è´ï¼Œä¾‹å¦‚ sliceã€duplicateã€CompositeByteBuf</li></ul><h2 id="4-åŒå‘é€šä¿¡"><a href="#4-åŒå‘é€šä¿¡" class="headerlink" title="4. åŒå‘é€šä¿¡"></a>4. åŒå‘é€šä¿¡</h2><h3 id="4-1-ç»ƒä¹ "><a href="#4-1-ç»ƒä¹ " class="headerlink" title="4.1 ç»ƒä¹ "></a>4.1 ç»ƒä¹ </h3><p>å®ç°ä¸€ä¸ª echo server</p><p>ç¼–å†™ server</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">ByteBuf</span> buffer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// å»ºè®®ä½¿ç”¨ ctx.alloc() åˆ›å»º ByteBuf</span>                    <span class="token class-name">ByteBuf</span> response <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    response<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                    ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// æ€è€ƒï¼šéœ€è¦é‡Šæ”¾ buffer å—</span>                    <span class="token comment">// æ€è€ƒï¼šéœ€è¦é‡Šæ”¾ response å—</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¼–å†™ client</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">NioEventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">ByteBuf</span> buffer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// æ€è€ƒï¼šéœ€è¦é‡Šæ”¾ buffer å—</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>channel<span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>future <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    group<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> line <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"q"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ğŸ’¡-è¯»å’Œå†™çš„è¯¯è§£"><a href="#ğŸ’¡-è¯»å’Œå†™çš„è¯¯è§£" class="headerlink" title="ğŸ’¡ è¯»å’Œå†™çš„è¯¯è§£"></a>ğŸ’¡ è¯»å’Œå†™çš„è¯¯è§£</h3><p>æˆ‘æœ€åˆåœ¨è®¤è¯†ä¸Šæœ‰è¿™æ ·çš„è¯¯åŒºï¼Œè®¤ä¸ºåªæœ‰åœ¨ nettyï¼Œnio è¿™æ ·çš„å¤šè·¯å¤ç”¨ IO æ¨¡å‹æ—¶ï¼Œè¯»å†™æ‰ä¸ä¼šç›¸äº’é˜»å¡ï¼Œæ‰å¯ä»¥å®ç°é«˜æ•ˆçš„åŒå‘é€šä¿¡ï¼Œä½†å®é™…ä¸Šï¼ŒJava Socket æ˜¯å…¨åŒå·¥çš„ï¼šåœ¨ä»»æ„æ—¶åˆ»ï¼Œçº¿è·¯ä¸Šå­˜åœ¨<code>A åˆ° B</code> å’Œ <code>B åˆ° A</code> çš„åŒå‘ä¿¡å·ä¼ è¾“ã€‚å³ä½¿æ˜¯é˜»å¡ IOï¼Œè¯»å’Œå†™æ˜¯å¯ä»¥åŒæ—¶è¿›è¡Œçš„ï¼Œåªè¦åˆ†åˆ«é‡‡ç”¨è¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹å³å¯ï¼Œè¯»ä¸ä¼šé˜»å¡å†™ã€å†™ä¹Ÿä¸ä¼šé˜»å¡è¯»</p><p>ä¾‹å¦‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestServer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServerSocket</span> ss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Socket</span> s <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">BufferedReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">BufferedWriter</span> writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedWriter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OutputStreamWriter</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// ä¾‹å¦‚åœ¨è¿™ä¸ªä½ç½®åŠ å…¥ thread çº§åˆ«æ–­ç‚¹ï¼Œå¯ä»¥å‘ç°å³ä½¿ä¸å†™å…¥æ•°æ®ï¼Œä¹Ÿä¸å¦¨ç¢å‰é¢çº¿ç¨‹è¯»å–å®¢æˆ·ç«¯æ•°æ®</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    writer<span class="token punctuation">.</span><span class="token function">newLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestClient</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Socket</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">BufferedReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">BufferedWriter</span> writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedWriter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OutputStreamWriter</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    writer<span class="token punctuation">.</span><span class="token function">newLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;äºŒ-Netty-å…¥é—¨&quot;&gt;&lt;a href=&quot;#äºŒ-Netty-å…¥é—¨&quot; class=&quot;headerlink&quot; title=&quot;äºŒ. Netty å…¥é—¨&quot;&gt;&lt;/a&gt;äºŒ. Netty å…¥é—¨&lt;/h1&gt;&lt;h2 id=&quot;1-æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#1-æ¦‚è¿°&quot; class=&quot;he</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://100qin10086.github.io/posts/0.html"/>
    <id>https://100qin10086.github.io/posts/0.html</id>
    <published>2024-05-06T14:13:59.606Z</published>
    <updated>2024-05-06T14:13:59.606Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸‰-Netty-è¿›é˜¶"><a href="#ä¸‰-Netty-è¿›é˜¶" class="headerlink" title="ä¸‰. Netty è¿›é˜¶"></a>ä¸‰. Netty è¿›é˜¶</h1><h2 id="1-ç²˜åŒ…ä¸åŠåŒ…"><a href="#1-ç²˜åŒ…ä¸åŠåŒ…" class="headerlink" title="1. ç²˜åŒ…ä¸åŠåŒ…"></a>1. ç²˜åŒ…ä¸åŠåŒ…</h2><h3 id="1-1-ç²˜åŒ…ç°è±¡"><a href="#1-1-ç²˜åŒ…ç°è±¡" class="headerlink" title="1.1 ç²˜åŒ…ç°è±¡"></a>1.1 ç²˜åŒ…ç°è±¡</h3><p>æœåŠ¡ç«¯ä»£ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorldServer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">HelloWorldServer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">NioEventLoopGroup</span> boss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">NioEventLoopGroup</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">ServerBootstrap</span> serverBootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            serverBootstrap<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            serverBootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>boss<span class="token punctuation">,</span> worker<span class="token punctuation">)</span><span class="token punctuation">;</span>            serverBootstrap<span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token annotation punctuation">@Override</span>                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"connected &#123;&#125;"</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">channelActive</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                        <span class="token annotation punctuation">@Override</span>                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelInactive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"disconnect &#123;&#125;"</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">channelInactive</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> serverBootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; binding..."</span><span class="token punctuation">,</span> channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channelFuture<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; bound..."</span><span class="token punctuation">,</span> channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"server error"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            boss<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            worker<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"stoped"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">new</span> <span class="token class-name">HelloWorldServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯ä»£ç å¸Œæœ›å‘é€ 10 ä¸ªæ¶ˆæ¯ï¼Œæ¯ä¸ªæ¶ˆæ¯æ˜¯ 16 å­—èŠ‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorldClient</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">HelloWorldClient</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">NioEventLoopGroup</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>worker<span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"connetted..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token annotation punctuation">@Override</span>                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"sending..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">Random</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token char">'a'</span><span class="token punctuation">;</span>                            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                <span class="token class-name">ByteBuf</span> buffer <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                buffer<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"client error"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            worker<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœåŠ¡å™¨ç«¯çš„æŸæ¬¡è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°ä¸€æ¬¡å°±æ¥æ”¶äº† 160 ä¸ªå­—èŠ‚ï¼Œè€Œéåˆ† 10 æ¬¡æ¥æ”¶</p><pre class="line-numbers language-none"><code class="language-none">08:24:46 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0x81e0fda5] binding...08:24:46 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0x81e0fda5, L:&#x2F;0:0:0:0:0:0:0:0:8080] bound...08:24:55 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x94132411, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:58177] REGISTERED08:24:55 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x94132411, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:58177] ACTIVE08:24:55 [DEBUG] [nioEventLoopGroup-3-1] c.i.n.HelloWorldServer - connected [id: 0x94132411, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:58177]08:24:55 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x94132411, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:58177] READ: 160B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................||00000010| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................||00000020| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................||00000030| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................||00000040| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................||00000050| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................||00000060| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................||00000070| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................||00000080| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................||00000090| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................|+--------+-------------------------------------------------+----------------+08:24:55 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x94132411, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:58177] READ COMPLETE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-2-åŠåŒ…ç°è±¡"><a href="#1-2-åŠåŒ…ç°è±¡" class="headerlink" title="1.2 åŠåŒ…ç°è±¡"></a>1.2 åŠåŒ…ç°è±¡</h3><p>å®¢æˆ·ç«¯ä»£ç å¸Œæœ›å‘é€ 1 ä¸ªæ¶ˆæ¯ï¼Œè¿™ä¸ªæ¶ˆæ¯æ˜¯ 160 å­—èŠ‚ï¼Œä»£ç æ”¹ä¸º</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuf</span> buffer <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    buffer<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ºç°è±¡æ˜æ˜¾ï¼ŒæœåŠ¡ç«¯ä¿®æ”¹ä¸€ä¸‹æ¥æ”¶ç¼“å†²åŒºï¼Œå…¶å®ƒä»£ç ä¸å˜</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">serverBootstrap<span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span><span class="token constant">SO_RCVBUF</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æœåŠ¡å™¨ç«¯çš„æŸæ¬¡è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°æ¥æ”¶çš„æ¶ˆæ¯è¢«åˆ†ä¸ºä¸¤èŠ‚ï¼Œç¬¬ä¸€æ¬¡ 20 å­—èŠ‚ï¼Œç¬¬äºŒæ¬¡ 140 å­—èŠ‚</p><pre class="line-numbers language-none"><code class="language-none">08:43:49 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0x4d6c6a84] binding...08:43:49 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0x4d6c6a84, L:&#x2F;0:0:0:0:0:0:0:0:8080] bound...08:44:23 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:59221] REGISTERED08:44:23 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:59221] ACTIVE08:44:23 [DEBUG] [nioEventLoopGroup-3-1] c.i.n.HelloWorldServer - connected [id: 0x1719abf7, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:59221]08:44:24 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:59221] READ: 20B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f |................||00000010| 00 01 02 03                                     |....            |+--------+-------------------------------------------------+----------------+08:44:24 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:59221] READ COMPLETE08:44:24 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:59221] READ: 140B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................||00000010| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................||00000020| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................||00000030| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................||00000040| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................||00000050| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................||00000060| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................||00000070| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 00 01 02 03 |................||00000080| 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f             |............    |+--------+-------------------------------------------------+----------------+08:44:24 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:&#x2F;127.0.0.1:8080 - R:&#x2F;127.0.0.1:59221] READ COMPLETE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>æ³¨æ„</strong></p><p>serverBootstrap.option(ChannelOption.SO_RCVBUF, 10) å½±å“çš„åº•å±‚æ¥æ”¶ç¼“å†²åŒºï¼ˆå³æ»‘åŠ¨çª—å£ï¼‰å¤§å°ï¼Œä»…å†³å®šäº† netty è¯»å–çš„æœ€å°å•ä½ï¼Œnetty å®é™…æ¯æ¬¡è¯»å–çš„ä¸€èˆ¬æ˜¯å®ƒçš„æ•´æ•°å€</p></blockquote><h3 id="1-3-ç°è±¡åˆ†æ"><a href="#1-3-ç°è±¡åˆ†æ" class="headerlink" title="1.3 ç°è±¡åˆ†æ"></a>1.3 ç°è±¡åˆ†æ</h3><p>ç²˜åŒ…</p><ul><li>ç°è±¡ï¼Œå‘é€ abc defï¼Œæ¥æ”¶ abcdef</li><li>åŸå› <ul><li>åº”ç”¨å±‚ï¼šæ¥æ”¶æ–¹ ByteBuf è®¾ç½®å¤ªå¤§ï¼ˆNetty é»˜è®¤ 1024ï¼‰</li><li>æ»‘åŠ¨çª—å£ï¼šå‡è®¾å‘é€æ–¹ 256 bytes è¡¨ç¤ºä¸€ä¸ªå®Œæ•´æŠ¥æ–‡ï¼Œä½†ç”±äºæ¥æ”¶æ–¹å¤„ç†ä¸åŠæ—¶ä¸”çª—å£å¤§å°è¶³å¤Ÿå¤§ï¼Œè¿™ 256 bytes å­—èŠ‚å°±ä¼šç¼“å†²åœ¨æ¥æ”¶æ–¹çš„æ»‘åŠ¨çª—å£ä¸­ï¼Œå½“æ»‘åŠ¨çª—å£ä¸­ç¼“å†²äº†å¤šä¸ªæŠ¥æ–‡å°±ä¼šç²˜åŒ…</li><li>Nagle ç®—æ³•ï¼šä¼šé€ æˆç²˜åŒ…</li></ul></li></ul><p>åŠåŒ…</p><ul><li>ç°è±¡ï¼Œå‘é€ abcdefï¼Œæ¥æ”¶ abc def</li><li>åŸå› <ul><li>åº”ç”¨å±‚ï¼šæ¥æ”¶æ–¹ ByteBuf å°äºå®é™…å‘é€æ•°æ®é‡</li><li>æ»‘åŠ¨çª—å£ï¼šå‡è®¾æ¥æ”¶æ–¹çš„çª—å£åªå‰©äº† 128 bytesï¼Œå‘é€æ–¹çš„æŠ¥æ–‡å¤§å°æ˜¯ 256 bytesï¼Œè¿™æ—¶æ”¾ä¸ä¸‹äº†ï¼Œåªèƒ½å…ˆå‘é€å‰ 128 bytesï¼Œç­‰å¾… ack åæ‰èƒ½å‘é€å‰©ä½™éƒ¨åˆ†ï¼Œè¿™å°±é€ æˆäº†åŠåŒ…</li><li>MSS é™åˆ¶ï¼šå½“å‘é€çš„æ•°æ®è¶…è¿‡ MSS é™åˆ¶åï¼Œä¼šå°†æ•°æ®åˆ‡åˆ†å‘é€ï¼Œå°±ä¼šé€ æˆåŠåŒ…</li></ul></li></ul><p>æœ¬è´¨æ˜¯å› ä¸º TCP æ˜¯æµå¼åè®®ï¼Œæ¶ˆæ¯æ— è¾¹ç•Œ</p><blockquote><p>æ»‘åŠ¨çª—å£</p><ul><li><p>TCP ä»¥ä¸€ä¸ªæ®µï¼ˆsegmentï¼‰ä¸ºå•ä½ï¼Œæ¯å‘é€ä¸€ä¸ªæ®µå°±éœ€è¦è¿›è¡Œä¸€æ¬¡ç¡®è®¤åº”ç­”ï¼ˆackï¼‰å¤„ç†ï¼Œä½†å¦‚æœè¿™ä¹ˆåšï¼Œç¼ºç‚¹æ˜¯åŒ…çš„å¾€è¿”æ—¶é—´è¶Šé•¿æ€§èƒ½å°±è¶Šå·®</p><p><img src="/posts/0.htm/0049.png" alt></p></li></ul><ul><li><p>ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼Œå¼•å…¥äº†çª—å£æ¦‚å¿µï¼Œçª—å£å¤§å°å³å†³å®šäº†æ— éœ€ç­‰å¾…åº”ç­”è€Œå¯ä»¥ç»§ç»­å‘é€çš„æ•°æ®æœ€å¤§å€¼</p><p><img src="/posts/0.htm/0051.png" alt></p></li><li><p>çª—å£å®é™…å°±èµ·åˆ°ä¸€ä¸ªç¼“å†²åŒºçš„ä½œç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½èµ·åˆ°æµé‡æ§åˆ¶çš„ä½œç”¨</p><ul><li>å›¾ä¸­æ·±è‰²çš„éƒ¨åˆ†å³è¦å‘é€çš„æ•°æ®ï¼Œé«˜äº®çš„éƒ¨åˆ†å³çª—å£</li><li>çª—å£å†…çš„æ•°æ®æ‰å…è®¸è¢«å‘é€ï¼Œå½“åº”ç­”æœªåˆ°è¾¾å‰ï¼Œçª—å£å¿…é¡»åœæ­¢æ»‘åŠ¨</li><li>å¦‚æœ 1001~2000 è¿™ä¸ªæ®µçš„æ•°æ® ack å›æ¥äº†ï¼Œçª—å£å°±å¯ä»¥å‘å‰æ»‘åŠ¨</li><li>æ¥æ”¶æ–¹ä¹Ÿä¼šç»´æŠ¤ä¸€ä¸ªçª—å£ï¼Œåªæœ‰è½åœ¨çª—å£å†…çš„æ•°æ®æ‰èƒ½å…è®¸æ¥æ”¶</li></ul></li></ul><p> MSS é™åˆ¶</p><ul><li><p>é“¾è·¯å±‚å¯¹ä¸€æ¬¡èƒ½å¤Ÿå‘é€çš„æœ€å¤§æ•°æ®æœ‰é™åˆ¶ï¼Œè¿™ä¸ªé™åˆ¶ç§°ä¹‹ä¸º MTUï¼ˆmaximum transmission unitï¼‰ï¼Œä¸åŒçš„é“¾è·¯è®¾å¤‡çš„ MTU å€¼ä¹Ÿæœ‰æ‰€ä¸åŒï¼Œä¾‹å¦‚</p><ul><li>ä»¥å¤ªç½‘çš„ MTU æ˜¯ 1500</li><li>FDDIï¼ˆå…‰çº¤åˆ†å¸ƒå¼æ•°æ®æ¥å£ï¼‰çš„ MTU æ˜¯ 4352</li><li>æœ¬åœ°å›ç¯åœ°å€çš„ MTU æ˜¯ 65535 - æœ¬åœ°æµ‹è¯•ä¸èµ°ç½‘å¡</li></ul></li><li><p>MSS æ˜¯æœ€å¤§æ®µé•¿åº¦ï¼ˆmaximum segment sizeï¼‰ï¼Œå®ƒæ˜¯ MTU åˆ¨å» tcp å¤´å’Œ ip å¤´åå‰©ä½™èƒ½å¤Ÿä½œä¸ºæ•°æ®ä¼ è¾“çš„å­—èŠ‚æ•°</p><ul><li>ipv4 tcp å¤´å ç”¨ 20 bytesï¼Œip å¤´å ç”¨ 20 bytesï¼Œå› æ­¤ä»¥å¤ªç½‘ MSS çš„å€¼ä¸º 1500 - 40 = 1460</li><li>TCP åœ¨ä¼ é€’å¤§é‡æ•°æ®æ—¶ï¼Œä¼šæŒ‰ç…§ MSS å¤§å°å°†æ•°æ®è¿›è¡Œåˆ†å‰²å‘é€</li><li>MSS çš„å€¼åœ¨ä¸‰æ¬¡æ¡æ‰‹æ—¶é€šçŸ¥å¯¹æ–¹è‡ªå·± MSS çš„å€¼ï¼Œç„¶ååœ¨ä¸¤è€…ä¹‹é—´é€‰æ‹©ä¸€ä¸ªå°å€¼ä½œä¸º MSS</li></ul><p><img src="/posts/0.htm/0031.jpg" style="zoom:50%;"></p></li></ul><p>Nagle ç®—æ³•</p><ul><li>å³ä½¿å‘é€ä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿéœ€è¦åŠ å…¥ tcp å¤´å’Œ ip å¤´ï¼Œä¹Ÿå°±æ˜¯æ€»å­—èŠ‚æ•°ä¼šä½¿ç”¨ 41 bytesï¼Œéå¸¸ä¸ç»æµã€‚å› æ­¤ä¸ºäº†æé«˜ç½‘ç»œåˆ©ç”¨ç‡ï¼Œtcp å¸Œæœ›å°½å¯èƒ½å‘é€è¶³å¤Ÿå¤§çš„æ•°æ®ï¼Œè¿™å°±æ˜¯ Nagle ç®—æ³•äº§ç”Ÿçš„ç¼˜ç”±</li><li>è¯¥ç®—æ³•æ˜¯æŒ‡å‘é€ç«¯å³ä½¿è¿˜æœ‰åº”è¯¥å‘é€çš„æ•°æ®ï¼Œä½†å¦‚æœè¿™éƒ¨åˆ†æ•°æ®å¾ˆå°‘çš„è¯ï¼Œåˆ™è¿›è¡Œå»¶è¿Ÿå‘é€<ul><li>å¦‚æœ SO_SNDBUF çš„æ•°æ®è¾¾åˆ° MSSï¼Œåˆ™éœ€è¦å‘é€</li><li>å¦‚æœ SO_SNDBUF ä¸­å«æœ‰ FINï¼ˆè¡¨ç¤ºéœ€è¦è¿æ¥å…³é—­ï¼‰è¿™æ—¶å°†å‰©ä½™æ•°æ®å‘é€ï¼Œå†å…³é—­</li><li>å¦‚æœ TCP_NODELAY = trueï¼Œåˆ™éœ€è¦å‘é€</li><li>å·²å‘é€çš„æ•°æ®éƒ½æ”¶åˆ° ack æ—¶ï¼Œåˆ™éœ€è¦å‘é€</li><li>ä¸Šè¿°æ¡ä»¶ä¸æ»¡è¶³ï¼Œä½†å‘ç”Ÿè¶…æ—¶ï¼ˆä¸€èˆ¬ä¸º 200msï¼‰åˆ™éœ€è¦å‘é€</li><li>é™¤ä¸Šè¿°æƒ…å†µï¼Œå»¶è¿Ÿå‘é€</li></ul></li></ul></blockquote><h3 id="1-4-è§£å†³æ–¹æ¡ˆ"><a href="#1-4-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="1.4 è§£å†³æ–¹æ¡ˆ"></a>1.4 è§£å†³æ–¹æ¡ˆ</h3><ol><li>çŸ­é“¾æ¥ï¼Œå‘ä¸€ä¸ªåŒ…å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼Œè¿™æ ·è¿æ¥å»ºç«‹åˆ°è¿æ¥æ–­å¼€ä¹‹é—´å°±æ˜¯æ¶ˆæ¯çš„è¾¹ç•Œï¼Œç¼ºç‚¹æ•ˆç‡å¤ªä½</li><li>æ¯ä¸€æ¡æ¶ˆæ¯é‡‡ç”¨å›ºå®šé•¿åº¦ï¼Œç¼ºç‚¹æµªè´¹ç©ºé—´</li><li>æ¯ä¸€æ¡æ¶ˆæ¯é‡‡ç”¨åˆ†éš”ç¬¦ï¼Œä¾‹å¦‚ \nï¼Œç¼ºç‚¹éœ€è¦è½¬ä¹‰</li><li>æ¯ä¸€æ¡æ¶ˆæ¯åˆ†ä¸º head å’Œ bodyï¼Œhead ä¸­åŒ…å« body çš„é•¿åº¦</li></ol><h4 id="æ–¹æ³•1ï¼ŒçŸ­é“¾æ¥"><a href="#æ–¹æ³•1ï¼ŒçŸ­é“¾æ¥" class="headerlink" title="æ–¹æ³•1ï¼ŒçŸ­é“¾æ¥"></a>æ–¹æ³•1ï¼ŒçŸ­é“¾æ¥</h4><p>ä»¥è§£å†³ç²˜åŒ…ä¸ºä¾‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorldClient</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">HelloWorldClient</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// åˆ† 10 æ¬¡å‘é€</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">NioEventLoopGroup</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>worker<span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"conneted..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token annotation punctuation">@Override</span>                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"sending..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">ByteBuf</span> buffer <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            buffer<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token comment">// å‘å®Œå³å…³</span>                            ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"client error"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            worker<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡ºï¼Œç•¥</p><blockquote><p>åŠåŒ…ç”¨è¿™ç§åŠæ³•è¿˜æ˜¯ä¸å¥½è§£å†³ï¼Œå› ä¸ºæ¥æ”¶æ–¹çš„ç¼“å†²åŒºå¤§å°æ˜¯æœ‰é™çš„</p></blockquote><h4 id="æ–¹æ³•2ï¼Œå›ºå®šé•¿åº¦"><a href="#æ–¹æ³•2ï¼Œå›ºå®šé•¿åº¦" class="headerlink" title="æ–¹æ³•2ï¼Œå›ºå®šé•¿åº¦"></a>æ–¹æ³•2ï¼Œå›ºå®šé•¿åº¦</h4><p>è®©æ‰€æœ‰æ•°æ®åŒ…é•¿åº¦å›ºå®šï¼ˆå‡è®¾é•¿åº¦ä¸º 8 å­—èŠ‚ï¼‰ï¼ŒæœåŠ¡å™¨ç«¯åŠ å…¥</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FixedLengthFrameDecoder</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®¢æˆ·ç«¯æµ‹è¯•ä»£ç ï¼Œæ³¨æ„, é‡‡ç”¨è¿™ç§æ–¹æ³•åï¼Œå®¢æˆ·ç«¯ä»€ä¹ˆæ—¶å€™ flush éƒ½å¯ä»¥</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorldClient</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">HelloWorldClient</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">NioEventLoopGroup</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>worker<span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"connetted..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token annotation punctuation">@Override</span>                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"sending..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token comment">// å‘é€å†…å®¹éšæœºçš„æ•°æ®åŒ…</span>                            <span class="token class-name">Random</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token char">'a'</span><span class="token punctuation">;</span>                            <span class="token class-name">ByteBuf</span> buffer <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> r<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                    bytes<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> c<span class="token punctuation">;</span>                                <span class="token punctuation">&#125;</span>                                c<span class="token operator">++</span><span class="token punctuation">;</span>                                buffer<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"192.168.0.103"</span><span class="token punctuation">,</span> <span class="token number">9090</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"client error"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            worker<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">12:07:00 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - connetted...12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2] REGISTERED12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2] CONNECT: &#x2F;192.168.0.103:909012:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2, L:&#x2F;192.168.0.103:53155 - R:&#x2F;192.168.0.103:9090] ACTIVE12:07:00 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - sending...12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2, L:&#x2F;192.168.0.103:53155 - R:&#x2F;192.168.0.103:9090] WRITE: 80B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 61 61 61 61 00 00 00 00 62 00 00 00 00 00 00 00 |aaaa....b.......||00000010| 63 63 00 00 00 00 00 00 64 00 00 00 00 00 00 00 |cc......d.......||00000020| 00 00 00 00 00 00 00 00 66 66 66 66 00 00 00 00 |........ffff....||00000030| 67 67 67 00 00 00 00 00 68 00 00 00 00 00 00 00 |ggg.....h.......||00000040| 69 69 69 69 69 00 00 00 6a 6a 6a 6a 00 00 00 00 |iiiii...jjjj....|+--------+-------------------------------------------------+----------------+12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2, L:&#x2F;192.168.0.103:53155 - R:&#x2F;192.168.0.103:9090] FLUSH<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœåŠ¡ç«¯è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">12:06:51 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0xe3d9713f] binding...12:06:51 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0xe3d9713f, L:&#x2F;192.168.0.103:9090] bound...12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:53155] REGISTERED12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:53155] ACTIVE12:07:00 [DEBUG] [nioEventLoopGroup-3-1] c.i.n.HelloWorldServer - connected [id: 0xd739f137, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:53155]12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:53155] READ: 8B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 61 61 61 61 00 00 00 00                         |aaaa....        |+--------+-------------------------------------------------+----------------+12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:53155] READ: 8B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 62 00 00 00 00 00 00 00                         |b.......        |+--------+-------------------------------------------------+----------------+12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:53155] READ: 8B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 63 63 00 00 00 00 00 00                         |cc......        |+--------+-------------------------------------------------+----------------+12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:53155] READ: 8B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 64 00 00 00 00 00 00 00                         |d.......        |+--------+-------------------------------------------------+----------------+12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:53155] READ: 8B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 00 00 00 00 00 00 00 00                         |........        |+--------+-------------------------------------------------+----------------+12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:53155] READ: 8B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 66 66 66 66 00 00 00 00                         |ffff....        |+--------+-------------------------------------------------+----------------+12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:53155] READ: 8B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 67 67 67 00 00 00 00 00                         |ggg.....        |+--------+-------------------------------------------------+----------------+12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:53155] READ: 8B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 68 00 00 00 00 00 00 00                         |h.......        |+--------+-------------------------------------------------+----------------+12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:53155] READ: 8B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 69 69 69 69 69 00 00 00                         |iiiii...        |+--------+-------------------------------------------------+----------------+12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:53155] READ: 8B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 6a 6a 6a 6a 00 00 00 00                         |jjjj....        |+--------+-------------------------------------------------+----------------+12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:53155] READ COMPLETE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¼ºç‚¹æ˜¯ï¼Œæ•°æ®åŒ…çš„å¤§å°ä¸å¥½æŠŠæ¡</p><ul><li>é•¿åº¦å®šçš„å¤ªå¤§ï¼Œæµªè´¹</li><li>é•¿åº¦å®šçš„å¤ªå°ï¼Œå¯¹æŸäº›æ•°æ®åŒ…åˆæ˜¾å¾—ä¸å¤Ÿ</li></ul><h4 id="æ–¹æ³•3ï¼Œå›ºå®šåˆ†éš”ç¬¦"><a href="#æ–¹æ³•3ï¼Œå›ºå®šåˆ†éš”ç¬¦" class="headerlink" title="æ–¹æ³•3ï¼Œå›ºå®šåˆ†éš”ç¬¦"></a>æ–¹æ³•3ï¼Œå›ºå®šåˆ†éš”ç¬¦</h4><p>æœåŠ¡ç«¯åŠ å…¥ï¼Œé»˜è®¤ä»¥ \n æˆ– \r\n ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå¦‚æœè¶…å‡ºæŒ‡å®šé•¿åº¦ä»æœªå‡ºç°åˆ†éš”ç¬¦ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LineBasedFrameDecoder</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®¢æˆ·ç«¯åœ¨æ¯æ¡æ¶ˆæ¯ä¹‹åï¼ŒåŠ å…¥ \n åˆ†éš”ç¬¦</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorldClient</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">HelloWorldClient</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">NioEventLoopGroup</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>worker<span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"connetted..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token annotation punctuation">@Override</span>                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"sending..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">Random</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token char">'a'</span><span class="token punctuation">;</span>                            <span class="token class-name">ByteBuf</span> buffer <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> r<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                    buffer<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token punctuation">&#125;</span>                                buffer<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                c<span class="token operator">++</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"192.168.0.103"</span><span class="token punctuation">,</span> <span class="token number">9090</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"client error"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            worker<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">14:08:18 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - connetted...14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755] REGISTERED14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755] CONNECT: &#x2F;192.168.0.103:909014:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755, L:&#x2F;192.168.0.103:63641 - R:&#x2F;192.168.0.103:9090] ACTIVE14:08:18 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - sending...14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755, L:&#x2F;192.168.0.103:63641 - R:&#x2F;192.168.0.103:9090] WRITE: 60B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 61 0a 62 62 62 0a 63 63 63 0a 64 64 0a 65 65 65 |a.bbb.ccc.dd.eee||00000010| 65 65 65 65 65 65 65 0a 66 66 0a 67 67 67 67 67 |eeeeeee.ff.ggggg||00000020| 67 67 0a 68 68 68 68 0a 69 69 69 69 69 69 69 0a |gg.hhhh.iiiiiii.||00000030| 6a 6a 6a 6a 6a 6a 6a 6a 6a 6a 6a 0a             |jjjjjjjjjjj.    |+--------+-------------------------------------------------+----------------+14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755, L:&#x2F;192.168.0.103:63641 - R:&#x2F;192.168.0.103:9090] FLUSH<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœåŠ¡ç«¯è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">14:08:18 [DEBUG] [nioEventLoopGroup-3-5] c.i.n.HelloWorldServer - connected [id: 0xa4b3be43, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:63641]14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:63641] READ: 1B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 61                                              |a               |+--------+-------------------------------------------------+----------------+14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:63641] READ: 3B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 62 62 62                                        |bbb             |+--------+-------------------------------------------------+----------------+14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:63641] READ: 3B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 63 63 63                                        |ccc             |+--------+-------------------------------------------------+----------------+14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:63641] READ: 2B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 64 64                                           |dd              |+--------+-------------------------------------------------+----------------+14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:63641] READ: 10B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 65 65 65 65 65 65 65 65 65 65                   |eeeeeeeeee      |+--------+-------------------------------------------------+----------------+14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:63641] READ: 2B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 66 66                                           |ff              |+--------+-------------------------------------------------+----------------+14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:63641] READ: 7B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 67 67 67 67 67 67 67                            |ggggggg         |+--------+-------------------------------------------------+----------------+14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:63641] READ: 4B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 68 68 68 68                                     |hhhh            |+--------+-------------------------------------------------+----------------+14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:63641] READ: 7B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 69 69 69 69 69 69 69                            |iiiiiii         |+--------+-------------------------------------------------+----------------+14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:63641] READ: 11B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 6a 6a 6a 6a 6a 6a 6a 6a 6a 6a 6a                |jjjjjjjjjjj     |+--------+-------------------------------------------------+----------------+14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:63641] READ COMPLETE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¼ºç‚¹ï¼Œå¤„ç†å­—ç¬¦æ•°æ®æ¯”è¾ƒåˆé€‚ï¼Œä½†å¦‚æœå†…å®¹æœ¬èº«åŒ…å«äº†åˆ†éš”ç¬¦ï¼ˆå­—èŠ‚æ•°æ®å¸¸å¸¸ä¼šæœ‰æ­¤æƒ…å†µï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šè§£æé”™è¯¯</p><h4 id="æ–¹æ³•4ï¼Œé¢„è®¾é•¿åº¦"><a href="#æ–¹æ³•4ï¼Œé¢„è®¾é•¿åº¦" class="headerlink" title="æ–¹æ³•4ï¼Œé¢„è®¾é•¿åº¦"></a>æ–¹æ³•4ï¼Œé¢„è®¾é•¿åº¦</h4><p>åœ¨å‘é€æ¶ˆæ¯å‰ï¼Œå…ˆçº¦å®šç”¨å®šé•¿å­—èŠ‚è¡¨ç¤ºæ¥ä¸‹æ¥æ•°æ®çš„é•¿åº¦</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æœ€å¤§é•¿åº¦ï¼Œé•¿åº¦åç§»ï¼Œé•¿åº¦å ç”¨å­—èŠ‚ï¼Œé•¿åº¦è°ƒæ•´ï¼Œå‰¥ç¦»å­—èŠ‚æ•°</span>ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LengthFieldBasedFrameDecoder</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯ä»£ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorldClient</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">HelloWorldClient</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">NioEventLoopGroup</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>worker<span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"connetted..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token annotation punctuation">@Override</span>                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"sending..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">Random</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token char">'a'</span><span class="token punctuation">;</span>                            <span class="token class-name">ByteBuf</span> buffer <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                <span class="token keyword">byte</span> length <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token comment">// å…ˆå†™å…¥é•¿åº¦</span>                                buffer<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token comment">// å†</span>                                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                    buffer<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token punctuation">&#125;</span>                                c<span class="token operator">++</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"192.168.0.103"</span><span class="token punctuation">,</span> <span class="token number">9090</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"client error"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            worker<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">14:37:10 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - connetted...14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8] REGISTERED14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8] CONNECT: &#x2F;192.168.0.103:909014:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8, L:&#x2F;192.168.0.103:49979 - R:&#x2F;192.168.0.103:9090] ACTIVE14:37:10 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - sending...14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8, L:&#x2F;192.168.0.103:49979 - R:&#x2F;192.168.0.103:9090] WRITE: 97B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 09 61 61 61 61 61 61 61 61 61 09 62 62 62 62 62 |.aaaaaaaaa.bbbbb||00000010| 62 62 62 62 06 63 63 63 63 63 63 08 64 64 64 64 |bbbb.cccccc.dddd||00000020| 64 64 64 64 0f 65 65 65 65 65 65 65 65 65 65 65 |dddd.eeeeeeeeeee||00000030| 65 65 65 65 0d 66 66 66 66 66 66 66 66 66 66 66 |eeee.fffffffffff||00000040| 66 66 02 67 67 02 68 68 0e 69 69 69 69 69 69 69 |ff.gg.hh.iiiiiii||00000050| 69 69 69 69 69 69 69 09 6a 6a 6a 6a 6a 6a 6a 6a |iiiiiii.jjjjjjjj||00000060| 6a                                              |j               |+--------+-------------------------------------------------+----------------+14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8, L:&#x2F;192.168.0.103:49979 - R:&#x2F;192.168.0.103:9090] FLUSH<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœåŠ¡ç«¯è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">14:36:50 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0xdff439d3] binding...14:36:51 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0xdff439d3, L:&#x2F;192.168.0.103:9090] bound...14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:49979] REGISTERED14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:49979] ACTIVE14:37:10 [DEBUG] [nioEventLoopGroup-3-1] c.i.n.HelloWorldServer - connected [id: 0x744f2b47, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:49979]14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:49979] READ: 9B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 61 61 61 61 61 61 61 61 61                      |aaaaaaaaa       |+--------+-------------------------------------------------+----------------+14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:49979] READ: 9B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 62 62 62 62 62 62 62 62 62                      |bbbbbbbbb       |+--------+-------------------------------------------------+----------------+14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:49979] READ: 6B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 63 63 63 63 63 63                               |cccccc          |+--------+-------------------------------------------------+----------------+14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:49979] READ: 8B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 64 64 64 64 64 64 64 64                         |dddddddd        |+--------+-------------------------------------------------+----------------+14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:49979] READ: 15B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 65 65 65 65 65 65 65 65 65 65 65 65 65 65 65    |eeeeeeeeeeeeeee |+--------+-------------------------------------------------+----------------+14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:49979] READ: 13B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 66 66 66 66 66 66 66 66 66 66 66 66 66          |fffffffffffff   |+--------+-------------------------------------------------+----------------+14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:49979] READ: 2B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 67 67                                           |gg              |+--------+-------------------------------------------------+----------------+14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:49979] READ: 2B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 68 68                                           |hh              |+--------+-------------------------------------------------+----------------+14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:49979] READ: 14B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 69 69 69 69 69 69 69 69 69 69 69 69 69 69       |iiiiiiiiiiiiii  |+--------+-------------------------------------------------+----------------+14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:49979] READ: 9B         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 6a 6a 6a 6a 6a 6a 6a 6a 6a                      |jjjjjjjjj       |+--------+-------------------------------------------------+----------------+14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:&#x2F;192.168.0.103:9090 - R:&#x2F;192.168.0.103:49979] READ COMPLETE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-åè®®è®¾è®¡ä¸è§£æ"><a href="#2-åè®®è®¾è®¡ä¸è§£æ" class="headerlink" title="2. åè®®è®¾è®¡ä¸è§£æ"></a>2. åè®®è®¾è®¡ä¸è§£æ</h2><h3 id="2-1-ä¸ºä»€ä¹ˆéœ€è¦åè®®ï¼Ÿ"><a href="#2-1-ä¸ºä»€ä¹ˆéœ€è¦åè®®ï¼Ÿ" class="headerlink" title="2.1 ä¸ºä»€ä¹ˆéœ€è¦åè®®ï¼Ÿ"></a>2.1 ä¸ºä»€ä¹ˆéœ€è¦åè®®ï¼Ÿ</h3><p>TCP/IP ä¸­æ¶ˆæ¯ä¼ è¾“åŸºäºæµçš„æ–¹å¼ï¼Œæ²¡æœ‰è¾¹ç•Œã€‚</p><p>åè®®çš„ç›®çš„å°±æ˜¯åˆ’å®šæ¶ˆæ¯çš„è¾¹ç•Œï¼Œåˆ¶å®šé€šä¿¡åŒæ–¹è¦å…±åŒéµå®ˆçš„é€šä¿¡è§„åˆ™</p><p>ä¾‹å¦‚ï¼šåœ¨ç½‘ç»œä¸Šä¼ è¾“</p><pre class="line-numbers language-none"><code class="language-none">ä¸‹é›¨å¤©ç•™å®¢å¤©ç•™æˆ‘ä¸ç•™<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ˜¯ä¸­æ–‡ä¸€å¥è‘—åçš„æ— æ ‡ç‚¹ç¬¦å·å¥å­ï¼Œåœ¨æ²¡æœ‰æ ‡ç‚¹ç¬¦å·æƒ…å†µä¸‹ï¼Œè¿™å¥è¯æœ‰æ•°ç§æ‹†è§£æ–¹å¼ï¼Œè€Œæ„æ€å´æ˜¯å®Œå…¨ä¸åŒï¼Œæ‰€ä»¥å¸¸è¢«ç”¨ä½œè®²è¿°æ ‡ç‚¹ç¬¦å·çš„é‡è¦æ€§</p><p>ä¸€ç§è§£è¯»</p><pre class="line-numbers language-none"><code class="language-none">ä¸‹é›¨å¤©ç•™å®¢ï¼Œå¤©ç•™ï¼Œæˆ‘ä¸ç•™<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦ä¸€ç§è§£è¯»</p><pre class="line-numbers language-none"><code class="language-none">ä¸‹é›¨å¤©ï¼Œç•™å®¢å¤©ï¼Œç•™æˆ‘ä¸ï¼Ÿç•™<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚ä½•è®¾è®¡åè®®å‘¢ï¼Ÿå…¶å®å°±æ˜¯ç»™ç½‘ç»œä¼ è¾“çš„ä¿¡æ¯åŠ ä¸Šâ€œæ ‡ç‚¹ç¬¦å·â€ã€‚ä½†é€šè¿‡åˆ†éš”ç¬¦æ¥æ–­å¥ä¸æ˜¯å¾ˆå¥½ï¼Œå› ä¸ºåˆ†éš”ç¬¦æœ¬èº«å¦‚æœç”¨äºä¼ è¾“ï¼Œé‚£ä¹ˆå¿…é¡»åŠ ä»¥åŒºåˆ†ã€‚å› æ­¤ï¼Œä¸‹é¢ä¸€ç§åè®®è¾ƒä¸ºå¸¸ç”¨</p><pre class="line-numbers language-none"><code class="language-none">å®šé•¿å­—èŠ‚è¡¨ç¤ºå†…å®¹é•¿åº¦ + å®é™…å†…å®¹<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ªä¸­æ–‡å­—ç¬¦é•¿åº¦ä¸º 3ï¼ŒæŒ‰ç…§ä¸Šè¿°åè®®çš„è§„åˆ™ï¼Œå‘é€ä¿¡æ¯æ–¹å¼å¦‚ä¸‹ï¼Œå°±ä¸ä¼šè¢«æ¥æ”¶æ–¹å¼„é”™æ„æ€äº†</p><pre class="line-numbers language-none"><code class="language-none">0fä¸‹é›¨å¤©ç•™å®¢06å¤©ç•™09æˆ‘ä¸ç•™<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>å°æ•…äº‹</p><p>å¾ˆä¹…å¾ˆä¹…ä»¥å‰ï¼Œä¸€ä½ç§å¡¾å…ˆç”Ÿåˆ°ä¸€å®¶ä»»æ•™ã€‚åŒæ–¹ç­¾è®¢äº†ä¸€çº¸åè®®ï¼šâ€œæ— é¸¡é¸­äº¦å¯æ— é±¼è‚‰äº¦å¯ç™½èœè±†è…ä¸å¯å°‘ä¸å¾—æŸä¿®é‡‘â€ã€‚æ­¤åï¼Œç§å¡¾å…ˆç”Ÿè™½ç„¶è®¤çœŸæ•™è¯¾ï¼Œä½†ä¸»äººå®¶åˆ™æ€»æ˜¯ç»™ç§å¡¾å…ˆç”Ÿä»¥ç™½èœè±†è…ä¸ºèœï¼Œä¸æ¯«æœªè§é¸¡é¸­é±¼è‚‰çš„æ¬¾å¾…ã€‚ç§å¡¾å…ˆç”Ÿå…ˆæ˜¯å¾ˆä¸è§£ï¼Œå¯æ˜¯åæ¥ä¹Ÿå°±æƒ³é€šäº†ï¼šä¸»äººæŠŠé¸¡é¸­é±¼è‚‰çš„é’±éƒ½ä¼šæ¢ä¸ºæŸä¿®é‡‘çš„ï¼Œä¹Ÿç½¢ã€‚è‡³æ­¤åŒæ–¹ç›¸å®‰æ— äº‹ã€‚</p><p>å¹´å…³å°†è‡³ï¼Œä¸€ä¸ªå­¦å¹´æ®µäº¦å‘Šç»“æŸã€‚ç§å¡¾å…ˆç”Ÿä¸´è¡Œæ—¶ï¼Œä¹Ÿä¸è§ä¸»äººå®¶ä¸ºä»–äº¤ä»˜æŸä¿®é‡‘ï¼Œé‚ä¸ä¸»å®¶ç†è®ºã€‚ç„¶ä¸»å®¶äº¦æŒ¯æŒ¯æœ‰è¯ï¼šâ€œæœ‰åè®®ä¸ºè¯â€”â€”æ— é¸¡é¸­äº¦å¯ï¼Œæ— é±¼è‚‰äº¦å¯ï¼Œç™½èœè±†è…ä¸å¯å°‘ï¼Œä¸å¾—æŸä¿®é‡‘ã€‚è¿™ç™½çº¸é»‘å­—æ˜æ‘†ç€çš„ï¼Œä½ æœ‰ä»€ä¹ˆè¦è¯´çš„å‘¢ï¼Ÿâ€</p><p>ç§å¡¾å…ˆç”Ÿæ®ç†åŠ›äº‰ï¼šâ€œåè®®æ˜¯è¿™æ ·çš„â€”â€”æ— é¸¡ï¼Œé¸­äº¦å¯ï¼›æ— é±¼ï¼Œè‚‰äº¦å¯ï¼›ç™½èœè±†è…ä¸å¯ï¼Œå°‘ä¸å¾—æŸä¿®é‡‘ã€‚â€</p><p>åŒæ–¹å”‡æªèˆŒæˆ˜ï¼Œä½ æ¥æˆ‘å¾€ï¼ŒçœŸä¸ªæ˜¯ä¸äº¦ä¹ä¹ï¼</p><p>è¿™é‡Œçš„æŸä¿®é‡‘ï¼Œä¹Ÿä½œâ€œæŸè„©â€ï¼Œåº”å½“æ˜¯æ³›æŒ‡æ•™å¸ˆåº”å½“å¾—åˆ°çš„æŠ¥é…¬</p></blockquote><h3 id="2-2-redis-åè®®ä¸¾ä¾‹"><a href="#2-2-redis-åè®®ä¸¾ä¾‹" class="headerlink" title="2.2 redis åè®®ä¸¾ä¾‹"></a>2.2 redis åè®®ä¸¾ä¾‹</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">NioEventLoopGroup</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">LINE</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    bootstrap<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>worker<span class="token punctuation">)</span><span class="token punctuation">;</span>    bootstrap<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// ä¼šåœ¨è¿æ¥ channel å»ºç«‹æˆåŠŸåï¼Œä¼šè§¦å‘ active äº‹ä»¶</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token function">set</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token function">get</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token string">"*2"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token constant">LINE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token string">"$3"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token constant">LINE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token constant">LINE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token string">"$3"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token constant">LINE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token string">"aaa"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token constant">LINE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token string">"*3"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token constant">LINE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token string">"$3"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token constant">LINE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token string">"set"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token constant">LINE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token string">"$3"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token constant">LINE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token string">"aaa"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token constant">LINE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token string">"$3"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token constant">LINE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token string">"bbb"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    buf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token constant">LINE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"client error"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>    worker<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-3-http-åè®®ä¸¾ä¾‹"><a href="#2-3-http-åè®®ä¸¾ä¾‹" class="headerlink" title="2.3 http åè®®ä¸¾ä¾‹"></a>2.3 http åè®®ä¸¾ä¾‹</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">NioEventLoopGroup</span> boss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">NioEventLoopGroup</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">ServerBootstrap</span> serverBootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    serverBootstrap<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    serverBootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>boss<span class="token punctuation">,</span> worker<span class="token punctuation">)</span><span class="token punctuation">;</span>    serverBootstrap<span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpServerCodec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HttpRequest</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">HttpRequest</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">// è·å–è¯·æ±‚</span>                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// è¿”å›å“åº”</span>                    <span class="token class-name">DefaultFullHttpResponse</span> response <span class="token operator">=</span>                            <span class="token keyword">new</span> <span class="token class-name">DefaultFullHttpResponse</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">protocolVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">HttpResponseStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token string">"&lt;h1>Hello, world!&lt;/h1>"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    response<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token constant">CONTENT_LENGTH</span><span class="token punctuation">,</span> bytes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>                    response<span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// å†™å›å“åº”</span>                    ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">/*ch.pipeline().addLast(new ChannelInboundHandlerAdapter() &#123;                @Override                public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123;                    log.debug("&#123;&#125;", msg.getClass());                    if (msg instanceof HttpRequest) &#123; // è¯·æ±‚è¡Œï¼Œè¯·æ±‚å¤´                    &#125; else if (msg instanceof HttpContent) &#123; //è¯·æ±‚ä½“                    &#125;                &#125;            &#125;);*/</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> serverBootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"server error"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>    boss<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    worker<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-4-è‡ªå®šä¹‰åè®®è¦ç´ "><a href="#2-4-è‡ªå®šä¹‰åè®®è¦ç´ " class="headerlink" title="2.4 è‡ªå®šä¹‰åè®®è¦ç´ "></a>2.4 è‡ªå®šä¹‰åè®®è¦ç´ </h3><ul><li>é­”æ•°ï¼Œç”¨æ¥åœ¨ç¬¬ä¸€æ—¶é—´åˆ¤å®šæ˜¯å¦æ˜¯æ— æ•ˆæ•°æ®åŒ…</li><li>ç‰ˆæœ¬å·ï¼Œå¯ä»¥æ”¯æŒåè®®çš„å‡çº§</li><li>åºåˆ—åŒ–ç®—æ³•ï¼Œæ¶ˆæ¯æ­£æ–‡åˆ°åº•é‡‡ç”¨å“ªç§åºåˆ—åŒ–ååºåˆ—åŒ–æ–¹å¼ï¼Œå¯ä»¥ç”±æ­¤æ‰©å±•ï¼Œä¾‹å¦‚ï¼šjsonã€protobufã€hessianã€jdk</li><li>æŒ‡ä»¤ç±»å‹ï¼Œæ˜¯ç™»å½•ã€æ³¨å†Œã€å•èŠã€ç¾¤èŠâ€¦ è·Ÿä¸šåŠ¡ç›¸å…³</li><li>è¯·æ±‚åºå·ï¼Œä¸ºäº†åŒå·¥é€šä¿¡ï¼Œæä¾›å¼‚æ­¥èƒ½åŠ›</li><li>æ­£æ–‡é•¿åº¦</li><li>æ¶ˆæ¯æ­£æ–‡</li></ul><h4 id="ç¼–è§£ç å™¨"><a href="#ç¼–è§£ç å™¨" class="headerlink" title="ç¼–è§£ç å™¨"></a>ç¼–è§£ç å™¨</h4><p>æ ¹æ®ä¸Šé¢çš„è¦ç´ ï¼Œè®¾è®¡ä¸€ä¸ªç™»å½•è¯·æ±‚æ¶ˆæ¯å’Œç™»å½•å“åº”æ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨ Netty å®Œæˆæ”¶å‘</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageCodec</span> <span class="token keyword">extends</span> <span class="token class-name">ByteToMessageCodec</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Message</span> msg<span class="token punctuation">,</span> <span class="token class-name">ByteBuf</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 1. 4 å­—èŠ‚çš„é­”æ•°</span>        out<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 2. 1 å­—èŠ‚çš„ç‰ˆæœ¬,</span>        out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 3. 1 å­—èŠ‚çš„åºåˆ—åŒ–æ–¹å¼ jdk 0 , json 1</span>        out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 4. 1 å­—èŠ‚çš„æŒ‡ä»¤ç±»å‹</span>        out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getMessageType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 5. 4 ä¸ªå­—èŠ‚</span>        out<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getSequenceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ— æ„ä¹‰ï¼Œå¯¹é½å¡«å……</span>        out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span><span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 6. è·å–å†…å®¹çš„å­—èŠ‚æ•°ç»„</span>        <span class="token class-name">ByteArrayOutputStream</span> bos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>bos<span class="token punctuation">)</span><span class="token punctuation">;</span>        oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> bos<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 7. é•¿åº¦</span>        out<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 8. å†™å…¥å†…å®¹</span>        out<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">ByteBuf</span> in<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> magicNum <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span> version <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span> serializerType <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span> messageType <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> sequenceId <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> length <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>        in<span class="token punctuation">.</span><span class="token function">readBytes</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token punctuation">)</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;"</span><span class="token punctuation">,</span> magicNum<span class="token punctuation">,</span> version<span class="token punctuation">,</span> serializerType<span class="token punctuation">,</span> messageType<span class="token punctuation">,</span> sequenceId<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">EmbeddedChannel</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EmbeddedChannel</span><span class="token punctuation">(</span>    <span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">new</span> <span class="token class-name">LengthFieldBasedFrameDecoder</span><span class="token punctuation">(</span>        <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">new</span> <span class="token class-name">MessageCodec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// encode</span><span class="token class-name">LoginRequestMessage</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoginRequestMessage</span><span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">,</span> <span class="token string">"123"</span><span class="token punctuation">,</span> <span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        channel.writeOutbound(message);</span><span class="token comment">// decode</span><span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token class-name">ByteBufAllocator</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">new</span> <span class="token class-name">MessageCodec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">ByteBuf</span> s1 <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">ByteBuf</span> s2 <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s1<span class="token punctuation">.</span><span class="token function">retain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¼•ç”¨è®¡æ•° 2</span>channel<span class="token punctuation">.</span><span class="token function">writeInbound</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// release 1</span>channel<span class="token punctuation">.</span><span class="token function">writeInbound</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è§£è¯»</p><p><img src="/posts/0.htm/0013.png" alt></p><h4 id="ğŸ’¡-ä»€ä¹ˆæ—¶å€™å¯ä»¥åŠ -Sharable"><a href="#ğŸ’¡-ä»€ä¹ˆæ—¶å€™å¯ä»¥åŠ -Sharable" class="headerlink" title="ğŸ’¡ ä»€ä¹ˆæ—¶å€™å¯ä»¥åŠ  @Sharable"></a>ğŸ’¡ ä»€ä¹ˆæ—¶å€™å¯ä»¥åŠ  @Sharable</h4><ul><li>å½“ handler ä¸ä¿å­˜çŠ¶æ€æ—¶ï¼Œå°±å¯ä»¥å®‰å…¨åœ°åœ¨å¤šçº¿ç¨‹ä¸‹è¢«å…±äº«</li><li>ä½†è¦æ³¨æ„å¯¹äºç¼–è§£ç å™¨ç±»ï¼Œä¸èƒ½ç»§æ‰¿ ByteToMessageCodec æˆ– CombinedChannelDuplexHandler çˆ¶ç±»ï¼Œä»–ä»¬çš„æ„é€ æ–¹æ³•å¯¹ @Sharable æœ‰é™åˆ¶</li><li>å¦‚æœèƒ½ç¡®ä¿ç¼–è§£ç å™¨ä¸ä¼šä¿å­˜çŠ¶æ€ï¼Œå¯ä»¥ç»§æ‰¿ MessageToMessageCodec çˆ¶ç±»</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@ChannelHandler.Sharable</span><span class="token comment">/** * å¿…é¡»å’Œ LengthFieldBasedFrameDecoder ä¸€èµ·ä½¿ç”¨ï¼Œç¡®ä¿æ¥åˆ°çš„ ByteBuf æ¶ˆæ¯æ˜¯å®Œæ•´çš„ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageCodecSharable</span> <span class="token keyword">extends</span> <span class="token class-name">MessageToMessageCodec</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ByteBuf</span><span class="token punctuation">,</span> <span class="token class-name">Message</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Message</span> msg<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> outList<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ByteBuf</span> out <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 1. 4 å­—èŠ‚çš„é­”æ•°</span>        out<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 2. 1 å­—èŠ‚çš„ç‰ˆæœ¬,</span>        out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 3. 1 å­—èŠ‚çš„åºåˆ—åŒ–æ–¹å¼ jdk 0 , json 1</span>        out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 4. 1 å­—èŠ‚çš„æŒ‡ä»¤ç±»å‹</span>        out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getMessageType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 5. 4 ä¸ªå­—èŠ‚</span>        out<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getSequenceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ— æ„ä¹‰ï¼Œå¯¹é½å¡«å……</span>        out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span><span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 6. è·å–å†…å®¹çš„å­—èŠ‚æ•°ç»„</span>        <span class="token class-name">ByteArrayOutputStream</span> bos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>bos<span class="token punctuation">)</span><span class="token punctuation">;</span>        oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> bos<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 7. é•¿åº¦</span>        out<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 8. å†™å…¥å†…å®¹</span>        out<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>        outList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">ByteBuf</span> in<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> magicNum <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span> version <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span> serializerType <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span> messageType <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> sequenceId <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> length <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>        in<span class="token punctuation">.</span><span class="token function">readBytes</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token punctuation">)</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;"</span><span class="token punctuation">,</span> magicNum<span class="token punctuation">,</span> version<span class="token punctuation">,</span> serializerType<span class="token punctuation">,</span> messageType<span class="token punctuation">,</span> sequenceId<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-èŠå¤©å®¤æ¡ˆä¾‹"><a href="#3-èŠå¤©å®¤æ¡ˆä¾‹" class="headerlink" title="3. èŠå¤©å®¤æ¡ˆä¾‹"></a>3. èŠå¤©å®¤æ¡ˆä¾‹</h2><h3 id="3-1-èŠå¤©å®¤ä¸šåŠ¡ä»‹ç»"><a href="#3-1-èŠå¤©å®¤ä¸šåŠ¡ä»‹ç»" class="headerlink" title="3.1 èŠå¤©å®¤ä¸šåŠ¡ä»‹ç»"></a>3.1 èŠå¤©å®¤ä¸šåŠ¡ä»‹ç»</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ç”¨æˆ·ç®¡ç†æ¥å£ */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserService</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * ç™»å½•     * @param username ç”¨æˆ·å     * @param password å¯†ç      * @return ç™»å½•æˆåŠŸè¿”å› true, å¦åˆ™è¿”å› false     */</span>    <span class="token keyword">boolean</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ä¼šè¯ç®¡ç†æ¥å£ */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Session</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * ç»‘å®šä¼šè¯     * @param channel å“ªä¸ª channel è¦ç»‘å®šä¼šè¯     * @param username ä¼šè¯ç»‘å®šç”¨æˆ·     */</span>    <span class="token keyword">void</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> channel<span class="token punctuation">,</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * è§£ç»‘ä¼šè¯     * @param channel å“ªä¸ª channel è¦è§£ç»‘ä¼šè¯     */</span>    <span class="token keyword">void</span> <span class="token function">unbind</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * è·å–å±æ€§     * @param channel å“ªä¸ª channel     * @param name å±æ€§å     * @return å±æ€§å€¼     */</span>    <span class="token class-name">Object</span> <span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> channel<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * è®¾ç½®å±æ€§     * @param channel å“ªä¸ª channel     * @param name å±æ€§å     * @param value å±æ€§å€¼     */</span>    <span class="token keyword">void</span> <span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> channel<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * æ ¹æ®ç”¨æˆ·åè·å– channel     * @param username ç”¨æˆ·å     * @return channel     */</span>    <span class="token class-name">Channel</span> <span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * èŠå¤©ç»„ä¼šè¯ç®¡ç†æ¥å£ */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">GroupSession</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * åˆ›å»ºä¸€ä¸ªèŠå¤©ç»„, å¦‚æœä¸å­˜åœ¨æ‰èƒ½åˆ›å»ºæˆåŠŸ, å¦åˆ™è¿”å› null     * @param name ç»„å     * @param members æˆå‘˜     * @return æˆåŠŸæ—¶è¿”å›ç»„å¯¹è±¡, å¤±è´¥è¿”å› null     */</span>    <span class="token class-name">Group</span> <span class="token function">createGroup</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> members<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * åŠ å…¥èŠå¤©ç»„     * @param name ç»„å     * @param member æˆå‘˜å     * @return å¦‚æœç»„ä¸å­˜åœ¨è¿”å› null, å¦åˆ™è¿”å›ç»„å¯¹è±¡     */</span>    <span class="token class-name">Group</span> <span class="token function">joinMember</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> member<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * ç§»é™¤ç»„æˆå‘˜     * @param name ç»„å     * @param member æˆå‘˜å     * @return å¦‚æœç»„ä¸å­˜åœ¨è¿”å› null, å¦åˆ™è¿”å›ç»„å¯¹è±¡     */</span>    <span class="token class-name">Group</span> <span class="token function">removeMember</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> member<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * ç§»é™¤èŠå¤©ç»„     * @param name ç»„å     * @return å¦‚æœç»„ä¸å­˜åœ¨è¿”å› null, å¦åˆ™è¿”å›ç»„å¯¹è±¡     */</span>    <span class="token class-name">Group</span> <span class="token function">removeGroup</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * è·å–ç»„æˆå‘˜     * @param name ç»„å     * @return æˆå‘˜é›†åˆ, æ²¡æœ‰æˆå‘˜ä¼šè¿”å› empty set     */</span>    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">getMembers</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * è·å–ç»„æˆå‘˜çš„ channel é›†åˆ, åªæœ‰åœ¨çº¿çš„ channel æ‰ä¼šè¿”å›     * @param name ç»„å     * @return æˆå‘˜ channel é›†åˆ     */</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">></span></span> <span class="token function">getMembersChannel</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-2-èŠå¤©å®¤ä¸šåŠ¡-ç™»å½•"><a href="#3-2-èŠå¤©å®¤ä¸šåŠ¡-ç™»å½•" class="headerlink" title="3.2 èŠå¤©å®¤ä¸šåŠ¡-ç™»å½•"></a>3.2 èŠå¤©å®¤ä¸šåŠ¡-ç™»å½•</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatServer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">NioEventLoopGroup</span> boss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">NioEventLoopGroup</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">LoggingHandler</span> <span class="token constant">LOGGING_HANDLER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">MessageCodecSharable</span> <span class="token constant">MESSAGE_CODEC</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageCodecSharable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">ServerBootstrap</span> serverBootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            serverBootstrap<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            serverBootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>boss<span class="token punctuation">,</span> worker<span class="token punctuation">)</span><span class="token punctuation">;</span>            serverBootstrap<span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProcotolFrameDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token constant">LOGGING_HANDLER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token constant">MESSAGE_CODEC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LoginRequestMessage</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token annotation punctuation">@Override</span>                        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">LoginRequestMessage</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                            <span class="token class-name">String</span> username <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">String</span> password <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">boolean</span> login <span class="token operator">=</span> <span class="token class-name">UserServiceFactory</span><span class="token punctuation">.</span><span class="token function">getUserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">LoginResponseMessage</span> message<span class="token punctuation">;</span>                            <span class="token keyword">if</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoginResponseMessage</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">"ç™»å½•æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                                message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoginResponseMessage</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">"ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Channel</span> channel <span class="token operator">=</span> serverBootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"server error"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            boss<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            worker<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatClient</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">NioEventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">LoggingHandler</span> <span class="token constant">LOGGING_HANDLER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">MessageCodecSharable</span> <span class="token constant">MESSAGE_CODEC</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageCodecSharable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">CountDownLatch</span> <span class="token constant">WAIT_FOR_LOGIN</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">AtomicBoolean</span> <span class="token constant">LOGIN</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProcotolFrameDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//                    ch.pipeline().addLast(LOGGING_HANDLER);</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token constant">MESSAGE_CODEC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">"client handler"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token comment">// æ¥æ”¶å“åº”æ¶ˆæ¯</span>                        <span class="token annotation punctuation">@Override</span>                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"msg: &#123;&#125;"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">LoginResponseMessage</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                <span class="token class-name">LoginResponseMessage</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LoginResponseMessage</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                    <span class="token comment">// å¦‚æœç™»å½•æˆåŠŸ</span>                                    <span class="token constant">LOGIN</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token punctuation">&#125;</span>                                <span class="token comment">// å”¤é†’ system in çº¿ç¨‹</span>                                <span class="token constant">WAIT_FOR_LOGIN</span><span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                        <span class="token punctuation">&#125;</span>                        <span class="token comment">// åœ¨è¿æ¥å»ºç«‹åè§¦å‘ active äº‹ä»¶</span>                        <span class="token annotation punctuation">@Override</span>                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                            <span class="token comment">// è´Ÿè´£æ¥æ”¶ç”¨æˆ·åœ¨æ§åˆ¶å°çš„è¾“å…¥ï¼Œè´Ÿè´£å‘æœåŠ¡å™¨å‘é€å„ç§æ¶ˆæ¯</span>                            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                                <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¯·è¾“å…¥ç”¨æˆ·å:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token class-name">String</span> username <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¯·è¾“å…¥å¯†ç :"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token class-name">String</span> password <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token comment">// æ„é€ æ¶ˆæ¯å¯¹è±¡</span>                                <span class="token class-name">LoginRequestMessage</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoginRequestMessage</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token comment">// å‘é€æ¶ˆæ¯</span>                                ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç­‰å¾…åç»­æ“ä½œ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                                    <span class="token constant">WAIT_FOR_LOGIN</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token punctuation">&#125;</span>                                <span class="token comment">// å¦‚æœç™»å½•å¤±è´¥</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">LOGIN</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                    ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token keyword">return</span><span class="token punctuation">;</span>                                <span class="token punctuation">&#125;</span>                                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=================================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"send [username] [content]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"gsend [group name] [content]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"gcreate [group name] [m1,m2,m3...]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"gmembers [group name]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"gjoin [group name]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"gquit [group name]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"quit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=================================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token class-name">String</span> command <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> s <span class="token operator">=</span> command<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token keyword">switch</span> <span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                                        <span class="token keyword">case</span> <span class="token string">"send"</span><span class="token operator">:</span>                                            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChatRequestMessage</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                            <span class="token keyword">break</span><span class="token punctuation">;</span>                                        <span class="token keyword">case</span> <span class="token string">"gsend"</span><span class="token operator">:</span>                                            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GroupChatRequestMessage</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                            <span class="token keyword">break</span><span class="token punctuation">;</span>                                        <span class="token keyword">case</span> <span class="token string">"gcreate"</span><span class="token operator">:</span>                                            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                            set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åŠ å…¥è‡ªå·±</span>                                            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GroupCreateRequestMessage</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> set<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                            <span class="token keyword">break</span><span class="token punctuation">;</span>                                        <span class="token keyword">case</span> <span class="token string">"gmembers"</span><span class="token operator">:</span>                                            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GroupMembersRequestMessage</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                            <span class="token keyword">break</span><span class="token punctuation">;</span>                                        <span class="token keyword">case</span> <span class="token string">"gjoin"</span><span class="token operator">:</span>                                            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GroupJoinRequestMessage</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                            <span class="token keyword">break</span><span class="token punctuation">;</span>                                        <span class="token keyword">case</span> <span class="token string">"gquit"</span><span class="token operator">:</span>                                            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GroupQuitRequestMessage</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                            <span class="token keyword">break</span><span class="token punctuation">;</span>                                        <span class="token keyword">case</span> <span class="token string">"quit"</span><span class="token operator">:</span>                                            ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                            <span class="token keyword">return</span><span class="token punctuation">;</span>                                    <span class="token punctuation">&#125;</span>                                <span class="token punctuation">&#125;</span>                            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">"system in"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Channel</span> channel <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"client error"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            group<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-3-èŠå¤©å®¤ä¸šåŠ¡-å•èŠ"><a href="#3-3-èŠå¤©å®¤ä¸šåŠ¡-å•èŠ" class="headerlink" title="3.3 èŠå¤©å®¤ä¸šåŠ¡-å•èŠ"></a>3.3 èŠå¤©å®¤ä¸šåŠ¡-å•èŠ</h3><p>æœåŠ¡å™¨ç«¯å°† handler ç‹¬ç«‹å‡ºæ¥</p><p>ç™»å½• handler</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ChannelHandler.Sharable</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginRequestMessageHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LoginRequestMessage</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">LoginRequestMessage</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> username <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">boolean</span> login <span class="token operator">=</span> <span class="token class-name">UserServiceFactory</span><span class="token punctuation">.</span><span class="token function">getUserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">LoginResponseMessage</span> message<span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">SessionFactory</span><span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>            message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoginResponseMessage</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">"ç™»å½•æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoginResponseMessage</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">"ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å•èŠ handler</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ChannelHandler.Sharable</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatRequestMessageHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ChatRequestMessage</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">ChatRequestMessage</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> <span class="token keyword">to</span> <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">SessionFactory</span><span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åœ¨çº¿</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>channel <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChatResponseMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getFrom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// ä¸åœ¨çº¿</span>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChatResponseMessage</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">"å¯¹æ–¹ç”¨æˆ·ä¸å­˜åœ¨æˆ–è€…ä¸åœ¨çº¿"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-4-èŠå¤©å®¤ä¸šåŠ¡-ç¾¤èŠ"><a href="#3-4-èŠå¤©å®¤ä¸šåŠ¡-ç¾¤èŠ" class="headerlink" title="3.4 èŠå¤©å®¤ä¸šåŠ¡-ç¾¤èŠ"></a>3.4 èŠå¤©å®¤ä¸šåŠ¡-ç¾¤èŠ</h3><p>åˆ›å»ºç¾¤èŠ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ChannelHandler.Sharable</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GroupCreateRequestMessageHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GroupCreateRequestMessage</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">GroupCreateRequestMessage</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> groupName <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> members <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getMembers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç¾¤ç®¡ç†å™¨</span>        <span class="token class-name">GroupSession</span> groupSession <span class="token operator">=</span> <span class="token class-name">GroupSessionFactory</span><span class="token punctuation">.</span><span class="token function">getGroupSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Group</span> group <span class="token operator">=</span> groupSession<span class="token punctuation">.</span><span class="token function">createGroup</span><span class="token punctuation">(</span>groupName<span class="token punctuation">,</span> members<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>group <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// å‘ç”ŸæˆåŠŸæ¶ˆæ¯</span>            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GroupCreateResponseMessage</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> groupName <span class="token operator">+</span> <span class="token string">"åˆ›å»ºæˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å‘é€æ‹‰ç¾¤æ¶ˆæ¯</span>            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">></span></span> channels <span class="token operator">=</span> groupSession<span class="token punctuation">.</span><span class="token function">getMembersChannel</span><span class="token punctuation">(</span>groupName<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Channel</span> channel <span class="token operator">:</span> channels<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GroupCreateResponseMessage</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">"æ‚¨å·²è¢«æ‹‰å…¥"</span> <span class="token operator">+</span> groupName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GroupCreateResponseMessage</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> groupName <span class="token operator">+</span> <span class="token string">"å·²ç»å­˜åœ¨"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¾¤èŠ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ChannelHandler.Sharable</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GroupChatRequestMessageHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GroupChatRequestMessage</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">GroupChatRequestMessage</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">></span></span> channels <span class="token operator">=</span> <span class="token class-name">GroupSessionFactory</span><span class="token punctuation">.</span><span class="token function">getGroupSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">getMembersChannel</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Channel</span> channel <span class="token operator">:</span> channels<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GroupChatResponseMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getFrom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŠ å…¥ç¾¤èŠ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ChannelHandler.Sharable</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GroupJoinRequestMessageHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GroupJoinRequestMessage</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">GroupJoinRequestMessage</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Group</span> group <span class="token operator">=</span> <span class="token class-name">GroupSessionFactory</span><span class="token punctuation">.</span><span class="token function">getGroupSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">joinMember</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>group <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GroupJoinResponseMessage</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"ç¾¤åŠ å…¥æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GroupJoinResponseMessage</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"ç¾¤ä¸å­˜åœ¨"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€€å‡ºç¾¤èŠ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ChannelHandler.Sharable</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GroupQuitRequestMessageHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GroupQuitRequestMessage</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">GroupQuitRequestMessage</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Group</span> group <span class="token operator">=</span> <span class="token class-name">GroupSessionFactory</span><span class="token punctuation">.</span><span class="token function">getGroupSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeMember</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>group <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GroupJoinResponseMessage</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">"å·²é€€å‡ºç¾¤"</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span><span class="token function">getGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GroupJoinResponseMessage</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"ç¾¤ä¸å­˜åœ¨"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹æˆå‘˜</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ChannelHandler.Sharable</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GroupMembersRequestMessageHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GroupMembersRequestMessage</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">GroupMembersRequestMessage</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> members <span class="token operator">=</span> <span class="token class-name">GroupSessionFactory</span><span class="token punctuation">.</span><span class="token function">getGroupSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">getMembers</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GroupMembersResponseMessage</span><span class="token punctuation">(</span>members<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-5-èŠå¤©å®¤ä¸šåŠ¡-é€€å‡º"><a href="#3-5-èŠå¤©å®¤ä¸šåŠ¡-é€€å‡º" class="headerlink" title="3.5 èŠå¤©å®¤ä¸šåŠ¡-é€€å‡º"></a>3.5 èŠå¤©å®¤ä¸šåŠ¡-é€€å‡º</h3><pre class="line-numbers language-none"><code class="language-none">@Slf4j@ChannelHandler.Sharablepublic class QuitHandler extends ChannelInboundHandlerAdapter &#123;    &#x2F;&#x2F; å½“è¿æ¥æ–­å¼€æ—¶è§¦å‘ inactive äº‹ä»¶    @Override    public void channelInactive(ChannelHandlerContext ctx) throws Exception &#123;        SessionFactory.getSession().unbind(ctx.channel());        log.debug(&quot;&#123;&#125; å·²ç»æ–­å¼€&quot;, ctx.channel());    &#125;&#x2F;&#x2F; å½“å‡ºç°å¼‚å¸¸æ—¶è§¦å‘    @Override    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123;        SessionFactory.getSession().unbind(ctx.channel());        log.debug(&quot;&#123;&#125; å·²ç»å¼‚å¸¸æ–­å¼€ å¼‚å¸¸æ˜¯&#123;&#125;&quot;, ctx.channel(), cause.getMessage());    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-6-èŠå¤©å®¤ä¸šåŠ¡-ç©ºé—²æ£€æµ‹"><a href="#3-6-èŠå¤©å®¤ä¸šåŠ¡-ç©ºé—²æ£€æµ‹" class="headerlink" title="3.6 èŠå¤©å®¤ä¸šåŠ¡-ç©ºé—²æ£€æµ‹"></a>3.6 èŠå¤©å®¤ä¸šåŠ¡-ç©ºé—²æ£€æµ‹</h3><h4 id="è¿æ¥å‡æ­»"><a href="#è¿æ¥å‡æ­»" class="headerlink" title="è¿æ¥å‡æ­»"></a>è¿æ¥å‡æ­»</h4><p>åŸå› </p><ul><li>ç½‘ç»œè®¾å¤‡å‡ºç°æ•…éšœï¼Œä¾‹å¦‚ç½‘å¡ï¼Œæœºæˆ¿ç­‰ï¼Œåº•å±‚çš„ TCP è¿æ¥å·²ç»æ–­å¼€äº†ï¼Œä½†åº”ç”¨ç¨‹åºæ²¡æœ‰æ„ŸçŸ¥åˆ°ï¼Œä»ç„¶å ç”¨ç€èµ„æºã€‚</li><li>å…¬ç½‘ç½‘ç»œä¸ç¨³å®šï¼Œå‡ºç°ä¸¢åŒ…ã€‚å¦‚æœè¿ç»­å‡ºç°ä¸¢åŒ…ï¼Œè¿™æ—¶ç°è±¡å°±æ˜¯å®¢æˆ·ç«¯æ•°æ®å‘ä¸å‡ºå»ï¼ŒæœåŠ¡ç«¯ä¹Ÿä¸€ç›´æ”¶ä¸åˆ°æ•°æ®ï¼Œå°±è¿™ä¹ˆä¸€ç›´è€—ç€</li><li>åº”ç”¨ç¨‹åºçº¿ç¨‹é˜»å¡ï¼Œæ— æ³•è¿›è¡Œæ•°æ®è¯»å†™</li></ul><p>é—®é¢˜</p><ul><li>å‡æ­»çš„è¿æ¥å ç”¨çš„èµ„æºä¸èƒ½è‡ªåŠ¨é‡Šæ”¾</li><li>å‘å‡æ­»çš„è¿æ¥å‘é€æ•°æ®ï¼Œå¾—åˆ°çš„åé¦ˆæ˜¯å‘é€è¶…æ—¶</li></ul><p>æœåŠ¡å™¨ç«¯è§£å†³</p><ul><li>æ€ä¹ˆåˆ¤æ–­å®¢æˆ·ç«¯è¿æ¥æ˜¯å¦å‡æ­»å‘¢ï¼Ÿå¦‚æœèƒ½æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®ï¼Œè¯´æ˜æ²¡æœ‰å‡æ­»ã€‚å› æ­¤ç­–ç•¥å°±å¯ä»¥å®šä¸ºï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å°±æ£€æŸ¥è¿™æ®µæ—¶é—´å†…æ˜¯å¦æ¥æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®ï¼Œæ²¡æœ‰å°±å¯ä»¥åˆ¤å®šä¸ºè¿æ¥å‡æ­»</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ç”¨æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯ è¯»ç©ºé—²æ—¶é—´è¿‡é•¿ï¼Œæˆ– å†™ç©ºé—²æ—¶é—´è¿‡é•¿</span><span class="token comment">// 5s å†…å¦‚æœæ²¡æœ‰æ”¶åˆ° channel çš„æ•°æ®ï¼Œä¼šè§¦å‘ä¸€ä¸ª IdleState#READER_IDLE äº‹ä»¶</span>ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IdleStateHandler</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ChannelDuplexHandler å¯ä»¥åŒæ—¶ä½œä¸ºå…¥ç«™å’Œå‡ºç«™å¤„ç†å™¨</span>ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelDuplexHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ç”¨æ¥è§¦å‘ç‰¹æ®Šäº‹ä»¶</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">userEventTriggered</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> evt<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>        <span class="token class-name">IdleStateEvent</span> event <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">IdleStateEvent</span><span class="token punctuation">)</span> evt<span class="token punctuation">;</span>        <span class="token comment">// è§¦å‘äº†è¯»ç©ºé—²äº‹ä»¶</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">IdleState</span><span class="token punctuation">.</span><span class="token constant">READER_IDLE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"å·²ç» 5s æ²¡æœ‰è¯»åˆ°æ•°æ®äº†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯å®šæ—¶å¿ƒè·³</p><ul><li>å®¢æˆ·ç«¯å¯ä»¥å®šæ—¶å‘æœåŠ¡å™¨ç«¯å‘é€æ•°æ®ï¼Œåªè¦è¿™ä¸ªæ—¶é—´é—´éš”å°äºæœåŠ¡å™¨å®šä¹‰çš„ç©ºé—²æ£€æµ‹çš„æ—¶é—´é—´éš”ï¼Œé‚£ä¹ˆå°±èƒ½é˜²æ­¢å‰é¢æåˆ°çš„è¯¯åˆ¤ï¼Œå®¢æˆ·ç«¯å¯ä»¥å®šä¹‰å¦‚ä¸‹å¿ƒè·³å¤„ç†å™¨</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ç”¨æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯ è¯»ç©ºé—²æ—¶é—´è¿‡é•¿ï¼Œæˆ– å†™ç©ºé—²æ—¶é—´è¿‡é•¿</span><span class="token comment">// 3s å†…å¦‚æœæ²¡æœ‰å‘æœåŠ¡å™¨å†™æ•°æ®ï¼Œä¼šè§¦å‘ä¸€ä¸ª IdleState#WRITER_IDLE äº‹ä»¶</span>ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IdleStateHandler</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ChannelDuplexHandler å¯ä»¥åŒæ—¶ä½œä¸ºå…¥ç«™å’Œå‡ºç«™å¤„ç†å™¨</span>ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelDuplexHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ç”¨æ¥è§¦å‘ç‰¹æ®Šäº‹ä»¶</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">userEventTriggered</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> evt<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>        <span class="token class-name">IdleStateEvent</span> event <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">IdleStateEvent</span><span class="token punctuation">)</span> evt<span class="token punctuation">;</span>        <span class="token comment">// è§¦å‘äº†å†™ç©ºé—²äº‹ä»¶</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">IdleState</span><span class="token punctuation">.</span><span class="token constant">WRITER_IDLE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//                                log.debug("3s æ²¡æœ‰å†™æ•°æ®äº†ï¼Œå‘é€ä¸€ä¸ªå¿ƒè·³åŒ…");</span>            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PingMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä¸‰-Netty-è¿›é˜¶&quot;&gt;&lt;a href=&quot;#ä¸‰-Netty-è¿›é˜¶&quot; class=&quot;headerlink&quot; title=&quot;ä¸‰. Netty è¿›é˜¶&quot;&gt;&lt;/a&gt;ä¸‰. Netty è¿›é˜¶&lt;/h1&gt;&lt;h2 id=&quot;1-ç²˜åŒ…ä¸åŠåŒ…&quot;&gt;&lt;a href=&quot;#1-ç²˜åŒ…ä¸åŠåŒ…&quot; cla</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://100qin10086.github.io/posts/0.html"/>
    <id>https://100qin10086.github.io/posts/0.html</id>
    <published>2024-05-06T14:13:59.606Z</published>
    <updated>2024-05-06T14:13:59.610Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å››-ä¼˜åŒ–ä¸æºç "><a href="#å››-ä¼˜åŒ–ä¸æºç " class="headerlink" title="å››. ä¼˜åŒ–ä¸æºç "></a>å››. ä¼˜åŒ–ä¸æºç </h1><h2 id="1-ä¼˜åŒ–"><a href="#1-ä¼˜åŒ–" class="headerlink" title="1. ä¼˜åŒ–"></a>1. ä¼˜åŒ–</h2><h3 id="1-1-æ‰©å±•åºåˆ—åŒ–ç®—æ³•"><a href="#1-1-æ‰©å±•åºåˆ—åŒ–ç®—æ³•" class="headerlink" title="1.1 æ‰©å±•åºåˆ—åŒ–ç®—æ³•"></a>1.1 æ‰©å±•åºåˆ—åŒ–ç®—æ³•</h3><p>åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–ä¸»è¦ç”¨åœ¨æ¶ˆæ¯æ­£æ–‡çš„è½¬æ¢ä¸Š</p><ul><li>åºåˆ—åŒ–æ—¶ï¼Œéœ€è¦å°† Java å¯¹è±¡å˜ä¸ºè¦ä¼ è¾“çš„æ•°æ®ï¼ˆå¯ä»¥æ˜¯ byte[]ï¼Œæˆ– json ç­‰ï¼Œæœ€ç»ˆéƒ½éœ€è¦å˜æˆ byte[]ï¼‰</li><li>ååºåˆ—åŒ–æ—¶ï¼Œéœ€è¦å°†ä¼ å…¥çš„æ­£æ–‡æ•°æ®è¿˜åŸæˆ Java å¯¹è±¡ï¼Œä¾¿äºå¤„ç†</li></ul><p>ç›®å‰çš„ä»£ç ä»…æ”¯æŒ Java è‡ªå¸¦çš„åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–æœºåˆ¶ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ååºåˆ—åŒ–</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>bodyLength<span class="token punctuation">]</span><span class="token punctuation">;</span>byteByf<span class="token punctuation">.</span><span class="token function">readBytes</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">ObjectInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token punctuation">)</span> in<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>message<span class="token punctuation">.</span><span class="token function">setSequenceId</span><span class="token punctuation">(</span>sequenceId<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åºåˆ—åŒ–</span><span class="token class-name">ByteArrayOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> out<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ºäº†æ”¯æŒæ›´å¤šåºåˆ—åŒ–ç®—æ³•ï¼ŒæŠ½è±¡ä¸€ä¸ª Serializer æ¥å£</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Serializer</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ååºåˆ—åŒ–æ–¹æ³•</span>    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">T</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> clazz<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åºåˆ—åŒ–æ–¹æ³•</span>    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token class-name">T</span> object<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æä¾›ä¸¤ä¸ªå®ç°ï¼Œæˆ‘è¿™é‡Œç›´æ¥å°†å®ç°åŠ å…¥äº†æšä¸¾ç±» Serializer.Algorithm ä¸­</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">enum</span> <span class="token class-name">SerializerAlgorithm</span> <span class="token keyword">implements</span> <span class="token class-name">Serializer</span> <span class="token punctuation">&#123;</span><span class="token comment">// Java å®ç°</span>    <span class="token class-name">Java</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">T</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> clazz<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">ObjectInputStream</span> in <span class="token operator">=</span>                     <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Object</span> object <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> object<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> <span class="token operator">|</span> <span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"SerializerAlgorithm.Java ååºåˆ—åŒ–é”™è¯¯"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token class-name">T</span> object<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">ByteArrayOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> out<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"SerializerAlgorithm.Java åºåˆ—åŒ–é”™è¯¯"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>     <span class="token comment">// Json å®ç°(å¼•å…¥äº† Gson ä¾èµ–)</span>    <span class="token class-name">Json</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">T</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> clazz<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token class-name">T</span> object<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token comment">// éœ€è¦ä»åè®®çš„å­—èŠ‚ä¸­å¾—åˆ°æ˜¯å“ªç§åºåˆ—åŒ–ç®—æ³•</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SerializerAlgorithm</span> <span class="token function">getByInt</span><span class="token punctuation">(</span><span class="token keyword">int</span> type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SerializerAlgorithm</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token class-name">SerializerAlgorithm</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> type <span class="token operator">></span> array<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"è¶…è¿‡ SerializerAlgorithm èŒƒå›´"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> array<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¢åŠ é…ç½®ç±»å’Œé…ç½®æ–‡ä»¶</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token class-name">Properties</span> properties<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token class-name">Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"/application.properties"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ExceptionInInitializerError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getServerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> value <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"server.port"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token number">8080</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Serializer<span class="token punctuation">.</span>Algorithm</span> <span class="token function">getSerializerAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> value <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"serializer.algorithm"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token class-name">Serializer<span class="token punctuation">.</span>Algorithm<span class="token punctuation">.</span>Java</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token class-name">Serializer<span class="token punctuation">.</span>Algorithm</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é…ç½®æ–‡ä»¶</p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">serializer.algorithm</span><span class="token punctuation">=</span><span class="token value attr-value">Json</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¿®æ”¹ç¼–è§£ç å™¨</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * å¿…é¡»å’Œ LengthFieldBasedFrameDecoder ä¸€èµ·ä½¿ç”¨ï¼Œç¡®ä¿æ¥åˆ°çš„ ByteBuf æ¶ˆæ¯æ˜¯å®Œæ•´çš„ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageCodecSharable</span> <span class="token keyword">extends</span> <span class="token class-name">MessageToMessageCodec</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ByteBuf</span><span class="token punctuation">,</span> <span class="token class-name">Message</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Message</span> msg<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> outList<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ByteBuf</span> out <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 1. 4 å­—èŠ‚çš„é­”æ•°</span>        out<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 2. 1 å­—èŠ‚çš„ç‰ˆæœ¬,</span>        out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 3. 1 å­—èŠ‚çš„åºåˆ—åŒ–æ–¹å¼ jdk 0 , json 1</span>        out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span><span class="token class-name">Config</span><span class="token punctuation">.</span><span class="token function">getSerializerAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ordinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 4. 1 å­—èŠ‚çš„æŒ‡ä»¤ç±»å‹</span>        out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getMessageType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 5. 4 ä¸ªå­—èŠ‚</span>        out<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getSequenceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ— æ„ä¹‰ï¼Œå¯¹é½å¡«å……</span>        out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span><span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 6. è·å–å†…å®¹çš„å­—èŠ‚æ•°ç»„</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token class-name">Config</span><span class="token punctuation">.</span><span class="token function">getSerializerAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 7. é•¿åº¦</span>        out<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 8. å†™å…¥å†…å®¹</span>        out<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>        outList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">ByteBuf</span> in<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> magicNum <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span> version <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span> serializerAlgorithm <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0 æˆ– 1</span>        <span class="token keyword">byte</span> messageType <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0,1,2...</span>        <span class="token keyword">int</span> sequenceId <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> length <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>        in<span class="token punctuation">.</span><span class="token function">readBytes</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ‰¾åˆ°ååºåˆ—åŒ–ç®—æ³•</span>        <span class="token class-name">Serializer<span class="token punctuation">.</span>Algorithm</span> algorithm <span class="token operator">=</span> <span class="token class-name">Serializer<span class="token punctuation">.</span>Algorithm</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>serializerAlgorithm<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">// ç¡®å®šå…·ä½“æ¶ˆæ¯ç±»å‹</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Message</span><span class="token punctuation">></span></span> messageClass <span class="token operator">=</span> <span class="token class-name">Message</span><span class="token punctuation">.</span><span class="token function">getMessageClass</span><span class="token punctuation">(</span>messageType<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Message</span> message <span class="token operator">=</span> algorithm<span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span>messageClass<span class="token punctuation">,</span> bytes<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        log.debug("&#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;", magicNum, version, serializerType, messageType, sequenceId, length);</span><span class="token comment">//        log.debug("&#123;&#125;", message);</span>        out<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­ç¡®å®šå…·ä½“æ¶ˆæ¯ç±»å‹ï¼Œå¯ä»¥æ ¹æ® <code>æ¶ˆæ¯ç±»å‹å­—èŠ‚</code> è·å–åˆ°å¯¹åº”çš„ <code>æ¶ˆæ¯ class</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Message</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * æ ¹æ®æ¶ˆæ¯ç±»å‹å­—èŠ‚ï¼Œè·å¾—å¯¹åº”çš„æ¶ˆæ¯ class     * @param messageType æ¶ˆæ¯ç±»å‹å­—èŠ‚     * @return æ¶ˆæ¯ class     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Message</span><span class="token punctuation">></span></span> <span class="token function">getMessageClass</span><span class="token punctuation">(</span><span class="token keyword">int</span> messageType<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> messageClasses<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>messageType<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> sequenceId<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> messageType<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">int</span> <span class="token function">getMessageType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">LoginRequestMessage</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">LoginResponseMessage</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">ChatRequestMessage</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">ChatResponseMessage</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">GroupCreateRequestMessage</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">GroupCreateResponseMessage</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">GroupJoinRequestMessage</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">GroupJoinResponseMessage</span> <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">GroupQuitRequestMessage</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">GroupQuitResponseMessage</span> <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">GroupChatRequestMessage</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">GroupChatResponseMessage</span> <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">GroupMembersRequestMessage</span> <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">GroupMembersResponseMessage</span> <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">PingMessage</span> <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">PongMessage</span> <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Message</span><span class="token punctuation">></span><span class="token punctuation">></span></span> messageClasses <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        messageClasses<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">LoginRequestMessage</span><span class="token punctuation">,</span> <span class="token class-name">LoginRequestMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        messageClasses<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">LoginResponseMessage</span><span class="token punctuation">,</span> <span class="token class-name">LoginResponseMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        messageClasses<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ChatRequestMessage</span><span class="token punctuation">,</span> <span class="token class-name">ChatRequestMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        messageClasses<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ChatResponseMessage</span><span class="token punctuation">,</span> <span class="token class-name">ChatResponseMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        messageClasses<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">GroupCreateRequestMessage</span><span class="token punctuation">,</span> <span class="token class-name">GroupCreateRequestMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        messageClasses<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">GroupCreateResponseMessage</span><span class="token punctuation">,</span> <span class="token class-name">GroupCreateResponseMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        messageClasses<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">GroupJoinRequestMessage</span><span class="token punctuation">,</span> <span class="token class-name">GroupJoinRequestMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        messageClasses<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">GroupJoinResponseMessage</span><span class="token punctuation">,</span> <span class="token class-name">GroupJoinResponseMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        messageClasses<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">GroupQuitRequestMessage</span><span class="token punctuation">,</span> <span class="token class-name">GroupQuitRequestMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        messageClasses<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">GroupQuitResponseMessage</span><span class="token punctuation">,</span> <span class="token class-name">GroupQuitResponseMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        messageClasses<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">GroupChatRequestMessage</span><span class="token punctuation">,</span> <span class="token class-name">GroupChatRequestMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        messageClasses<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">GroupChatResponseMessage</span><span class="token punctuation">,</span> <span class="token class-name">GroupChatResponseMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        messageClasses<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">GroupMembersRequestMessage</span><span class="token punctuation">,</span> <span class="token class-name">GroupMembersRequestMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        messageClasses<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">GroupMembersResponseMessage</span><span class="token punctuation">,</span> <span class="token class-name">GroupMembersResponseMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-2-å‚æ•°è°ƒä¼˜"><a href="#1-2-å‚æ•°è°ƒä¼˜" class="headerlink" title="1.2 å‚æ•°è°ƒä¼˜"></a>1.2 å‚æ•°è°ƒä¼˜</h3><h4 id="1ï¼‰CONNECT-TIMEOUT-MILLIS"><a href="#1ï¼‰CONNECT-TIMEOUT-MILLIS" class="headerlink" title="1ï¼‰CONNECT_TIMEOUT_MILLIS"></a>1ï¼‰CONNECT_TIMEOUT_MILLIS</h4><ul><li>å±äº SocketChannal å‚æ•°</li><li><p>ç”¨åœ¨å®¢æˆ·ç«¯å»ºç«‹è¿æ¥æ—¶ï¼Œå¦‚æœåœ¨æŒ‡å®šæ¯«ç§’å†…æ— æ³•è¿æ¥ï¼Œä¼šæŠ›å‡º timeout å¼‚å¸¸</p></li><li><p>SO_TIMEOUT ä¸»è¦ç”¨åœ¨é˜»å¡ IOï¼Œé˜»å¡ IO ä¸­ acceptï¼Œread ç­‰éƒ½æ˜¯æ— é™ç­‰å¾…çš„ï¼Œå¦‚æœä¸å¸Œæœ›æ°¸è¿œé˜»å¡ï¼Œä½¿ç”¨å®ƒè°ƒæ•´è¶…æ—¶æ—¶é—´</p></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestConnectionTimeout</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">NioEventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span><span class="token constant">CONNECT_TIMEOUT_MILLIS</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ChannelFuture</span> future <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            future<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–­ç‚¹1</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"timeout"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            group<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦å¤–æºç éƒ¨åˆ† <code>io.netty.channel.nio.AbstractNioChannel.AbstractNioUnsafe#connect</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">connect</span><span class="token punctuation">(</span>        <span class="token keyword">final</span> <span class="token class-name">SocketAddress</span> remoteAddress<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">SocketAddress</span> localAddress<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ...</span>    <span class="token comment">// Schedule connect timeout.</span>    <span class="token keyword">int</span> connectTimeoutMillis <span class="token operator">=</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConnectTimeoutMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>connectTimeoutMillis <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        connectTimeoutFuture <span class="token operator">=</span> <span class="token function">eventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                <span class="token class-name">ChannelPromise</span> connectPromise <span class="token operator">=</span> <span class="token class-name">AbstractNioChannel</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>connectPromise<span class="token punctuation">;</span>                <span class="token class-name">ConnectTimeoutException</span> cause <span class="token operator">=</span>                    <span class="token keyword">new</span> <span class="token class-name">ConnectTimeoutException</span><span class="token punctuation">(</span><span class="token string">"connection timed out: "</span> <span class="token operator">+</span> remoteAddress<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–­ç‚¹2</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>connectPromise <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> connectPromise<span class="token punctuation">.</span><span class="token function">tryFailure</span><span class="token punctuation">(</span>cause<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token function">close</span><span class="token punctuation">(</span><span class="token function">voidPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> connectTimeoutMillis<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ï¼‰SO-BACKLOG"><a href="#2ï¼‰SO-BACKLOG" class="headerlink" title="2ï¼‰SO_BACKLOG"></a>2ï¼‰SO_BACKLOG</h4><ul><li>å±äº ServerSocketChannal å‚æ•°</li></ul><pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid"><span class="token keyword">sequenceDiagram</span><span class="token keyword">participant</span> c as client<span class="token keyword">participant</span> s as server<span class="token keyword">participant</span> sq as syns queue<span class="token keyword">participant</span> aq as accept queues <span class="token arrow operator">->></span> s <span class="token operator">:</span> bind<span class="token punctuation">(</span><span class="token punctuation">)</span>s <span class="token arrow operator">->></span> s <span class="token operator">:</span> listen<span class="token punctuation">(</span><span class="token punctuation">)</span>c <span class="token arrow operator">->></span> c <span class="token operator">:</span> connect<span class="token punctuation">(</span><span class="token punctuation">)</span>c <span class="token arrow operator">->></span> s <span class="token operator">:</span> 1. SYN<span class="token keyword">Note left of</span> c <span class="token operator">:</span> SYN_SENDs <span class="token arrow operator">->></span> sq <span class="token operator">:</span> put<span class="token keyword">Note right of</span> s <span class="token operator">:</span> SYN_RCVDs <span class="token arrow operator">->></span> c <span class="token operator">:</span> 2. SYN + ACK<span class="token keyword">Note left of</span> c <span class="token operator">:</span> ESTABLISHEDc <span class="token arrow operator">->></span> s <span class="token operator">:</span> 3. ACKsq <span class="token arrow operator">->></span> aq <span class="token operator">:</span> put<span class="token keyword">Note right of</span> s <span class="token operator">:</span> ESTABLISHEDaq <span class="token arrow operator">-->></span> s <span class="token operator">:</span> s <span class="token arrow operator">->></span> s <span class="token operator">:</span> accept<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼Œclient å‘é€ SYN åˆ° serverï¼ŒçŠ¶æ€ä¿®æ”¹ä¸º SYN_SENDï¼Œserver æ”¶åˆ°ï¼ŒçŠ¶æ€æ”¹å˜ä¸º SYN_REVDï¼Œå¹¶å°†è¯¥è¯·æ±‚æ”¾å…¥ sync queue é˜Ÿåˆ—</li><li>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼Œserver å›å¤ SYN + ACK ç»™ clientï¼Œclient æ”¶åˆ°ï¼ŒçŠ¶æ€æ”¹å˜ä¸º ESTABLISHEDï¼Œå¹¶å‘é€ ACK ç»™ server</li><li>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œserver æ”¶åˆ° ACKï¼ŒçŠ¶æ€æ”¹å˜ä¸º ESTABLISHEDï¼Œå°†è¯¥è¯·æ±‚ä» sync queue æ”¾å…¥ accept queue</li></ol><p>å…¶ä¸­</p><ul><li><p>åœ¨ linux 2.2 ä¹‹å‰ï¼Œbacklog å¤§å°åŒ…æ‹¬äº†ä¸¤ä¸ªé˜Ÿåˆ—çš„å¤§å°ï¼Œåœ¨ 2.2 ä¹‹åï¼Œåˆ†åˆ«ç”¨ä¸‹é¢ä¸¤ä¸ªå‚æ•°æ¥æ§åˆ¶</p></li><li><p>sync queue - åŠè¿æ¥é˜Ÿåˆ—</p><ul><li>å¤§å°é€šè¿‡ /proc/sys/net/ipv4/tcp_max_syn_backlog æŒ‡å®šï¼Œåœ¨ <code>syncookies</code> å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œé€»è¾‘ä¸Šæ²¡æœ‰æœ€å¤§å€¼é™åˆ¶ï¼Œè¿™ä¸ªè®¾ç½®ä¾¿è¢«å¿½ç•¥</li></ul></li><li>accept queue - å…¨è¿æ¥é˜Ÿåˆ—<ul><li>å…¶å¤§å°é€šè¿‡ /proc/sys/net/core/somaxconn æŒ‡å®šï¼Œåœ¨ä½¿ç”¨ listen å‡½æ•°æ—¶ï¼Œå†…æ ¸ä¼šæ ¹æ®ä¼ å…¥çš„ backlog å‚æ•°ä¸ç³»ç»Ÿå‚æ•°ï¼Œå–äºŒè€…çš„è¾ƒå°å€¼</li><li>å¦‚æœ accpet queue é˜Ÿåˆ—æ»¡äº†ï¼Œserver å°†å‘é€ä¸€ä¸ªæ‹’ç»è¿æ¥çš„é”™è¯¯ä¿¡æ¯åˆ° client</li></ul></li></ul><p>netty ä¸­</p><p>å¯ä»¥é€šè¿‡  option(ChannelOption.SO_BACKLOG, å€¼) æ¥è®¾ç½®å¤§å°</p><p>å¯ä»¥é€šè¿‡ä¸‹é¢æºç æŸ¥çœ‹é»˜è®¤å¤§å°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultServerSocketChannelConfig</span> <span class="token keyword">extends</span> <span class="token class-name">DefaultChannelConfig</span>                                              <span class="token keyword">implements</span> <span class="token class-name">ServerSocketChannelConfig</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> backlog <span class="token operator">=</span> <span class="token class-name">NetUtil</span><span class="token punctuation">.</span><span class="token constant">SOMAXCONN</span><span class="token punctuation">;</span>    <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯¾å ‚è°ƒè¯•å…³é”®æ–­ç‚¹ä¸ºï¼š<code>io.netty.channel.nio.NioEventLoop#processSelectedKey</code></p><p>oio ä¸­æ›´å®¹æ˜“è¯´æ˜ï¼Œä¸ç”¨ debug æ¨¡å¼</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServerSocket</span> ss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Socket</span> accept <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>accept<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯å¯åŠ¨ 4 ä¸ª</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Socket</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" connecting..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            s<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" connected..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            s<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" connecting timeout..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬ 1ï¼Œ2ï¼Œ3 ä¸ªå®¢æˆ·ç«¯éƒ½æ‰“å°ï¼Œä½†é™¤äº†ç¬¬ä¸€ä¸ªå¤„äº accpet å¤–ï¼Œå…¶å®ƒä¸¤ä¸ªéƒ½å¤„äº accept queue ä¸­</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Tue</span> <span class="token class-name">Apr</span> <span class="token number">21</span> <span class="token number">20</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">28</span> <span class="token constant">CST</span> <span class="token number">2020</span> connecting<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token class-name">Tue</span> <span class="token class-name">Apr</span> <span class="token number">21</span> <span class="token number">20</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">28</span> <span class="token constant">CST</span> <span class="token number">2020</span> connected<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç¬¬ 4 ä¸ªå®¢æˆ·ç«¯è¿æ¥æ—¶</p><pre class="line-numbers language-none"><code class="language-none">Tue Apr 21 20:53:58 CST 2020 connecting...Tue Apr 21 20:53:59 CST 2020 connecting timeout...java.net.SocketTimeoutException: connect timed out<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="3ï¼‰ulimit-n"><a href="#3ï¼‰ulimit-n" class="headerlink" title="3ï¼‰ulimit -n"></a>3ï¼‰ulimit -n</h4><ul><li>å±äºæ“ä½œç³»ç»Ÿå‚æ•°</li></ul><h4 id="4ï¼‰TCP-NODELAY"><a href="#4ï¼‰TCP-NODELAY" class="headerlink" title="4ï¼‰TCP_NODELAY"></a>4ï¼‰TCP_NODELAY</h4><ul><li>å±äº SocketChannal å‚æ•°</li></ul><h4 id="5ï¼‰SO-SNDBUF-amp-SO-RCVBUF"><a href="#5ï¼‰SO-SNDBUF-amp-SO-RCVBUF" class="headerlink" title="5ï¼‰SO_SNDBUF &amp; SO_RCVBUF"></a>5ï¼‰SO_SNDBUF &amp; SO_RCVBUF</h4><ul><li>SO_SNDBUF å±äº SocketChannal å‚æ•°</li><li>SO_RCVBUF æ—¢å¯ç”¨äº SocketChannal å‚æ•°ï¼Œä¹Ÿå¯ä»¥ç”¨äº ServerSocketChannal å‚æ•°ï¼ˆå»ºè®®è®¾ç½®åˆ° ServerSocketChannal ä¸Šï¼‰</li></ul><h4 id="6ï¼‰ALLOCATOR"><a href="#6ï¼‰ALLOCATOR" class="headerlink" title="6ï¼‰ALLOCATOR"></a>6ï¼‰ALLOCATOR</h4><ul><li>å±äº SocketChannal å‚æ•°</li><li>ç”¨æ¥åˆ†é… ByteBufï¼Œ ctx.alloc()</li></ul><h4 id="7ï¼‰RCVBUF-ALLOCATOR"><a href="#7ï¼‰RCVBUF-ALLOCATOR" class="headerlink" title="7ï¼‰RCVBUF_ALLOCATOR"></a>7ï¼‰RCVBUF_ALLOCATOR</h4><ul><li>å±äº SocketChannal å‚æ•°</li><li>æ§åˆ¶ netty æ¥æ”¶ç¼“å†²åŒºå¤§å°</li><li>è´Ÿè´£å…¥ç«™æ•°æ®çš„åˆ†é…ï¼Œå†³å®šå…¥ç«™ç¼“å†²åŒºçš„å¤§å°ï¼ˆå¹¶å¯åŠ¨æ€è°ƒæ•´ï¼‰ï¼Œç»Ÿä¸€é‡‡ç”¨ direct ç›´æ¥å†…å­˜ï¼Œå…·ä½“æ± åŒ–è¿˜æ˜¯éæ± åŒ–ç”± allocator å†³å®š</li></ul><h3 id="1-3-RPC-æ¡†æ¶"><a href="#1-3-RPC-æ¡†æ¶" class="headerlink" title="1.3 RPC æ¡†æ¶"></a>1.3 RPC æ¡†æ¶</h3><h4 id="1ï¼‰å‡†å¤‡å·¥ä½œ"><a href="#1ï¼‰å‡†å¤‡å·¥ä½œ" class="headerlink" title="1ï¼‰å‡†å¤‡å·¥ä½œ"></a>1ï¼‰å‡†å¤‡å·¥ä½œ</h4><p>è¿™äº›ä»£ç å¯ä»¥è®¤ä¸ºæ˜¯ç°æˆçš„ï¼Œæ— éœ€ä»å¤´ç¼–å†™ç»ƒä¹ </p><p>ä¸ºäº†ç®€åŒ–èµ·è§ï¼Œåœ¨åŸæ¥èŠå¤©é¡¹ç›®çš„åŸºç¡€ä¸Šæ–°å¢ Rpc è¯·æ±‚å’Œå“åº”æ¶ˆæ¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Message</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// çœç•¥æ—§çš„ä»£ç </span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">RPC_MESSAGE_TYPE_REQUEST</span> <span class="token operator">=</span> <span class="token number">101</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span>  <span class="token constant">RPC_MESSAGE_TYPE_RESPONSE</span> <span class="token operator">=</span> <span class="token number">102</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// ...</span>        messageClasses<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token constant">RPC_MESSAGE_TYPE_REQUEST</span><span class="token punctuation">,</span> <span class="token class-name">RpcRequestMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        messageClasses<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token constant">RPC_MESSAGE_TYPE_RESPONSE</span><span class="token punctuation">,</span> <span class="token class-name">RpcResponseMessage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯·æ±‚æ¶ˆæ¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Getter</span><span class="token annotation punctuation">@ToString</span><span class="token punctuation">(</span>callSuper <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RpcRequestMessage</span> <span class="token keyword">extends</span> <span class="token class-name">Message</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * è°ƒç”¨çš„æ¥å£å…¨é™å®šåï¼ŒæœåŠ¡ç«¯æ ¹æ®å®ƒæ‰¾åˆ°å®ç°     */</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> interfaceName<span class="token punctuation">;</span>    <span class="token comment">/**     * è°ƒç”¨æ¥å£ä¸­çš„æ–¹æ³•å     */</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> methodName<span class="token punctuation">;</span>    <span class="token comment">/**     * æ–¹æ³•è¿”å›ç±»å‹     */</span>    <span class="token keyword">private</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> returnType<span class="token punctuation">;</span>    <span class="token comment">/**     * æ–¹æ³•å‚æ•°ç±»å‹æ•°ç»„     */</span>    <span class="token keyword">private</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterTypes<span class="token punctuation">;</span>    <span class="token comment">/**     * æ–¹æ³•å‚æ•°å€¼æ•°ç»„     */</span>    <span class="token keyword">private</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterValue<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">RpcRequestMessage</span><span class="token punctuation">(</span><span class="token keyword">int</span> sequenceId<span class="token punctuation">,</span> <span class="token class-name">String</span> interfaceName<span class="token punctuation">,</span> <span class="token class-name">String</span> methodName<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> returnType<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterTypes<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterValue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setSequenceId</span><span class="token punctuation">(</span>sequenceId<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>interfaceName <span class="token operator">=</span> interfaceName<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>methodName <span class="token operator">=</span> methodName<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>returnType <span class="token operator">=</span> returnType<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>parameterTypes <span class="token operator">=</span> parameterTypes<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>parameterValue <span class="token operator">=</span> parameterValue<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMessageType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant">RPC_MESSAGE_TYPE_REQUEST</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å“åº”æ¶ˆæ¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@ToString</span><span class="token punctuation">(</span>callSuper <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RpcResponseMessage</span> <span class="token keyword">extends</span> <span class="token class-name">Message</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * è¿”å›å€¼     */</span>    <span class="token keyword">private</span> <span class="token class-name">Object</span> returnValue<span class="token punctuation">;</span>    <span class="token comment">/**     * å¼‚å¸¸å€¼     */</span>    <span class="token keyword">private</span> <span class="token class-name">Exception</span> exceptionValue<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMessageType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant">RPC_MESSAGE_TYPE_RESPONSE</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœåŠ¡å™¨æ¶å­</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RpcServer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">NioEventLoopGroup</span> boss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">NioEventLoopGroup</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">LoggingHandler</span> <span class="token constant">LOGGING_HANDLER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">MessageCodecSharable</span> <span class="token constant">MESSAGE_CODEC</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageCodecSharable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// rpc è¯·æ±‚æ¶ˆæ¯å¤„ç†å™¨ï¼Œå¾…å®ç°</span>        <span class="token class-name">RpcRequestMessageHandler</span> <span class="token constant">RPC_HANDLER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RpcRequestMessageHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">ServerBootstrap</span> serverBootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            serverBootstrap<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            serverBootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>boss<span class="token punctuation">,</span> worker<span class="token punctuation">)</span><span class="token punctuation">;</span>            serverBootstrap<span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProcotolFrameDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token constant">LOGGING_HANDLER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token constant">MESSAGE_CODEC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token constant">RPC_HANDLER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Channel</span> channel <span class="token operator">=</span> serverBootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"server error"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            boss<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            worker<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯æ¶å­</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RpcClient</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">NioEventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">LoggingHandler</span> <span class="token constant">LOGGING_HANDLER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">MessageCodecSharable</span> <span class="token constant">MESSAGE_CODEC</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageCodecSharable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// rpc å“åº”æ¶ˆæ¯å¤„ç†å™¨ï¼Œå¾…å®ç°</span>        <span class="token class-name">RpcResponseMessageHandler</span> <span class="token constant">RPC_HANDLER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RpcResponseMessageHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProcotolFrameDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token constant">LOGGING_HANDLER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token constant">MESSAGE_CODEC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token constant">RPC_HANDLER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Channel</span> channel <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"client error"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            group<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœåŠ¡å™¨ç«¯çš„ service è·å–</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServicesFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token class-name">Properties</span> properties<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token class-name">Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"/application.properties"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> names <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">stringPropertyNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> name <span class="token operator">:</span> names<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">"Service"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> interfaceClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> instanceClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>interfaceClass<span class="token punctuation">,</span> instanceClass<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> <span class="token operator">|</span> <span class="token class-name">ClassNotFoundException</span> <span class="token operator">|</span> <span class="token class-name">InstantiationException</span> <span class="token operator">|</span> <span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ExceptionInInitializerError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">T</span> <span class="token function">getService</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> interfaceClass<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>interfaceClass<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›¸å…³é…ç½® application.properties</p><pre class="line-numbers language-none"><code class="language-none">serializer.algorithm&#x3D;Jsoncn.itcast.server.service.HelloService&#x3D;cn.itcast.server.service.HelloServiceImpl<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="2ï¼‰æœåŠ¡å™¨-handler"><a href="#2ï¼‰æœåŠ¡å™¨-handler" class="headerlink" title="2ï¼‰æœåŠ¡å™¨ handler"></a>2ï¼‰æœåŠ¡å™¨ handler</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@ChannelHandler.Sharable</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RpcRequestMessageHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RpcRequestMessage</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">RpcRequestMessage</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">RpcResponseMessage</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RpcResponseMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        response<span class="token punctuation">.</span><span class="token function">setSequenceId</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getSequenceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// è·å–çœŸæ­£çš„å®ç°å¯¹è±¡</span>            <span class="token class-name">HelloService</span> service <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HelloService</span><span class="token punctuation">)</span>                    <span class="token class-name">ServicesFactory</span><span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getInterfaceName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// è·å–è¦è°ƒç”¨çš„æ–¹æ³•</span>            <span class="token class-name">Method</span> method <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMethodName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// è°ƒç”¨æ–¹æ³•</span>            <span class="token class-name">Object</span> invoke <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getParameterValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è°ƒç”¨æˆåŠŸ</span>            response<span class="token punctuation">.</span><span class="token function">setReturnValue</span><span class="token punctuation">(</span>invoke<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è°ƒç”¨å¼‚å¸¸</span>            response<span class="token punctuation">.</span><span class="token function">setExceptionValue</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// è¿”å›ç»“æœ</span>        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ï¼‰å®¢æˆ·ç«¯ä»£ç ç¬¬ä¸€ç‰ˆ"><a href="#3ï¼‰å®¢æˆ·ç«¯ä»£ç ç¬¬ä¸€ç‰ˆ" class="headerlink" title="3ï¼‰å®¢æˆ·ç«¯ä»£ç ç¬¬ä¸€ç‰ˆ"></a>3ï¼‰å®¢æˆ·ç«¯ä»£ç ç¬¬ä¸€ç‰ˆ</h4><p>åªå‘æ¶ˆæ¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RpcClient</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">NioEventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">LoggingHandler</span> <span class="token constant">LOGGING_HANDLER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">MessageCodecSharable</span> <span class="token constant">MESSAGE_CODEC</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageCodecSharable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">RpcResponseMessageHandler</span> <span class="token constant">RPC_HANDLER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RpcResponseMessageHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>            bootstrap<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProcotolFrameDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token constant">LOGGING_HANDLER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token constant">MESSAGE_CODEC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token constant">RPC_HANDLER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Channel</span> channel <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ChannelFuture</span> future <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RpcRequestMessage</span><span class="token punctuation">(</span>                    <span class="token number">1</span><span class="token punctuation">,</span>                    <span class="token string">"cn.itcast.server.service.HelloService"</span><span class="token punctuation">,</span>                    <span class="token string">"sayHello"</span><span class="token punctuation">,</span>                    <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>                    <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                    <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">&#125;</span>            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>promise <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>promise<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">Throwable</span> cause <span class="token operator">=</span> promise<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"client error"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            group<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ï¼‰å®¢æˆ·ç«¯-handler-ç¬¬ä¸€ç‰ˆ"><a href="#4ï¼‰å®¢æˆ·ç«¯-handler-ç¬¬ä¸€ç‰ˆ" class="headerlink" title="4ï¼‰å®¢æˆ·ç«¯ handler ç¬¬ä¸€ç‰ˆ"></a>4ï¼‰å®¢æˆ·ç«¯ handler ç¬¬ä¸€ç‰ˆ</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@ChannelHandler.Sharable</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RpcResponseMessageHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RpcResponseMessage</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">RpcResponseMessage</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5ï¼‰å®¢æˆ·ç«¯ä»£ç -ç¬¬äºŒç‰ˆ"><a href="#5ï¼‰å®¢æˆ·ç«¯ä»£ç -ç¬¬äºŒç‰ˆ" class="headerlink" title="5ï¼‰å®¢æˆ·ç«¯ä»£ç  ç¬¬äºŒç‰ˆ"></a>5ï¼‰å®¢æˆ·ç«¯ä»£ç  ç¬¬äºŒç‰ˆ</h4><p>åŒ…æ‹¬ channel ç®¡ç†ï¼Œä»£ç†ï¼Œæ¥æ”¶ç»“æœ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RpcClientManager</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">HelloService</span> service <span class="token operator">=</span> <span class="token function">getProxyService</span><span class="token punctuation">(</span><span class="token class-name">HelloService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        System.out.println(service.sayHello("lisi"));</span><span class="token comment">//        System.out.println(service.sayHello("wangwu"));</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// åˆ›å»ºä»£ç†ç±»</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">T</span> <span class="token function">getProxyService</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> serviceClass<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ClassLoader</span> loader <span class="token operator">=</span> serviceClass<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> interfaces <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>serviceClass<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token comment">//                                                            sayHello  "å¼ ä¸‰"</span>        <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>loader<span class="token punctuation">,</span> interfaces<span class="token punctuation">,</span> <span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token comment">// 1. å°†æ–¹æ³•è°ƒç”¨è½¬æ¢ä¸º æ¶ˆæ¯å¯¹è±¡</span>            <span class="token keyword">int</span> sequenceId <span class="token operator">=</span> <span class="token class-name">SequenceIdGenerator</span><span class="token punctuation">.</span><span class="token function">nextId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">RpcRequestMessage</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RpcRequestMessage</span><span class="token punctuation">(</span>                    sequenceId<span class="token punctuation">,</span>                    serviceClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    method<span class="token punctuation">.</span><span class="token function">getReturnType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    method<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    args            <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 2. å°†æ¶ˆæ¯å¯¹è±¡å‘é€å‡ºå»</span>            <span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 3. å‡†å¤‡ä¸€ä¸ªç©º Promise å¯¹è±¡ï¼Œæ¥æ¥æ”¶ç»“æœ             æŒ‡å®š promise å¯¹è±¡å¼‚æ­¥æ¥æ”¶ç»“æœçº¿ç¨‹</span>            <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">RpcResponseMessageHandler</span><span class="token punctuation">.</span><span class="token constant">PROMISES</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>sequenceId<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//            promise.addListener(future -> &#123;</span><span class="token comment">//                // çº¿ç¨‹</span><span class="token comment">//            &#125;);</span>            <span class="token comment">// 4. ç­‰å¾… promise ç»“æœ</span>            promise<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>promise<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// è°ƒç”¨æ­£å¸¸</span>                <span class="token keyword">return</span> promise<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// è°ƒç”¨å¤±è´¥</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>promise<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> <span class="token constant">LOCK</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è·å–å”¯ä¸€çš„ channel å¯¹è±¡</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Channel</span> <span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>channel <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> channel<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token constant">LOCK</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//  t2</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>channel <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// t1</span>                <span class="token keyword">return</span> channel<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> channel<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// åˆå§‹åŒ– channel æ–¹æ³•</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">NioEventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">LoggingHandler</span> <span class="token constant">LOGGING_HANDLER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">MessageCodecSharable</span> <span class="token constant">MESSAGE_CODEC</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageCodecSharable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">RpcResponseMessageHandler</span> <span class="token constant">RPC_HANDLER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RpcResponseMessageHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        bootstrap<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>        bootstrap<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProcotolFrameDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token constant">LOGGING_HANDLER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token constant">MESSAGE_CODEC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token constant">RPC_HANDLER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            channel <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>future <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                group<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"client error"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6ï¼‰å®¢æˆ·ç«¯-handler-ç¬¬äºŒç‰ˆ"><a href="#6ï¼‰å®¢æˆ·ç«¯-handler-ç¬¬äºŒç‰ˆ" class="headerlink" title="6ï¼‰å®¢æˆ·ç«¯ handler ç¬¬äºŒç‰ˆ"></a>6ï¼‰å®¢æˆ·ç«¯ handler ç¬¬äºŒç‰ˆ</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@ChannelHandler.Sharable</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RpcResponseMessageHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RpcResponseMessage</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token comment">//                       åºå·      ç”¨æ¥æ¥æ”¶ç»“æœçš„ promise å¯¹è±¡</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Promise</span><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token constant">PROMISES</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">RpcResponseMessage</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ‹¿åˆ°ç©ºçš„ promise</span>        <span class="token class-name">Promise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> promise <span class="token operator">=</span> <span class="token constant">PROMISES</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getSequenceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>promise <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Object</span> returnValue <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getReturnValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Exception</span> exceptionValue <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getExceptionValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>exceptionValue <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                promise<span class="token punctuation">.</span><span class="token function">setFailure</span><span class="token punctuation">(</span>exceptionValue<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                promise<span class="token punctuation">.</span><span class="token function">setSuccess</span><span class="token punctuation">(</span>returnValue<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-æºç åˆ†æ"><a href="#2-æºç åˆ†æ" class="headerlink" title="2. æºç åˆ†æ"></a>2. æºç åˆ†æ</h2><h3 id="2-1-å¯åŠ¨å‰–æ"><a href="#2-1-å¯åŠ¨å‰–æ" class="headerlink" title="2.1 å¯åŠ¨å‰–æ"></a>2.1 å¯åŠ¨å‰–æ</h3><p>æˆ‘ä»¬å°±æ¥çœ‹çœ‹ netty ä¸­å¯¹ä¸‹é¢çš„ä»£ç æ˜¯æ€æ ·è¿›è¡Œå¤„ç†çš„</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//1 netty ä¸­ä½¿ç”¨ NioEventLoopGroup ï¼ˆç®€ç§° nio boss çº¿ç¨‹ï¼‰æ¥å°è£…çº¿ç¨‹å’Œ selector</span><span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2 åˆ›å»º NioServerSocketChannelï¼ŒåŒæ—¶ä¼šåˆå§‹åŒ–å®ƒå…³è”çš„ handlerï¼Œä»¥åŠä¸ºåŸç”Ÿ ssc å­˜å‚¨ config</span><span class="token class-name">NioServerSocketChannel</span> attachment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3 åˆ›å»º NioServerSocketChannel æ—¶ï¼Œåˆ›å»ºäº† java åŸç”Ÿçš„ ServerSocketChannel</span><span class="token class-name">ServerSocketChannel</span> serverSocketChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> serverSocketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//4 å¯åŠ¨ nio boss çº¿ç¨‹æ‰§è¡Œæ¥ä¸‹æ¥çš„æ“ä½œ</span><span class="token comment">//5 æ³¨å†Œï¼ˆä»…å…³è” selector å’Œ NioServerSocketChannelï¼‰ï¼Œæœªå…³æ³¨äº‹ä»¶</span><span class="token class-name">SelectionKey</span> selectionKey <span class="token operator">=</span> serverSocketChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> attachment<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//6 head -> åˆå§‹åŒ–å™¨ -> ServerBootstrapAcceptor -> tailï¼Œåˆå§‹åŒ–å™¨æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œåªä¸ºæ·»åŠ  acceptor</span><span class="token comment">//7 ç»‘å®šç«¯å£</span>serverSocketChannel<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//8 è§¦å‘ channel active äº‹ä»¶ï¼Œåœ¨ head ä¸­å…³æ³¨ op_accept äº‹ä»¶</span>selectionKey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¥å£ <code>io.netty.bootstrap.ServerBootstrap#bind</code></p><p>å…³é”®ä»£ç  <code>io.netty.bootstrap.AbstractBootstrap#doBind</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token class-name">ChannelFuture</span> <span class="token function">doBind</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">SocketAddress</span> localAddress<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// 1. æ‰§è¡Œåˆå§‹åŒ–å’Œæ³¨å†Œ regFuture ä¼šç”± initAndRegister è®¾ç½®å…¶æ˜¯å¦å®Œæˆï¼Œä»è€Œå›è°ƒ 3.2 å¤„ä»£ç </span>    <span class="token keyword">final</span> <span class="token class-name">ChannelFuture</span> regFuture <span class="token operator">=</span> <span class="token function">initAndRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> <span class="token class-name">Channel</span> channel <span class="token operator">=</span> regFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>regFuture<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> regFuture<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 2. å› ä¸ºæ˜¯ initAndRegister å¼‚æ­¥æ‰§è¡Œï¼Œéœ€è¦åˆ†ä¸¤ç§æƒ…å†µæ¥çœ‹ï¼Œè°ƒè¯•æ—¶ä¹Ÿéœ€è¦é€šè¿‡ suspend æ–­ç‚¹ç±»å‹åŠ ä»¥åŒºåˆ†</span>    <span class="token comment">// 2.1 å¦‚æœå·²ç»å®Œæˆ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>regFuture<span class="token punctuation">.</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ChannelPromise</span> promise <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">newPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 3.1 ç«‹åˆ»è°ƒç”¨ doBind0</span>        <span class="token function">doBind0</span><span class="token punctuation">(</span>regFuture<span class="token punctuation">,</span> channel<span class="token punctuation">,</span> localAddress<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> promise<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token comment">// 2.2 è¿˜æ²¡æœ‰å®Œæˆ</span>    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">final</span> <span class="token class-name">PendingRegistrationPromise</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PendingRegistrationPromise</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 3.2 å›è°ƒ doBind0</span>        regFuture<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelFutureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelFuture</span> future<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Throwable</span> cause <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>cause <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">// å¤„ç†å¼‚å¸¸...</span>                    promise<span class="token punctuation">.</span><span class="token function">setFailure</span><span class="token punctuation">(</span>cause<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    promise<span class="token punctuation">.</span><span class="token function">registered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 3. ç”±æ³¨å†Œçº¿ç¨‹å»æ‰§è¡Œ doBind0</span>                    <span class="token function">doBind0</span><span class="token punctuation">(</span>regFuture<span class="token punctuation">,</span> channel<span class="token punctuation">,</span> localAddress<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> promise<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…³é”®ä»£ç  <code>io.netty.bootstrap.AbstractBootstrap#initAndRegister</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name">ChannelFuture</span> <span class="token function">initAndRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        channel <span class="token operator">=</span> channelFactory<span class="token punctuation">.</span><span class="token function">newChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 1.1 åˆå§‹åŒ– - åšçš„äº‹å°±æ˜¯æ·»åŠ ä¸€ä¸ªåˆå§‹åŒ–å™¨ ChannelInitializer</span>        <span class="token function">init</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å¤„ç†å¼‚å¸¸...</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultChannelPromise</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FailedChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">GlobalEventExecutor</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFailure</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 1.2 æ³¨å†Œ - åšçš„äº‹å°±æ˜¯å°†åŸç”Ÿ channel æ³¨å†Œåˆ° selector ä¸Š</span>    <span class="token class-name">ChannelFuture</span> regFuture <span class="token operator">=</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>regFuture<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å¤„ç†å¼‚å¸¸...</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> regFuture<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…³é”®ä»£ç  <code>io.netty.bootstrap.ServerBootstrap#init</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// è¿™é‡Œ channel å®é™…ä¸Šæ˜¯ NioServerSocketChannel</span><span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> channel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ChannelOption</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> options <span class="token operator">=</span> <span class="token function">options0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">setChannelOptions</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> options<span class="token punctuation">,</span> logger<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttributeKey</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> attrs <span class="token operator">=</span> <span class="token function">attrs0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>attrs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttributeKey</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> e<span class="token operator">:</span> attrs<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>            <span class="token class-name">AttributeKey</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">AttributeKey</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">ChannelPipeline</span> p <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> <span class="token class-name">EventLoopGroup</span> currentChildGroup <span class="token operator">=</span> childGroup<span class="token punctuation">;</span>    <span class="token keyword">final</span> <span class="token class-name">ChannelHandler</span> currentChildHandler <span class="token operator">=</span> childHandler<span class="token punctuation">;</span>    <span class="token keyword">final</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ChannelOption</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> currentChildOptions<span class="token punctuation">;</span>    <span class="token keyword">final</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttributeKey</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> currentChildAttrs<span class="token punctuation">;</span>    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>childOptions<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        currentChildOptions <span class="token operator">=</span> childOptions<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token function">newOptionArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>childAttrs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        currentChildAttrs <span class="token operator">=</span> childAttrs<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token function">newAttrArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// ä¸º NioServerSocketChannel æ·»åŠ åˆå§‹åŒ–å™¨</span>    p<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Channel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">final</span> <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ChannelHandler</span> handler <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">// åˆå§‹åŒ–å™¨çš„èŒè´£æ˜¯å°† ServerBootstrapAcceptor åŠ å…¥è‡³ NioServerSocketChannel</span>            ch<span class="token punctuation">.</span><span class="token function">eventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServerBootstrapAcceptor</span><span class="token punctuation">(</span>                            ch<span class="token punctuation">,</span> currentChildGroup<span class="token punctuation">,</span> currentChildHandler<span class="token punctuation">,</span> currentChildOptions<span class="token punctuation">,</span> currentChildAttrs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…³é”®ä»£ç  <code>io.netty.channel.AbstractChannel.AbstractUnsafe#register</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">EventLoop</span> eventLoop<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ä¸€äº›æ£€æŸ¥ï¼Œç•¥...</span>    <span class="token class-name">AbstractChannel</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>eventLoop <span class="token operator">=</span> eventLoop<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>eventLoop<span class="token punctuation">.</span><span class="token function">inEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">register0</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// é¦–æ¬¡æ‰§è¡Œ execute æ–¹æ³•æ—¶ï¼Œä¼šå¯åŠ¨ nio çº¿ç¨‹ï¼Œä¹‹åæ³¨å†Œç­‰æ“ä½œåœ¨ nio çº¿ç¨‹ä¸Šæ‰§è¡Œ</span>            <span class="token comment">// å› ä¸ºåªæœ‰ä¸€ä¸ª NioServerSocketChannel å› æ­¤ï¼Œä¹Ÿåªä¼šæœ‰ä¸€ä¸ª boss nio çº¿ç¨‹</span>            <span class="token comment">// è¿™è¡Œä»£ç å®Œæˆçš„äº‹å®æ˜¯ main -> nio boss çº¿ç¨‹çš„åˆ‡æ¢</span>            eventLoop<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token function">register0</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// æ—¥å¿—è®°å½•...</span>            <span class="token function">closeForcibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            closeFuture<span class="token punctuation">.</span><span class="token function">setClosed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">safeSetFailure</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>io.netty.channel.AbstractChannel.AbstractUnsafe#register0</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">register0</span><span class="token punctuation">(</span><span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>promise<span class="token punctuation">.</span><span class="token function">setUncancellable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">ensureOpen</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">boolean</span> firstRegistration <span class="token operator">=</span> neverRegistered<span class="token punctuation">;</span>        <span class="token comment">// 1.2.1 åŸç”Ÿçš„ nio channel ç»‘å®šåˆ° selector ä¸Šï¼Œæ³¨æ„æ­¤æ—¶æ²¡æœ‰æ³¨å†Œ selector å…³æ³¨äº‹ä»¶ï¼Œé™„ä»¶ä¸º NioServerSocketChannel</span>        <span class="token function">doRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        neverRegistered <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        registered <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token comment">// 1.2.2 æ‰§è¡Œ NioServerSocketChannel åˆå§‹åŒ–å™¨çš„ initChannel</span>        pipeline<span class="token punctuation">.</span><span class="token function">invokeHandlerAddedIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å›è°ƒ 3.2 io.netty.bootstrap.AbstractBootstrap#doBind0</span>        <span class="token function">safeSetSuccess</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>        pipeline<span class="token punctuation">.</span><span class="token function">fireChannelRegistered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// å¯¹åº” server socket channel è¿˜æœªç»‘å®šï¼ŒisActive ä¸º false</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>firstRegistration<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                pipeline<span class="token punctuation">.</span><span class="token function">fireChannelActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAutoRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token function">beginRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Close the channel directly to avoid FD leak.</span>        <span class="token function">closeForcibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        closeFuture<span class="token punctuation">.</span><span class="token function">setClosed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">safeSetFailure</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…³é”®ä»£ç  <code>io.netty.channel.ChannelInitializer#initChannel</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>initMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// Guard against re-entrance.</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// 1.2.2.1 æ‰§è¡Œåˆå§‹åŒ–</span>            <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">C</span><span class="token punctuation">)</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">exceptionCaught</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// 1.2.2.2 ç§»é™¤åˆå§‹åŒ–å™¨</span>            <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>pipeline<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                pipeline<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…³é”®ä»£ç  <code>io.netty.bootstrap.AbstractBootstrap#doBind0</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 3.1 æˆ– 3.2 æ‰§è¡Œ doBind0</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">doBind0</span><span class="token punctuation">(</span>        <span class="token keyword">final</span> <span class="token class-name">ChannelFuture</span> regFuture<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">,</span>        <span class="token keyword">final</span> <span class="token class-name">SocketAddress</span> localAddress<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    channel<span class="token punctuation">.</span><span class="token function">eventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>regFuture<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                channel<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>localAddress<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token class-name">ChannelFutureListener</span><span class="token punctuation">.</span><span class="token constant">CLOSE_ON_FAILURE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                promise<span class="token punctuation">.</span><span class="token function">setFailure</span><span class="token punctuation">(</span>regFuture<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…³é”®ä»£ç  <code>io.netty.channel.AbstractChannel.AbstractUnsafe#bind</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">SocketAddress</span> localAddress<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">assertEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>promise<span class="token punctuation">.</span><span class="token function">setUncancellable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">ensureOpen</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOption</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span><span class="token constant">SO_BROADCAST</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>        localAddress <span class="token keyword">instanceof</span> <span class="token class-name">InetSocketAddress</span> <span class="token operator">&amp;&amp;</span>        <span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">InetSocketAddress</span><span class="token punctuation">)</span> localAddress<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAnyLocalAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>        <span class="token operator">!</span><span class="token class-name">PlatformDependent</span><span class="token punctuation">.</span><span class="token function">isWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">PlatformDependent</span><span class="token punctuation">.</span><span class="token function">maybeSuperUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// è®°å½•æ—¥å¿—...</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">boolean</span> wasActive <span class="token operator">=</span> <span class="token function">isActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 3.3 æ‰§è¡Œç«¯å£ç»‘å®š</span>        <span class="token function">doBind</span><span class="token punctuation">(</span>localAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">safeSetFailure</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">closeIfClosed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>wasActive <span class="token operator">&amp;&amp;</span> <span class="token function">isActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">invokeLater</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// 3.4 è§¦å‘ active äº‹ä»¶</span>                pipeline<span class="token punctuation">.</span><span class="token function">fireChannelActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">safeSetSuccess</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3.3 å…³é”®ä»£ç  <code>io.netty.channel.socket.nio.NioServerSocketChannel#doBind</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doBind</span><span class="token punctuation">(</span><span class="token class-name">SocketAddress</span> localAddress<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">PlatformDependent</span><span class="token punctuation">.</span><span class="token function">javaVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">javaChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>localAddress<span class="token punctuation">,</span> config<span class="token punctuation">.</span><span class="token function">getBacklog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token function">javaChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>localAddress<span class="token punctuation">,</span> config<span class="token punctuation">.</span><span class="token function">getBacklog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3.4 å…³é”®ä»£ç  <code>io.netty.channel.DefaultChannelPipeline.HeadContext#channelActive</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    ctx<span class="token punctuation">.</span><span class="token function">fireChannelActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è§¦å‘ read (NioServerSocketChannel ä¸Šçš„ read ä¸æ˜¯è¯»å–æ•°æ®ï¼Œåªæ˜¯ä¸ºäº†è§¦å‘ channel çš„äº‹ä»¶æ³¨å†Œ)</span>    <span class="token function">readIfIsAutoRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…³é”®ä»£ç  <code>io.netty.channel.nio.AbstractNioChannel#doBeginRead</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doBeginRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// Channel.read() or ChannelHandlerContext.read() was called</span>    <span class="token keyword">final</span> <span class="token class-name">SelectionKey</span> selectionKey <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selectionKey<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>selectionKey<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    readPending <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> <span class="token keyword">int</span> interestOps <span class="token operator">=</span> selectionKey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// readInterestOp å–å€¼æ˜¯ 16ï¼Œåœ¨ NioServerSocketChannel åˆ›å»ºæ—¶åˆå§‹åŒ–å¥½ï¼Œä»£è¡¨å…³æ³¨ accept äº‹ä»¶</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>interestOps <span class="token operator">&amp;</span> readInterestOp<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        selectionKey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span>interestOps <span class="token operator">|</span> readInterestOp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-2-NioEventLoop-å‰–æ"><a href="#2-2-NioEventLoop-å‰–æ" class="headerlink" title="2.2 NioEventLoop å‰–æ"></a>2.2 NioEventLoop å‰–æ</h3><p>NioEventLoop çº¿ç¨‹ä¸ä»…è¦å¤„ç† IO äº‹ä»¶ï¼Œè¿˜è¦å¤„ç† Taskï¼ˆåŒ…æ‹¬æ™®é€šä»»åŠ¡å’Œå®šæ—¶ä»»åŠ¡ï¼‰ï¼Œ</p><p>æäº¤ä»»åŠ¡ä»£ç  <code>io.netty.util.concurrent.SingleThreadEventExecutor#execute</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> task<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>task <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token string">"task"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">boolean</span> inEventLoop <span class="token operator">=</span> <span class="token function">inEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ·»åŠ ä»»åŠ¡ï¼Œå…¶ä¸­é˜Ÿåˆ—ä½¿ç”¨äº† jctools æä¾›çš„ mpsc æ— é”é˜Ÿåˆ—</span>    <span class="token function">addTask</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>inEventLoop<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// inEventLoop å¦‚æœä¸º false è¡¨ç¤ºç”±å…¶å®ƒçº¿ç¨‹æ¥è°ƒç”¨ executeï¼Œå³é¦–æ¬¡è°ƒç”¨ï¼Œè¿™æ—¶éœ€è¦å‘ eventLoop æäº¤é¦–ä¸ªä»»åŠ¡ï¼Œå¯åŠ¨æ­»å¾ªç¯ï¼Œä¼šæ‰§è¡Œåˆ°ä¸‹é¢çš„ doStartThread</span>        <span class="token function">startThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// å¦‚æœå·²ç» shutdownï¼Œåšæ‹’ç»é€»è¾‘ï¼Œä»£ç ç•¥...</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>addTaskWakesUp <span class="token operator">&amp;&amp;</span> <span class="token function">wakesUpForTask</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å¦‚æœçº¿ç¨‹ç”±äº IO select é˜»å¡äº†ï¼Œæ·»åŠ çš„ä»»åŠ¡çš„çº¿ç¨‹éœ€è¦è´Ÿè´£å”¤é†’ NioEventLoop çº¿ç¨‹</span>        <span class="token function">wakeup</span><span class="token punctuation">(</span>inEventLoop<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å”¤é†’ select é˜»å¡çº¿ç¨‹<code>io.netty.channel.nio.NioEventLoop#wakeup</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">wakeup</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> inEventLoop<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>inEventLoop <span class="token operator">&amp;&amp;</span> wakenUp<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        selector<span class="token punctuation">.</span><span class="token function">wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯åŠ¨ EventLoop ä¸»å¾ªç¯ <code>io.netty.util.concurrent.SingleThreadEventExecutor#doStartThread</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">doStartThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">assert</span> thread <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// å°†çº¿ç¨‹æ± çš„å½“å‰çº¿ç¨‹ä¿å­˜åœ¨æˆå‘˜å˜é‡ä¸­ï¼Œä»¥ä¾¿åç»­ä½¿ç”¨</span>            thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>interrupted<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                thread<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">boolean</span> success <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token function">updateLastExecutionTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// è°ƒç”¨å¤–éƒ¨ç±» SingleThreadEventExecutor çš„ run æ–¹æ³•ï¼Œè¿›å…¥æ­»å¾ªç¯ï¼Œrun æ–¹æ³•è§ä¸‹</span>                <span class="token class-name">SingleThreadEventExecutor</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                success <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"Unexpected exception from an event executor: "</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span><span class="token comment">// æ¸…ç†å·¥ä½œï¼Œä»£ç ç•¥...</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>io.netty.channel.nio.NioEventLoop#run</code> ä¸»è¦ä»»åŠ¡æ˜¯æ‰§è¡Œæ­»å¾ªç¯ï¼Œä¸æ–­çœ‹æœ‰æ²¡æœ‰æ–°ä»»åŠ¡ï¼Œæœ‰æ²¡æœ‰ IO äº‹ä»¶</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// calculateStrategy çš„é€»è¾‘å¦‚ä¸‹ï¼š</span>                <span class="token comment">// æœ‰ä»»åŠ¡ï¼Œä¼šæ‰§è¡Œä¸€æ¬¡ selectNowï¼Œæ¸…é™¤ä¸Šä¸€æ¬¡çš„ wakeup ç»“æœï¼Œæ— è®ºæœ‰æ²¡æœ‰ IO äº‹ä»¶ï¼Œéƒ½ä¼šè·³è¿‡ switch</span>                <span class="token comment">// æ²¡æœ‰ä»»åŠ¡ï¼Œä¼šåŒ¹é… SelectStrategy.SELECTï¼Œçœ‹æ˜¯å¦åº”å½“é˜»å¡</span>                <span class="token keyword">switch</span> <span class="token punctuation">(</span>selectStrategy<span class="token punctuation">.</span><span class="token function">calculateStrategy</span><span class="token punctuation">(</span>selectNowSupplier<span class="token punctuation">,</span> <span class="token function">hasTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">case</span> <span class="token class-name">SelectStrategy</span><span class="token punctuation">.</span><span class="token constant">CONTINUE</span><span class="token operator">:</span>                        <span class="token keyword">continue</span><span class="token punctuation">;</span>                    <span class="token keyword">case</span> <span class="token class-name">SelectStrategy</span><span class="token punctuation">.</span><span class="token constant">BUSY_WAIT</span><span class="token operator">:</span>                    <span class="token keyword">case</span> <span class="token class-name">SelectStrategy</span><span class="token punctuation">.</span><span class="token constant">SELECT</span><span class="token operator">:</span>                        <span class="token comment">// å› ä¸º IO çº¿ç¨‹å’Œæäº¤ä»»åŠ¡çº¿ç¨‹éƒ½æœ‰å¯èƒ½æ‰§è¡Œ wakeupï¼Œè€Œ wakeup å±äºæ¯”è¾ƒæ˜‚è´µçš„æ“ä½œï¼Œå› æ­¤ä½¿ç”¨äº†ä¸€ä¸ªåŸå­å¸ƒå°”å¯¹è±¡ wakenUpï¼Œå®ƒå–å€¼ä¸º true æ—¶ï¼Œè¡¨ç¤ºè¯¥ç”±å½“å‰çº¿ç¨‹å”¤é†’</span>                        <span class="token comment">// è¿›è¡Œ select é˜»å¡ï¼Œå¹¶è®¾ç½®å”¤é†’çŠ¶æ€ä¸º false</span>                        <span class="token keyword">boolean</span> oldWakenUp <span class="token operator">=</span> wakenUp<span class="token punctuation">.</span><span class="token function">getAndSet</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                <span class="token comment">// å¦‚æœåœ¨è¿™ä¸ªä½ç½®ï¼Œé EventLoop çº¿ç¨‹æŠ¢å…ˆå°† wakenUp ç½®ä¸º trueï¼Œå¹¶ wakeup</span>                        <span class="token comment">// ä¸‹é¢çš„ select æ–¹æ³•ä¸ä¼šé˜»å¡</span>                        <span class="token comment">// ç­‰ runAllTasks å¤„ç†å®Œæˆåï¼Œåˆ°å†å¾ªç¯è¿›æ¥è¿™ä¸ªé˜¶æ®µæ–°å¢çš„ä»»åŠ¡ä¼šä¸ä¼šåŠæ—¶æ‰§è¡Œå‘¢?</span>                        <span class="token comment">// å› ä¸º oldWakenUp ä¸º trueï¼Œå› æ­¤ä¸‹é¢çš„ select æ–¹æ³•å°±ä¼šé˜»å¡ï¼Œç›´åˆ°è¶…æ—¶</span>                        <span class="token comment">// æ‰èƒ½æ‰§è¡Œï¼Œè®© select æ–¹æ³•æ— è°“é˜»å¡</span>                        <span class="token function">select</span><span class="token punctuation">(</span>oldWakenUp<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>wakenUp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            selector<span class="token punctuation">.</span><span class="token function">wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token keyword">default</span><span class="token operator">:</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token function">rebuildSelector0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">handleLoopException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            cancelledKeys <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            needsToSelectAgain <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token comment">// ioRatio é»˜è®¤æ˜¯ 50</span>            <span class="token keyword">final</span> <span class="token keyword">int</span> ioRatio <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ioRatio<span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>ioRatio <span class="token operator">==</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token function">processSelectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">// ioRatio ä¸º 100 æ—¶ï¼Œæ€»æ˜¯è¿è¡Œå®Œæ‰€æœ‰é IO ä»»åŠ¡</span>                    <span class="token function">runAllTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                                <span class="token keyword">final</span> <span class="token keyword">long</span> ioStartTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token function">processSelectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">// è®°å½• io äº‹ä»¶å¤„ç†è€—æ—¶</span>                    <span class="token keyword">final</span> <span class="token keyword">long</span> ioTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> ioStartTime<span class="token punctuation">;</span>                    <span class="token comment">// è¿è¡Œé IO ä»»åŠ¡ï¼Œä¸€æ—¦è¶…æ—¶ä¼šé€€å‡º runAllTasks</span>                    <span class="token function">runAllTasks</span><span class="token punctuation">(</span>ioTime <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">-</span> ioRatio<span class="token punctuation">)</span> <span class="token operator">/</span> ioRatio<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">handleLoopException</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isShuttingDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token function">closeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">confirmShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">return</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">handleLoopException</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="âš ï¸-æ³¨æ„"><a href="#âš ï¸-æ³¨æ„" class="headerlink" title="âš ï¸ æ³¨æ„"></a>âš ï¸ æ³¨æ„</h4><blockquote><p>è¿™é‡Œæœ‰ä¸ªè´¹è§£çš„åœ°æ–¹å°±æ˜¯ wakeupï¼Œå®ƒæ—¢å¯ä»¥ç”±æäº¤ä»»åŠ¡çš„çº¿ç¨‹æ¥è°ƒç”¨ï¼ˆæ¯”è¾ƒå¥½ç†è§£ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”± EventLoop çº¿ç¨‹æ¥è°ƒç”¨ï¼ˆæ¯”è¾ƒè´¹è§£ï¼‰ï¼Œè¿™é‡Œè¦çŸ¥é“ wakeup æ–¹æ³•çš„æ•ˆæœï¼š</p><ul><li>ç”±é EventLoop çº¿ç¨‹è°ƒç”¨ï¼Œä¼šå”¤é†’å½“å‰åœ¨æ‰§è¡Œ select é˜»å¡çš„ EventLoop çº¿ç¨‹</li><li>ç”± EventLoop è‡ªå·±è°ƒç”¨ï¼Œä¼šæœ¬æ¬¡çš„ wakeup ä¼šå–æ¶ˆä¸‹ä¸€æ¬¡çš„ select æ“ä½œ</li></ul></blockquote><p>å‚è€ƒä¸‹å›¾</p><p><img src="/posts/0.htm/0032.png"></p><p><code>io.netty.channel.nio.NioEventLoop#select</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> oldWakenUp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selector<span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> selectCnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> currentTimeNanos <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¡ç®—ç­‰å¾…æ—¶é—´</span>        <span class="token comment">// * æ²¡æœ‰ scheduledTaskï¼Œè¶…æ—¶æ—¶é—´ä¸º 1s</span>        <span class="token comment">// * æœ‰ scheduledTaskï¼Œè¶…æ—¶æ—¶é—´ä¸º `ä¸‹ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶é—´ - å½“å‰æ—¶é—´`</span>        <span class="token keyword">long</span> selectDeadLineNanos <span class="token operator">=</span> currentTimeNanos <span class="token operator">+</span> <span class="token function">delayNanos</span><span class="token punctuation">(</span>currentTimeNanos<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">long</span> timeoutMillis <span class="token operator">=</span> <span class="token punctuation">(</span>selectDeadLineNanos <span class="token operator">-</span> currentTimeNanos <span class="token operator">+</span> <span class="token number">500000L</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000000L</span><span class="token punctuation">;</span>            <span class="token comment">// å¦‚æœè¶…æ—¶ï¼Œé€€å‡ºå¾ªç¯</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>timeoutMillis <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>selectCnt <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    selector<span class="token punctuation">.</span><span class="token function">selectNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    selectCnt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">// å¦‚æœæœŸé—´åˆæœ‰ task é€€å‡ºå¾ªç¯ï¼Œå¦‚æœæ²¡è¿™ä¸ªåˆ¤æ–­ï¼Œé‚£ä¹ˆä»»åŠ¡å°±ä¼šç­‰åˆ°ä¸‹æ¬¡ select è¶…æ—¶æ—¶æ‰èƒ½è¢«æ‰§è¡Œ</span>            <span class="token comment">// wakenUp.compareAndSet(false, true) æ˜¯è®©é NioEventLoop ä¸å¿…å†æ‰§è¡Œ wakeup</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> wakenUp<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                selector<span class="token punctuation">.</span><span class="token function">selectNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                selectCnt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">// select æœ‰é™æ—¶é˜»å¡</span>            <span class="token comment">// æ³¨æ„ nio æœ‰ bugï¼Œå½“ bug å‡ºç°æ—¶ï¼Œselect æ–¹æ³•å³ä½¿æ²¡æœ‰æ—¶é—´å‘ç”Ÿï¼Œä¹Ÿä¸ä¼šé˜»å¡ä½ï¼Œå¯¼è‡´ä¸æ–­ç©ºè½®è¯¢ï¼Œcpu å ç”¨ 100%</span>            <span class="token keyword">int</span> selectedKeys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>timeoutMillis<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è®¡æ•°åŠ  1</span>            selectCnt <span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token comment">// é†’æ¥åï¼Œå¦‚æœæœ‰ IO äº‹ä»¶ã€æˆ–æ˜¯ç”±é EventLoop çº¿ç¨‹å”¤é†’ï¼Œæˆ–è€…æœ‰ä»»åŠ¡ï¼Œé€€å‡ºå¾ªç¯</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>selectedKeys <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">||</span> oldWakenUp <span class="token operator">||</span> wakenUp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">hasTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">hasScheduledTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>               <span class="token comment">// çº¿ç¨‹è¢«æ‰“æ–­ï¼Œé€€å‡ºå¾ªç¯</span>                <span class="token comment">// è®°å½•æ—¥å¿—</span>                selectCnt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">long</span> time <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">-</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">.</span><span class="token function">toNanos</span><span class="token punctuation">(</span>timeoutMillis<span class="token punctuation">)</span> <span class="token operator">>=</span> currentTimeNanos<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// å¦‚æœè¶…æ—¶ï¼Œè®¡æ•°é‡ç½®ä¸º 1ï¼Œä¸‹æ¬¡å¾ªç¯å°±ä¼š break</span>                selectCnt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>             <span class="token comment">// è®¡æ•°è¶…è¿‡é˜ˆå€¼ï¼Œç”± io.netty.selectorAutoRebuildThreshold æŒ‡å®šï¼Œé»˜è®¤ 512</span>            <span class="token comment">// è¿™æ˜¯ä¸ºäº†è§£å†³ nio ç©ºè½®è¯¢ bug</span>            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">SELECTOR_AUTO_REBUILD_THRESHOLD</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>                    selectCnt <span class="token operator">>=</span> <span class="token constant">SELECTOR_AUTO_REBUILD_THRESHOLD</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// é‡å»º selector</span>                selector <span class="token operator">=</span> <span class="token function">selectRebuildSelector</span><span class="token punctuation">(</span>selectCnt<span class="token punctuation">)</span><span class="token punctuation">;</span>                selectCnt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            currentTimeNanos <span class="token operator">=</span> time<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>selectCnt <span class="token operator">></span> <span class="token constant">MIN_PREMATURE_SELECTOR_RETURNS</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// è®°å½•æ—¥å¿—</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CancelledKeyException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// è®°å½•æ—¥å¿—</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¤„ç† keys <code>io.netty.channel.nio.NioEventLoop#processSelectedKeys</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">processSelectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>selectedKeys <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// é€šè¿‡åå°„å°† Selector å®ç°ç±»ä¸­çš„å°±ç»ªäº‹ä»¶é›†åˆæ›¿æ¢ä¸º SelectedSelectionKeySet </span>        <span class="token comment">// SelectedSelectionKeySet åº•å±‚ä¸ºæ•°ç»„å®ç°ï¼Œå¯ä»¥æé«˜éå†æ€§èƒ½ï¼ˆåŸæœ¬ä¸º HashSetï¼‰</span>        <span class="token function">processSelectedKeysOptimized</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token function">processSelectedKeysPlain</span><span class="token punctuation">(</span>selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>io.netty.channel.nio.NioEventLoop#processSelectedKey</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">processSelectedKey</span><span class="token punctuation">(</span><span class="token class-name">SelectionKey</span> k<span class="token punctuation">,</span> <span class="token class-name">AbstractNioChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">final</span> <span class="token class-name">AbstractNioChannel<span class="token punctuation">.</span>NioUnsafe</span> unsafe <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">unsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å½“ key å–æ¶ˆæˆ–å…³é—­æ—¶ä¼šå¯¼è‡´è¿™ä¸ª key æ— æ•ˆ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>k<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// æ— æ•ˆæ—¶å¤„ç†...</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> readyOps <span class="token operator">=</span> k<span class="token punctuation">.</span><span class="token function">readyOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è¿æ¥äº‹ä»¶</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>readyOps <span class="token operator">&amp;</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_CONNECT</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">int</span> ops <span class="token operator">=</span> k<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ops <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_CONNECT</span><span class="token punctuation">;</span>            k<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span>ops<span class="token punctuation">)</span><span class="token punctuation">;</span>            unsafe<span class="token punctuation">.</span><span class="token function">finishConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// å¯å†™äº‹ä»¶</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>readyOps <span class="token operator">&amp;</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_WRITE</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ch<span class="token punctuation">.</span><span class="token function">unsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forceFlush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// å¯è¯»æˆ–å¯æ¥å…¥äº‹ä»¶</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>readyOps <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span> <span class="token operator">|</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">||</span> readyOps <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// å¦‚æœæ˜¯å¯æ¥å…¥ io.netty.channel.nio.AbstractNioMessageChannel.NioMessageUnsafe#read</span>            <span class="token comment">// å¦‚æœæ˜¯å¯è¯» io.netty.channel.nio.AbstractNioByteChannel.NioByteUnsafe#read</span>            unsafe<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CancelledKeyException</span> ignored<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        unsafe<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">voidPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-3-accept-å‰–æ"><a href="#2-3-accept-å‰–æ" class="headerlink" title="2.3 accept å‰–æ"></a>2.3 accept å‰–æ</h3><p>nio ä¸­å¦‚ä¸‹ä»£ç ï¼Œåœ¨ netty ä¸­çš„æµç¨‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//1 é˜»å¡ç›´åˆ°äº‹ä»¶å‘ç”Ÿ</span>selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> iter <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//2 æ‹¿åˆ°ä¸€ä¸ªäº‹ä»¶</span>    <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3 å¦‚æœæ˜¯ accept äº‹ä»¶</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">//4 æ‰§è¡Œ accept</span>        <span class="token class-name">SocketChannel</span> channel <span class="token operator">=</span> serverSocketChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        channel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//5 å…³æ³¨ read äº‹ä»¶</span>        channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…ˆæ¥çœ‹å¯æ¥å…¥äº‹ä»¶å¤„ç†ï¼ˆacceptï¼‰</p><p><code>io.netty.channel.nio.AbstractNioMessageChannel.NioMessageUnsafe#read</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">assert</span> <span class="token function">eventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> <span class="token class-name">ChannelConfig</span> config <span class="token operator">=</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> <span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> <span class="token class-name">RecvByteBufAllocator<span class="token punctuation">.</span>Handle</span> allocHandle <span class="token operator">=</span> <span class="token function">unsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">recvBufAllocHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    allocHandle<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">boolean</span> closed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token class-name">Throwable</span> exception <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">do</span> <span class="token punctuation">&#123;</span><span class="token comment">// doReadMessages ä¸­æ‰§è¡Œäº† accept å¹¶åˆ›å»º NioSocketChannel ä½œä¸ºæ¶ˆæ¯æ”¾å…¥ readBuf</span>                <span class="token comment">// readBuf æ˜¯ä¸€ä¸ª ArrayList ç”¨æ¥ç¼“å­˜æ¶ˆæ¯</span>                <span class="token keyword">int</span> localRead <span class="token operator">=</span> <span class="token function">doReadMessages</span><span class="token punctuation">(</span>readBuf<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>localRead <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>localRead <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    closed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span><span class="token comment">// localRead ä¸º 1ï¼Œå°±ä¸€æ¡æ¶ˆæ¯ï¼Œå³æ¥æ”¶ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥</span>                allocHandle<span class="token punctuation">.</span><span class="token function">incMessagesRead</span><span class="token punctuation">(</span>localRead<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>allocHandle<span class="token punctuation">.</span><span class="token function">continueReading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            exception <span class="token operator">=</span> t<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">int</span> size <span class="token operator">=</span> readBuf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            readPending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token comment">// è§¦å‘ read äº‹ä»¶ï¼Œè®© pipeline ä¸Šçš„ handler å¤„ç†ï¼Œè¿™æ—¶æ˜¯å¤„ç†</span>            <span class="token comment">// io.netty.bootstrap.ServerBootstrap.ServerBootstrapAcceptor#channelRead</span>            pipeline<span class="token punctuation">.</span><span class="token function">fireChannelRead</span><span class="token punctuation">(</span>readBuf<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        readBuf<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        allocHandle<span class="token punctuation">.</span><span class="token function">readComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pipeline<span class="token punctuation">.</span><span class="token function">fireChannelReadComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>exception <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            closed <span class="token operator">=</span> <span class="token function">closeOnReadError</span><span class="token punctuation">(</span>exception<span class="token punctuation">)</span><span class="token punctuation">;</span>            pipeline<span class="token punctuation">.</span><span class="token function">fireExceptionCaught</span><span class="token punctuation">(</span>exception<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>closed<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            inputShutdown <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token function">close</span><span class="token punctuation">(</span><span class="token function">voidPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>readPending <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>config<span class="token punctuation">.</span><span class="token function">isAutoRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">removeReadOp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…³é”®ä»£ç  <code>io.netty.bootstrap.ServerBootstrap.ServerBootstrapAcceptor#channelRead</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è¿™æ—¶çš„ msg æ˜¯ NioSocketChannel</span>    <span class="token keyword">final</span> <span class="token class-name">Channel</span> child <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Channel</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>    <span class="token comment">// NioSocketChannel æ·»åŠ   childHandler å³åˆå§‹åŒ–å™¨</span>    child<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>childHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è®¾ç½®é€‰é¡¹</span>    <span class="token function">setChannelOptions</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> childOptions<span class="token punctuation">,</span> logger<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttributeKey</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> e<span class="token operator">:</span> childAttrs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        child<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">AttributeKey</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// æ³¨å†Œ NioSocketChannel åˆ° nio worker çº¿ç¨‹ï¼Œæ¥ä¸‹æ¥çš„å¤„ç†ä¹Ÿç§»äº¤è‡³ nio worker çº¿ç¨‹</span>        childGroup<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelFutureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelFuture</span> future<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>future<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token function">forceClose</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> future<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">forceClose</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆå›åˆ°äº†ç†Ÿæ‚‰çš„ <code>io.netty.channel.AbstractChannel.AbstractUnsafe#register</code>  æ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">EventLoop</span> eventLoop<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ä¸€äº›æ£€æŸ¥ï¼Œç•¥...</span>    <span class="token class-name">AbstractChannel</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>eventLoop <span class="token operator">=</span> eventLoop<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>eventLoop<span class="token punctuation">.</span><span class="token function">inEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">register0</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// è¿™è¡Œä»£ç å®Œæˆçš„äº‹å®æ˜¯ nio boss -> nio worker çº¿ç¨‹çš„åˆ‡æ¢</span>            eventLoop<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token function">register0</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// æ—¥å¿—è®°å½•...</span>            <span class="token function">closeForcibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            closeFuture<span class="token punctuation">.</span><span class="token function">setClosed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">safeSetFailure</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>io.netty.channel.AbstractChannel.AbstractUnsafe#register0</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">register0</span><span class="token punctuation">(</span><span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>promise<span class="token punctuation">.</span><span class="token function">setUncancellable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">ensureOpen</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">boolean</span> firstRegistration <span class="token operator">=</span> neverRegistered<span class="token punctuation">;</span>        <span class="token function">doRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        neverRegistered <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        registered <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token comment">// æ‰§è¡Œåˆå§‹åŒ–å™¨ï¼Œæ‰§è¡Œå‰ pipeline ä¸­åªæœ‰ head -> åˆå§‹åŒ–å™¨ -> tail</span>        pipeline<span class="token punctuation">.</span><span class="token function">invokeHandlerAddedIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ‰§è¡Œåå°±æ˜¯ head -> logging handler -> my handler -> tail</span>        <span class="token function">safeSetSuccess</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>        pipeline<span class="token punctuation">.</span><span class="token function">fireChannelRegistered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>firstRegistration<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// è§¦å‘ pipeline ä¸Š active äº‹ä»¶</span>                pipeline<span class="token punctuation">.</span><span class="token function">fireChannelActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAutoRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token function">beginRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">closeForcibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        closeFuture<span class="token punctuation">.</span><span class="token function">setClosed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">safeSetFailure</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å›åˆ°äº†ç†Ÿæ‚‰çš„ä»£ç  <code>io.netty.channel.DefaultChannelPipeline.HeadContext#channelActive</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    ctx<span class="token punctuation">.</span><span class="token function">fireChannelActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è§¦å‘ read (NioSocketChannel è¿™é‡Œ readï¼Œåªæ˜¯ä¸ºäº†è§¦å‘ channel çš„äº‹ä»¶æ³¨å†Œï¼Œè¿˜æœªæ¶‰åŠæ•°æ®è¯»å–)</span>    <span class="token function">readIfIsAutoRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>io.netty.channel.nio.AbstractNioChannel#doBeginRead</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doBeginRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// Channel.read() or ChannelHandlerContext.read() was called</span>    <span class="token keyword">final</span> <span class="token class-name">SelectionKey</span> selectionKey <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selectionKey<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>selectionKey<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    readPending <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">// è¿™æ—¶å€™ interestOps æ˜¯ 0</span>    <span class="token keyword">final</span> <span class="token keyword">int</span> interestOps <span class="token operator">=</span> selectionKey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>interestOps <span class="token operator">&amp;</span> readInterestOp<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å…³æ³¨ read äº‹ä»¶</span>        selectionKey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span>interestOps <span class="token operator">|</span> readInterestOp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-4-read-å‰–æ"><a href="#2-4-read-å‰–æ" class="headerlink" title="2.4 read å‰–æ"></a>2.4 read å‰–æ</h3><p>å†æ¥çœ‹å¯è¯»äº‹ä»¶ <code>io.netty.channel.nio.AbstractNioByteChannel.NioByteUnsafe#read</code>ï¼Œæ³¨æ„å‘é€çš„æ•°æ®æœªå¿…èƒ½å¤Ÿä¸€æ¬¡è¯»å®Œï¼Œå› æ­¤ä¼šè§¦å‘å¤šæ¬¡ nio read äº‹ä»¶ï¼Œä¸€æ¬¡äº‹ä»¶å†…ä¼šè§¦å‘å¤šæ¬¡ pipeline readï¼Œä¸€æ¬¡äº‹ä»¶ä¼šè§¦å‘ä¸€æ¬¡ pipeline read complete</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">final</span> <span class="token class-name">ChannelConfig</span> config <span class="token operator">=</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">shouldBreakReadReady</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">clearReadPending</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">final</span> <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> <span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// io.netty.allocator.type å†³å®š allocator çš„å®ç°</span>    <span class="token keyword">final</span> <span class="token class-name">ByteBufAllocator</span> allocator <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getAllocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ç”¨æ¥åˆ†é… byteBufï¼Œç¡®å®šå•æ¬¡è¯»å–å¤§å°</span>    <span class="token keyword">final</span> <span class="token class-name">RecvByteBufAllocator<span class="token punctuation">.</span>Handle</span> allocHandle <span class="token operator">=</span> <span class="token function">recvBufAllocHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    allocHandle<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ByteBuf</span> byteBuf <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">boolean</span> close <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>            byteBuf <span class="token operator">=</span> allocHandle<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>allocator<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è¯»å–</span>            allocHandle<span class="token punctuation">.</span><span class="token function">lastBytesRead</span><span class="token punctuation">(</span><span class="token function">doReadBytes</span><span class="token punctuation">(</span>byteBuf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>allocHandle<span class="token punctuation">.</span><span class="token function">lastBytesRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                byteBuf<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                byteBuf <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                close <span class="token operator">=</span> allocHandle<span class="token punctuation">.</span><span class="token function">lastBytesRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>close<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    readPending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            allocHandle<span class="token punctuation">.</span><span class="token function">incMessagesRead</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            readPending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token comment">// è§¦å‘ read äº‹ä»¶ï¼Œè®© pipeline ä¸Šçš„ handler å¤„ç†ï¼Œè¿™æ—¶æ˜¯å¤„ç† NioSocketChannel ä¸Šçš„ handler</span>            pipeline<span class="token punctuation">.</span><span class="token function">fireChannelRead</span><span class="token punctuation">(</span>byteBuf<span class="token punctuation">)</span><span class="token punctuation">;</span>            byteBuf <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>         <span class="token comment">// æ˜¯å¦è¦ç»§ç»­å¾ªç¯</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>allocHandle<span class="token punctuation">.</span><span class="token function">continueReading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        allocHandle<span class="token punctuation">.</span><span class="token function">readComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è§¦å‘ read complete äº‹ä»¶</span>        pipeline<span class="token punctuation">.</span><span class="token function">fireChannelReadComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>close<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">closeOnRead</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">handleReadException</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span> byteBuf<span class="token punctuation">,</span> t<span class="token punctuation">,</span> close<span class="token punctuation">,</span> allocHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>readPending <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>config<span class="token punctuation">.</span><span class="token function">isAutoRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">removeReadOp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>io.netty.channel.DefaultMaxMessagesRecvByteBufAllocator.MaxMessageHandle#continueReading(io.netty.util.UncheckedBooleanSupplier)</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">continueReading</span><span class="token punctuation">(</span><span class="token class-name">UncheckedBooleanSupplier</span> maybeMoreDataSupplier<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span>            <span class="token comment">// ä¸€èˆ¬ä¸º true</span>           config<span class="token punctuation">.</span><span class="token function">isAutoRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>           <span class="token comment">// respectMaybeMoreData é»˜è®¤ä¸º true</span>           <span class="token comment">// maybeMoreDataSupplier çš„é€»è¾‘æ˜¯å¦‚æœé¢„æœŸè¯»å–å­—èŠ‚ä¸å®é™…è¯»å–å­—èŠ‚ç›¸ç­‰ï¼Œè¿”å› true</span>           <span class="token punctuation">(</span><span class="token operator">!</span>respectMaybeMoreData <span class="token operator">||</span> maybeMoreDataSupplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>           <span class="token comment">// å°äºæœ€å¤§æ¬¡æ•°ï¼ŒmaxMessagePerRead é»˜è®¤ 16</span>           totalMessages <span class="token operator">&lt;</span> maxMessagePerRead <span class="token operator">&amp;&amp;</span>           <span class="token comment">// å®é™…è¯»åˆ°äº†æ•°æ®</span>           totalBytesRead <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å››-ä¼˜åŒ–ä¸æºç &quot;&gt;&lt;a href=&quot;#å››-ä¼˜åŒ–ä¸æºç &quot; class=&quot;headerlink&quot; title=&quot;å››. ä¼˜åŒ–ä¸æºç &quot;&gt;&lt;/a&gt;å››. ä¼˜åŒ–ä¸æºç &lt;/h1&gt;&lt;h2 id=&quot;1-ä¼˜åŒ–&quot;&gt;&lt;a href=&quot;#1-ä¼˜åŒ–&quot; class=&quot;headerlink&quot; ti</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>SpringCloud &amp; SpringCloudAlibaba</title>
    <link href="https://100qin10086.github.io/posts/db1b69a.html"/>
    <id>https://100qin10086.github.io/posts/db1b69a.html</id>
    <published>2024-04-18T01:08:22.000Z</published>
    <updated>2024-05-06T14:13:59.610Z</updated>
    
    <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a><div class="note purple no-icon flat"><p>SpringCloud &amp; SpringCloudAlibabaå¤ä¹  </p></div></h1><h2 id="Spring-Cloud-åŸºæœ¬ä»‹ç»"><a href="#Spring-Cloud-åŸºæœ¬ä»‹ç»" class="headerlink" title="Spring Cloud åŸºæœ¬ä»‹ç»"></a>Spring Cloud åŸºæœ¬ä»‹ç»</h2><h3 id="ç³»ç»Ÿæ¶æ„çš„æ¼”å˜è¿‡ç¨‹"><a href="#ç³»ç»Ÿæ¶æ„çš„æ¼”å˜è¿‡ç¨‹" class="headerlink" title="ç³»ç»Ÿæ¶æ„çš„æ¼”å˜è¿‡ç¨‹"></a>ç³»ç»Ÿæ¶æ„çš„æ¼”å˜è¿‡ç¨‹</h3><h4 id="å•æœºæ¶æ„"><a href="#å•æœºæ¶æ„" class="headerlink" title="å•æœºæ¶æ„"></a>å•æœºæ¶æ„</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/41e80c2982515987ae7e9a1f14e348fa.png"></div></div><h4 id="åŠ¨é™åˆ†ç¦»æ¶æ„-é™æ€ç¼“å­˜-æ–‡ä»¶å­˜å‚¨"><a href="#åŠ¨é™åˆ†ç¦»æ¶æ„-é™æ€ç¼“å­˜-æ–‡ä»¶å­˜å‚¨" class="headerlink" title="åŠ¨é™åˆ†ç¦»æ¶æ„:é™æ€ç¼“å­˜+æ–‡ä»¶å­˜å‚¨"></a>åŠ¨é™åˆ†ç¦»æ¶æ„:é™æ€ç¼“å­˜+æ–‡ä»¶å­˜å‚¨</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/658053dabbd32532257568bc1806eff2.png"></div></div><h4 id="åˆ†å¸ƒå¼æ¶æ„-ä¸šåŠ¡æ‹†åˆ†-è´Ÿè½½å‡è¡¡"><a href="#åˆ†å¸ƒå¼æ¶æ„-ä¸šåŠ¡æ‹†åˆ†-è´Ÿè½½å‡è¡¡" class="headerlink" title="åˆ†å¸ƒå¼æ¶æ„:ä¸šåŠ¡æ‹†åˆ†+è´Ÿè½½å‡è¡¡"></a>åˆ†å¸ƒå¼æ¶æ„:ä¸šåŠ¡æ‹†åˆ†+è´Ÿè½½å‡è¡¡</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1141d9c79050fa061b9a9f3e81a8e637.png"></div></div><h3 id="Spring-Cloud-å…¨é¢è¯´æ˜-é‡è¦"><a href="#Spring-Cloud-å…¨é¢è¯´æ˜-é‡è¦" class="headerlink" title="Spring Cloud å…¨é¢è¯´æ˜(é‡è¦)"></a>Spring Cloud å…¨é¢è¯´æ˜(é‡è¦)</h3><p>1.SpringCloud æ¥æºäº Spring, æ˜¯æ›´é«˜å±‚æ¬¡çš„ã€ æ¶æ„è§†è§’çš„ç»¼åˆæ€§å¤§å‹é¡¹ç›®ï¼Œ ç›®æ ‡æ—¨åœ¨æ„å»ºä¸€å¥—æ ‡å‡†åŒ–çš„å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆï¼Œ<br>è®©æ¶æ„å¸ˆåœ¨ä½¿ç”¨å¾®æœåŠ¡ç†å¿µæ„å»ºç³»ç»Ÿçš„æ—¶ï¼Œ é¢å¯¹å„ç¯èŠ‚çš„é—®é¢˜éƒ½å¯ä»¥æ‰¾åˆ°ç›¸åº”çš„ç»„ä»¶æ¥å¤„ç†ã€‚<br>2.Spring Cloud æ˜¯ Spring ç¤¾åŒºä¸ºå¾®æœåŠ¡æ¶æ„æä¾›çš„ä¸€ä¸ª â€œå…¨å®¶æ¡¶â€ å¥—é¤ã€‚å¥—é¤ä¸­å„ä¸ªç»„ä»¶ä¹‹é—´çš„é…åˆï¼Œ<br>å¯ä»¥å‡å°‘åœ¨ç»„ä»¶çš„é€‰å‹å’Œæ•´åˆä¸ŠèŠ±è´¹çš„ç²¾åŠ›ï¼Œå¯ä»¥å¿«é€Ÿæ„å»ºèµ·åŸºç¡€çš„å¾®æœåŠ¡æ¶æ„ç³»ç»Ÿï¼Œæ˜¯å¾®æœåŠ¡æ¶æ„çš„æœ€ä½³è½åœ°æ–¹æ¡ˆ<br>3.Spirng Cloud å¤©ç„¶æ”¯æŒ Spring Boot(æœ‰ç‰ˆæœ¬å¯¹åº”è¦æ±‚)ï¼Œä½¿ç”¨é—¨æ§›è¾ƒä½<br>4.è§£å†³ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¤æ‚æ€§ â€“ ç½‘ç»œé—®é¢˜ï¼Œå»¶è¿Ÿå¼€é”€ï¼Œå¸¦å®½é—®é¢˜ï¼Œå®‰å…¨é—®é¢˜<br>5.å¤„ç†æœåŠ¡å‘ç°çš„èƒ½åŠ› â€“ æœåŠ¡å‘ç°å…è®¸é›†ç¾¤ä¸­çš„è¿›ç¨‹å’ŒæœåŠ¡æ‰¾åˆ°å½¼æ­¤å¹¶è¿›è¡Œé€šä¿¡<br>6.è§£å†³å†—ä½™é—®é¢˜ â€“ å†—ä½™é—®é¢˜ç»å¸¸å‘ç”Ÿåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­<br>7.è§£å†³è´Ÿè½½å¹³è¡¡ â€“ æ”¹è¿›è·¨å¤šä¸ªè®¡ç®—èµ„æºï¼ˆä¾‹å¦‚è®¡ç®—æœºé›†ç¾¤ï¼Œç½‘ç»œé“¾æ¥ï¼Œä¸­å¤®å¤„ç†å•å…ƒï¼‰çš„ å·¥ä½œè´Ÿè½½åˆ†å¸ƒ</p><h3 id="Spring-Cloudç»„ä»¶é€‰å‹"><a href="#Spring-Cloudç»„ä»¶é€‰å‹" class="headerlink" title="Spring Cloudç»„ä»¶é€‰å‹"></a>Spring Cloudç»„ä»¶é€‰å‹</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/303fc8102165a400bdd6f5745b714150.png"></div></div><h2 id="Spring-Cloud-Alibaba-åŸºæœ¬ä»‹ç»"><a href="#Spring-Cloud-Alibaba-åŸºæœ¬ä»‹ç»" class="headerlink" title="Spring Cloud Alibaba åŸºæœ¬ä»‹ç»"></a>Spring Cloud Alibaba åŸºæœ¬ä»‹ç»</h2><h3 id="åˆ†å¸ƒå¼å¾®æœåŠ¡æŠ€æœ¯é€‰å‹"><a href="#åˆ†å¸ƒå¼å¾®æœåŠ¡æŠ€æœ¯é€‰å‹" class="headerlink" title="åˆ†å¸ƒå¼å¾®æœåŠ¡æŠ€æœ¯é€‰å‹"></a>åˆ†å¸ƒå¼å¾®æœåŠ¡æŠ€æœ¯é€‰å‹</h3><p>Â·Spring Cloud åŸç”Ÿç»„ä»¶çš„å‡ å¤§ç—›ç‚¹<br>1.Spring Cloud éƒ¨åˆ†ç»„ä»¶åœæ­¢ç»´æŠ¤å’Œæ›´æ–°, ç»™å¼€å‘å¸¦æ¥ä¸ä¾¿<br>2.Spring Cloud éƒ¨åˆ†ç¯å¢ƒæ­å»ºå¤æ‚ï¼Œæ²¡æœ‰å®Œå–„çš„å¯è§†åŒ–ç•Œé¢ï¼Œæˆ‘ä»¬éœ€è¦å¤§é‡çš„äºŒæ¬¡å¼€å‘å’Œå®šåˆ¶<br>3.Spring Cloud é…ç½®å¤æ‚ï¼Œéš¾ä»¥ä¸Šæ‰‹<br>Â·Spring Cloud Alibaba çš„ä¼˜åŠ¿<br>1.é˜¿é‡Œä½¿ç”¨è¿‡çš„ç»„ä»¶ç»å†äº†è€ƒéªŒ[é«˜å¹¶å‘,é«˜æ€§èƒ½,é«˜å¯ç”¨]ï¼Œæ€§èƒ½å¼ºæ‚ï¼Œè®¾è®¡åˆç†ï¼Œç°åœ¨å¼€æºå‡ºæ¥ä¾›å¤§å®¶ä½¿ç”¨.<br>1.æ­é…å®Œå–„çš„å¯è§†åŒ–ç•Œé¢, ç»™å¼€å‘è¿ç»´å¸¦æ¥æå¤§çš„ä¾¿åˆ©æ­å»ºç®€å•ï¼Œå­¦ä¹ æ›²çº¿ä½</p><h2 id="RestTemplate"><a href="#RestTemplate" class="headerlink" title="RestTemplate"></a>RestTemplate</h2><h3 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>Â·RestTemplate æ˜¯ Spring æä¾›çš„ç”¨äºè®¿é—® Rest æœåŠ¡çš„æ¨¡æ¿ç±»<br>Â·RestTemplate æä¾›äº†å¤šç§ä¾¿æ·è®¿é—®è¿œç¨‹ Http æœåŠ¡çš„æ–¹æ³•<br>Â·å¯ä»¥è¿™æ ·ç†è§£, é€šè¿‡ RestTemplate, æˆ‘ä»¬å¯ä»¥å‘å‡º http è¯·æ±‚(æ”¯æŒ<br>Restful é£æ ¼), å»è°ƒç”¨ Controller æä¾›çš„ API æ¥å£, å°±åƒæˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨å‘å‡º http è¯·æ±‚,<br>è°ƒç”¨è¯¥ API æ¥å£ä¸€æ ·.</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">MEMBER_SERVICE_PROVIDER_URL</span><span class="token operator">=</span><span class="token string">"http://MEMBER-SERVICE-PROVIDER"</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span> <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/member/consumer/get/&#123;id&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">></span></span> <span class="token function">getMemberById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token constant">MEMBER_SERVICE_PROVIDER_URL</span>                 <span class="token operator">+</span><span class="token string">"/member/get/"</span><span class="token operator">+</span>id<span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°"><a href="#EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°" class="headerlink" title="EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°"></a>EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°</h2><h3 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h3><p>Â·åœ¨ä¼ä¸šçº§é¡¹ç›®ä¸­ï¼ŒæœåŠ¡æ¶ˆè´¹è®¿é—®è¯·æ±‚ä¼šå­˜åœ¨é«˜å¹¶å‘<br>Â·å¦‚æœåªæœ‰ä¸€ä¸ªä¼šå‘˜ä¸­å¿ƒ-æä¾›æœåŠ¡ï¼Œå¯ç”¨æ€§å·®<br>Â·æ‰€ä»¥ï¼Œä¼šå‘˜ä¸­å¿ƒæä¾›æœåŠ¡å¾€å¾€æ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šæœ‰å¤šä¸ªä¼šå‘˜ä¸­å¿ƒ-æä¾›æœåŠ¡å¾®æœåŠ¡æ¨¡å—<br>Â·é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œå°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜å°±æ˜¯æœåŠ¡æ¶ˆè´¹æ–¹ï¼Œæ€ä¹ˆå»å‘ç°å¯ä»¥ä½¿ç”¨çš„æœåŠ¡<br>Â·å½“æœåŠ¡æ¶ˆè´¹æ–¹ï¼Œå‘ç°äº†å¯ä»¥ä½¿ç”¨çš„æœåŠ¡å(<br>å¯èƒ½æ˜¯å¤šä¸ªï¼Œåˆå­˜åœ¨ä¸€ä¸ªé—®é¢˜å°±æ˜¯åˆ°åº•è°ƒç”¨AæœåŠ¡ï¼Œè¿˜æ˜¯BæœåŠ¡çš„é—®é¢˜ï¼Œè¿™å°±å¼•å‡ºäº†æœåŠ¡æ³¨å†Œå’Œè´Ÿè½½å‡è¡¡)<br>Â·Eurekaå°±å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/f769cb302d576c58e7a0159ce0510c22.png"></div></div></p><h3 id="è§£è¯»ä¸Šå›¾"><a href="#è§£è¯»ä¸Šå›¾" class="headerlink" title="è§£è¯»ä¸Šå›¾"></a>è§£è¯»ä¸Šå›¾</h3><p>Â·ä¼šå‘˜ä¸­å¿ƒ-æä¾›æœåŠ¡çš„ï¼Œåœ¨é¡¹ç›®ä¸­ï¼Œä¼šåšæˆé›†ç¾¤ï¼Œæä¾›é«˜å¯ç”¨<br>Â·Eureka Server æœ‰å¿…è¦çš„è¯ï¼Œä¹Ÿå¯ä»¥åšæˆé›†ç¾¤<br>Â·Eureka åŒ…å«ä¸¤ä¸ªç»„ä»¶âˆ¶Eureka Server å’Œ Eureka Client<br>Â·Eureka Server æä¾›æ³¨å†ŒæœåŠ¡, å„ä¸ªå¾®æœåŠ¡èŠ‚ç‚¹é€šè¿‡é…ç½®å¯åŠ¨åï¼Œä¼šåœ¨ Eureka Server ä¸­è¿›<br>è¡Œæ³¨å†Œï¼Œè¿™æ · EurekaServer ä¸­çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­å°†ä¼šå­˜å‚¨æ‰€æœ‰å¯ç”¨æœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒæœåŠ¡èŠ‚<br>ç‚¹çš„ä¿¡æ¯å¯ä»¥åœ¨ç•Œé¢ä¸­ç›´è§‚çœ‹åˆ°ã€‚<br>Â·EurekaClient é€šè¿‡æ³¨å†Œä¸­å¿ƒè¿›è¡Œè®¿é—®, æ˜¯ä¸€ä¸ª Java å®¢æˆ·ç«¯ï¼Œç”¨äºç®€åŒ– Eureka Server çš„äº¤<br>äº’ï¼Œå®¢æˆ·ç«¯åŒæ—¶ä¹Ÿå…·å¤‡ä¸€ä¸ªå†…ç½®çš„ã€ä½¿ç”¨è½®è¯¢(round-robin) è´Ÿè½½ç®—æ³•çš„è´Ÿè½½å‡è¡¡å™¨ã€‚åœ¨åº”<br>ç”¨å¯åŠ¨åï¼Œå°†ä¼šå‘ Eureka Server å‘é€å¿ƒè·³(é»˜è®¤å‘¨æœŸä¸º 30 ç§’)ã€‚å¦‚æœ Eureka Server åœ¨å¤šä¸ª<br>å¿ƒè·³å‘¨æœŸå†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªèŠ‚ç‚¹çš„å¿ƒè·³ï¼ŒEurekaServer å°†ä¼šä»æœåŠ¡æ³¨å†Œè¡¨ä¸­æŠŠè¿™ä¸ªæœåŠ¡èŠ‚<br>ç‚¹ç§»é™¤(é»˜è®¤ 90 ç§’)ã€é»˜è®¤ä½¿ç”¨è½®è¯¢ç®—æ³•,å¹¶ä¸”ä¼šåˆ¤æ–­clientæ˜¯å¦å­˜æ´»,å°†å…¶æ˜¯å¦å‰”é™¤ã€‘<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/93f2d62365027655ba4ac300cdf7d67c.png"></div></div></p><h3 id="åˆ›å»ºå•æœºEureka"><a href="#åˆ›å»ºå•æœºEureka" class="headerlink" title="åˆ›å»ºå•æœºEureka"></a>åˆ›å»ºå•æœºEureka</h3><p>Â·å¼•å…¥pom.xmlæ–‡ä»¶</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">></span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.qgq.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>e-eommerce-center<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>e-commerce-eureka-server-9001<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- å¼•å…¥eureka-server åœºæ™¯å¯åŠ¨å™¨starter: ä½¿ç”¨ç‰ˆæœ¬ä»²è£ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- å¼•å…¥web-starter è€å¸ˆè¯´æ˜æˆ‘ä»¬ä½¿ç”¨ç‰ˆæœ¬ä»²è£(ä»çˆ¶é¡¹ç›®ç»§æ‰¿äº†ç‰ˆæœ¬)                 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- è¯´æ˜:starter-actuator æ˜¯springbootç¨‹åºçš„ç›‘æ§ç³»ç»Ÿ, å¯ä»¥å®ç°ç³»ç»Ÿçš„å¥åº·æ£€æµ‹                å¯ä»¥é€šè¿‡http://localhost:9001/actuator çœ‹åˆ°ç›¸å…³çš„è¿æ¥,å’Œä¿¡æ¯                 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- lombok --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- å¼•å…¥test-starter --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- å¼•å…¥e_commerce_center-common-api --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.qgq.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>e_commerce_center-common-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·application.ymlé…ç½®</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9001</span><span class="token key atrule">eureka</span><span class="token punctuation">:</span>  <span class="token key atrule">instance</span><span class="token punctuation">:</span>    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> eureka9001.com  <span class="token comment">#</span>  <span class="token key atrule">client</span><span class="token punctuation">:</span>    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># ä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±</span>    <span class="token comment">#è¡¨ç¤ºè‡ªå·±å°±æ˜¯æ³¨å†Œä¸­å¿ƒ,ä½œç”¨å°±æ˜¯ç»´æŠ¤ç»„æµ‹æœåŠ¡å®ä¾‹,ä¸å»æ£€ç´¢æœåŠ¡</span>    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token comment">#è®¾ç½®ä¸eureka Serveräº¤äº’çš„æ¨¡å—,æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€</span>    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka9002.com<span class="token punctuation">:</span>9002/eureka/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·é…ç½®å¯åŠ¨ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@EnableEurekaServer</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EurekaApplication9001</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">EurekaApplication9001</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å°†member-service-provider-10000ä½œä¸ºEurekaClientæ³¨å†Œåˆ°e-commerce-eureka-server-9001æˆä¸ºæœåŠ¡æä¾›"><a href="#å°†member-service-provider-10000ä½œä¸ºEurekaClientæ³¨å†Œåˆ°e-commerce-eureka-server-9001æˆä¸ºæœåŠ¡æä¾›" class="headerlink" title="å°†member-service-provider-10000ä½œä¸ºEurekaClientæ³¨å†Œåˆ°e-commerce-eureka-server-9001æˆä¸ºæœåŠ¡æä¾›"></a>å°†member-service-provider-10000ä½œä¸ºEurekaClientæ³¨å†Œåˆ°e-commerce-eureka-server-9001æˆä¸ºæœåŠ¡æä¾›</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/b307a3f312df73d50be3b50ed58d5844.png"></div></div><p>Â·å¼•å…¥pom.xmlæ–‡ä»¶<br>Â·application.ymlé…ç½®</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10000</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> member<span class="token punctuation">-</span>service<span class="token punctuation">-</span>provider  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/e_commerce_center_db_review<span class="token punctuation">?</span>useSSL=true<span class="token important">&amp;userUnicode=true&amp;characterEncoding=UTF-</span><span class="token number">8</span>    <span class="token key atrule">username</span><span class="token punctuation">:</span> root    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">1234</span><span class="token key atrule">mybatis</span><span class="token punctuation">:</span>  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>  <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> com.qgq.springcloud.entity<span class="token key atrule">eureka</span><span class="token punctuation">:</span>  <span class="token key atrule">client</span><span class="token punctuation">:</span>    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#è¡¨ç¤ºä»Eureka-ServeræŠ“å–æ³¨å†Œä¿¡æ¯,å¦‚æœæ˜¯ä¸€ä¸ªå•èŠ‚ç‚¹,æ˜¯å¯ä»¥ä¸é…ç½®çš„</span>    <span class="token comment">#ä½†å¦‚æœæ˜¯ä¸€ä¸ªé›†ç¾¤,åˆ™å¿…é¡»é…ç½®true ,æ‰èƒ½é…ç½®Ribbonä½¿ç”¨è´Ÿè½½å‡è¡¡</span>    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#å°†è‡ªå·±æ³¨å†Œåˆ°EurekaServer</span>    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka9001.com<span class="token punctuation">:</span>9001/eureka/<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka9002.com<span class="token punctuation">:</span>9002/eureka/      <span class="token comment">#è¡¨ç¤ºå°†è‡ªå·±æ³¨å†Œåˆ°é‚£ä¸ªeurekaServer</span>  <span class="token key atrule">instance</span><span class="token punctuation">:</span>    <span class="token key atrule">instance-id</span><span class="token punctuation">:</span> $<span class="token punctuation">&#123;</span>spring.cloud.client.ip<span class="token punctuation">-</span>address<span class="token punctuation">&#125;</span><span class="token punctuation">:</span>$<span class="token punctuation">&#123;</span>spring.application.name<span class="token punctuation">&#125;</span><span class="token punctuation">:</span>$<span class="token punctuation">&#123;</span>server.port<span class="token punctuation">&#125;</span>    <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·ä¿®æ”¹å¯åŠ¨ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableEurekaClient</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberApplication10000</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MemberApplication10000</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é…-ç½®-member-service-consumer-80ä½œä¸ºEurekaClientå¯ä»¥æ‹‰å–-è·å–e-commerce-eureka-server-9001-æä¾›çš„æœåŠ¡ä¿¡"><a href="#é…-ç½®-member-service-consumer-80ä½œä¸ºEurekaClientå¯ä»¥æ‹‰å–-è·å–e-commerce-eureka-server-9001-æä¾›çš„æœåŠ¡ä¿¡" class="headerlink" title="é… ç½® member-service-consumer-80ä½œä¸ºEurekaClientå¯ä»¥æ‹‰å–/è·å–e-commerce-eureka-server-9001 æä¾›çš„æœåŠ¡ä¿¡"></a>é… ç½® member-service-consumer-80ä½œä¸ºEurekaClientå¯ä»¥æ‹‰å–/è·å–e-commerce-eureka-server-9001 æä¾›çš„æœåŠ¡ä¿¡</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/7e8048288b8c2a7948deff213366df53.png"></div></div><h4 id="Service-Consumer-ã€Service-Provider-ã€EurekaServer-çš„ç»´æŠ¤æœºåˆ¶"><a href="#Service-Consumer-ã€Service-Provider-ã€EurekaServer-çš„ç»´æŠ¤æœºåˆ¶" class="headerlink" title="Service Consumer ã€Service Provider ã€EurekaServer çš„ç»´æŠ¤æœºåˆ¶"></a>Service Consumer ã€Service Provider ã€EurekaServer çš„ç»´æŠ¤æœºåˆ¶</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/208257c1f24e08345a54d5cf96823eaa.png"></div></div><h3 id="æ­å»º-EurekaServer-é›†ç¾¤-å®ç°è´Ÿè½½å‡è¡¡-amp-æ•…éšœå®¹é”™"><a href="#æ­å»º-EurekaServer-é›†ç¾¤-å®ç°è´Ÿè½½å‡è¡¡-amp-æ•…éšœå®¹é”™" class="headerlink" title="æ­å»º EurekaServer é›†ç¾¤- å®ç°è´Ÿè½½å‡è¡¡&amp;æ•…éšœå®¹é”™"></a>æ­å»º EurekaServer é›†ç¾¤- å®ç°è´Ÿè½½å‡è¡¡&amp;æ•…éšœå®¹é”™</h3><h4 id="ä¸»è¦æ­¥éª¤"><a href="#ä¸»è¦æ­¥éª¤" class="headerlink" title="ä¸»è¦æ­¥éª¤"></a>ä¸»è¦æ­¥éª¤</h4><p>Â·å¤šä¸ªEurekaServerä¹‹é—´ç›¸äº’æ³¨å†Œ,å¦‚æœå…¶ä¸­ä¸€ä¸ªæŒ‚äº†å,ä¿è¯å…¶ä»–çš„å¯ä»¥è¿è¡Œ</p><h3 id="é…ç½®æœåŠ¡æ¶ˆè´¹ç«¯-member-service-consumer-80-ä½¿ç”¨ä¼šå‘˜ä¸­å¿ƒæœåŠ¡é›†ç¾¤"><a href="#é…ç½®æœåŠ¡æ¶ˆè´¹ç«¯-member-service-consumer-80-ä½¿ç”¨ä¼šå‘˜ä¸­å¿ƒæœåŠ¡é›†ç¾¤" class="headerlink" title="é…ç½®æœåŠ¡æ¶ˆè´¹ç«¯ member-service-consumer-80 ä½¿ç”¨ä¼šå‘˜ä¸­å¿ƒæœåŠ¡é›†ç¾¤"></a>é…ç½®æœåŠ¡æ¶ˆè´¹ç«¯ member-service-consumer-80 ä½¿ç”¨ä¼šå‘˜ä¸­å¿ƒæœåŠ¡é›†ç¾¤</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/942813b8384a6051644ff4efb2332aa9.png"></div></div><h4 id="ä»£ç ä¿®æ”¹"><a href="#ä»£ç ä¿®æ”¹" class="headerlink" title="ä»£ç ä¿®æ”¹"></a>ä»£ç ä¿®æ”¹</h4><p>Â·ä¼˜äºæœåŠ¡æ¶ˆè´¹æ–¹è°ƒç”¨å¤šä¸ªæœåŠ¡æä¾›æ–¹,æ‰€ä»¥è¦åœ¨RestTemplateä¸ŠåŠ å…¥@LoadBlaced</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomizationBean</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token annotation punctuation">@LoadBalanced</span>    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">getRestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·äº¤æ›¿è®¿é—®memberæœåŠ¡è¯´æ˜: 1. æ³¨è§£@LoadBalanced åº•å±‚æ˜¯Ribbonæ”¯æŒç®—æ³• 2.Ribbonå’ŒEureka<br>æ•´åˆå consumer ç›´æ¥è°ƒç”¨æœåŠ¡è€Œä¸ç”¨å†å…³å¿ƒåœ°å€å’Œç«¯å£å·ï¼Œä¸”è¯¥æœåŠ¡è¿˜æœ‰è´Ÿè½½åŠŸèƒ½ã€‚</p><h3 id="è·å–-Eureka-Server-æœåŠ¡æ³¨å†Œä¿¡æ¯-DiscoveryClient"><a href="#è·å–-Eureka-Server-æœåŠ¡æ³¨å†Œä¿¡æ¯-DiscoveryClient" class="headerlink" title="è·å– Eureka Server æœåŠ¡æ³¨å†Œä¿¡æ¯ -DiscoveryClient"></a>è·å– Eureka Server æœåŠ¡æ³¨å†Œä¿¡æ¯ -DiscoveryClient</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Resource</span><span class="token keyword">private</span> <span class="token class-name">DiscoveryClient</span> discoveryClient<span class="token punctuation">;</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/member/consumer/discovery"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">discovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> services <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> element <span class="token operator">:</span> services<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"======== æœ åŠ¡ å "</span> <span class="token operator">+</span> element <span class="token operator">+</span><span class="token string">"======================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceInstance</span><span class="token punctuation">></span></span> instances <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getInstances</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ServiceInstance</span> instance <span class="token operator">:</span> instances<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token function">getServiceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>discoveryClient<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>è¿˜è¦ä¿®æ”¹ä¸»å¯åŠ¨ç±»<span class="token comment">//æ’é™¤ DataSourceAutoConfiguration è‡ªåŠ¨é…ç½®</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token comment">//@EnableEurekaClient å°†è¯¥ç¨‹åºæ ‡è¯†ä¸º EurekaClient</span><span class="token annotation punctuation">@EnableEurekaClient</span><span class="token comment">//@EnableDiscoveryClient æ³¨è§£å¯ç”¨æœåŠ¡å‘ç°</span><span class="token annotation punctuation">@EnableDiscoveryClient</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberConsumerApplication</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MemberConsumerApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="SpringCloud-Ribbon"><a href="#SpringCloud-Ribbon" class="headerlink" title="SpringCloud Ribbon"></a>SpringCloud Ribbon</h2><h3 id="Ribbon-ä»‹ç»"><a href="#Ribbon-ä»‹ç»" class="headerlink" title="Ribbon ä»‹ç»"></a>Ribbon ä»‹ç»</h3><p>Â·Spring Cloud Ribbon æ˜¯åŸºäº Netflix Ribbon å®ç°çš„ä¸€å¥—å®¢æˆ·ç«¯ è´Ÿè½½å‡è¡¡çš„å·¥å…·ã€‚<br>Â·Ribbon ä¸»è¦åŠŸèƒ½æ˜¯æä¾›å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ç®—æ³•å’ŒæœåŠ¡è°ƒç”¨<br>Â·Ribbon å®¢æˆ·ç«¯ç»„ä»¶æä¾›ä¸€ç³»åˆ—å®Œå–„çš„é…ç½®é¡¹å¦‚è¿æ¥è¶…æ—¶ï¼Œé‡è¯•ç­‰ã€‚<br>Â·Ribbon ä¼šåŸºäºæŸç§è§„åˆ™ï¼ˆå¦‚ç®€å•è½®è¯¢ï¼Œéšæœºè¿æ¥ç­‰ï¼‰å»è¿æ¥æŒ‡å®šæœåŠ¡<br>Â·ç¨‹åºå‘˜å¾ˆå®¹æ˜“ä½¿ç”¨ Ribbon çš„è´Ÿè½½å‡è¡¡ç®—æ³•å®ç°è´Ÿè½½å‡è¡¡<br>Â·ä¸€å¥è¯: Ribbon: è´Ÿè½½å‡è¡¡+RestTemplate è°ƒç”¨</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RibbonRule</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">IRule</span> <span class="token function">myRibbonRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RandomRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//éšæœºè´Ÿè½½å‡è¡¡ç®—æ³•</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@EnableEurekaClient</span><span class="token annotation punctuation">@RibbonClient</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"MEMBER_SERVICE_PROVIDER_URL"</span><span class="token punctuation">,</span>configuration <span class="token operator">=</span> <span class="token class-name">RibbonRule</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token comment">//@EnableDiscoveryClient æ³¨è§£å¯ç”¨æœåŠ¡å‘ç°</span><span class="token annotation punctuation">@EnableDiscoveryClient</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberConsumerApplication</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MemberConsumerApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·Ribbonå¸¸è§çš„è´Ÿè½½ç®—æ³•<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/7e8a869d5ad5f079441dd6c8224d2a9e.png"></div></div></p><h2 id="SpringCloud-OpenFeign"><a href="#SpringCloud-OpenFeign" class="headerlink" title="SpringCloud OpenFeign"></a>SpringCloud OpenFeign</h2><h3 id="OpenFeignæ˜¯ä»€ä¹ˆ"><a href="#OpenFeignæ˜¯ä»€ä¹ˆ" class="headerlink" title="OpenFeignæ˜¯ä»€ä¹ˆ"></a>OpenFeignæ˜¯ä»€ä¹ˆ</h3><p>Â·OpenFeignæ˜¯ä¸ªå£°æ˜å¼WebServiceå®¢æˆ·ç«¯,ä½¿ç”¨OpenFeignè®©ç¼–å†™WebServiceå®¢æˆ·ç«¯æ›´ç®€å•<br>Â·OpenFeignä¹Ÿæ”¯æŒå¯æ‹”æ’å¼çš„ç¼–ç å™¨å’Œè§£ç å™¨<br>Â·SpringCloud å¯¹ OpenFeignè¿›è¡Œäº†å°è£…ä½¿å…¶æ”¯æŒäº†SpringMvcæ ‡å‡†æ³¨è§£å’ŒHttpMessageConverters<br>Â·OpenFeignå¯ä»¥ä¸Eurekaå’ŒRibbonç»„åˆä½¿ç”¨ä»¥æ”¯æŒè´Ÿè½½å‡è¡¡</p><h3 id="æˆ‘çš„ç†è§£"><a href="#æˆ‘çš„ç†è§£" class="headerlink" title="æˆ‘çš„ç†è§£"></a>æˆ‘çš„ç†è§£</h3><p>Â·åœ¨æœåŠ¡æ¶ˆè´¹æ–¹æ²¡æœ‰ä½¿ç”¨OpenFeignæ—¶,ä½¿ç”¨çš„RestTemplateå‘é€çš„è¯·æ±‚,è€Œä½¿ç”¨äº†OpenFeignåç›¸å½“äºåœ¨Serviceä¸Šå°±è¿›è¡Œ<br>äº†è¯·æ±‚çš„å‘é€<br>Â·ä¾‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"MEMBER-SERVICE-PROVIDER"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MemberFeignService</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 1.è¿œç¨‹è°ƒç”¨çš„æ–¹å¼ä¸ºget     * 2.è¿œç¨‹è°ƒç”¨çš„urlä¸ºhttp://MEMBER-SERVICE-PROVIDER/member/get/&#123;id&#125;     * 3.MEMBER-SERVICE-PROVIDER æ˜¯ æ³¨å†Œä¸­å¿ƒæœåŠ¡     * member-service-provider:10000/100002     * ä¼šæ ¹æ®OpenFeignçš„å‡è¡¡ç®—æ³•æ¥å†³å®šæ˜¯è°ƒç”¨10000è¿˜æ˜¯100002     * @param id     * @return     */</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/member/get/&#123;id&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">></span></span> <span class="token function">getMemberById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·ç„¶ååœ¨controllerå±‚ç»§ç»­ä½¿ç”¨æ³¨è§£çš„æ–¹å¼è¿›è¡Œè¯·æ±‚çš„æ¥æ”¶</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberConsumerFeignController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">MemberFeignService</span> memberFeignService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/member/consumer/openfeign/get/&#123;id&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">></span></span> <span class="token function">getMemberById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> memberFeignService<span class="token punctuation">.</span><span class="token function">getMemberById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="openFeignçš„ä½¿ç”¨"><a href="#openFeignçš„ä½¿ç”¨" class="headerlink" title="openFeignçš„ä½¿ç”¨"></a>openFeignçš„ä½¿ç”¨</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@EnableEurekaClient</span><span class="token annotation punctuation">@EnableFeignClients</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberConsumerOpenfeignApplication80</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MemberConsumerOpenfeignApplication80</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·openFeignçš„æ ¸å¿ƒ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"MEMBER-SERVICE-PROVIDER"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MemberFeignService</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 1.è¿œç¨‹è°ƒç”¨çš„æ–¹å¼ä¸ºget     * 2.è¿œç¨‹è°ƒç”¨çš„urlä¸ºhttp://MEMBER-SERVICE-PROVIDER/member/get/&#123;id&#125;     * 3.MEMBER-SERVICE-PROVIDER æ˜¯ æ³¨å†Œä¸­å¿ƒæœåŠ¡     * member-service-provider:10000/100002     * ä¼šæ ¹æ®OpenFeignçš„å‡è¡¡ç®—æ³•æ¥å†³å®šæ˜¯è°ƒç”¨10000è¿˜æ˜¯100002     * @param id     * @return     */</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/member/get/&#123;id&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">></span></span> <span class="token function">getMemberById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><p>Â·é…OpenFeignçš„ä½¿ç”¨ç‰¹ç‚¹æ—¶å¾®æœåŠ¡è°ƒç”¨æ¥å£+@FeignClient,ä½¿ç”¨æ¥å£è¿›è¡Œè§£è€¦<br>Â·@FeignClient(value = â€œMEMBER-SERVICE-PROVIDERâ€),<br>è¿™é‡ŒMEMBER-SERVICE-PROVIDERå°±æ˜¯Eureka ServeræœåŠ¡æä¾›æ–¹æ³¨å†Œçš„åç§°, ä¸è¦å†™é”™äº†<br>Â·æ¥å£æ–¹æ³•ä¸Šï¼š valueæ˜¯ä¸èƒ½ä¹±å†™, è¿œç¨‹è°ƒç”¨çš„url ä¸º<br><a href="http://MEMBER-SERVICE-PROVIDER/member/get/{id}">http://MEMBER-SERVICE-PROVIDER/member/get/{id}</a></p><h3 id="æ—¥å¿—é…ç½®"><a href="#æ—¥å¿—é…ç½®" class="headerlink" title="æ—¥å¿—é…ç½®"></a>æ—¥å¿—é…ç½®</h3><p>Â·è¯´æ˜: Feign æä¾›äº†æ—¥å¿—æ‰“å°åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ¥è°ƒæ•´æ—¥å¿—çº§åˆ«ï¼Œä»è€Œå¯¹ Feign æ¥å£çš„<br>è°ƒç”¨æƒ…å†µè¿›è¡Œç›‘æ§å’Œè¾“å‡º<br>Â·æ—¥å¿—çº§åˆ«<br>1.NONEâˆ¶é»˜è®¤çš„ï¼Œä¸æ˜¾ç¤ºä»»ä½•æ—¥å¿—<br>2.BASICâˆ¶ä»…è®°å½•è¯·æ±‚æ–¹æ³•ã€URLã€å“åº”çŠ¶æ€ç åŠæ‰§è¡Œæ—¶é—´<br>3.HEADERSâˆ¶é™¤äº† BASICä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯<br>4.FULLâˆ¶é™¤äº†HEADERSä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„æ­£æ–‡åŠå…ƒæ•°æ®</p><h3 id="OpenFeignè¶…æ—¶"><a href="#OpenFeignè¶…æ—¶" class="headerlink" title="OpenFeignè¶…æ—¶"></a>OpenFeignè¶…æ—¶</h3><p>Â·OpenFeigné»˜è®¤è¶…æ—¶æ—¶é—´1ç§’é’Ÿ,å³ç­‰å¾…è¿”å›ç»“æœ1ç§’<br>Â·åœ¨æŸäº›æƒ…å†µä¸‹,ä¸€äº›æœåŠ¡è°ƒç”¨æ—¶é—´å¯èƒ½è¦è¶…è¿‡1ç§’,å°±éœ€è¦é‡æ–°è®¾ç½®è¶…æ—¶æ—¶é—´</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">ribbon</span><span class="token punctuation">:</span>  <span class="token comment">#è®¾ç½®feignå®¢æˆ·ç«¯è¶…æ—¶äº‹ä»¶(openFeigné»˜è®¤æ”¯æŒribbon)</span>  <span class="token comment">#æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„äº‹ä»¶</span>  <span class="token comment">#æ—¶é—´å•ä½æ˜¯æ¯«ç§’</span>  <span class="token key atrule">ReadTimeout</span><span class="token punctuation">:</span> <span class="token number">8000</span>  <span class="token comment">#æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œ</span>  <span class="token comment">#ä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´</span>  <span class="token key atrule">ConnectTimeout</span><span class="token punctuation">:</span> <span class="token number">8000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="SpringCloud-Gateway"><a href="#SpringCloud-Gateway" class="headerlink" title="SpringCloud Gateway"></a>SpringCloud Gateway</h2><h3 id="çœ‹ä¸€ä¸ªéœ€æ±‚-å¼•å‡ºç½‘å…³æœåŠ¡"><a href="#çœ‹ä¸€ä¸ªéœ€æ±‚-å¼•å‡ºç½‘å…³æœåŠ¡" class="headerlink" title="çœ‹ä¸€ä¸ªéœ€æ±‚,å¼•å‡ºç½‘å…³æœåŠ¡"></a>çœ‹ä¸€ä¸ªéœ€æ±‚,å¼•å‡ºç½‘å…³æœåŠ¡</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1713772717696.jpg"></div></div><p>Â·å…¶å®å°±æ˜¯ä¸€ä¸ªæœåŠ¡ä¸€ä¸ªç«¯å£,ä¸å¥½ç»´æŠ¤</p><h3 id="ä½¿ç”¨ç½‘å…³æœåŠ¡-é‡æ„é¡¹ç›®æ¶æ„"><a href="#ä½¿ç”¨ç½‘å…³æœåŠ¡-é‡æ„é¡¹ç›®æ¶æ„" class="headerlink" title="ä½¿ç”¨ç½‘å…³æœåŠ¡,é‡æ„é¡¹ç›®æ¶æ„"></a>ä½¿ç”¨ç½‘å…³æœåŠ¡,é‡æ„é¡¹ç›®æ¶æ„</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1713772909087.jpg"></div></div><h3 id="Gatewayæ˜¯ä»€ä¹ˆ"><a href="#Gatewayæ˜¯ä»€ä¹ˆ" class="headerlink" title="Gatewayæ˜¯ä»€ä¹ˆ"></a>Gatewayæ˜¯ä»€ä¹ˆ</h3><p>Â·Gatewayæ˜¯åœ¨Springç”Ÿæ€ç³»ç»Ÿä¸Šæ„å»ºçš„APIç½‘å…³æœåŠ¡<br>Â·Gatewayæ—¨åœ¨æä¾›ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹å¼æ¥å¯¹APIè¿›è¡Œè·¯ç”±,ä»¥åŠæä¾›ä¸€äº›å¼ºå¤§<br>çš„è¿‡æ»¤åŠŸèƒ½,å¦‚:ç†”æ–­,é™æµ,é‡è¯•ç­‰</p><h3 id="Gatewayç‰¹æ€§"><a href="#Gatewayç‰¹æ€§" class="headerlink" title="Gatewayç‰¹æ€§"></a>Gatewayç‰¹æ€§</h3><p>Â·åŠ¨æ€è·¯ç”±<br>Â·å¯ä»¥å¯¹è·¯ç”±æŒ‡å®šPredicate(æ–­è¨€)å’ŒFilter(è¿‡æ»¤å™¨)<br>Â·é›†æˆHystrixçš„æ–­è·¯ç”±åŠŸèƒ½<br>Â·é›†æˆSpringCloudæœåŠ¡å‘ç°åŠŸèƒ½<br>Â·è¯·æ±‚é™æµåŠŸèƒ½<br>Â·æ”¯æŒè·¯å¾„é‡å†™</p><h3 id="GatewayåŸºæœ¬åŸç†"><a href="#GatewayåŸºæœ¬åŸç†" class="headerlink" title="GatewayåŸºæœ¬åŸç†"></a>GatewayåŸºæœ¬åŸç†</h3><p>1.web è¯·æ±‚ï¼Œé€šè¿‡ä¸€äº›åŒ¹é…æ¡ä»¶ï¼Œå®šä½åˆ°çœŸæ­£çš„æœåŠ¡èŠ‚ç‚¹/å¾®æœåŠ¡æ¨¡å—ï¼Œåœ¨è¿™ä¸ªè½¬å‘è¿‡ç¨‹çš„å‰åï¼Œè¿›è¡Œä¸€äº›ç²¾ç»†åŒ–æ§åˆ¶ã€‚<br>2.predicate: å°±æ˜¯åŒ¹é…æ¡ä»¶<br>3.filter: å¯ä»¥ç†è§£ä¸ºæ˜¯ç½‘å…³çš„è¿‡æ»¤æœºåˆ¶ã€‚æœ‰äº† predicate å’Œ filterï¼Œå†åŠ ä¸Šç›®æ ‡URLå°±å¯ä»¥å®ç°ä¸€ä¸ªå…·ä½“çš„è·¯ç”±<br>Â·Route(è·¯ç”±)<br>ä¸€å¥è¯: è·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—ï¼Œå®ƒç”± IDï¼Œç›®æ ‡ URIï¼Œä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆå¦‚æœæ–­è¨€ä¸ºtrueåˆ™åŒ¹é…è¯¥è·¯ç”±<br>ç®€å•ä¸¾ä¾‹, æ¯”å¦‚é…ç½®è·¯å¾„, - Path=/member/get/** #æ–­è¨€,è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±è½¬å‘ , å¦‚æœ Http è¯·æ±‚çš„è·¯å¾„ä¸åŒ¹é…, åˆ™ä¸è¿›è¡Œè·¯ç”±è½¬å‘<br>Â·Filter(è¿‡æ»¤)<br>ä¸€å¥è¯: ä½¿ç”¨è¿‡æ»¤å™¨ï¼Œå¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±å‰æˆ–è€…ä¹‹åå¯¹è¯·æ±‚è¿›è¡Œå¤„ç†<br>å¯ä»¥ç†è§£æˆ, åœ¨å¯¹ Http è¯·æ±‚æ–­è¨€åŒ¹é…æˆåŠŸå, å¯ä»¥é€šè¿‡ç½‘å…³çš„è¿‡æ»¤æœºåˆ¶,å¯¹Httpè¯·æ±‚å¤„ç†</p><h3 id="åˆ›å»ºapplication-yml"><a href="#åˆ›å»ºapplication-yml" class="headerlink" title="åˆ›å»ºapplication.yml"></a>åˆ›å»ºapplication.yml</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">20000</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> e<span class="token punctuation">-</span>commerce<span class="token punctuation">-</span>gateway  <span class="token comment">#  cloud:</span>  <span class="token comment">#    gateway:</span>  <span class="token comment">#      routes:</span>  <span class="token comment">#        - id: member_route01 #è·¯ç”±çš„ID,è¦æ±‚å”¯ä¸€</span>  <span class="token comment">#          # gatewayæœ€ç»ˆè®¿é—®çš„url=uri+Path</span>  <span class="token comment">#          uri: http://localhost:10000</span>  <span class="token comment">#          predicates:</span>  <span class="token comment">#            - Path=/member/get/** #æ–­è¨€,è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span>  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">locator</span><span class="token punctuation">:</span>          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment">#å¯ç”¨DiscoveryClientæœåŠ¡å‘ç°</span>      <span class="token key atrule">routes</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> member_routh01          <span class="token comment"># è¯´æ˜:lb æ˜¯åè®®å member-service-provider æ˜¯æœåŠ¡å</span>          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//member<span class="token punctuation">-</span>service<span class="token punctuation">-</span>provider          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>            <span class="token punctuation">-</span> Path=/member/get/<span class="token important">**</span><span class="token key atrule">eureka</span><span class="token punctuation">:</span>  <span class="token key atrule">client</span><span class="token punctuation">:</span>    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka9001.com<span class="token punctuation">:</span>9001/eureka/<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka9002.com<span class="token punctuation">:</span>9002/eureka/  <span class="token key atrule">instance</span><span class="token punctuation">:</span>    <span class="token key atrule">instance-id</span><span class="token punctuation">:</span> $<span class="token punctuation">&#123;</span>spring.cloud.client.ip<span class="token punctuation">-</span>address<span class="token punctuation">&#125;</span><span class="token punctuation">:</span>$<span class="token punctuation">&#123;</span>spring.application.name<span class="token punctuation">&#125;</span><span class="token punctuation">:</span>$<span class="token punctuation">&#123;</span>server.port<span class="token punctuation">&#125;</span>    <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ç¬¬äºŒç§æ–¹å¼-ç¼–å†™é…ç½®ç±»æ³¨å…¥"><a href="#ç¬¬äºŒç§æ–¹å¼-ç¼–å†™é…ç½®ç±»æ³¨å…¥" class="headerlink" title="ç¬¬äºŒç§æ–¹å¼:ç¼–å†™é…ç½®ç±»æ³¨å…¥"></a>ç¬¬äºŒç§æ–¹å¼:ç¼–å†™é…ç½®ç±»æ³¨å…¥</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GateWayRoutesConfig</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">myRouterLocator01</span><span class="token punctuation">(</span><span class="token class-name">RouteLocatorBuilder</span> routeLocatorBuilder<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">/*        å‚è€ƒ:application.ymlæ”¹å†™,ç†è§£å®¹æ˜“        gateway:          routes: #é…ç½®è·¯ç”±, å¯ä»¥æœ‰å¤šä¸ªè·¯ç”±é…ç½®           - id: member_routh01 #è·¯ç”±çš„ IDï¼Œç¨‹åºå‘˜è‡ªå·±å†™,è¦æ±‚å”¯ä¸€            #gateway æœ€ç»ˆè®¿é—®çš„ url = uri+Path å³: http://localhost:10000/memeber/get/             uri: http://localhost:10000 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€             predicates: - Path=/member/get/** #æ–­è¨€,è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±           - id: member_routh02 #å¦å¤–ä¸€ç»„è·¯ç”±             uri: http://localhost:10000             predicates: - Path=/member/save         */</span>        <span class="token class-name">RouteLocatorBuilder<span class="token punctuation">.</span>Builder</span> routes <span class="token operator">=</span> routeLocatorBuilder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> routes<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">"member_routh03"</span><span class="token punctuation">,</span>r<span class="token operator">-></span>r<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/member/get/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">"http://localhost:10000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åŠ¨æ€è·¯ç”±"><a href="#åŠ¨æ€è·¯ç”±" class="headerlink" title="åŠ¨æ€è·¯ç”±"></a>åŠ¨æ€è·¯ç”±</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">cloud</span><span class="token punctuation">:</span><span class="token key atrule">gateway</span><span class="token punctuation">:</span><span class="token key atrule">discovery</span><span class="token punctuation">:</span><span class="token key atrule">locator</span><span class="token punctuation">:</span><span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#å¼€å¯ Flag that enables DiscoveryClient gateway integration,å³å¯ç”¨iscoveryClient æœåŠ¡å‘ç°</span><span class="token key atrule">routes</span><span class="token punctuation">:</span> <span class="token comment">#é…ç½®è·¯ç”±, å¯ä»¥æœ‰å¤šä¸ªè·¯ç”±é…ç½®</span>  <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> member_routh01 <span class="token comment">#è·¯ç”±çš„ IDï¼Œç¨‹åºå‘˜è‡ªå·±å†™,è¦æ±‚å”¯ä¸€</span><span class="token comment">#gateway æœ€ç»ˆè®¿é—®çš„ url = uri+Path å³: http://localhost:10000/memeber/get/</span><span class="token comment">#uri: http://localhost:10000 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span><span class="token comment">#è¯´æ˜: lb æ˜¯åè®®å member-service-provider æ˜¯æœåŠ¡å</span><span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//member<span class="token punctuation">-</span>service<span class="token punctuation">-</span>provider<span class="token key atrule">predicates</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> Path=/member/get/<span class="token important">**</span> <span class="token comment">#æ–­è¨€,è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚<br>1.é…ç½®å¥½åŠ¨æ€è·¯ç”±åGatewayä¼šæ ¹æ®æ³¨å†Œä¸­å¿ƒä¸Šå¾®æœåŠ¡å,ä¸ºè¯·æ±‚åˆ›å»ºåŠ¨æ€è·¯ç”±,å®ç°åŠ¨ä»–è·¯ç”±åŠŸèƒ½<br>2.ä½¿ç”¨lbåè®®æ”¯æŒè´Ÿè½½å‡è¡¡-è½®è¯¢ç®—æ³•<br>3.ä¹Ÿå¯ä»¥é…ç½®è‡ªå·±çš„è´Ÿè½½å‡è¡¡ç®—æ³•</p><h3 id="Predicate-æ–­è¨€"><a href="#Predicate-æ–­è¨€" class="headerlink" title="Predicate/æ–­è¨€"></a>Predicate/æ–­è¨€</h3><p>Â·Spring Cloud GatewayåŒ…æ‹¬è®¸å¤šå†…ç½®çš„Route Predicateå·¥å‚,æ‰€æœ‰è¿™äº›Predicateéƒ½ä¸HTTP<br>è¯·æ±‚çš„ä¸åŒå±æ€§åŒ¹é…,å¯ä»¥ç»„åˆä½¿ç”¨<br>Â·å®ä¾‹</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">predicates</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> Path=/member/get/<span class="token important">**</span>  <span class="token comment">#æ–­è¨€,è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span>  <span class="token punctuation">-</span> After=2023<span class="token punctuation">-</span>11<span class="token punctuation">-</span>22T10<span class="token punctuation">:</span>20<span class="token punctuation">:</span>50.387+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>  <span class="token punctuation">-</span> Before=2023<span class="token punctuation">-</span>11<span class="token punctuation">-</span>23T10<span class="token punctuation">:</span>20<span class="token punctuation">:</span>50.387+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>  <span class="token punctuation">-</span> Between=2012<span class="token punctuation">-</span>06<span class="token punctuation">-</span>14T13<span class="token punctuation">:</span>11<span class="token punctuation">:</span>33.899001600+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span><span class="token punctuation">,</span>2024<span class="token punctuation">-</span>06<span class="token punctuation">-</span>14T13<span class="token punctuation">:</span>11<span class="token punctuation">:</span>33.899001600+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>  <span class="token punctuation">-</span> Cookie=user<span class="token punctuation">,</span>qgq  <span class="token punctuation">-</span> Header=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Id<span class="token punctuation">,</span>hello  <span class="token punctuation">-</span> Host=<span class="token important">**.qgq.**</span>  <span class="token punctuation">-</span> Method=GET  <span class="token punctuation">-</span> Query=email<span class="token punctuation">,</span><span class="token punctuation">[</span>\w<span class="token punctuation">-</span><span class="token punctuation">]</span>+@(<span class="token punctuation">[</span>a<span class="token punctuation">-</span>zA<span class="token punctuation">-</span>Z<span class="token punctuation">]</span>+\.)+<span class="token punctuation">[</span>a<span class="token punctuation">-</span>zA<span class="token punctuation">-</span>Z<span class="token punctuation">]</span>+  <span class="token punctuation">-</span> RemoteAddr=127.0.0.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Filter-è¿‡æ»¤å™¨"><a href="#Filter-è¿‡æ»¤å™¨" class="headerlink" title="Filter/è¿‡æ»¤å™¨"></a>Filter/è¿‡æ»¤å™¨</h3><h3 id="åŸºæœ¬ä»‹ç»-1"><a href="#åŸºæœ¬ä»‹ç»-1" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>Â·è·¯ç”±è¿‡æ»¤å™¨å¯ç”¨äºä¿®æ”¹è¿›å…¥çš„HTTPè¯·æ±‚å’Œè¿”å›çš„HTTPå“åº”<br>Â·Spring Cloud Gateway å†…ç½®äº†å¤šç§è·¯ç”±è¿‡æ»¤å™¨ï¼Œä»–ä»¬éƒ½ç”±GatewayFilterçš„å·¥å‚ç±»æ¥äº§ç”Ÿ</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">filters</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> AddRequestParameter=color<span class="token punctuation">,</span> blue <span class="token comment">#è¿‡æ»¤å™¨å·¥å‚ä¼šåœ¨åŒ¹é…çš„è¯·æ±‚å¤´åŠ ä¸Šä¸€å¯¹è¯·æ±‚å¤´ï¼Œåç§°ä¸º color å€¼ä¸º blue</span>  <span class="token punctuation">-</span> AddRequestParameter=age<span class="token punctuation">,</span> <span class="token number">18</span> <span class="token comment">#è¿‡æ»¤å™¨å·¥å‚ä¼šåœ¨åŒ¹é…çš„è¯·æ±‚å¤´åŠ ä¸Šä¸€å¯¹è¯·æ±‚å¤´ï¼Œåç§°ä¸ºageå€¼ä¸º18+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="è‡ªå®šä¹‰GlobalFilter"><a href="#è‡ªå®šä¹‰GlobalFilter" class="headerlink" title="è‡ªå®šä¹‰GlobalFilter"></a>è‡ªå®šä¹‰GlobalFilter</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomGateWayFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GlobalFilter</span><span class="token punctuation">,</span> <span class="token class-name">Ordered</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">></span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span>            éŸ©é¡ºå¹³ <span class="token class-name">Java</span> å·¥ç¨‹å¸ˆ                                     chain<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"==========CustomGateWayFilter=========== "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> uname <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> pwd <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">"pwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"hspedu"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>uname<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"123456"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>pwd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=========éæ³•ç”¨æˆ·============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">NOT_ACCEPTABLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å›åº”</span>            <span class="token keyword">return</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token comment">//éªŒè¯é€šè¿‡ï¼Œæ”¾è¡Œ</span>        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * order è¡¨ç¤ºè¯¥è¿‡æ»¤å™¨æ‰§è¡Œçš„é¡ºåºï¼Œæ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜. * @return     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="SpringCloud-Sleuth-Zipkin"><a href="#SpringCloud-Sleuth-Zipkin" class="headerlink" title="SpringCloud Sleuth+Zipkin"></a>SpringCloud Sleuth+Zipkin</h2><h3 id="Sleuth-Zipkin"><a href="#Sleuth-Zipkin" class="headerlink" title="Sleuth/Zipkin"></a>Sleuth/Zipkin</h3><p>Â·åœ¨å¾®æœåŠ¡æ¡†æ¶ä¸­ï¼Œä¸€ä¸ªç”±å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚åœ¨åç«¯ç³»ç»Ÿä¸­ä¼šç»è¿‡å¤šä¸ªä¸åŒçš„çš„æœåŠ¡èŠ‚<br>ç‚¹è°ƒç”¨, æ¥ååŒäº§ç”Ÿæœ€åçš„è¯·æ±‚ç»“æœï¼Œæ¯ä¸€ä¸ªè¯·æ±‚éƒ½ä¼šå½¢æˆä¸€æ¡å¤æ‚çš„åˆ†å¸ƒå¼æœåŠ¡è°ƒç”¨é“¾è·¯<br>Â·åœ¨å¾®æœåŠ¡æ¡†æ¶ä¸­ï¼Œä¸€ä¸ªç”±å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚åœ¨åç«¯ç³»ç»Ÿä¸­ä¼šç»è¿‡å¤šä¸ªä¸åŒçš„çš„æœåŠ¡èŠ‚<br>ç‚¹è°ƒç”¨, æ¥ååŒäº§ç”Ÿæœ€åçš„è¯·æ±‚ç»“æœï¼Œæ¯ä¸€ä¸ªè¯·æ±‚éƒ½ä¼šå½¢æˆä¸€æ¡å¤æ‚çš„åˆ†å¸ƒå¼æœåŠ¡è°ƒç”¨é“¾è·¯<br>Â·ä¸€å¥è¯:Sleuthæä¾›äº†ä¸€å¥—å®Œæ•´çš„æœåŠ¡è¿½è¸ªè§£å†³æ–¹æ¡ˆ å¹¶å…¼å®¹Zipkin<br>Â·Sleuthåšé“¾è·¯è¿½è¸ª,Zipkinåšæ•°æ®æœé›†/å­˜å‚¨/å¯è§†åŒ–</p><h3 id="Sleuth-Zipkinæ­å»ºé“¾è·¯ç›‘æ§å®ä¾‹"><a href="#Sleuth-Zipkinæ­å»ºé“¾è·¯ç›‘æ§å®ä¾‹" class="headerlink" title="Sleuth/Zipkinæ­å»ºé“¾è·¯ç›‘æ§å®ä¾‹"></a>Sleuth/Zipkinæ­å»ºé“¾è·¯ç›‘æ§å®ä¾‹</h3><p>Â·å®‰è£…ä½¿ç”¨Zipkin<br>Â·ä¿®æ”¹pom.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-zipkin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·ä¿®æ”¹application.ymlæ–‡ä»¶</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">zipkin</span><span class="token punctuation">:</span><span class="token key atrule">base-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">9411</span><span class="token key atrule">sleuth</span><span class="token punctuation">:</span><span class="token key atrule">sampler</span><span class="token punctuation">:</span><span class="token comment">#é‡‡æ ·ç‡åœ¨ 0-1 ä¹‹é—´ï¼Œ1 è¡¨ç¤ºå…¨éƒ¨é‡‡é›†</span><span class="token key atrule">probability</span><span class="token punctuation">:</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h2><h3 id="NacosåŸºç¡€"><a href="#NacosåŸºç¡€" class="headerlink" title="NacosåŸºç¡€"></a>NacosåŸºç¡€</h3><p>Â·ä¸€å¥è¯:Nacoså°±æ˜¯æ³¨å†Œä¸­å¿ƒã€ä»£æ›¿Eurekaã€‘+é…ç½®ä¸­å¿ƒã€æ›¿ä»£Configã€‘</p><h3 id="nacosä½¿ç”¨"><a href="#nacosä½¿ç”¨" class="headerlink" title="nacosä½¿ç”¨"></a>nacosä½¿ç”¨</h3><p>Â·ä¸‹è½½nacos<br>Â·é…ç½®ymlæ–‡ä»¶</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">cloud</span><span class="token punctuation">:</span>  <span class="token key atrule">nacos</span><span class="token punctuation">:</span>    <span class="token key atrule">discovery</span><span class="token punctuation">:</span>      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>    <span class="token key atrule">config</span><span class="token punctuation">:</span>      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>      <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#æŒ‡å®šyamlæ ¼å¼</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·å¼•å…¥pom.xmlæ–‡ä»¶</p><h3 id="nacosçš„é…ç½®"><a href="#nacosçš„é…ç½®" class="headerlink" title="nacosçš„é…ç½®"></a>nacosçš„é…ç½®</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span><span class="token key atrule">application</span><span class="token punctuation">:</span><span class="token comment">#è¿™é‡Œçš„ name éœ€è¦å‚è€ƒ nacos é…ç½®ä¸­å¿ƒçš„ Data Id</span><span class="token key atrule">name</span><span class="token punctuation">:</span> e<span class="token punctuation">-</span>commerce<span class="token punctuation">-</span>nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>client<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RefreshScope</span> <span class="token comment">//@RefreshScopeæ˜¯springcloudçš„åŸç”Ÿæ³¨è§£,å®ç°é…ç½®ä¿¡æ¯è‡ªåŠ¨åˆ·æ–°</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosConfigClientController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;config.ip&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> configIp<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;config.name&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> configName<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/nacos/config/ip"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getConfigIp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> configIp<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/nacos/config/name"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getConfigName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> configName<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚-1"><a href="#æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚-1" class="headerlink" title="æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><p>Â·æ³¨æ„åœ¨ Nacos Server çš„é…ç½®æ–‡ä»¶çš„åç¼€æ˜¯ .yaml , è€Œä¸æ˜¯ .yml<br>Â·åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶ï¼Œè¦ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒè¿›è¡Œé…ç½®æ‹‰å–ï¼Œæ‹‰å–é…ç½®ä¹‹åï¼Œæ‰èƒ½ä¿è¯é¡¹ç›®çš„æ­£å¸¸å¯åŠ¨, ä¹Ÿå°±æ˜¯è¯´å¦‚æœé¡¹ç›®ä¸èƒ½æ­£ç¡®çš„è·å–åˆ°<br>Nacos Server çš„é…ç½®æ•°æ®ï¼Œé¡¹ç›®æ˜¯å¯åŠ¨ä¸äº†çš„<br>Â·springboot ä¸­é…ç½®æ–‡ä»¶çš„åŠ è½½æ˜¯å­˜åœ¨ä¼˜å…ˆçº§é¡ºåºçš„ï¼Œbootstrap.yml ä¼˜å…ˆçº§é«˜äºapplication.yml<br>Â·@RefreshScope æ˜¯ springcloud åŸç”Ÿæ³¨è§£ï¼Œå®ç°é…ç½®ä¿¡æ¯è‡ªåŠ¨åˆ·æ–°, å¦‚æœåœ¨ Nacos Server ä¿®æ”¹äº†é…ç½®æ•°æ®ï¼ŒClient ç«¯å°±ä¼šå¾—åˆ°æœ€æ–°é…ç½®</p><h3 id="nacosé…ç½®éš”ç¦»"><a href="#nacosé…ç½®éš”ç¦»" class="headerlink" title="nacosé…ç½®éš”ç¦»"></a>nacosé…ç½®éš”ç¦»</h3><p>Â·é€šè¿‡Dataæ–¹æ¡ˆ</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span><span class="token key atrule">profiles</span><span class="token punctuation">:</span><span class="token comment">#active: dev #æŒ‡å®šç¯å¢ƒ dev/test/... </span><span class="token key atrule">active</span><span class="token punctuation">:</span> test <span class="token comment">#æŒ‡å®šç¯å¢ƒæ˜¯ test</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Â·Groupæ–¹æ¡ˆ</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token comment">#è¿™é‡Œçš„nameéœ€è¦å‚è€ƒnacosé…ç½®ä¸­å¿ƒçš„Data Id</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> e<span class="token punctuation">-</span>commerce<span class="token punctuation">-</span>nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>client  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>      <span class="token key atrule">config</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#æŒ‡å®šyamlæ ¼å¼</span>        <span class="token key atrule">group</span><span class="token punctuation">:</span> older<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·Namespace</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token comment">#è¿™é‡Œçš„nameéœ€è¦å‚è€ƒnacosé…ç½®ä¸­å¿ƒçš„Data Id</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> e<span class="token punctuation">-</span>commerce<span class="token punctuation">-</span>nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>client  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>      <span class="token key atrule">config</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#æŒ‡å®šyamlæ ¼å¼</span>        <span class="token key atrule">group</span><span class="token punctuation">:</span> seckill        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> e0e2bcf7<span class="token punctuation">-</span>d15c<span class="token punctuation">-</span>46ca<span class="token punctuation">-</span>a910<span class="token punctuation">-</span>4784dc1573de<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Namespace-Group-DataIdå…³ç³»"><a href="#Namespace-Group-DataIdå…³ç³»" class="headerlink" title="Namespace/Group/DataIdå…³ç³»"></a>Namespace/Group/DataIdå…³ç³»</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/a9545e1f67ae36fffedfd75ed463ab46.png"></div></div><p>Â·Nacosé»˜è®¤çš„å‘½åç©ºé—´æ˜¯publicï¼ŒNamespaceä¸»è¦ç”¨æ¥å®ç°é…ç½®éš”ç¦», éš”ç¦»èŒƒå›´å¤§<br>Â·Groupé»˜è®¤æ˜¯DEFAULT GROUPï¼ŒGroupå¯ä»¥æŠŠä¸åŒçš„å¾®æœåŠ¡åˆ’åˆ†åˆ°åŒä¸€ä¸ªåˆ†ç»„é‡Œé¢å»</p><h2 id="SpringCloud-Alibaba-Sentinel"><a href="#SpringCloud-Alibaba-Sentinel" class="headerlink" title="SpringCloud Alibaba Sentinel"></a>SpringCloud Alibaba Sentinel</h2><h3 id="SentinelåŸºç¡€"><a href="#SentinelåŸºç¡€" class="headerlink" title="SentinelåŸºç¡€"></a>SentinelåŸºç¡€</h3><p>Â·éšç€å¾®æœåŠ¡çš„æµè¡Œ,æœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦,Sentinelä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹,ä»æµé‡æ§åˆ¶,ç†”æ–­é™çº§,ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦<br>ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§</p><h3 id="Sentinelçš„ä¸»è¦ç‰¹æ€§"><a href="#Sentinelçš„ä¸»è¦ç‰¹æ€§" class="headerlink" title="Sentinelçš„ä¸»è¦ç‰¹æ€§"></a>Sentinelçš„ä¸»è¦ç‰¹æ€§</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/68e3cd42617a4895e29b68df37488d50.png"></div></div><p>Â·ä¸€å¥è¯:Sentinel:åˆ†å¸ƒå¼ç³»ç»Ÿçš„æµé‡é˜²å«å…µ,ä¿æŠ¤å¾®æœåŠ¡</p><h3 id="Sentinel-æ ¸å¿ƒåŠŸèƒ½"><a href="#Sentinel-æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="Sentinel æ ¸å¿ƒåŠŸèƒ½"></a>Sentinel æ ¸å¿ƒåŠŸèƒ½</h3><p>Â·æµé‡æ§åˆ¶<br>Â·ç†”æ–­é™çº§<br>1.åœ¨è°ƒç”¨ç³»ç»Ÿçš„æ—¶å€™,å¦‚æœè°ƒç”¨é“¾è·¯ä¸­çš„æŸä¸ªèµ„æºå‡ºç°äº†ä¸ç¨³å®š,æœ€ç»ˆä¼šå¯¼è‡´è¯·æ±‚å‘ç”Ÿå †ç§¯<br>2.ç†”æ–­é™çº§å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‰€è°“çš„ç†”æ–­é™çº§å°±æ˜¯å½“æ£€æµ‹åˆ°è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç°ä¸<br>ç¨³å®šçš„è¡¨ç°ï¼Œä¾‹å¦‚è¯·æ±‚å“åº”æ—¶é—´é•¿æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜çš„æ—¶å€™ï¼Œåˆ™å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œé™<br>åˆ¶ï¼Œè®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“åˆ°å…¶å®ƒçš„èµ„æºè€Œå¯¼è‡´çº§è”æ•…éšœ<br>Â·ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤<br>1.æ ¹æ®ç³»ç»Ÿèƒ½å¤Ÿå¤„ç†çš„è¯·æ±‚ï¼Œå’Œå…è®¸è¿›æ¥çš„è¯·æ±‚ï¼Œæ¥åšå¹³è¡¡ï¼Œè¿½æ±‚çš„ç›®æ ‡æ˜¯åœ¨ç³»ç»Ÿä¸è¢«<br>æ‹–å®çš„æƒ…å†µä¸‹, æé«˜ç³»ç»Ÿçš„ååç‡<br>Â·æ¶ˆæ¯å‰Šå³°å¡«è°·<br>1.æŸç¬æ—¶æ¥äº†å¤§æµé‡çš„è¯·æ±‚, è€Œå¦‚æœæ­¤æ—¶è¦å¤„ç†æ‰€æœ‰è¯·æ±‚ï¼Œå¾ˆå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿè´Ÿè½½è¿‡é«˜ï¼Œ<br>å½±å“ç¨³å®šæ€§ã€‚ä½†å…¶å®å¯èƒ½åé¢å‡ ç§’ä¹‹å†…éƒ½æ²¡æœ‰æ¶ˆæ¯æŠ•é€’ï¼Œè‹¥ç›´æ¥æŠŠå¤šä½™çš„æ¶ˆæ¯ä¸¢æ‰åˆ™æ²¡<br>æœ‰å……åˆ†åˆ©ç”¨ç³»ç»Ÿå¤„ç†æ¶ˆæ¯çš„èƒ½åŠ›</p><h3 id="Sentinelä¸¤ä¸ªç»„æˆéƒ¨åˆ†"><a href="#Sentinelä¸¤ä¸ªç»„æˆéƒ¨åˆ†" class="headerlink" title="Sentinelä¸¤ä¸ªç»„æˆéƒ¨åˆ†"></a>Sentinelä¸¤ä¸ªç»„æˆéƒ¨åˆ†</h3><p>Â·æ ¸å¿ƒåº“:ï¼šï¼ˆJava å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶/åº“ï¼Œèƒ½å¤Ÿè¿è¡Œåœ¨æ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼Œ å¯¹ Spring Cloud æœ‰è¾ƒå¥½çš„æ”¯æŒ<br>Â·æ§åˆ¶å°ï¼šï¼ˆDashboardï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œ ä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨</p><h3 id="Sentinelä½¿ç”¨"><a href="#Sentinelä½¿ç”¨" class="headerlink" title="Sentinelä½¿ç”¨"></a>Sentinelä½¿ç”¨</h3><p>Â·ä¸‹è½½Sentinel<br>Â·å¼•å…¥pom.xml<br>Â·é…ç½®application.ymlæ–‡ä»¶</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">sentinel</span><span class="token punctuation">:</span>  <span class="token key atrule">transport</span><span class="token punctuation">:</span>    <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span> <span class="token comment">#è¿™ä¸ªå¸ˆsentinelæ§åˆ¶å°çš„åœ°å€</span>    <span class="token comment">#1.spring.cloud.sentinel.transport.port ç«¯å£é…ç½®ä¼šåœ¨è¢«ç›‘æ§çš„å¾®æœåŠ¡</span>    <span class="token comment">#  å¯¹åº”çš„æœºå™¨ä¸Šå¯åŠ¨ä¸€ä¸ªHttp Server</span>    <span class="token comment">#2.è¯¥ Server ä¼šä¸ Sentinel æ§åˆ¶å°åšäº¤äº’</span>    <span class="token comment">#3.æ¯”å¦‚ Sentinel æ§åˆ¶å°æ·»åŠ äº† 1 ä¸ªé™æµè§„åˆ™ï¼Œä¼šæŠŠè§„åˆ™æ•°æ® push ç»™</span>    <span class="token comment"># Http Server æ¥æ”¶ï¼ŒHttp Server å†å°†è§„åˆ™æ³¨å†Œåˆ° Sentinel ä¸­</span>    <span class="token comment"># ç®€å•çš„è¯´æ˜: spring.cloud.sentinel.transport.portï¼šæŒ‡å®šè¢«ç›‘æ§çš„å¾®æœåŠ¡åº”ç”¨ä¸</span>    <span class="token comment"># Sentinelæ§åˆ¶å°äº¤äº’çš„ç«¯å£ï¼Œå¾®æœåŠ¡åº”ç”¨æœ¬åœ°ä¼šèµ·ä¸€ä¸ªè¯¥ç«¯å£å ç”¨çš„ Http Server</span>    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8719</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>Â·QPS: Queries Per Second(æ¯ç§’æŸ¥è¯¢ç‡)ï¼Œæ˜¯æœåŠ¡å™¨æ¯ç§’å“åº”çš„æŸ¥è¯¢æ¬¡æ•°<br>Â·Sentinel é‡‡ç”¨çš„æ˜¯æ‡’åŠ è½½ï¼Œ åªæœ‰è°ƒç”¨äº†æŸä¸ªæ¥å£/æœåŠ¡ï¼Œæ‰èƒ½çœ‹åˆ°ç›‘æ§æ•°æ®</p><h3 id="Sentinel-æµé‡æ§åˆ¶"><a href="#Sentinel-æµé‡æ§åˆ¶" class="headerlink" title="Sentinel æµé‡æ§åˆ¶"></a>Sentinel æµé‡æ§åˆ¶</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/e1f874577d8f95d8e330f3ce6016cd5a.png"></div></div><p>Â·å¯¹ä¸Šå›¾è§£æ<br>1.èµ„æºå:å”¯ä¸€åç§°,é»˜è®¤è¯·æ±‚è·¯å¾„<br>2.é’ˆå¯¹æ¥æº:Sentinelå¯ä»¥é’ˆå¯¹è°ƒç”¨è€…è¿›è¡Œé™æµ,å¡«å†™å¾®æœåŠ¡å,é»˜è®¤default,ä¸åŒºåˆ†æ¥æº<br>3.é˜ˆå€¼ç±»å‹/å•æœºé˜ˆå€¼:<br>QPS(æ¯ç§’é’Ÿçš„è¯·æ±‚æ•°é‡):å½“è°ƒç”¨è¯¥apiçš„QPSè¾¾åˆ°é˜ˆå€¼,è¿›è¡Œé™æµ<br>çº¿ç¨‹æ•°:âˆ¶å½“è°ƒç”¨è¯¥ api çš„çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™,è¿›è¡Œé™æµ</p><h4 id="QPSå’Œçº¿ç¨‹æ•°çš„åŒºåˆ«-æ¯”å¦‚QPSå’Œçº¿ç¨‹æˆ‘ä»¬éƒ½è®¾ç½®é˜ˆå€¼ä¸º1"><a href="#QPSå’Œçº¿ç¨‹æ•°çš„åŒºåˆ«-æ¯”å¦‚QPSå’Œçº¿ç¨‹æˆ‘ä»¬éƒ½è®¾ç½®é˜ˆå€¼ä¸º1" class="headerlink" title="QPSå’Œçº¿ç¨‹æ•°çš„åŒºåˆ«:æ¯”å¦‚QPSå’Œçº¿ç¨‹æˆ‘ä»¬éƒ½è®¾ç½®é˜ˆå€¼ä¸º1"></a>QPSå’Œçº¿ç¨‹æ•°çš„åŒºåˆ«:æ¯”å¦‚QPSå’Œçº¿ç¨‹æˆ‘ä»¬éƒ½è®¾ç½®é˜ˆå€¼ä¸º1</h4><p>Â·å¯¹äºQPSè€Œè¨€,å¦‚æœä¸€ç§’å†…,å®¢æˆ·ç«¯å‘å‡ºäº†2æ¬¡è¯·æ±‚,å°±è¾¾åˆ°é˜ˆå€¼,ä»è€Œé™æµ<br>Â·å¯¹äºçº¿ç¨‹æ•°è€Œè¨€,å¦‚æœåœ¨ä¸€ç§’å†…,å®¢æˆ·ç«¯å‘å‡ºæ¥2æ¬¡è¯·æ±‚,ä¸ä¸€å®šè¾¾åˆ°çº¿ç¨‹é™åˆ¶çš„é˜ˆå€¼<br>å‡è®¾æˆ‘ä»¬ 1 æ¬¡è¯·æ±‚åå°ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹, ä½†æ˜¯è¿™ä¸ªè¯·æ±‚å®Œæˆæ—¶é—´æ˜¯ 0.1 ç§’(å¯ä»¥<br>è§†ä¸ºè¯¥è¯·æ±‚å¯¹åº”çš„çº¿ç¨‹å­˜æ´» 0.1 ç§’), æ‰€ä»¥å½“å®¢æˆ·ç«¯ç¬¬ 2 æ¬¡è¯·æ±‚æ—¶(æ¯”å¦‚å®¢æˆ·ç«¯æ˜¯åœ¨ 0.3 ç§’å‘<br>å‡ºçš„), è¿™æ—¶ç¬¬ 1 ä¸ªè¯·æ±‚çš„çº¿ç¨‹å°±å·²ç»ç»“æŸäº†, å› æ­¤å°±æ²¡æœ‰è¾¾åˆ°çº¿ç¨‹çš„é˜ˆå€¼, ä¹Ÿä¸ä¼šé™æµ<br>Â·å¦‚æœä¸€ä¸ªè¯·æ±‚å¯¹åº”çš„çº¿ç¨‹å¹³å‡æ‰§è¡Œæ—¶é—´ä¸º0.1,é‚£ä¹ˆ,å°±ç›¸å½“äºQPSä¸º10<br>4.æ˜¯å¦é›†ç¾¤:ä¸éœ€è¦é›†ç¾¤<br>5.æµæ§æ¨¡å¼<br>ç›´æ¥:api è¾¾åˆ°é™æµæ¡ä»¶æ—¶ï¼Œç›´æ¥é™æµ<br>å…³è”:å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±<br>é“¾è·¯:å½“ä»æŸä¸ªæ¥å£è¿‡æ¥çš„èµ„æºè¾¾åˆ°é™æµæ¡ä»¶æ—¶ï¼Œå¼€å¯é™æµ<br>6.æµæ§æ•ˆæœ<br>å¿«é€Ÿå¤±è´¥:ç›´æ¥å¤±è´¥,æŠ›å¼‚å¸¸<br>Warm up:æ ¹æ®codeFactor(å†·åŠ è½½å› å­,é»˜è®¤3)çš„å€¼,ä»é˜ˆå€¼/codeFactor,ç»è¿‡é¢„çƒ­æ—¶é•¿,æ‰è¾¾åˆ°è®¾ç½®çš„QPSé˜ˆå€¼<br>æ’é˜Ÿç­‰å¾…:åŒ€é€Ÿæ’é˜Ÿï¼Œè®©è¯·æ±‚ä»¥åŒ€é€Ÿçš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼ç±»å‹å¿…é¡»è®¾ç½®ä¸º QPSï¼Œå¦åˆ™æ— æ•ˆ</p><h3 id="æµé‡æ§åˆ¶å®ä¾‹"><a href="#æµé‡æ§åˆ¶å®ä¾‹" class="headerlink" title="æµé‡æ§åˆ¶å®ä¾‹"></a>æµé‡æ§åˆ¶å®ä¾‹</h3><p>Â·åœ¨Sentinelé…ç½®æµé‡è§„åˆ™æ—¶,å¦‚ä½•é…ç½®é€šé…ç¬¦é—®é¢˜,æ¯”å¦‚/member/get/1,/member/get/2ç»Ÿä¸€ä½¿ç”¨ä¸€ä¸ªè§„åˆ™<br>1.æ–¹æ¡ˆ1:åœ¨sentinelä¸­ /member/get?id=1 å’Œ /member/get?id=2 è¢«ç»Ÿä¸€è®¤ä¸ºæ˜¯/member/get æ‰€ä»¥åªè¦å¯¹/member/get é™æµå°±OK<br>2.æ–¹æ¡ˆ2:URLèµ„æºæ¸…æ´—<br>Â·å¯ä»¥é€šè¿‡UrlCleaneræ¥å£æ¥å®ç°èµ„æºæ¸…æ´—,ä¹Ÿå°±æ˜¯å¯¹äº/member/get/{id}è¿™ä¸ªURL,æˆ‘ä»¬å¯ä»¥ç»Ÿä¸€å½’é›†åˆ°/member/get/*èµ„æºä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomUrlCleaner</span> <span class="token keyword">implements</span> <span class="token class-name">UrlCleaner</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">clean</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>           <span class="token keyword">return</span> s<span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"/member/get"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>           <span class="token keyword">return</span> <span class="token string">"/member/get/*"</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>       <span class="token keyword">return</span> s<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·å¦‚æœsentinelæµæ§è§„åˆ™æ²¡æœ‰æŒä¹…åŒ–,å½“æˆ‘ä»¬é‡å¯è°ƒç”¨APIæ‰€åœ¨å¾®æœåŠ¡æ¨¡å—å,è§„åˆ™ä¼šä¸¢å¤±,éœ€è¦é‡æ–°åŠ å…¥</p><h4 id="æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚-2"><a href="#æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚-2" class="headerlink" title="æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><p>é˜ˆå€¼ç±»å‹ QPS å’Œ çº¿ç¨‹æ•°çš„åŒºåˆ«è®¨è®º<br>Â·å¦‚æœä¸€ä¸ªçº¿ç¨‹å¹³å‡æ‰§è¡Œæ—¶é—´ä¸º0.05ç§’ï¼Œå°±è¯´æ˜åœ¨1ç§’é’Ÿï¼Œå¯ä»¥æ‰§è¡Œ20æ¬¡(ç›¸å½“äº QPSä¸º<br>Â·å¦‚æœä¸€ä¸ªçº¿ç¨‹å¹³å‡æ‰§è¡Œæ—¶é—´ä¸º1ç§’, è¯´æ˜1ç§’é’Ÿï¼Œå¯ä»¥æ‰§è¡Œ1æ¬¡æ•°(ç›¸å½“äº QPSä¸º1)<br>Â·å¦‚æœä¸€ä¸ªçº¿ç¨‹å¹³å‡æ‰§è¡Œæ—¶é—´ä¸º2ç§’, è¯´æ˜2ç§’é’Ÿå†…ï¼Œæ‰èƒ½æ‰§è¡Œ1æ¬¡</p><h3 id="æµé‡æ§åˆ¶å®ä¾‹-å…³è”"><a href="#æµé‡æ§åˆ¶å®ä¾‹-å…³è”" class="headerlink" title="æµé‡æ§åˆ¶å®ä¾‹-å…³è”"></a>æµé‡æ§åˆ¶å®ä¾‹-å…³è”</h3><p>Â·å…³è”çš„å«ä¹‰:å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶,å°±é™æµè‡ªå·±<br>Â·å½“è°ƒç”¨ member-service-nacos-provider-10004 çš„ /t2 API æ¥å£æ—¶ï¼Œå¦‚æœ QPS è¶…è¿‡ 1ï¼Œè¿™æ—¶è°ƒç”¨ /t1 API æ¥å£ ç›´æ¥æ¥å¤±è´¥ï¼ŒæŠ›å¼‚å¸¸.<br>æ¢³ç† /t2 æ˜¯å…³è”çš„èµ„æº , é™æµçš„èµ„æºæ˜¯/t1</p><h3 id="æµé‡æ§åˆ¶å®ä¾‹-Warm-up"><a href="#æµé‡æ§åˆ¶å®ä¾‹-Warm-up" class="headerlink" title="æµé‡æ§åˆ¶å®ä¾‹-Warm up"></a>æµé‡æ§åˆ¶å®ä¾‹-Warm up</h3><p>1.æ¦‚è¿°<br>Â·å½“æµé‡çªç„¶å¢å¤§çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šå¸Œæœ›ç³»ç»Ÿä»ç©ºé—²çŠ¶æ€åˆ°ç¹å¿™çŠ¶æ€çš„åˆ‡æ¢çš„æ—¶é—´é•¿<br>ä¸€äº›ã€‚å³å¦‚æœç³»ç»Ÿåœ¨æ­¤ä¹‹å‰é•¿æœŸå¤„äºç©ºé—²çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å¸Œæœ›å¤„ç†è¯·æ±‚çš„æ•°é‡æ˜¯ç¼“æ­¥çš„<br>å¢å¤šï¼Œç»è¿‡é¢„æœŸçš„æ—¶é—´ä»¥åï¼Œåˆ°è¾¾ç³»ç»Ÿå¤„ç†è¯·æ±‚ä¸ªæ•°çš„æœ€å¤§å€¼ã€‚Warm Up(å†·å¯åŠ¨ï¼Œ<br>é¢„çƒ­)æ¨¡å¼å°±æ˜¯ä¸ºäº†å®ç°è¿™ä¸ªç›®çš„çš„ã€‚<br>Â·åº”ç”¨åœºæ™¯: ç§’æ€åœ¨å¼€å¯ç¬é—´ï¼Œå¤§æµé‡å¾ˆå®¹æ˜“é€ æˆå†²å®ç³»ç»Ÿï¼ŒWarmup å¯æ…¢æ…¢çš„æŠŠæµé‡æ”¾å…¥ï¼Œæœ€ç»ˆå°†é˜€å€¼å¢é•¿åˆ°è®¾ç½®é˜€å€¼<br>2.éœ€æ±‚åˆ†æ<br>Â·è°ƒç”¨ member-service-nacos-provider-10004 çš„ /t2 API æ¥å£ï¼Œå°† QPS è®¾ç½®ä¸º 9, è®¾ç½®Warm up å€¼<br>Â·å«ä¹‰ä¸º è¯·æ±‚ /t2 çš„ QPS ä» threshold / 3( 9 /3 = 3) å¼€å§‹ï¼Œç»é¢„çƒ­æ—¶é•¿(3 ç§’)é€æ¸å‡è‡³è®¾å®šçš„ QPS é˜ˆå€¼<br>Â·ä¸ºä»€ä¹ˆæ˜¯ 9 / 3, è¿™ä¸ªæ˜¯ 3 å°±æ˜¯é»˜è®¤å†·å¯åŠ¨å¯åŠ¨åŠ è½½å› å­ coldFactor=3<br>Â·.æµ‹è¯•é¢„æœŸæ•ˆæœ: åœ¨å‰ 3 ç§’ï¼Œå¦‚æœè®¿é—® /t2 çš„ QPS è¶…è¿‡ 3, ä¼šç›´æ¥æŠ¥é”™ï¼Œåœ¨ 3 ç§’å è®¿é—®/t2 çš„ QPS è¶…è¿‡ 3, å°äºç­‰äº 9, æ˜¯æ­£å¸¸è®¿é—®</p><h3 id="æµé‡æ§åˆ¶å®ä¾‹-æ’é˜Ÿ"><a href="#æµé‡æ§åˆ¶å®ä¾‹-æ’é˜Ÿ" class="headerlink" title="æµé‡æ§åˆ¶å®ä¾‹-æ’é˜Ÿ"></a>æµé‡æ§åˆ¶å®ä¾‹-æ’é˜Ÿ</h3><p>Â·æ’é˜Ÿæ–¹å¼ï¼šè¿™ç§æ–¹å¼ä¸¥æ ¼æ§åˆ¶äº†è¯·æ±‚é€šè¿‡çš„é—´éš”æ—¶é—´ï¼Œä¹Ÿå³æ˜¯è®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œå¯¹åº”çš„æ˜¯æ¼æ¡¶ç®—æ³•<br>Â·éœ€æ±‚åˆ†æ<br>1.é€šè¿‡ Sentinel å®ç° æµé‡æ§åˆ¶<br>2.è°ƒç”¨ member-service-nacos-provider-10004 çš„ /t2 API æ¥å£ï¼Œå°† QPSè®¾ç½®ä¸º1<br>3.å½“è°ƒç”¨ /t2 çš„ QPS è¶…è¿‡ 1 æ—¶ï¼Œä¸æ‹’ç»è¯·æ±‚ï¼Œè€Œæ˜¯æ’é˜Ÿç­‰å¾…, ä¾æ¬¡æ‰§è¡Œ<br>4.å½“ç­‰å¾…æ—¶é—´è¶…è¿‡ 10 ç§’ï¼Œåˆ™ä¸ºç­‰å¾…</p><h3 id="Sentinel-ç†”æ–­é™çº§"><a href="#Sentinel-ç†”æ–­é™çº§" class="headerlink" title="Sentinel ç†”æ–­é™çº§"></a>Sentinel ç†”æ–­é™çº§</h3><p>Â·æˆ‘ä»¬å¯¹ä¸ç¨³å®šçš„æœåŠ¡è¿›è¡Œç†”æ–­é™çº§ï¼Œè®©å…¶å¿«é€Ÿè¿”å›ç»“æœï¼Œä¸è¦é€ æˆçº¿ç¨‹å †ç§¯<br>Â·ç°ä»£å¾®æœåŠ¡æ¶æ„éƒ½æ˜¯åˆ†å¸ƒå¼çš„ï¼Œç”±éå¸¸å¤šçš„æœåŠ¡ç»„æˆã€‚ä¸åŒæœåŠ¡ä¹‹é—´ç›¸äº’è°ƒç”¨ï¼Œç»„æˆå¤æ‚çš„è°ƒç”¨é“¾è·¯<br>Â·é“¾è·¯è°ƒç”¨ä¸­ä¼šäº§ç”Ÿæ”¾å¤§çš„æ•ˆæœã€‚å¤æ‚é“¾è·¯ä¸Šçš„æŸä¸€ç¯ä¸ç¨³å®šï¼Œå°±å¯èƒ½ä¼šå±‚å±‚çº§è”ï¼Œæœ€ç»ˆå¯¼è‡´æ•´ä¸ªé“¾è·¯éƒ½ä¸å¯ç”¨<br>Â·å› æ­¤éœ€è¦å¯¹ä¸ç¨³å®šçš„å¼±ä¾èµ–æœåŠ¡è°ƒç”¨è¿›è¡Œç†”æ–­é™çº§ï¼Œæš‚æ—¶åˆ‡æ–­ä¸ç¨³å®šè°ƒç”¨ï¼Œé¿å…å±€éƒ¨ä¸ç¨³å®šå› ç´ å¯¼è‡´æ•´ä½“çš„é›ªå´©</p><h4 id="ç†”æ–­-é™çº§-é™æµä¸‰è€…çš„å…³ç³»"><a href="#ç†”æ–­-é™çº§-é™æµä¸‰è€…çš„å…³ç³»" class="headerlink" title="ç†”æ–­,é™çº§,é™æµä¸‰è€…çš„å…³ç³»"></a>ç†”æ–­,é™çº§,é™æµä¸‰è€…çš„å…³ç³»</h4><p>Â·ç†”æ–­å¼ºè°ƒçš„æ˜¯æœåŠ¡ä¹‹é—´çš„è°ƒç”¨èƒ½å®ç°è‡ªæˆ‘æ¢å¤çš„çŠ¶æ€<br>Â·é™æµæ˜¯ä»ç³»ç»Ÿçš„æµé‡å…¥å£è€ƒè™‘, ä»è¿›å…¥çš„æµé‡ä¸Šè¿›è¡Œé™åˆ¶, è¾¾åˆ°ä¿æŠ¤ç³»ç»Ÿçš„ä½œç”¨<br>Â·é™çº§, æ˜¯ä»ç³»ç»Ÿä¸šåŠ¡çš„ç»´åº¦è€ƒè™‘ï¼Œæµé‡å¤§äº†æˆ–è€…é¢‘ç¹å¼‚å¸¸, å¯ä»¥ç‰ºç‰²ä¸€äº›éæ ¸å¿ƒä¸šåŠ¡ï¼Œä¿æŠ¤æ ¸å¿ƒæµç¨‹æ­£å¸¸ä½¿ç”¨</p><h4 id="ç†”æ–­ç­–ç•¥"><a href="#ç†”æ–­ç­–ç•¥" class="headerlink" title="ç†”æ–­ç­–ç•¥"></a>ç†”æ–­ç­–ç•¥</h4><p>1.æ…¢è°ƒç”¨æ¯”ä¾‹<br>Â·æ…¢è°ƒç”¨æ¯”ä¾‹ (SLOW_REQUEST_RATIO)ï¼šé€‰æ‹©ä»¥æ…¢è°ƒç”¨æ¯”ä¾‹ä½œä¸ºé˜ˆå€¼ï¼Œéœ€è¦è®¾ç½®å…è®¸çš„æ…¢è°ƒç”¨ RT(å³æœ€å¤§çš„å“åº”æ—¶é—´)ï¼Œè¯·æ±‚çš„å“åº”æ—¶é—´å¤§äºè¯¥å€¼åˆ™ç»Ÿè®¡ä¸ºæ…¢è°ƒç”¨<br>Â·å½“å•ä½ç»Ÿè®¡æ—¶é•¿(statIntervalMs)å†…è¯·æ±‚æ•°ç›®å¤§äºè®¾ç½®çš„æœ€å°è¯·æ±‚æ•°ç›®ï¼Œå¹¶ä¸”æ…¢è°ƒç”¨çš„æ¯”ä¾‹å¤§äºé˜ˆå€¼ï¼Œåˆ™æ¥ä¸‹æ¥çš„ç†”æ–­æ—¶é•¿å†…è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­<br>Â·ç†”æ–­æ—¶é•¿å, ç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€(HALF-OPEN çŠ¶æ€)ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚å“åº”æ—¶é—´å°äºè®¾ç½®çš„æ…¢è°ƒç”¨ RT åˆ™ç»“æŸç†”æ–­ï¼Œè‹¥å¤§äºè®¾ç½®çš„æ…¢è°ƒç”¨<br>RT åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­<br>Â·å®ä¾‹:<br>å½“è°ƒç”¨ member-service-nacos-provider-10004 çš„ /t3 API æ¥å£æ—¶ï¼Œå¦‚æœåœ¨ 1s å†…æŒç»­è¿›<br>å…¥äº† 5 ä¸ªè¯·æ±‚ï¼Œå¹¶ä¸”è¯·æ±‚çš„å¹³å‡å“åº”æ—¶é—´è¶…è¿‡ 200ms, é‚£ä¹ˆå°±åœ¨æœªæ¥ 10 ç§’é’Ÿå†…ï¼Œæ–­è·¯å™¨<br>æ‰“å¼€, è®© /t3 API æ¥å£ å¾®æœåŠ¡ä¸å¯ç”¨ï¼Œåé¢å¯¹/t3 API æ¥å£ è®¿é—®é™åˆ° 1S å†… 1 ä¸ªè¯·æ±‚ï¼Œé™ä½è®¿é—®é‡äº†ï¼Œæ–­è·¯å™¨å…³é—­ï¼Œå¾®æœåŠ¡æ¢å¤<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/f1a6dcb008342cf5f9b316575ccfe4df.png"></div></div><br>2.å¼‚å¸¸æ¯”åˆ—<br>Â·å¼‚å¸¸æ¯”ä¾‹ (ERROR_RATIO)ï¼šå½“å•ä½ç»Ÿè®¡æ—¶é•¿(statIntervalMs)å†…è¯·æ±‚æ•°ç›®å¤§äºè®¾ç½®çš„æœ€å°è¯·æ±‚æ•°ç›®ï¼Œå¹¶ä¸”å¼‚å¸¸çš„æ¯”ä¾‹å¤§äºé˜ˆå€¼ï¼Œåˆ™æ¥ä¸‹æ¥çš„ç†”æ–­æ—¶é•¿å†…è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­<br>Â·ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€(HALF-OPEN çŠ¶æ€)<br>Â·è‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚æˆåŠŸå®Œæˆ(æ²¡æœ‰é”™è¯¯)åˆ™ç»“æŸç†”æ–­, å¦åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­<br>Â·å¼‚å¸¸æ¯”ç‡çš„é˜ˆå€¼èŒƒå›´æ˜¯ [0.0, 1.0]ï¼Œä»£è¡¨ 0%-100%<br>Â·å®ä¾‹<br>å½“è°ƒç”¨ member-service-nacos-provider-10004 çš„ /t4 API æ¥å£æ—¶ï¼Œå½“èµ„æºçš„æ¯ç§’è¯·æ±‚<br>é‡&gt;=5ï¼Œå¹¶ä¸”æ¯ç§’å¼‚å¸¸æ€»æ•°å é€šè¿‡é‡çš„æ¯”å€¼è¶…è¿‡ 20%(å³å¼‚å¸¸æ¯”ä¾‹åˆ° 20%), æ–­è·¯å™¨æ‰“å¼€(å³:è¿›å…¥é™çº§çŠ¶æ€), è®© /t4 API æ¥å£ å¾®æœåŠ¡ä¸å¯ç”¨<br>Â·å¼‚å¸¸æ•°<br>1.å¼‚å¸¸æ•° (ERROR_COUNT)ï¼šå½“å•ä½ç»Ÿè®¡æ—¶é•¿å†…çš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè‡ªåŠ¨è¿›è¡Œç†”æ–­<br>2.ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€(HALF-OPEN çŠ¶æ€)<br>3.è‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚æˆåŠŸå®Œæˆ(æ²¡æœ‰é”™è¯¯)åˆ™ç»“æŸç†”æ–­ï¼Œå¦åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­</p><h3 id="Sentinel-çƒ­ç‚¹è§„åˆ™"><a href="#Sentinel-çƒ­ç‚¹è§„åˆ™" class="headerlink" title="Sentinel çƒ­ç‚¹è§„åˆ™"></a>Sentinel çƒ­ç‚¹è§„åˆ™</h3><p>Â·çƒ­ç‚¹: çƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡çƒ­ç‚¹æ•°æ®ä¸­, è®¿é—®é¢‘æ¬¡æœ€é«˜çš„Top K æ•°æ®ï¼Œå¹¶å¯¹å…¶è®¿é—®è¿›è¡Œé™åˆ¶ã€‚<br>Â·æ¯”å¦‚æŸæ¡æ–°é—»ä¸Šçƒ­æœ ï¼Œåœ¨æŸæ®µæ—¶é—´å†…é«˜é¢‘è®¿é—®ï¼Œ ä¸ºäº†é˜²æ­¢ç³»ç»Ÿé›ªå´©, å¯ä»¥å¯¹è¯¥æ¡æ–°é—»è¿›è¡Œçƒ­ç‚¹é™æµ</p><h4 id="çƒ­ç‚¹Keyé™æµ-å®ä¾‹"><a href="#çƒ­ç‚¹Keyé™æµ-å®ä¾‹" class="headerlink" title="çƒ­ç‚¹Keyé™æµ-å®ä¾‹"></a>çƒ­ç‚¹Keyé™æµ-å®ä¾‹</h4><p>Â·å¯¹ member-service-nacos-provider-10004 çš„ /news?id=x&amp;type=x API æ¥å£è¿›è¡Œçƒ­ç‚¹é™æµ<br>Â·å‡å®š id=10 è¿™ä¸€æ¡æ–°é—»æ˜¯å½“å‰çš„çƒ­ç‚¹æ–°é—»ï¼Œ å½“æŸ¥è¯¢æ–°é—»æ—¶ï¼Œå¯¹é€šå¸¸çš„ id(éçƒ­ç‚¹æ–°é—»)è¯·æ±‚ QPS é™å®šä¸º 2, å¦‚æœ id=10 QPS é™å®šä¸º 1<br>Â·å¦‚æœè®¿é—®è¶…å‡ºäº†è§„å®šçš„ QPS, è§¦å‘çƒ­ç‚¹é™æµæœºåˆ¶, è°ƒç”¨è‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œç»™å‡ºæç¤ºä¿¡æ¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**     *1.@SentinelResource:æŒ‡å®šsentinel é™æµèµ„æº     *2.value="news" è¡¨ç¤ºsentinelé™æµèµ„æº,åå­—è‡ªå·±å–     *3.blockHandler = "newsBlockHandler":å½“å‡ºç°é™æµæ—¶,ç”±newsBlockHandleræ–¹æ³•è¿›è¡Œå¤„ç†     *     */</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/news"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"news"</span><span class="token punctuation">,</span>blockHandler <span class="token operator">=</span> <span class="token string">"newsBlockHandler"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">queryNews</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> id<span class="token punctuation">,</span>                            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"type"</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"åˆ° DB æŸ¥è¯¢æ•°æ®åº“.... "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"è¿”å› id= "</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">" æ–°é—» fromDB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç³»ç»Ÿè§„åˆ™"><a href="#ç³»ç»Ÿè§„åˆ™" class="headerlink" title="ç³»ç»Ÿè§„åˆ™"></a>ç³»ç»Ÿè§„åˆ™</h3><p>Â·å¦‚æˆ‘ä»¬ç³»ç»Ÿæœ€å¤§æ€§èƒ½èƒ½æŠ— 100QPS, å¦‚ä½•åˆ†é… /t1 /t2çš„QPS<br>Â·æ–¹æ¡ˆ 1: /t1 åˆ†é… QPS=50 /t2 åˆ†é… QPS=50 , é—®é¢˜, å¦‚æœ/t1 å½“å‰ QPS è¾¾åˆ° 50 , è€Œ/t2 çš„ QPS æ‰ 10, ä¼šé€ æˆæ²¡æœ‰å……åˆ†åˆ©ç”¨æœåŠ¡å™¨æ€§èƒ½<br>Â·æ–¹æ¡ˆ 2: /t1 åˆ†é… QPS=100 /t2 åˆ†é… QPS=100 , é—®é¢˜, å®¹æ˜“é€ æˆ ç³»ç»Ÿæ²¡æœ‰æµé‡ä¿æŠ¤ï¼Œé€ æˆè¯·æ±‚çº¿ç¨‹å †ç§¯ï¼Œå½¢æˆé›ªå´©<br>Â·ä¸€å¥è¯: ç³»ç»Ÿè§„åˆ™ä½œç”¨, åœ¨ç³»ç»Ÿç¨³å®šçš„å‰æä¸‹ï¼Œä¿æŒç³»ç»Ÿçš„ååé‡<br>Â·ç³»ç»Ÿå¤„ç†è¯·æ±‚çš„è¿‡ç¨‹æƒ³è±¡ä¸ºä¸€ä¸ªæ°´ç®¡ï¼Œåˆ°æ¥çš„è¯·æ±‚æ˜¯å¾€è¿™ä¸ªæ°´ç®¡çŒæ°´ï¼Œå½“ç³»ç»Ÿå¤„ç†é¡ºç•…çš„æ—¶å€™ï¼Œè¯·æ±‚ä¸éœ€è¦æ’é˜Ÿï¼Œç›´æ¥ä»æ°´ç®¡ä¸­ç©¿è¿‡ï¼Œè¿™ä¸ªè¯·æ±‚çš„RTæ˜¯æœ€çŸ­çš„<br>Â·åä¹‹ï¼Œå½“è¯·æ±‚å †ç§¯çš„æ—¶å€™ï¼Œé‚£ä¹ˆå¤„ç†è¯·æ±‚çš„æ—¶é—´åˆ™ä¼šå˜ä¸ºï¼šæ’é˜Ÿæ—¶é—´ + æœ€çŸ­å¤„ç†æ—¶</p><h4 id="è§„åˆ™"><a href="#è§„åˆ™" class="headerlink" title="è§„åˆ™"></a>è§„åˆ™</h4><p>Â·Load è‡ªé€‚åº”ï¼ˆä»…å¯¹ Linux/Unix-like æœºå™¨ç”Ÿæ•ˆï¼‰ï¼šç³»ç»Ÿçš„ load1 ä½œä¸ºå¯å‘æŒ‡æ ‡ï¼Œè¿›è¡Œè‡ª<br>é€‚åº”ç³»ç»Ÿä¿æŠ¤ã€‚å½“ç³»ç»Ÿ load1 è¶…è¿‡è®¾å®šçš„å¯å‘å€¼ï¼Œä¸”ç³»ç»Ÿå½“å‰çš„å¹¶å‘çº¿ç¨‹æ•°è¶…è¿‡ä¼°ç®—<br>çš„ç³»ç»Ÿå®¹é‡æ—¶æ‰ä¼šè§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆBBR é˜¶æ®µï¼‰ã€‚ç³»ç»Ÿå®¹é‡ç”±ç³»ç»Ÿçš„ maxQps <em> minRtä¼°ç®—å¾—å‡ºã€‚è®¾å®šå‚è€ƒå€¼ä¸€èˆ¬æ˜¯ CPU cores </em> 2.5<br>Â·CPU usageï¼ˆ1.5.0+ ç‰ˆæœ¬ï¼‰ï¼šå½“ç³»ç»Ÿ CPU ä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆå–å€¼èŒƒå›´ 0.0-1.0ï¼‰ï¼Œæ¯”è¾ƒçµæ•<br>Â·å¹³å‡ RTï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹³å‡ RT è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚<br>Â·å¹¶å‘çº¿ç¨‹æ•°ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹¶å‘çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤<br>Â·å…¥å£ QPSï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„ QPS è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</p><h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><p>Â·å¯¹ member-service-nacos-provider-10004 çš„ æ‰€æœ‰ API æ¥å£è¿›è¡Œæµé‡ä¿æŠ¤ï¼Œä¸ç®¡è®¿é—®å“ªä¸ª API æ¥å£, ç³»ç»Ÿå…¥å£æ€»çš„ QPS ä¸èƒ½å¤§äº 2, å¤§äº 2ï¼Œå°±è¿›è¡Œé™æµæ§åˆ¶</p><h3 id="SentinelResourceè‡ªå®šä¹‰å…¨å±€é™æµå¤„ç†ç±»"><a href="#SentinelResourceè‡ªå®šä¹‰å…¨å±€é™æµå¤„ç†ç±»" class="headerlink" title="@SentinelResourceè‡ªå®šä¹‰å…¨å±€é™æµå¤„ç†ç±»"></a>@SentinelResourceè‡ªå®šä¹‰å…¨å±€é™æµå¤„ç†ç±»</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/t6"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"t6"</span><span class="token punctuation">,</span>    blockHandlerClass <span class="token operator">=</span> <span class="token class-name">CustomGlobalBlockHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>    blockHandler <span class="token operator">=</span> <span class="token string">"handlerMethod1"</span><span class="token punctuation">,</span>    fallbackClass <span class="token operator">=</span> <span class="token class-name">CustomGlobalFallbackHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>    fallback <span class="token operator">=</span> <span class="token string">"fallBackHandlerMethod1"</span><span class="token punctuation">,</span>    exceptionsToIgnore <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">RuntimeException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">t6</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œ t6() çº¿ç¨‹ id= "</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>num <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"num çš„å€¼å¼‚å¸¸ num= "</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"200"</span><span class="token punctuation">,</span> <span class="token string">"t6()æ‰§è¡ŒæˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomGlobalBlockHandler</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æé†’:åˆ›å»ºçš„å¤„ç†å¼‚å¸¸æ–¹æ³•éœ€è¦æ˜¯static</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Result</span> <span class="token function">handlerMethod1</span><span class="token punctuation">(</span><span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"400"</span><span class="token punctuation">,</span> <span class="token string">"å®¢æˆ·è‡ªå®šä¹‰å¼‚å¸¸å¤„ç† handlerm1()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Result</span> handlerMethod2 <span class="token punctuation">(</span><span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"401"</span><span class="token punctuation">,</span> <span class="token string">"å®¢æˆ·è‡ªå®šä¹‰å¼‚å¸¸å¤„ç† handlerm2()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomGlobalFallbackHandler</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Result</span> <span class="token function">fallBackHandlerMethod1</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"400"</span><span class="token punctuation">,</span> <span class="token string">"java å¼‚å¸¸ä¿¡æ¯= "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Result</span> <span class="token function">fallBackHandlerMethod2</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"401"</span><span class="token punctuation">,</span> <span class="token string">"java å¼‚å¸¸ä¿¡æ¯= "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="fallback"><a href="#fallback" class="headerlink" title="fallback"></a>fallback</h3><p>Â·blockHandler åªè´Ÿè´£ sentine æ§åˆ¶å°é…ç½®è¿è§„<br>Â·fallback è´Ÿè´£ Java å¼‚å¸¸/ä¸šåŠ¡å¼‚å¸¸</p><h3 id="æ¥å…¥-Sentinel-çš„æ–¹å¼"><a href="#æ¥å…¥-Sentinel-çš„æ–¹å¼" class="headerlink" title="æ¥å…¥ Sentinel çš„æ–¹å¼"></a>æ¥å…¥ Sentinel çš„æ–¹å¼</h3><p>Â·ä»£ç æ–¹å¼(ç¡¬ç¼–ç ,ä¾µå…¥æ€§å¼º,ä¸æ¨è)<br>Â·æ³¨è§£æ–¹å¼(ä½ä¾µå…¥æ€§, å‰é¢ç”¨è¿‡, æ¨è)<br>Â·@SentinelResource ç”¨äºå®šä¹‰èµ„æºï¼Œå¹¶æä¾›å¯é€‰çš„å¼‚å¸¸å¤„ç†å’Œ fallback é…ç½®é¡¹ã€‚<br>@SentinelResource æ³¨è§£åŒ…å«ä»¥ä¸‹å±æ€§(æˆ‘ä»¬å†æ¢³ç†ä¸€ä¸‹)<br>ï‚· valueï¼šèµ„æºåç§°ï¼Œå¿…éœ€é¡¹ï¼ˆä¸èƒ½ä¸ºç©ºï¼‰<br>ï‚· entryTypeï¼šentry ç±»å‹ï¼Œå¯é€‰é¡¹ï¼ˆé»˜è®¤ä¸º EntryType.OUTï¼‰<br>ï‚· blockHandler / blockHandlerClass: blockHandler å¯¹åº”å¤„ç† BlockException çš„å‡½æ•°å<br>ç§°ï¼Œå¯é€‰é¡¹ã€‚blockHandler å‡½æ•°è®¿é—®èŒƒå›´éœ€è¦æ˜¯ publicï¼Œè¿”å›ç±»å‹éœ€è¦ä¸åŸæ–¹æ³•ç›¸åŒ¹<br>é…ï¼Œå‚æ•°ç±»å‹éœ€è¦å’ŒåŸæ–¹æ³•ç›¸åŒ¹é…å¹¶ä¸”æœ€ååŠ ä¸€ä¸ªé¢å¤–çš„å‚æ•°ï¼Œç±»å‹ä¸º<br>BlockExceptionã€‚blockHandler å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶<br>ä»–ç±»çš„å‡½æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®š blockHandlerClass ä¸ºå¯¹åº”çš„ç±»çš„ Class å¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„<br>å‡½æ•°å¿…éœ€ä¸º static å‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æã€‚<br>ï‚· fallback / fallbackClassï¼šfallback å‡½æ•°åç§°ï¼Œå¯é€‰é¡¹ï¼Œç”¨äºåœ¨æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™æä¾›<br>fallback å¤„ç†é€»è¾‘ã€‚fallback å‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸ï¼ˆé™¤äº† exceptionsToIgnore<br>é‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹ï¼‰è¿›è¡Œå¤„ç†ã€‚fallback å‡½æ•°ç­¾åå’Œä½ç½®è¦æ±‚ï¼š<br>(1)è¿”å›å€¼ç±»å‹å¿…é¡»ä¸åŸå‡½æ•°è¿”å›å€¼ç±»å‹ä¸€è‡´ï¼›<br>(2)æ–¹æ³•å‚æ•°åˆ—è¡¨éœ€è¦å’ŒåŸå‡½æ•°ä¸€è‡´ï¼Œæˆ–è€…å¯ä»¥é¢å¤–å¤šä¸€ä¸ª Throwable ç±»å‹çš„å‚æ•°<br>ç”¨äºæ¥æ”¶å¯¹åº”çš„å¼‚å¸¸ã€‚<br>(3)fallback å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œåˆ™å¯<br>ä»¥æŒ‡å®š fallbackClass ä¸ºå¯¹åº”çš„ç±»çš„ Class å¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸º static å‡½æ•°ï¼Œå¦<br>åˆ™æ— æ³•è§£æã€‚<br>ï‚· defaultFallbackï¼ˆsince 1.6.0ï¼‰ï¼šé»˜è®¤çš„ fallback å‡½æ•°åç§°ï¼Œå¯é€‰é¡¹ï¼Œé€šå¸¸ç”¨äºé€šç”¨çš„<br>fallback é€»è¾‘ï¼ˆå³å¯ä»¥ç”¨äºå¾ˆå¤šæœåŠ¡æˆ–æ–¹æ³•ï¼‰ã€‚é»˜è®¤ fallback å‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹<br>çš„å¼‚å¸¸ï¼ˆé™¤äº† exceptionsToIgnore é‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹ï¼‰è¿›è¡Œå¤„ç†ã€‚è‹¥åŒæ—¶é…ç½®äº†<br>fallback å’Œ defaultFallbackï¼Œåˆ™åªæœ‰ fallback ä¼šç”Ÿæ•ˆã€‚defaultFallback å‡½æ•°ç­¾åè¦æ±‚ï¼š<br>(1)è¿”å›å€¼ç±»å‹å¿…é¡»ä¸åŸå‡½æ•°è¿”å›å€¼ç±»å‹ä¸€è‡´ï¼›<br>(2)æ–¹æ³•å‚æ•°åˆ—è¡¨éœ€è¦ä¸ºç©ºï¼Œæˆ–è€…å¯ä»¥é¢å¤–å¤šä¸€ä¸ª Throwable ç±»å‹çš„å‚æ•°ç”¨äºæ¥æ”¶<br>å¯¹åº”çš„å¼‚å¸¸ã€‚<br>(3)defaultFallback å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œ<br>åˆ™å¯ä»¥æŒ‡å®š fallbackClass ä¸ºå¯¹åº”çš„ç±»çš„ Class å¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸º static å‡½æ•°ï¼Œ<br>å¦åˆ™æ— æ³•è§£æã€‚<br>ï‚· exceptionsToIgnoreï¼ˆsince 1.6.0ï¼‰ï¼šç”¨äºæŒ‡å®šå“ªäº›å¼‚å¸¸è¢«æ’é™¤æ‰ï¼Œä¸ä¼šè®¡å…¥å¼‚å¸¸ç»Ÿè®¡ä¸­ï¼Œ<br>ä¹Ÿä¸ä¼šè¿›å…¥ fallback é€»è¾‘ä¸­ï¼Œè€Œæ˜¯ä¼šåŸæ ·æŠ›å‡º</p><h3 id="openFeign-sentinel-å¯¹è¿œç¨‹è°ƒç”¨ç†”æ–­é™çº§"><a href="#openFeign-sentinel-å¯¹è¿œç¨‹è°ƒç”¨ç†”æ–­é™çº§" class="headerlink" title="openFeign+sentinel å¯¹è¿œç¨‹è°ƒç”¨ç†”æ–­é™çº§"></a>openFeign+sentinel å¯¹è¿œç¨‹è°ƒç”¨ç†”æ–­é™çº§</h3><p>Â·åœ¨ member-service-nacos-consumer-80 è°ƒç”¨æŸä¸ªæ— æ•ˆæœåŠ¡æ—¶ï¼Œå¯åŠ¨ Sentinel çš„ç†”æ–­é™çº§æœºåˆ¶ , èƒ½å¤Ÿå¿«é€Ÿè¿”å›å“åº”ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤çš„è¶…æ—¶æœºåˆ¶(å› ä¸ºè¶…æ—¶æœºåˆ¶å®¹æ˜“çº¿ç¨‹å †ç§¯, ä»è€Œå¯¼è‡´é›ªå´©)</p><h3 id="è§„åˆ™æŒä¹…åŒ–-åœ¨Nacos-Serveré…ç½®è§„åˆ™-å®ŒæˆæŒä¹…åŒ–"><a href="#è§„åˆ™æŒä¹…åŒ–-åœ¨Nacos-Serveré…ç½®è§„åˆ™-å®ŒæˆæŒä¹…åŒ–" class="headerlink" title="è§„åˆ™æŒä¹…åŒ–,åœ¨Nacos Serveré…ç½®è§„åˆ™,å®ŒæˆæŒä¹…åŒ–"></a>è§„åˆ™æŒä¹…åŒ–,åœ¨Nacos Serveré…ç½®è§„åˆ™,å®ŒæˆæŒä¹…åŒ–</h3><p>Â·åœ¨nacosä¸­é…ç½®è§„åˆ™<br><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span>  <span class="token punctuation">&#123;</span>    <span class="token property">"resource"</span><span class="token operator">:</span> <span class="token string">"/member/openfeign/consumer/get/1"</span><span class="token punctuation">,</span>    <span class="token property">"limitApp"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>    <span class="token property">"grade"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token property">"count"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token property">"strategy"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token property">"controlBehavior"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token property">"clusterMode"</span><span class="token operator">:</span> <span class="token boolean">false</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>Â·åœ¨application.ymlä¸­é…ç½®<br><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">sentinel</span><span class="token punctuation">:</span>  <span class="token key atrule">transport</span><span class="token punctuation">:</span>    <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">9999</span> <span class="token comment">#æŒ‡å®šsentinelæ§åˆ¶å°åœ°å€</span>    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8719</span>  <span class="token comment">#è®¾ç½®ç«¯å£é»˜è®¤ä¸º8719,å¦‚æœè¯¥ç«¯å£è¢«å ç”¨äº† å°±è‡ªåŠ¨ä»8719+1è¿›è¡Œæ‰«æ,ç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæ²¡æœ‰è¢«å ç”¨çš„ç«¯å£</span>  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>    <span class="token key atrule">ds1</span><span class="token punctuation">:</span>      <span class="token comment">#æµæ§è§„åˆ™é…ç½®æ˜¯ä»nacos serveré…ç½®ä¸­å¿ƒè·å–</span>      <span class="token key atrule">nacos</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#æŒ‡å®šnacos serveræœåŠ¡åœ°å€</span>        <span class="token key atrule">data-id</span><span class="token punctuation">:</span> member<span class="token punctuation">-</span>service<span class="token punctuation">-</span>nacos<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span><span class="token number">80</span> <span class="token comment">#data-id</span>        <span class="token key atrule">group-id</span><span class="token punctuation">:</span> DEFAULT_GROUP <span class="token comment">#æŒ‡å®šç»„ã€nacos serveré…ç½®ä¸­å¿ƒã€‘</span>        <span class="token key atrule">data-type</span><span class="token punctuation">:</span> json <span class="token comment">#æŒ‡å®šæµæ§è§„åˆ™çš„æ•°æ®ç±»å‹</span>        <span class="token key atrule">rule-type</span><span class="token punctuation">:</span> flow <span class="token comment">#è¡¨ç¤ºè§„åˆ™çš„ç±»å‹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="seata-åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†"><a href="#seata-åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†" class="headerlink" title="seata åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†"></a>seata åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†</h2><h3 id="åº”ç”¨å®ä¾‹"><a href="#åº”ç”¨å®ä¾‹" class="headerlink" title="åº”ç”¨å®ä¾‹"></a>åº”ç”¨å®ä¾‹</h3><p>Â·ä¸€ä¸ªå¾®æœåŠ¡è°ƒç”¨ä¸€ä¸ªæ•°æ®åº“,æ€ä¹ˆæ ·åšåˆ°æ•°æ®çš„ç»Ÿä¸€<br>Â·è¿™ä¸ªæ—¶å€™å°±è¦ç”¨åˆ°seata,ä¸»è¦æ˜¯é…ç½®<br>Â·ä¸‹è½½å®‰è£…seata<br>Â·é…ç½®seata<br>Â·åˆ›å»ºå¯¹åº”çš„seataæ•°æ®åº“å’Œè¡¨,åœ¨seataå®‰è£…ç›®å½•æœ‰<br>Â·å°†seataæ³¨å†Œåˆ°nacoaä¸­<br>Â·å¯¹æ¯ä¸ªå¾®æœåŠ¡å¯¹äºçš„åº“åˆ›å»ºundo_logè¡¨<br>Â·æ¯ä¸ªå¾®æœåŠ¡çš„resourceä¸‹åˆ›å»ºä¸¤ä¸ªé…ç½®æ–‡ä»¶</p><h3 id="æœ€åæ˜¯äº‹åŠ¡æ§åˆ¶"><a href="#æœ€åæ˜¯äº‹åŠ¡æ§åˆ¶" class="headerlink" title="æœ€åæ˜¯äº‹åŠ¡æ§åˆ¶"></a>æœ€åæ˜¯äº‹åŠ¡æ§åˆ¶</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderService</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">OrderDao</span> orderDao<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">StorageService</span> storageService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">AccountService</span> accountService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token comment">/**     * è€å¸ˆè§£è¯»     * 1. @GlobalTransactional : åˆ†å¸ƒå¼å…¨å±€äº‹åŠ¡æ§åˆ¶  io.seata.spring.annotationåŒ…     * 2. name = "qgq-save-order" åç§°ï¼Œç¨‹åºå‘˜è‡ªå·±æŒ‡å®š,ä¿è¯å”¯ä¸€å³å¯     * 3. rollbackFor = Exception.class æŒ‡å®šå‘é€ä»€ä¹ˆå¼‚å¸¸å°±å›æ»š, è¿™é‡Œæˆ‘ä»¬æŒ‡å®šçš„æ˜¯Exception.class     *    å³ åªè¦å‘ç”Ÿäº†å¼‚å¸¸å°±å›æ»š     */</span>    <span class="token annotation punctuation">@GlobalTransactional</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"qgq-save-order"</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åé¢æˆ‘ä»¬å¦‚æœéœ€è¦æ‰“å°æ—¥å¿—</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====åˆ›å»ºè®¢å• start====="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====æœ¬åœ°ç”Ÿæˆè®¢å• start==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        orderDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è°ƒç”¨æœ¬åœ°æ–¹æ³•ç”Ÿæˆè®¢å•order</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====æœ¬åœ°ç”Ÿæˆè®¢å• end==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====æ‰£å‡åº“å­˜ start==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¿œç¨‹è°ƒç”¨storageå¾®æœåŠ¡æ‰£å‡åº“å­˜</span>        storageService<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getProductId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getNums</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====æ‰£å‡åº“å­˜ end==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====æ‰£å‡ç”¨æˆ·ä½™é¢ start==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¿œç¨‹è°ƒç”¨accountå¾®æœåŠ¡æ‰£å‡ç”¨æˆ·money</span>        accountService<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====æ‰£å‡ç”¨æˆ·ä½™é¢ end==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====æœ¬åœ°ä¿®æ”¹è®¢å•çŠ¶æ€ start==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è°ƒç”¨æœ¬åœ°æ–¹æ³•ä¿®æ”¹è®¢å•çŠ¶æ€0->1</span>        orderDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====æœ¬åœ°ä¿®æ”¹è®¢å•çŠ¶æ€ end==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====åˆ›å»ºè®¢å• end====="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title&gt;&lt;/a&gt;&lt;div class=&quot;note purple no-icon flat&quot;&gt;&lt;p&gt;SpringCloud &amp;amp; SpringCloudAlibabaå¤ä¹  &lt;/p&gt;
&lt;/div&gt;&lt;</summary>
      
    
    
    
    <category term="åˆ†å¸ƒå¼å¾®æœåŠ¡" scheme="https://100qin10086.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    
    <category term="æ¡†æ¶" scheme="https://100qin10086.github.io/tags/%E6%A1%86%E6%9E%B6/"/>
    
    <category term="Java" scheme="https://100qin10086.github.io/tags/Java/"/>
    
    <category term="åˆ†å¸ƒå¼å¾®æœåŠ¡" scheme="https://100qin10086.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>SpringBootå¤ä¹ </title>
    <link href="https://100qin10086.github.io/posts/a8c3babf.html"/>
    <id>https://100qin10086.github.io/posts/a8c3babf.html</id>
    <published>2024-04-09T07:16:27.000Z</published>
    <updated>2024-05-06T14:13:59.610Z</updated>
    
    <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a><div class="note purple no-icon flat"><p>SpringBootå¤ä¹  </p></div></h1><h2 id="SpringBootåŸºæœ¬ä»‹ç»"><a href="#SpringBootåŸºæœ¬ä»‹ç»" class="headerlink" title="SpringBootåŸºæœ¬ä»‹ç»"></a>SpringBootåŸºæœ¬ä»‹ç»</h2><p>Â·SpringBoot å¯ä»¥è½»æ¾åˆ›å»ºç‹¬ç«‹,ç”Ÿäº§çº§çš„åŸºäºSpringçš„åº”ç”¨ç¨‹åº<br>Â·SpringBoot ç›´æ¥åµŒå…¥Tomcat,Jettyæˆ–Undertow,å¯ä»¥ç›´æ¥è¿è¡ŒSpringBootåº”ç”¨ç¨‹åº</p><h3 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h3><p>Â·å¼•å…¥SpringBootçˆ¶å·¥ç¨‹å’Œwebé¡¹ç›®åœºæ™¯å¯åŠ¨å™¨</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- å¯¼å…¥ springboot çˆ¶å·¥ç¨‹ï¼Œè§„å®šçš„å†™æ³• --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.5.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- å¯¼å…¥ web é¡¹ç›®åœºæ™¯å¯åŠ¨å™¨,ä¼šè‡ªåŠ¨å¯¼å…¥å’Œ web å¼€å‘ç›¸å…³ä¾èµ–,éå¸¸æ–¹ä¾¿ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å¿«é€Ÿå…¥é—¨å°ç»“"><a href="#å¿«é€Ÿå…¥é—¨å°ç»“" class="headerlink" title="å¿«é€Ÿå…¥é—¨å°ç»“"></a>å¿«é€Ÿå…¥é—¨å°ç»“</h4><p>Â·SpringBootæ¯”è¾ƒä¼ ç»Ÿçš„SSMå¼€å‘,ç®€åŒ–æ•´åˆæ­¥éª¤,æé«˜å¼€å‘æ•ˆç‡<br>Â·ç®€åŒ–äº†Mavené¡¹ç›®çš„pom.xmlä¾èµ–å¯¼å…¥,å¯ä»¥è¯´æ˜¯ä¸€é”®å¯¼å…¥</p><h3 id="Spring-SpringMVC-SpringBootçš„å…³ç³»"><a href="#Spring-SpringMVC-SpringBootçš„å…³ç³»" class="headerlink" title="Spring SpringMVC SpringBootçš„å…³ç³»"></a>Spring SpringMVC SpringBootçš„å…³ç³»</h3><p>Â·ä»–ä»¬çš„å…³ç³»å¤§æ¦‚æ˜¯: Spring Boot &gt; Spring &gt; Spring MVC<br>Â·Spring MVCåªæ˜¯Springå¤„ç†WEBå±‚è¯·æ±‚çš„ä¸€ä¸ªæ¨¡å—/ç»„ä»¶,Spring MVCçš„åŸºçŸ³æ˜¯Servlet<br>Â·Spring çš„æ ¸å¿ƒæ˜¯IOCå’ŒAOP,IOCæä¾›äº†ä¾èµ–æ³¨å…¥çš„å®¹å™¨,AOPè§£å†³äº†é¢å‘åˆ‡é¢ç¼–ç¨‹<br>Â·Spring Bootæ˜¯ä¸ºäº†ç®€åŒ–å¼€å‘,é€€å‡ºçš„å°ç¥æ¡†æ¶(çº¦å®šç”±äºé…ç½®ã€COCã€‘,ç®€åŒ–äº†Springé¡¹ç›®çš„é…ç½®æµç¨‹),SpringBoot åŒ…å«å¾ˆå¤šç»„ä»¶/<br>æ¡†æ¶,Springå°±æ˜¯æœ€æ ¸å¿ƒä¹‹ä¸€,ä¹ŸåŒ…å«SpringMVC</p><h4 id="å¦‚ä½•ç†è§£-çº¦å®šä¼˜äºé…ç½®"><a href="#å¦‚ä½•ç†è§£-çº¦å®šä¼˜äºé…ç½®" class="headerlink" title="å¦‚ä½•ç†è§£-çº¦å®šä¼˜äºé…ç½®"></a>å¦‚ä½•ç†è§£-çº¦å®šä¼˜äºé…ç½®</h4><p>Â·çº¦å®šä¼˜äºé…ç½®,åˆç§°æŒ‰çº¦å®šç¼–ç¨‹,æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡è§„èŒƒ,æœ¬è´¨ä¸Šæ˜¯å¯¹ç³»ç»Ÿ,ç±»åº“æˆ–æ¡†æ¶ä¸­ä¸€äº›å¯¹è±¡å‡å®šä¸€ä¸ªå¤§ä¼—åŒ–åˆç†çš„é»˜è®¤å€¼<br>Â·ä¾‹å¦‚åœ¨æ¨¡å‹ä¸­å­˜åœ¨ä¸€ä¸ªåä¸ºUserçš„ç±»,é‚£ä¹ˆå¯¹åº”åˆ°æ•°æ®åº“ä¼šå­˜åœ¨ä¸€ä¸ªåä¸ºuserçš„è¡¨,åªæœ‰åœ¨åç¦»è¿™ä¸ªçº¦å®šæ—¶æ‰éœ€è¦åšç›¸å…³çš„é…ç½®(ä¾‹å¦‚ä½ æƒ³<br>å°†è¡¨åå‘½å‘½ä¸ºt_userç­‰éuseræ—¶æ‰éœ€è¦å†™ç›¸å…³è¿™ä¸ªåå­—çš„é…ç½®)ã€‚<br>Â·ç®€å•æ¥è¯´å°±æ˜¯å‡å¦‚ä½ æ‰€æœŸå¾…çš„é…ç½®ä¸çº¦å®šçš„é…ç½®ä¸€è‡´,é‚£ä¹ˆå°±å¯ä»¥ä¸åšä»»ä½•é…ç½®,çº¦å®šä¸ç¬¦åˆæœŸå¾…æ—¶,æ‰éœ€è¦å¯¹çº¦å®šè¿›è¡Œæ›¿æ¢é…ç½®<br>Â·çº¦å®šä¼˜äºé…ç½®ç†å¿µ:<br>çº¦å®šå…¶å®å°±æ˜¯ä¸€ç§è§„èŒƒ,éµå¾ªäº†è§„èŒƒ,é‚£ä¹ˆå°±å­˜åœ¨é€šç”¨æ€§,äº‹æƒ…å°±ä¼šå˜å¾—ç›¸å¯¹ç®€å•,ç¨‹åºå‘˜ä¹‹é—´çš„æ²Ÿé€šæˆæœ¬ä¼šé™ä½,å·¥ä½œæ•ˆç‡ä¼šæå‡,åˆä½œä¹Ÿä¼š<br>å˜å¾—æ›´åŠ ç®€å•</p><h3 id="ä¾èµ–ç®¡ç†å’Œè‡ªåŠ¨é…ç½®"><a href="#ä¾èµ–ç®¡ç†å’Œè‡ªåŠ¨é…ç½®" class="headerlink" title="ä¾èµ–ç®¡ç†å’Œè‡ªåŠ¨é…ç½®"></a>ä¾èµ–ç®¡ç†å’Œè‡ªåŠ¨é…ç½®</h3><h4 id="ä¾èµ–ç®¡ç†"><a href="#ä¾èµ–ç®¡ç†" class="headerlink" title="ä¾èµ–ç®¡ç†"></a>ä¾èµ–ç®¡ç†</h4><p>Â·ä»€ä¹ˆæ˜¯ä¾èµ–ç®¡ç†<br>1.spring-boot-starter-parent è¿˜æœ‰çˆ¶é¡¹ç›®,å£°æ˜äº†å¼€å‘å¸¸ç”¨çš„ä¾èµ–çš„ç‰ˆæœ¬å·<br>2.å¹¶ä¸”è¿›è¡Œè‡ªåŠ¨ç‰ˆæœ¬ä»²è£,å³å¦‚æœç¨‹åºå‘˜æ²¡æœ‰æŒ‡å®šæŸä¸ªä¾èµ–çš„jarçš„ç‰ˆæœ¬,åˆ™ä»¥çˆ¶é¡¹ç›®æŒ‡å®šçš„ç‰ˆæœ¬ä¸ºå‡†</p><h4 id="starteråœºæ™¯å¯åŠ¨å™¨åŸºæœ¬ä»‹ç»"><a href="#starteråœºæ™¯å¯åŠ¨å™¨åŸºæœ¬ä»‹ç»" class="headerlink" title="starteråœºæ™¯å¯åŠ¨å™¨åŸºæœ¬ä»‹ç»"></a>starteråœºæ™¯å¯åŠ¨å™¨åŸºæœ¬ä»‹ç»</h4><p>Â·å¼€å‘ä¸­æˆ‘ä»¬å¼•å…¥äº†ç›¸å…³åœºæ™¯çš„starter,è¿™ä¸ªåœºæ™¯ä¸­æ‰€æœ‰çš„ç›¸å…³ä¾èµ–éƒ½å¼•å…¥è¿›æ¥äº†,æ¯”å¦‚æˆ‘ä»¬åšwebå¼€å‘å¼•å…¥äº†starterå°†å¯¼å…¥ä¸webå¼€å‘ç›¸å…³çš„æ‰€æœ‰åŒ…</p><h4 id="è‡ªåŠ¨é…ç½®"><a href="#è‡ªåŠ¨é…ç½®" class="headerlink" title="è‡ªåŠ¨é…ç½®"></a>è‡ªåŠ¨é…ç½®</h4><p>Â·å‰é¢å­¦ä¹ ssmæ•´åˆæ—¶,éœ€è¦é…ç½®Tomcat,é…ç½®SpringMVC,é…ç½®å¦‚ä½•æ‰«æåŒ…,é…ç½®å­—ç¬¦è¿‡æ»¤å™¨,é…ç½®è§†å›¾è§£æå™¨,æ–‡ä»¶ä¸Šä¼ ç­‰,éå¸¸éº»çƒ¦,è€Œåœ¨<br>SpringBootä¸­,å­˜åœ¨è‡ªåŠ¨é…ç½®æœºåˆ¶,æé«˜å¼€å‘æ•ˆç‡</p><h4 id="SpringBootè‡ªåŠ¨é…ç½®äº†é‚£äº›"><a href="#SpringBootè‡ªåŠ¨é…ç½®äº†é‚£äº›" class="headerlink" title="SpringBootè‡ªåŠ¨é…ç½®äº†é‚£äº›"></a>SpringBootè‡ªåŠ¨é…ç½®äº†é‚£äº›</h4><p>Â·è‡ªåŠ¨é…ç½®Tomcat<br>Â·è‡ªåŠ¨é…ç½®SpringMVC<br>Â·è‡ªåŠ¨é…ç½®Webå¸¸ç”¨åŠŸèƒ½,æ¯”å¦‚å­—ç¬¦è¿‡æ»¤å™¨:æç¤º,é€šè¿‡è·å–iocå®¹å™¨,æŸ¥çœ‹å®¹å™¨åˆ›å»ºçš„ç»„ä»¶æ¥éªŒè¯<br>Â·è‡ªåŠ¨é…ç½®:é»˜è®¤æ‰«æåŒ…ç»“æ„:é»˜è®¤ä¸»ç¨‹åºæ‰€åœ¨çš„åŒ…åŠå…¶å­åŒ…ä¼šè¢«æ‰«æ,è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ²¡æœ‰é…ç½®æ‰«æåŒ…,ä¹Ÿä¼šè¢«æ‰«æ</p><h4 id="å¦‚ä½•ä¿®æ”¹é»˜è®¤é…ç½®"><a href="#å¦‚ä½•ä¿®æ”¹é»˜è®¤é…ç½®" class="headerlink" title="å¦‚ä½•ä¿®æ”¹é»˜è®¤é…ç½®"></a>å¦‚ä½•ä¿®æ”¹é»˜è®¤é…ç½®</h4><p>Â·ä¿®æ”¹MainApp.java,å¢åŠ æ‰«æçš„åŒ…,å¹¶å®Œæˆæµ‹è¯•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>scanBasePackage<span class="token operator">=</span><span class="token string">"com.gqg"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainApp</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="resources-application-propertiesé…ç½®å¤§å…¨"><a href="#resources-application-propertiesé…ç½®å¤§å…¨" class="headerlink" title="resources/application.propertiesé…ç½®å¤§å…¨"></a>resources/application.propertiesé…ç½®å¤§å…¨</h4><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">ï¼ƒSPRING</span> <span class="token value attr-value">CONFIGï¼ˆConfigFileApplicationListenerï¼‰  </span><span class="token key attr-name">spring.config.name</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒé…ç½®æ–‡ä»¶åï¼ˆé»˜è®¤ ä¸º  'application' ï¼‰  </span><span class="token key attr-name">spring.config.location</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒé…ç½®æ–‡ä»¶çš„ä½ç½®  </span> <span class="token key attr-name">ï¼ƒ</span> <span class="token value attr-value">å¤šç¯å¢ƒé…ç½®æ–‡ä»¶æ¿€æ´»å±æ€§</span><span class="token key attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token value attr-value">devï¼ƒåŠ è½½application-dev.propertiesé…ç½®æ–‡ä»¶å†…å®¹ </span>application-dev.propertiesï¼šï¼ƒå¼€å‘ç¯å¢ƒapplication-test.propertiesï¼šï¼ƒæµ‹è¯•ç¯å¢ƒapplication-prod.propertiesï¼šï¼ƒç”Ÿäº§ç¯å¢ƒ  ï¼ƒactivemqspring.activemq.broker-urlï¼ƒæŒ‡å®šActiveMQ brokerçš„URLï¼Œé»˜è®¤è‡ªåŠ¨ç”Ÿæˆ.spring.activemq.in-memoryï¼ƒæ˜¯å¦æ˜¯å†…å­˜æ¨¡å¼ï¼Œé»˜è®¤ä¸ºtrue.spring.activemq.passwordï¼ƒæŒ‡å®šbrokerçš„å¯†ç .spring.activemq.pooledï¼ƒæ˜¯å¦åˆ›å»ºPooledConnectionFactoryï¼Œè€ŒéConnectionFactoryï¼Œé»˜è®¤falsespring.activemq.userï¼ƒæŒ‡å®šbrokerçš„ç”¨æˆ·.  ï¼ƒaopspring.aop.autoï¼ƒæ˜¯å¦æ”¯æŒ@EnableAspectJAutoProxyï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> truespring.aop.proxy-target-classï¼ƒtrueä¸ºä½¿ç”¨CGLIBä»£ç†ï¼Œfalseä¸ºJDKä»£ç†ï¼Œé»˜è®¤ä¸ºfalse  ï¼ƒapplicationspring.application.admin.enabledï¼ƒæ˜¯å¦å¯ç”¨adminç‰¹æ€§ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> falsespring.application.admin.jmx-nameï¼ƒæŒ‡å®šadmin MBeançš„åç§°ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> org.springframework.boot<span class="token punctuation">:</span>type<span class="token punctuation">=</span>Admin,name<span class="token punctuation">=</span>SpringApplication  ï¼ƒartemis(HornetQæçŒ®ç»™apacheåçš„ç‰ˆæœ¬)spring.artemis.embedded.cluster-passwordï¼ƒæŒ‡å®šé›†ç¾¤çš„å¯†ç ï¼Œé»˜è®¤æ˜¯å¯åŠ¨æ—¶éšæœºç”Ÿæˆ.spring.artemis.embedded.data-directoryï¼ƒæŒ‡å®šJournalæ–‡ä»¶çš„ç›®å½•.å¦‚æœä¸å¼€å§‹æŒä¹…åŒ–åˆ™ä¸å¿…è¦æŒ‡å®š.spring.artemis.embedded.enabledï¼ƒæ˜¯å¦å¼€å¯å†…åµŒæ¨¡å¼ï¼Œé»˜è®¤truespring.artemis.embedded.persistentï¼ƒæ˜¯å¦å¼€å¯persistent storeï¼Œé»˜è®¤false.spring.artemis.embedded.queuesï¼ƒæŒ‡å®šå¯åŠ¨æ—¶åˆ›å»ºçš„é˜Ÿåˆ—ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼Œé»˜è®¤<span class="token punctuation">:</span> []spring.artemis.embedded.server-idï¼ƒæŒ‡å®šServer ID. é»˜è®¤æ˜¯ä¸€ä¸ªè‡ªå¢çš„æ•°å­—ï¼Œä»0å¼€å§‹.spring.artemis.embedded.topicsï¼ƒæŒ‡å®šå¯åŠ¨æ—¶åˆ›å»ºçš„topicï¼Œå¤šä¸ªçš„è¯é€—å·åˆ†éš”ï¼Œé»˜è®¤<span class="token punctuation">:</span> []spring.artemis.hostï¼ƒæŒ‡å®šArtemis broker çš„host. é»˜è®¤<span class="token punctuation">:</span> localhostspring.artemis.modeï¼ƒæŒ‡å®šArtemis çš„éƒ¨ç½²æ¨¡å¼, é»˜è®¤ä¸ºauto-detected(ä¹Ÿå¯ä»¥ä¸ºnative or embedded).spring.artemis.portï¼ƒæŒ‡å®šArtemis broker çš„ç«¯å£ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> 61616  ï¼ƒautoconfigspring.autoconfigure.excludeï¼ƒé…ç½®è¦æ’é™¤çš„Auto-configuration classes.  ï¼ƒbatchspring.batch.initializer.enabledï¼ƒæ˜¯å¦åœ¨å¿…è¦æ—¶åˆ›å»ºbatchè¡¨ï¼Œé»˜è®¤ä¸ºtruespring.batch.job.enabledï¼ƒæ˜¯å¦åœ¨å¯åŠ¨æ—¶å¼€å¯batch jobï¼Œé»˜è®¤ä¸ºtruespring.batch.job.namesï¼ƒæŒ‡å®šå¯åŠ¨æ—¶è¦æ‰§è¡Œçš„jobçš„åç§°ï¼Œé€—å·åˆ†éš”ï¼Œé»˜è®¤æ‰€æœ‰jobéƒ½ä¼šè¢«æ‰§è¡Œspring.batch.schemaï¼ƒæŒ‡å®šè¦åˆå§‹åŒ–çš„sqlè¯­å¥è·¯å¾„ï¼Œé»˜è®¤<span class="token punctuation">:</span>classpath<span class="token punctuation">:</span>org/springframework/batch/core/schema-@@platform@@.sql)spring.batch.table-prefixï¼ƒæŒ‡å®šæ‰¹é‡å¤„ç†çš„è¡¨çš„å‰ç¼€.  ï¼ƒcookieã€sessioné…ç½®server.session.cookie.commentï¼ƒæŒ‡å®šsession cookieçš„commentserver.session.cookie.domainï¼ƒæŒ‡å®šsession cookieçš„domainserver.session.cookie.http-onlyï¼ƒæ˜¯å¦å¼€å¯HttpOnly.server.session.cookie.max-ageï¼ƒè®¾å®šsession cookieçš„æœ€å¤§age.server.session.cookie.nameï¼ƒè®¾å®šSession cookie çš„åç§°.server.session.cookie.pathï¼ƒè®¾å®šsession cookieçš„è·¯å¾„.server.session.cookie.secureï¼ƒè®¾å®šsession cookieçš„â€œSecureâ€ flag.server.session.persistentï¼ƒé‡å¯æ—¶æ˜¯å¦æŒä¹…åŒ–sessionï¼Œé»˜è®¤falseserver.session.timeoutï¼ƒsessionçš„è¶…æ—¶æ—¶é—´server.session.tracking-modesï¼ƒè®¾å®šSessionçš„è¿½è¸ªæ¨¡å¼(cookie, url, ssl).  <span class="token key attr-name">ï¼ƒdatasource</span> spring.dao.exceptiontranslation.enabledï¼ƒæ˜¯å¦å¼€å¯PersistenceExceptionTranslationPostProcessorï¼Œé»˜è®¤ä¸ºtruespring.datasource.abandon-when-percentage-fullï¼ƒè®¾å®šè¶…æ—¶è¢«åºŸå¼ƒçš„è¿æ¥å åˆ°å¤šå°‘æ¯”ä¾‹æ—¶è¦è¢«å…³é—­æˆ–ä¸ŠæŠ¥spring.datasource.allow-pool-suspensionï¼ƒä½¿ç”¨Hikari poolæ—¶ï¼Œæ˜¯å¦å…è®¸è¿æ¥æ± æš‚åœï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> falsespring.datasource.alternate-username-allowedï¼ƒæ˜¯å¦å…è®¸æ›¿ä»£çš„ç”¨æˆ·å.spring.datasource.auto-commitï¼ƒæŒ‡å®šupdatesæ˜¯å¦è‡ªåŠ¨æäº¤.spring.datasource.catalogï¼ƒæŒ‡å®šé»˜è®¤çš„catalog.spring.datasource.commit-on-returnï¼ƒè®¾ç½®å½“è¿æ¥è¢«å½’è¿˜æ—¶ï¼Œæ˜¯å¦è¦æäº¤æ‰€æœ‰è¿˜æœªå®Œæˆçš„äº‹åŠ¡spring.datasource.connection-init-sqlï¼ƒæŒ‡å®šè¿æ¥è¢«åˆ›å»ºï¼Œå†è¢«æ·»åŠ åˆ°è¿æ¥æ± ä¹‹å‰æ‰§è¡Œçš„sql.spring.datasource.connection-init-sqlsï¼ƒä½¿ç”¨DBCP connection poolæ—¶ï¼ŒæŒ‡å®šåˆå§‹åŒ–æ—¶è¦æ‰§è¡Œçš„sqlspring.datasource.connection-properties.[key]ï¼ƒåœ¨ä½¿ç”¨DBCP connection poolæ—¶æŒ‡å®šè¦é…ç½®çš„å±æ€§spring.datasource.connection-test-queryï¼ƒæŒ‡å®šæ ¡éªŒè¿æ¥åˆæ³•æ€§æ‰§è¡Œçš„sqlè¯­å¥spring.datasource.connection-timeoutï¼ƒæŒ‡å®šè¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œæ¯«ç§’å•ä½.spring.datasource.continue-on-errorï¼ƒåœ¨åˆå§‹åŒ–æ•°æ®åº“æ—¶ï¼Œé‡åˆ°é”™è¯¯æ˜¯å¦ç»§ç»­ï¼Œé»˜è®¤falsespring.datasource.dataï¼ƒæŒ‡å®šData (DML)è„šæœ¬spring.datasource.data-source-class-nameï¼ƒæŒ‡å®šæ•°æ®æºçš„å…¨é™å®šå.spring.datasource.data-source-jndiï¼ƒæŒ‡å®šjndiçš„åœ°å€spring.datasource.data-source-properties.[key]ï¼ƒä½¿ç”¨Hikari connection poolæ—¶ï¼ŒæŒ‡å®šè¦è®¾ç½®çš„å±æ€§spring.datasource.db-propertiesï¼ƒä½¿ç”¨Tomcat connection poolï¼ŒæŒ‡å®šè¦è®¾ç½®çš„å±æ€§spring.datasource.default-auto-commitï¼ƒæ˜¯å¦è‡ªåŠ¨æäº¤.spring.datasource.default-catalogï¼ƒæŒ‡å®šè¿æ¥é»˜è®¤çš„catalog.spring.datasource.default-read-onlyï¼ƒæ˜¯å¦è®¾ç½®é»˜è®¤è¿æ¥åªè¯».spring.datasource.default-transaction-isolationï¼ƒæŒ‡å®šè¿æ¥çš„äº‹åŠ¡çš„é»˜è®¤éš”ç¦»çº§åˆ«.spring.datasource.driver-class-nameï¼ƒæŒ‡å®šdriverçš„ç±»åï¼Œé»˜è®¤ä»jdbc urlä¸­è‡ªåŠ¨æ¢æµ‹.spring.datasource.fair-queueï¼ƒæ˜¯å¦é‡‡ç”¨FIFOè¿”å›è¿æ¥.spring.datasource.health-check-properties.[key]ï¼ƒä½¿ç”¨Hikari connection poolæ—¶ï¼Œåœ¨å¿ƒè·³æ£€æŸ¥æ—¶ä¼ é€’çš„å±æ€§spring.datasource.idle-timeoutï¼ƒæŒ‡å®šè¿æ¥å¤šä¹…æ²¡è¢«ä½¿ç”¨æ—¶ï¼Œè¢«è®¾ç½®ä¸ºç©ºé—²ï¼Œé»˜è®¤ä¸º10msspring.datasource.ignore-exception-on-pre-loadï¼ƒå½“åˆå§‹åŒ–è¿æ¥æ± æ—¶ï¼Œæ˜¯å¦å¿½ç•¥å¼‚å¸¸.spring.datasource.init-sqlï¼ƒå½“è¿æ¥åˆ›å»ºæ—¶ï¼Œæ‰§è¡Œçš„sqlspring.datasource.initial-sizeï¼ƒæŒ‡å®šå¯åŠ¨è¿æ¥æ± æ—¶ï¼Œåˆå§‹å»ºç«‹çš„è¿æ¥æ•°é‡spring.datasource.initialization-fail-fastï¼ƒå½“åˆ›å»ºè¿æ¥æ± æ—¶ï¼Œæ²¡æ³•åˆ›å»ºæŒ‡å®šæœ€å°è¿æ¥æ•°é‡æ˜¯å¦æŠ›å¼‚å¸¸spring.datasource.initializeï¼ƒæŒ‡å®šåˆå§‹åŒ–æ•°æ®æºï¼Œæ˜¯å¦ç”¨data.sqlæ¥åˆå§‹åŒ–ï¼Œé»˜è®¤<span class="token punctuation">:</span> truespring.datasource.isolate-internal-queriesï¼ƒæŒ‡å®šå†…éƒ¨æŸ¥è¯¢æ˜¯å¦è¦è¢«éš”ç¦»ï¼Œé»˜è®¤ä¸ºfalsespring.datasource.jdbc-interceptorsï¼ƒä½¿ç”¨Tomcat connection poolæ—¶ï¼ŒæŒ‡å®šjdbcæ‹¦æˆªå™¨ï¼Œåˆ†å·åˆ†éš”spring.datasource.jdbc-urlï¼ƒæŒ‡å®šJDBC URL.spring.datasource.jmx-enabledï¼ƒæ˜¯å¦å¼€å¯JMXï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> falsespring.datasource.jndi-nameï¼ƒæŒ‡å®šjndiçš„åç§°.spring.datasource.leak-detection-thresholdï¼ƒä½¿ç”¨Hikari connection poolæ—¶ï¼Œå¤šå°‘æ¯«ç§’æ£€æµ‹ä¸€æ¬¡è¿æ¥æ³„éœ².spring.datasource.log-abandonedï¼ƒä½¿ç”¨DBCP connection poolï¼Œæ˜¯å¦è¿½è¸ªåºŸå¼ƒstatementæˆ–è¿æ¥ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> falsespring.datasource.log-validation-errorsï¼ƒå½“ä½¿ç”¨Tomcat connection poolæ˜¯å¦æ‰“å°æ ¡éªŒé”™è¯¯.spring.datasource.login-timeoutï¼ƒæŒ‡å®šè¿æ¥æ•°æ®åº“çš„è¶…æ—¶æ—¶é—´.spring.datasource.max-activeï¼ƒæŒ‡å®šè¿æ¥æ± ä¸­æœ€å¤§çš„æ´»è·ƒè¿æ¥æ•°.spring.datasource.max-ageï¼ƒæŒ‡å®šè¿æ¥æ± ä¸­è¿æ¥çš„æœ€å¤§å¹´é¾„spring.datasource.max-idleï¼ƒæŒ‡å®šè¿æ¥æ± æœ€å¤§çš„ç©ºé—²è¿æ¥æ•°é‡.spring.datasource.max-lifetimeï¼ƒæŒ‡å®šè¿æ¥æ± ä¸­è¿æ¥çš„æœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼Œæ¯«ç§’å•ä½.spring.datasource.max-open-prepared-statementsï¼ƒæŒ‡å®šæœ€å¤§çš„æ‰“å¼€çš„prepared statementsæ•°é‡.spring.datasource.max-waitï¼ƒæŒ‡å®šè¿æ¥æ± ç­‰å¾…è¿æ¥è¿”å›çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œæ¯«ç§’å•ä½.spring.datasource.maximum-pool-sizeï¼ƒæŒ‡å®šè¿æ¥æ± æœ€å¤§çš„è¿æ¥æ•°ï¼ŒåŒ…æ‹¬ä½¿ç”¨ä¸­çš„å’Œç©ºé—²çš„è¿æ¥.spring.datasource.min-evictable-idle-time-millisï¼ƒæŒ‡å®šä¸€ä¸ªç©ºé—²è¿æ¥æœ€å°‘ç©ºé—²å¤šä¹…åå¯è¢«æ¸…é™¤.spring.datasource.min-idleï¼ƒæŒ‡å®šå¿…é¡»ä¿æŒè¿æ¥çš„æœ€å°å€¼(For DBCP and Tomcat connection pools)spring.datasource.minimum-idleï¼ƒæŒ‡å®šè¿æ¥ç»´æŠ¤çš„æœ€å°ç©ºé—²è¿æ¥æ•°ï¼Œå½“ä½¿ç”¨HikariCPæ—¶æŒ‡å®š.spring.datasource.nameï¼ƒæŒ‡å®šæ•°æ®æºå.spring.datasource.num-tests-per-eviction-runï¼ƒæŒ‡å®šè¿è¡Œæ¯ä¸ªidle object evictorçº¿ç¨‹æ—¶çš„å¯¹è±¡æ•°é‡spring.datasource.passwordï¼ƒæŒ‡å®šæ•°æ®åº“å¯†ç .spring.datasource.platformï¼ƒæŒ‡å®šschemaè¦ä½¿ç”¨çš„Platform(schema-$&#123;platform&#125;.sql)ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> allspring.datasource.pool-nameï¼ƒæŒ‡å®šè¿æ¥æ± åå­—.spring.datasource.pool-prepared-statementsï¼ƒæŒ‡å®šæ˜¯å¦æ± åŒ–statements.spring.datasource.propagate-interrupt-stateï¼ƒåœ¨ç­‰å¾…è¿æ¥æ—¶ï¼Œå¦‚æœçº¿ç¨‹è¢«ä¸­æ–­ï¼Œæ˜¯å¦ä¼ æ’­ä¸­æ–­çŠ¶æ€.spring.datasource.read-onlyï¼ƒå½“ä½¿ç”¨Hikari connection poolæ—¶ï¼Œæ˜¯å¦æ ‡è®°æ•°æ®æºåªè¯»spring.datasource.register-mbeansï¼ƒæŒ‡å®šHikari connection poolæ˜¯å¦æ³¨å†ŒJMX MBeans.spring.datasource.remove-abandonedï¼ƒæŒ‡å®šå½“è¿æ¥è¶…è¿‡åºŸå¼ƒè¶…æ—¶æ—¶é—´æ—¶ï¼Œæ˜¯å¦ç«‹åˆ»åˆ é™¤è¯¥è¿æ¥.spring.datasource.remove-abandoned-timeoutï¼ƒæŒ‡å®šè¿æ¥åº”è¯¥è¢«åºŸå¼ƒçš„æ—¶é—´.spring.datasource.rollback-on-returnï¼ƒåœ¨å½’è¿˜è¿æ¥æ—¶ï¼Œæ˜¯å¦å›æ»šç­‰å¾…ä¸­çš„äº‹åŠ¡.spring.datasource.schemaï¼ƒæŒ‡å®šSchema (DDL)è„šæœ¬.spring.datasource.separatorï¼ƒæŒ‡å®šåˆå§‹åŒ–è„šæœ¬çš„è¯­å¥åˆ†éš”ç¬¦ï¼Œé»˜è®¤<span class="token punctuation">:</span> ;spring.datasource.sql-script-encodingï¼ƒæŒ‡å®šSQL scriptsç¼–ç .spring.datasource.suspect-timeoutï¼ƒæŒ‡å®šæ‰“å°åºŸå¼ƒè¿æ¥å‰çš„è¶…æ—¶æ—¶é—´.spring.datasource.test-on-borrowï¼ƒå½“ä»è¿æ¥æ± å€Ÿç”¨è¿æ¥æ—¶ï¼Œæ˜¯å¦æµ‹è¯•è¯¥è¿æ¥.spring.datasource.test-on-connectï¼ƒåˆ›å»ºæ—¶ï¼Œæ˜¯å¦æµ‹è¯•è¿æ¥spring.datasource.test-on-returnï¼ƒåœ¨è¿æ¥å½’è¿˜åˆ°è¿æ¥æ± æ—¶æ˜¯å¦æµ‹è¯•è¯¥è¿æ¥.spring.datasource.test-while-idleï¼ƒå½“è¿æ¥ç©ºé—²æ—¶ï¼Œæ˜¯å¦æ‰§è¡Œè¿æ¥æµ‹è¯•.<span class="token key attr-name">spring.datasource.time-between-eviction-runs-millis</span> <span class="token value attr-value">   ï¼ƒæŒ‡å®šç©ºé—²è¿æ¥æ£€æŸ¥ã€åºŸå¼ƒè¿æ¥æ¸…ç†ã€ç©ºé—²è¿æ¥æ± å¤§å°è°ƒæ•´ä¹‹é—´çš„æ“ä½œæ—¶é—´é—´éš”</span>spring.datasource.transaction-isolationï¼ƒæŒ‡å®šäº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œä½¿ç”¨Hikari connection poolæ—¶æŒ‡å®šspring.datasource.urlï¼ƒæŒ‡å®šJDBC URL.spring.datasource.use-disposable-connection-facadeï¼ƒæ˜¯å¦å¯¹è¿æ¥è¿›è¡ŒåŒ…è£…ï¼Œé˜²æ­¢è¿æ¥å…³é—­ä¹‹åè¢«ä½¿ç”¨.spring.datasource.use-equalsï¼ƒæ¯”è¾ƒæ–¹æ³•åæ—¶æ˜¯å¦ä½¿ç”¨String.equals()æ›¿æ¢<span class="token punctuation">=</span><span class="token punctuation">=</span>.spring.datasource.use-lockï¼ƒæ˜¯å¦å¯¹è¿æ¥æ“ä½œåŠ é”spring.datasource.usernameï¼ƒæŒ‡å®šæ•°æ®åº“å.spring.datasource.validation-intervalï¼ƒæŒ‡å®šå¤šå°‘msæ‰§è¡Œä¸€æ¬¡è¿æ¥æ ¡éªŒ.spring.datasource.validation-queryï¼ƒæŒ‡å®šè·å–è¿æ¥æ—¶è¿æ¥æ ¡éªŒçš„sqlæŸ¥è¯¢è¯­å¥.spring.datasource.validation-query-timeoutï¼ƒæŒ‡å®šè¿æ¥æ ¡éªŒæŸ¥è¯¢çš„è¶…æ—¶æ—¶é—´.spring.datasource.validation-timeoutï¼ƒè®¾å®šè¿æ¥æ ¡éªŒçš„è¶…æ—¶æ—¶é—´ï¼Œå½“ä½¿ç”¨Hikari connection poolæ—¶æŒ‡å®šspring.datasource.validator-class-nameï¼ƒç”¨æ¥æµ‹è¯•æŸ¥è¯¢çš„validatorå…¨é™å®šå.spring.datasource.xa.data-source-class-nameï¼ƒæŒ‡å®šæ•°æ®æºçš„å…¨é™å®šå.spring.datasource.xa.propertiesï¼ƒæŒ‡å®šä¼ é€’ç»™XA data sourceçš„å±æ€§<span class="token key attr-name">ï¼ƒdata</span> <span class="token value attr-value"> springdata</span>spring.data.elasticsearch.cluster-nameï¼ƒæŒ‡å®šesé›†ç¾¤åç§°ï¼Œé»˜è®¤<span class="token punctuation">:</span> elasticsearchspring.data.elasticsearch.cluster-nodesï¼ƒæŒ‡å®šesçš„é›†ç¾¤ï¼Œé€—å·åˆ†éš”ï¼Œä¸æŒ‡å®šçš„è¯ï¼Œåˆ™å¯åŠ¨client node.spring.data.elasticsearch.propertiesï¼ƒæŒ‡å®šè¦é…ç½®çš„eså±æ€§.spring.data.elasticsearch.repositories.enabledï¼ƒæ˜¯å¦å¼€å¯eså­˜å‚¨ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> truespring.data.jpa.repositories.enabledï¼ƒæ˜¯å¦å¼€å¯JPAæ”¯æŒï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> truespring.data.mongodb.authentication-databaseï¼ƒæŒ‡å®šé‰´æƒçš„æ•°æ®åº“åspring.data.mongodb.databaseï¼ƒæŒ‡å®šmongodbæ•°æ®åº“åspring.data.mongodb.field-naming-strategyï¼ƒæŒ‡å®šè¦ä½¿ç”¨çš„FieldNamingStrategy.spring.data.mongodb.grid-fs-databaseï¼ƒæŒ‡å®šGridFS databaseçš„åç§°.spring.data.mongodb.hostï¼ƒæŒ‡å®šMongo server host.spring.data.mongodb.passwordï¼ƒæŒ‡å®šMongo serverçš„å¯†ç .spring.data.mongodb.portï¼ƒæŒ‡å®šMongo server port.spring.data.mongodb.repositories.enabledï¼ƒæ˜¯å¦å¼€å¯mongodbå­˜å‚¨ï¼Œé»˜è®¤ä¸ºtruespring.data.mongodb.uriï¼ƒæŒ‡å®šMongo database URI.é»˜è®¤<span class="token punctuation">:</span>mongodb<span class="token punctuation">:</span>//localhost/testspring.data.mongodb.usernameï¼ƒæŒ‡å®šç™»é™†mongodbçš„ç”¨æˆ·å.spring.data.rest.base-pathï¼ƒæŒ‡å®šæš´éœ²èµ„æºçš„åŸºå‡†è·¯å¾„.spring.data.rest.default-page-sizeï¼ƒæŒ‡å®šæ¯é¡µçš„å¤§å°ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> 20spring.data.rest.limit-param-nameï¼ƒæŒ‡å®šlimitçš„å‚æ•°åï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> sizespring.data.rest.max-page-sizeï¼ƒæŒ‡å®šæœ€å¤§çš„é¡µæ•°ï¼Œé»˜è®¤ä¸º1000spring.data.rest.page-param-nameï¼ƒæŒ‡å®šåˆ†é¡µçš„å‚æ•°åï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> pagespring.data.rest.return-body-on-createï¼ƒå½“åˆ›å»ºå®Œå®ä½“ä¹‹åï¼Œæ˜¯å¦è¿”å›bodyï¼Œé»˜è®¤ä¸ºfalsespring.data.rest.return-body-on-updateï¼ƒåœ¨æ›´æ–°å®Œå®ä½“åï¼Œæ˜¯å¦è¿”å›bodyï¼Œé»˜è®¤ä¸ºfalsespring.data.rest.sort-param-nameï¼ƒæŒ‡å®šæ’åºä½¿ç”¨çš„keyï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> sortspring.data.solr.hostï¼ƒæŒ‡å®šSolr hostï¼Œå¦‚æœæœ‰æŒ‡å®šäº†zkçš„hostçš„è¯ï¼Œåˆ™å¿½ç•¥ã€‚é»˜è®¤ä¸º<span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>8983/solrspring.data.solr.repositories.enabledï¼ƒæ˜¯å¦å¼€å¯Solr repositoriesï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> truespring.data.solr.zk-hostï¼ƒæŒ‡å®šzkçš„åœ°å€ï¼Œæ ¼å¼ä¸ºHOST<span class="token punctuation">:</span>PORT.<span class="token key attr-name">ï¼ƒ----------------------------------------</span> <span class="token value attr-value"> </span><span class="token key attr-name">ï¼ƒDEVTOOLSå±æ€§</span> <span class="token value attr-value"> </span><span class="token key attr-name">ï¼ƒ----------------------------------------</span> <span class="token value attr-value"> </span>  <span class="token key attr-name">ï¼ƒDEVTOOLSï¼ˆDevToolsPropertiesï¼‰</span> <span class="token value attr-value"> </span><span class="token key attr-name">spring.devtools.livereload.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨livereload.comå…¼å®¹çš„serverã€‚  </span><span class="token key attr-name">spring.devtools.livereload.port</span> <span class="token punctuation">=</span> <span class="token value attr-value">35729ï¼ƒæœåŠ¡å™¨ç«¯å£ã€‚  </span><span class="token key attr-name">spring.devtools.restart.additional-exclude</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒåº”è¯¥ä»è§¦å‘å®Œå…¨é‡æ–°å¯åŠ¨æ—¶æ’é™¤çš„å…¶ä»–æ¨¡å¼ã€‚  </span><span class="token key attr-name">spring.devtools.restart.additional-paths</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒé¢å¤–çš„è·¯å¾„æ¥è§‚å¯Ÿå˜åŒ–ã€‚  </span><span class="token key attr-name">spring.devtools.restart.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨è‡ªåŠ¨é‡å¯ã€‚  </span><span class="token key attr-name">spring.devtools.restart.exclude</span> <span class="token punctuation">=</span> <span class="token value attr-value">META-INF /è¡Œå®¶/ **ï¼ŒMETA-INF /èµ„æº/ **ï¼Œèµ„æº/ **ï¼Œé™æ€/ **ï¼Œå…¬å…±/ **ï¼Œæ¨¡æ¿/ **ï¼Œ** / * Test.classï¼Œ** / * Tests.classï¼Œgit.propertiesï¼ƒåº”è¯¥æ’é™¤è§¦å‘å®Œå…¨é‡å¯çš„æ¨¡å¼ã€‚  </span><span class="token key attr-name">spring.devtools.restart.poll-interval</span> <span class="token punctuation">=</span> <span class="token value attr-value">1000ï¼ƒpolling è·¯å¾„æ›´æ”¹ä¹‹é—´ç­‰å¾…çš„æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚  </span><span class="token key attr-name">spring.devtools.restart.quiet-period</span> <span class="token punctuation">=</span> <span class="token value attr-value">400ï¼ƒè§¦å‘é‡æ–°å¯åŠ¨ä¹‹å‰ï¼Œæ²¡æœ‰ä»»ä½•ç±»è·¯å¾„å˜åŒ–æ‰€éœ€çš„é™é»˜æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚  </span><span class="token key attr-name">spring.devtools.restart.trigger-file</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒç‰¹å®šæ–‡ä»¶çš„åç§°ï¼Œåœ¨æ›´æ”¹æ—¶ä¼šè§¦å‘é‡æ–°å¯åŠ¨æ£€æŸ¥ã€‚å¦‚æœæœªæŒ‡å®šä»»ä½•ç±»è·¯å¾„æ–‡ä»¶æ›´æ”¹å°†è§¦å‘é‡æ–°å¯åŠ¨ã€‚  </span>    <span class="token key attr-name">ï¼ƒDEVTOOLS</span> <span class="token value attr-value">  REMOTE DEVTOOLSï¼ˆRemoteDevToolsPropertiesï¼‰  </span><span class="token key attr-name">spring.devtools.remote.context-path</span> <span class="token punctuation">=</span>  <span class="token value attr-value">ï¼ƒç”¨äºå¤„ç†è¿œç¨‹è¿æ¥çš„ä¸Šä¸‹æ–‡è·¯å¾„ã€‚  </span><span class="token key attr-name">spring.devtools.remote.debug.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨è¿œç¨‹è°ƒè¯•æ”¯æŒã€‚  </span><span class="token key attr-name">spring.devtools.remote.debug.local-port</span> <span class="token punctuation">=</span> <span class="token value attr-value">8000ï¼ƒæœ¬åœ°è¿œç¨‹è°ƒè¯•æœåŠ¡å™¨ç«¯å£ã€‚  </span><span class="token key attr-name">spring.devtools.remote.proxy.host</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒç”¨äºè¿æ¥è¿œç¨‹åº”ç”¨ç¨‹åºçš„ä»£ç†ä¸»æœºã€‚  </span><span class="token key attr-name">spring.devtools.remote.proxy.port</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒç”¨äºè¿æ¥è¿œç¨‹åº”ç”¨ç¨‹åºçš„ä»£ç†ç«¯å£ã€‚  </span><span class="token key attr-name">spring.devtools.remote.restart.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨è¿œç¨‹é‡å¯ã€‚  </span><span class="token key attr-name">spring.devtools.remote.secret</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒå»ºç«‹è¿æ¥æ‰€éœ€çš„å…±äº«å¯†é’¥ï¼ˆéœ€è¦å¯ç”¨è¿œç¨‹æ”¯æŒï¼‰ã€‚  </span><span class="token key attr-name">spring.devtools.remote.secret-header-name</span> <span class="token punctuation">=</span> <span class="token value attr-value">X-AUTH-TOKEN  ï¼ƒç”¨äºä¼ è¾“å…±äº«å¯†é’¥çš„HTTPå¤´ã€‚  </span>  <span class="token key attr-name">ï¼ƒ----------------------------------------</span> <span class="token value attr-value"> </span><span class="token key attr-name">ï¼ƒæ‰§è¡Œå™¨å±æ€§</span> <span class="token value attr-value"> </span><span class="token key attr-name">ï¼ƒ----------------------------------------</span> <span class="token value attr-value"> </span>  <span class="token key attr-name">ï¼ƒENDPOINTSï¼ˆAbstractEndpointå­ç±»ï¼‰</span> <span class="token value attr-value"> </span><span class="token key attr-name">endpoints.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨ç«¯ç‚¹ã€‚  </span><span class="token key attr-name">endpoints.sensitive</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒé»˜è®¤çš„ç«¯ç‚¹æ•æ„Ÿè®¾ç½®ã€‚  </span><span class="token key attr-name">endpoints.actuator.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨ç«¯ç‚¹ã€‚  </span><span class="token key attr-name">endpoints.actuator.path</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒç«¯ç‚¹URLè·¯å¾„ã€‚  </span><span class="token key attr-name">endpoints.actuator.sensitive</span> <span class="token punctuation">=</span> <span class="token value attr-value">falseï¼ƒåœ¨ç«¯ç‚¹ä¸Šå¯ç”¨å®‰å…¨æ€§ã€‚  </span><span class="token key attr-name">endpoints.autoconfig.enabled</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒå¯ç”¨ç«¯ç‚¹ã€‚  </span><span class="token key attr-name">endpoints.autoconfig.id</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒç«¯ç‚¹æ ‡è¯†ç¬¦ã€‚  </span><span class="token key attr-name">endpoints.autoconfig.sensitive</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒæ ‡è®°ç«¯ç‚¹æ˜¯å¦æš´éœ²æ•æ„Ÿä¿¡æ¯ã€‚  </span><span class="token key attr-name">endpoints.beans.enabled</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒå¯ç”¨ç«¯ç‚¹ã€‚  </span><span class="token key attr-name">endpoints.beans.id</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒç«¯ç‚¹æ ‡è¯†ç¬¦ã€‚  </span><span class="token key attr-name">endpoints.beans.sensitive</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒæ ‡è®°ç«¯ç‚¹æ˜¯å¦æš´éœ²æ•æ„Ÿä¿¡æ¯ã€‚  </span><span class="token key attr-name">endpoints.configprops.enabled</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒå¯ç”¨ç«¯ç‚¹ã€‚  </span><span class="token key attr-name">endpoints.configprops.id</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒç«¯ç‚¹æ ‡è¯†ç¬¦ã€‚  </span>endpoints.configprops.keys-to-sanitizeï¼ƒåº”è¯¥æ¸…ç†çš„å¯†é’¥ã€‚é”®å¯ä»¥æ˜¯å±æ€§ä»¥æˆ–æ­£åˆ™è¡¨è¾¾å¼ç»“æŸçš„ç®€å•å­—ç¬¦ä¸²ã€‚  <span class="token key attr-name">endpoints.configprops.sensitive</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒæ ‡è®°ç«¯ç‚¹æ˜¯å¦å…¬å¼€æ•æ„Ÿä¿¡æ¯ã€‚  </span><span class="token key attr-name">endpoints.docs.curies.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">falseï¼ƒå¯ç”¨å±…é‡Œä»£ã€‚  </span><span class="token key attr-name">endpoints.docs.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨æ‰§è¡Œå™¨æ–‡æ¡£ç»ˆç»“ç‚¹ã€‚  </span><span class="token key attr-name">endpoints.docs.path</span> <span class="token punctuation">=</span> <span class="token value attr-value">/ docsï¼ƒ  </span><span class="token key attr-name">endpoints.docs.sensitive</span> <span class="token punctuation">=</span> <span class="token value attr-value">falseï¼ƒ  </span>   <span class="token key attr-name">ï¼ƒç»ˆç«¯CORSé…ç½®ï¼ˆEndpointCorsPropertiesï¼‰</span> <span class="token value attr-value"> </span><span class="token key attr-name">endpoints.cors.allow-credentials</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒè®¾ç½®æ˜¯å¦æ”¯æŒå‡­æ®ã€‚æœªè®¾ç½®æ—¶ï¼Œä¸æ”¯æŒå‡­è¯ã€‚  </span><span class="token key attr-name">endpoints.cors.allowed-headers</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒåœ¨è¯·æ±‚ä¸­å…è®¸ä½¿ç”¨é€—å·åˆ†éš”çš„æ ‡é¢˜åˆ—è¡¨ã€‚'*'å…è®¸æ‰€æœ‰æ ‡é¢˜ã€‚  </span><span class="token key attr-name">endpoints.cors.allowed-methods</span> <span class="token punctuation">=</span> <span class="token value attr-value">GETï¼ƒé€—å·åˆ†éš”çš„å…è®¸çš„æ–¹æ³•åˆ—è¡¨ã€‚'*'å…è®¸æ‰€æœ‰çš„æ–¹æ³•ã€‚  </span><span class="token key attr-name">endpoints.cors.allowed-origins</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒé€—å·åˆ†éš”çš„èµ·æºåˆ—è¡¨å…è®¸ã€‚'*'å…è®¸æ‰€æœ‰çš„æ¥æºã€‚æœªè®¾ç½®æ—¶ï¼ŒCORSæ”¯æŒè¢«ç¦ç”¨ã€‚  </span><span class="token key attr-name">endpoints.cors.exposed-headers</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒåŒ…å«åœ¨å“åº”ä¸­çš„é€—å·åˆ†éš”çš„æ ‡é¢˜åˆ—è¡¨ã€‚  </span><span class="token key attr-name">endpoints.cors.max-age</span> <span class="token punctuation">=</span> <span class="token value attr-value">1800ï¼ƒä»¥ç§’ä¸ºå•ä½ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç¼“å­˜é£è¡Œå‰è¯·æ±‚çš„å“åº”ã€‚  </span>  <span class="token key attr-name">ï¼ƒJMX</span> <span class="token value attr-value">ENDPOINTï¼ˆEndpointMBeanExportPropertiesï¼‰  </span><span class="token key attr-name">endpoints.jmx.domain</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒJMXåŸŸåã€‚å¦‚æœè®¾ç½®ï¼Œåˆ™ç”¨â€œspring.jmx.default-domainâ€çš„å€¼åˆå§‹åŒ–ã€‚  </span><span class="token key attr-name">endpoints.jmx.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨æ‰€æœ‰ç«¯ç‚¹çš„JMXå¯¼å‡ºã€‚  </span><span class="token key attr-name">endpoints.jmx.static-names</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒé™„åŠ åˆ°æ‰€æœ‰è¡¨ç¤ºç«¯ç‚¹çš„MBeançš„ObjectNameçš„é™æ€å±æ€§ã€‚  </span><span class="token key attr-name">endpoints.jmx.unique-names</span> <span class="token punctuation">=</span> <span class="token value attr-value">falseï¼ƒç¡®ä¿ObjectNamesåœ¨å‘ç”Ÿå†²çªæ—¶è¢«ä¿®æ”¹ã€‚  </span>  ï¼ƒflyway<span class="token key attr-name">flyway.baseline-description</span> <span class="token value attr-value">ï¼ƒå¯¹æ‰§è¡Œè¿ç§»æ—¶åŸºå‡†ç‰ˆæœ¬çš„æè¿°.</span>flyway.baseline-on-migrateï¼ƒå½“è¿ç§»æ—¶å‘ç°ç›®æ ‡schemaéç©ºï¼Œè€Œä¸”å¸¦æœ‰æ²¡æœ‰å…ƒæ•°æ®çš„è¡¨æ—¶ï¼Œæ˜¯å¦è‡ªåŠ¨æ‰§è¡ŒåŸºå‡†è¿ç§»ï¼Œé»˜è®¤false.flyway.baseline-versionï¼ƒå¼€å§‹æ‰§è¡ŒåŸºå‡†è¿ç§»æ—¶å¯¹ç°æœ‰çš„schemaçš„ç‰ˆæœ¬æ‰“æ ‡ç­¾ï¼Œé»˜è®¤å€¼ä¸º1.flyway.check-locationï¼ƒæ£€æŸ¥è¿ç§»è„šæœ¬çš„ä½ç½®æ˜¯å¦å­˜åœ¨ï¼Œé»˜è®¤false.flyway.clean-on-validation-errorï¼ƒå½“å‘ç°æ ¡éªŒé”™è¯¯æ—¶æ˜¯å¦è‡ªåŠ¨è°ƒç”¨cleanï¼Œé»˜è®¤false.flyway.enabledï¼ƒæ˜¯å¦å¼€å¯flywaryï¼Œé»˜è®¤true.flyway.encodingï¼ƒè®¾ç½®è¿ç§»æ—¶çš„ç¼–ç ï¼Œé»˜è®¤UTF-8.flyway.ignore-failed-future-migrationï¼ƒå½“è¯»å–å…ƒæ•°æ®è¡¨æ—¶æ˜¯å¦å¿½ç•¥é”™è¯¯çš„è¿ç§»ï¼Œé»˜è®¤false.flyway.init-sqlsï¼ƒå½“åˆå§‹åŒ–å¥½è¿æ¥æ—¶è¦æ‰§è¡Œçš„SQL.flyway.locationsï¼ƒè¿ç§»è„šæœ¬çš„ä½ç½®ï¼Œé»˜è®¤db/migration.flyway.out-of-orderï¼ƒæ˜¯å¦å…è®¸æ— åºçš„è¿ç§»ï¼Œé»˜è®¤false.flyway.passwordï¼ƒç›®æ ‡æ•°æ®åº“çš„å¯†ç .flyway.placeholder-prefixï¼ƒè®¾ç½®æ¯ä¸ªplaceholderçš„å‰ç¼€ï¼Œé»˜è®¤$&#123;.flyway.placeholder-replacementï¼ƒplaceholdersæ˜¯å¦è¦è¢«æ›¿æ¢ï¼Œé»˜è®¤true.flyway.placeholder-suffixï¼ƒè®¾ç½®æ¯ä¸ªplaceholderçš„åç¼€ï¼Œé»˜è®¤&#125;.<span class="token key attr-name">flyway.placeholders.[placeholder</span> <span class="token value attr-value">name]ï¼ƒè®¾ç½®placeholderçš„value</span>flyway.schemasï¼ƒè®¾å®šéœ€è¦flywaryè¿ç§»çš„schemaï¼Œå¤§å°å†™æ•æ„Ÿï¼Œé»˜è®¤ä¸ºè¿æ¥é»˜è®¤çš„schema.flyway.sql-migration-prefixï¼ƒè¿ç§»æ–‡ä»¶çš„å‰ç¼€ï¼Œé»˜è®¤ä¸ºV.flyway.sql-migration-separatorï¼ƒè¿ç§»è„šæœ¬çš„æ–‡ä»¶ååˆ†éš”ç¬¦ï¼Œé»˜è®¤__flyway.sql-migration-suffixï¼ƒè¿ç§»è„šæœ¬çš„åç¼€ï¼Œé»˜è®¤ä¸º.sqlflyway.tableï¼ƒflywayä½¿ç”¨çš„å…ƒæ•°æ®è¡¨åï¼Œé»˜è®¤ä¸ºschema_versionflyway.targetï¼ƒè¿ç§»æ—¶ä½¿ç”¨çš„ç›®æ ‡ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸ºlatest versionflyway.urlï¼ƒè¿ç§»æ—¶ä½¿ç”¨çš„JDBC URLï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šçš„è¯ï¼Œå°†ä½¿ç”¨é…ç½®çš„ä¸»æ•°æ®æºflyway.userï¼ƒè¿ç§»æ•°æ®åº“çš„ç”¨æˆ·åflyway.validate-on-migrateï¼ƒè¿ç§»æ—¶æ˜¯å¦æ ¡éªŒï¼Œé»˜è®¤ä¸ºtrue. <span class="token key attr-name">ï¼ƒFREEMARKERï¼ˆFreeMarkerAutoConfigurationï¼‰</span> <span class="token value attr-value"> </span><span class="token key attr-name">spring.freemarker.allowRequestOverride</span> <span class="token punctuation">=</span> <span class="token value attr-value">false   ï¼ƒè®¾ç½®HttpServletRequestå±æ€§æ˜¯å¦å…è®¸è¦†ç›–(éšè—)æ§åˆ¶å™¨ç”Ÿæˆçš„ç›¸åŒåç§°çš„æ¨¡å‹å±æ€§ã€‚</span><span class="token key attr-name">spring.freemarker.allowSessionOverride</span> <span class="token punctuation">=</span> <span class="token value attr-value">false   ï¼ƒè®¾ç½®HttpSessionå±æ€§æ˜¯å¦å…è®¸è¦†ç›–(éšè—)æ§åˆ¶å™¨ç”Ÿæˆçš„ç›¸åŒåç§°çš„æ¨¡å‹å±æ€§ã€‚</span><span class="token key attr-name">spring.freemarker.cache</span> <span class="token punctuation">=</span> <span class="token value attr-value">true   ï¼ƒä½¿ç”¨æ¨¡æ¿ç¼“å­˜ã€‚</span><span class="token key attr-name">spring.freemarker.charset</span><span class="token punctuation">=</span><span class="token value attr-value">UTF-8  ï¼ƒ Template encoding.</span><span class="token key attr-name">spring.freemarker.checkTemplateLocation</span> <span class="token punctuation">=</span> <span class="token value attr-value">true   ï¼ƒæ£€æŸ¥æ¨¡æ¿ä½ç½®æ˜¯å¦å­˜åœ¨spring.freemarker.check-template-location=true </span><span class="token key attr-name">spring.freemarker.contentType</span> <span class="token punctuation">=</span> <span class="token value attr-value">text / html   ï¼ƒContent-Type  </span><span class="token key attr-name">spring.freemarker.exposeRequestAttributes</span> <span class="token punctuation">=</span> <span class="token value attr-value">false  ï¼ƒåœ¨ä¸æ¨¡æ¿åˆå¹¶ä¹‹å‰ï¼Œè®¾ç½®æ˜¯å¦åº”è¯¥å°†æ‰€æœ‰è¯·æ±‚å±æ€§æ·»åŠ åˆ°æ¨¡å‹ä¸­ã€‚spring.freemarker.expose-request-attributes=false</span><span class="token key attr-name">spring.freemarker.exposeSessionAttributes</span> <span class="token punctuation">=</span> <span class="token value attr-value">false  ï¼ƒåœ¨ä¸æ¨¡æ¿åˆå¹¶ä¹‹å‰ï¼Œè®¾ç½®æ˜¯å¦åº”è¯¥å°†æ‰€æœ‰HttpSessionå±æ€§æ·»åŠ åˆ°æ¨¡å‹ä¸­ã€‚spring.freemarker.expose-session-attributes=false</span><span class="token key attr-name">spring.freemarker.exposeSpringMacroHelpers</span> <span class="token punctuation">=</span> <span class="token value attr-value">false  ï¼ƒè®¾å®šæ˜¯å¦ä»¥springMacroRequestContextçš„å½¢å¼æš´éœ²RequestContextç»™Springâ€™s macro libraryä½¿ç”¨      spring.freemarker.expose-spring-macro-helpers=true</span><span class="token key attr-name">spring.freemarker.prefer-file-system-access</span><span class="token punctuation">=</span><span class="token value attr-value">true ï¼ƒæ˜¯å¦ä¼˜å…ˆä»æ–‡ä»¶ç³»ç»ŸåŠ è½½templateï¼Œä»¥æ”¯æŒçƒ­åŠ è½½ï¼Œé»˜è®¤ä¸ºtrue</span><span class="token key attr-name">spring.freemarker.prefix</span> <span class="token punctuation">=</span>  <span class="token value attr-value">ï¼ƒåœ¨æ„å»ºURLæ—¶ï¼Œå‰ç¼€è¢«é¢„å…ˆæŒ‡å®šä»¥æŸ¥çœ‹åç§°ã€‚</span><span class="token key attr-name">spring.freemarker.requestContextAttribute</span> <span class="token punctuation">=</span>  <span class="token value attr-value">ï¼ƒæ‰€æœ‰è§†å›¾çš„RequestContextå±æ€§çš„åç§°.   freemarker.request-context-attribute= </span><span class="token key attr-name">spring.freemarker.settings.*</span> <span class="token punctuation">=</span>  <span class="token value attr-value">ï¼ƒWell-known FreeMarker keys which will be passed to FreeMarker's Configuration</span><span class="token key attr-name">spring.freemarker.suffix</span> <span class="token punctuation">=</span> <span class="token value attr-value">.ftl  ï¼ƒåœ¨æ„å»ºURLæ—¶é™„åŠ åˆ°è§†å›¾åç§°åé¢çš„åç¼€</span><span class="token key attr-name">spring.freemarker.templateEncoding</span> <span class="token punctuation">=</span> <span class="token value attr-value">UTF- 8  </span><span class="token key attr-name">spring.freemarker.templateLoaderPath</span> <span class="token punctuation">=</span><span class="token value attr-value">classpath:/templates  ï¼ƒè®¾å®šftlæ–‡ä»¶è·¯å¾„ ç±»è·¯å¾„ï¼š/æ¨¡æ¿/  </span><span class="token key attr-name">spring.freemarker.viewNames</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒå¯ä»¥è§£æçš„è§†å›¾åç§°çš„ç™½åå•  </span><span class="token key attr-name">spring.mvc.static-path-pattern</span><span class="token punctuation">=</span><span class="token value attr-value">/static/**  ï¼ƒè®¾å®šé™æ€æ–‡ä»¶è·¯å¾„ï¼Œjs,cssç­‰</span><span class="token key attr-name">ï¼ƒGITä¿¡æ¯</span> <span class="token value attr-value"> </span><span class="token key attr-name">spring.git.properties</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒç”Ÿæˆçš„gitä¿¡æ¯å±æ€§æ–‡ä»¶çš„èµ„æºå¼•ç”¨ã€‚  </span><span class="token key attr-name">ï¼ƒGROOVYæ¨¡æ¿ï¼ˆGroovyTemplateAutoConfigurationï¼‰</span> <span class="token value attr-value"> </span><span class="token key attr-name">spring.groovy.template.allow-request-override</span> <span class="token value attr-value">ï¼ƒæŒ‡å®šHttpServletRequestçš„å±æ€§æ˜¯å¦å¯ä»¥è¦†ç›–controllerçš„modelçš„åŒåé¡¹</span><span class="token key attr-name">spring.groovy.template.allow-session-override</span> <span class="token value attr-value">ï¼ƒæŒ‡å®šHttpSessionçš„å±æ€§æ˜¯å¦å¯ä»¥è¦†ç›–controllerçš„modelçš„åŒåé¡¹</span><span class="token key attr-name">spring.groovy.template.cache</span> <span class="token value attr-value"> ï¼ƒæ˜¯å¦å¼€å¯æ¨¡æ¿ç¼“å­˜</span><span class="token key attr-name">.spring.groovy.template.charset</span> <span class="token value attr-value">ï¼ƒæŒ‡å®šTemplateç¼–ç </span><span class="token key attr-name">.spring.groovy.template.check-template-location</span> <span class="token value attr-value">ï¼ƒæ˜¯å¦æ£€æŸ¥æ¨¡æ¿çš„è·¯å¾„æ˜¯å¦å­˜åœ¨.</span><span class="token key attr-name">spring.groovy.template.configuration.auto-escape</span> <span class="token value attr-value">ï¼ƒæ˜¯å¦åœ¨æ¸²æŸ“æ¨¡æ¿æ—¶è‡ªåŠ¨æ’æŸ¥modelçš„å˜é‡ï¼Œé»˜è®¤ä¸º: false</span><span class="token key attr-name">spring.groovy.template.configuration.auto-indent</span> <span class="token value attr-value">ï¼ƒæ˜¯å¦åœ¨æ¸²æŸ“æ¨¡æ¿æ—¶è‡ªåŠ¨ç¼©è¿›ï¼Œé»˜è®¤ä¸ºfalse</span><span class="token key attr-name">spring.groovy.template.configuration.auto-indent-string</span> <span class="token value attr-value">ï¼ƒå¦‚æœè‡ªåŠ¨ç¼©è¿›å¯ç”¨çš„è¯ï¼Œæ˜¯ä½¿ç”¨SPACESè¿˜æ˜¯TABï¼Œé»˜è®¤ä¸º: SPACES</span><span class="token key attr-name">spring.groovy.template.configuration.auto-new-line</span> <span class="token value attr-value">ï¼ƒæ¸²æŸ“æ¨¡æ¿æ—¶æ˜¯å¦è¦è¾“å‡ºæ¢è¡Œï¼Œé»˜è®¤ä¸ºfalse</span><span class="token key attr-name">spring.groovy.template.configuration.base-template-class</span> <span class="token value attr-value">ï¼ƒæŒ‡å®štemplate base class.</span><span class="token key attr-name">spring.groovy.template.configuration.cache-templates</span> <span class="token value attr-value">ï¼ƒæ˜¯å¦è¦ç¼“å­˜æ¨¡æ¿ï¼Œé»˜è®¤ä¸ºtrue</span><span class="token key attr-name">spring.groovy.template.configuration.declaration-encoding</span> <span class="token value attr-value">ï¼ƒåœ¨å†™å…¥declaration headeræ—¶ä½¿ç”¨çš„ç¼–ç </span><span class="token key attr-name">spring.groovy.template.configuration.expand-empty-elements</span> <span class="token value attr-value">ï¼ƒæ˜¯ä½¿ç”¨&lt;br/>è¿™ç§å½¢å¼ï¼Œè¿˜æ˜¯&lt;br>&lt;/br>è¿™ç§å±•å¼€æ¨¡å¼ï¼Œé»˜è®¤ä¸º: false)</span><span class="token key attr-name">spring.groovy.template.configuration.locale</span> <span class="token value attr-value">ï¼ƒæŒ‡å®štemplate locale.</span><span class="token key attr-name">spring.groovy.template.configuration.new-line-string</span> <span class="token value attr-value">ï¼ƒå½“å¯ç”¨è‡ªåŠ¨æ¢è¡Œæ—¶ï¼Œæ¢è¡Œçš„è¾“å‡ºï¼Œé»˜è®¤ä¸ºç³»ç»Ÿçš„line.separatorå±æ€§çš„å€¼</span><span class="token key attr-name">spring.groovy.template.configuration.resource-loader-path</span> <span class="token value attr-value">ï¼ƒæŒ‡å®šgroovyçš„æ¨¡æ¿è·¯å¾„ï¼Œé»˜è®¤ä¸ºclasspath:/templates/</span><span class="token key attr-name">spring.groovy.template.configuration.use-double-quotes</span> <span class="token value attr-value">ï¼ƒæŒ‡å®šå±æ€§è¦ä½¿ç”¨åŒå¼•å·è¿˜æ˜¯å•å¼•å·ï¼Œé»˜è®¤ä¸ºfalse</span><span class="token key attr-name">spring.groovy.template.content-type</span> <span class="token value attr-value">ï¼ƒæŒ‡å®šContent-Type.</span><span class="token key attr-name">spring.groovy.template.enabled</span> <span class="token value attr-value">ï¼ƒæ˜¯å¦å¼€å¯groovyæ¨¡æ¿çš„æ”¯æŒ.</span><span class="token key attr-name">spring.groovy.template.expose-request-attributes</span> <span class="token value attr-value">ï¼ƒè®¾å®šæ‰€æœ‰requestçš„å±æ€§åœ¨mergeåˆ°æ¨¡æ¿çš„æ—¶å€™ï¼Œæ˜¯å¦è¦éƒ½æ·»åŠ åˆ°modelä¸­.</span><span class="token key attr-name">spring.groovy.template.expose-session-attributes</span> <span class="token value attr-value">ï¼ƒè®¾å®šæ‰€æœ‰requestçš„å±æ€§åœ¨mergeåˆ°æ¨¡æ¿çš„æ—¶å€™ï¼Œæ˜¯å¦è¦éƒ½æ·»åŠ åˆ°modelä¸­.</span><span class="token key attr-name">spring.groovy.template.expose-spring-macro-helpers</span> <span class="token value attr-value">ï¼ƒè®¾å®šæ˜¯å¦ä»¥springMacroRequestContextçš„å½¢å¼æš´éœ²RequestContextç»™Springâ€™s macro libraryä½¿ç”¨</span><span class="token key attr-name">spring.groovy.template.prefix</span> <span class="token value attr-value">ï¼ƒæŒ‡å®šæ¨¡æ¿çš„å‰ç¼€.</span><span class="token key attr-name">spring.groovy.template.request-context-attribute</span> <span class="token value attr-value">ï¼ƒæŒ‡å®šRequestContextå±æ€§çš„å.</span>spring.groovy.template.resource-loader-path ï¼ƒæŒ‡å®šæ¨¡æ¿çš„è·¯å¾„ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>/templates/spring.groovy.template.suffixï¼ƒæŒ‡å®šæ¨¡æ¿çš„åç¼€<span class="token key attr-name">spring.groovy.template.view-names</span> <span class="token value attr-value">ï¼ƒæŒ‡å®šè¦ä½¿ç”¨æ¨¡æ¿çš„è§†å›¾åç§°.</span>ï¼ƒh2spring.h2.console.enabledï¼ƒæ˜¯å¦å¼€å¯æ§åˆ¶å°ï¼Œé»˜è®¤ä¸ºfalsespring.h2.console.pathï¼ƒæŒ‡å®šæ§åˆ¶å°è·¯å¾„ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> /h2-consoleï¼ƒhornetq(HornetQPropertiesï¼‰  spring.hornetq.embedded.cluster-passwordï¼ƒæŒ‡å®šé›†ç¾¤çš„å¯†ç ï¼Œé»˜è®¤å¯åŠ¨æ—¶éšæœºç”Ÿæˆ.spring.hornetq.embedded.data-directoryï¼ƒæŒ‡å®šJournal file çš„ç›®å½•. å¦‚æœä¸å¼€å¯æŒä¹…åŒ–åˆ™ä¸å¿…æŒ‡å®š.spring.hornetq.embedded.enabledï¼ƒæ˜¯å¦å¼€å¯å†…åµŒæ¨¡å¼ï¼Œé»˜è®¤<span class="token punctuation">:</span>truespring.hornetq.embedded.persistentï¼ƒæ˜¯å¦å¼€å¯persistent storeï¼Œé»˜è®¤<span class="token punctuation">:</span> falsespring.hornetq.embedded.queuesï¼ƒæŒ‡å®šå¯åŠ¨æ˜¯åˆ›å»ºçš„queueï¼Œå¤šä¸ªä»¥é€—å·åˆ†éš”ï¼Œé»˜è®¤<span class="token punctuation">:</span> []spring.hornetq.embedded.server-idï¼ƒæŒ‡å®šServer ID. é»˜è®¤ä½¿ç”¨è‡ªå¢æ•°å­—ï¼Œä»0å¼€å§‹.spring.hornetq.embedded.topicsï¼ƒæŒ‡å®šå¯åŠ¨æ—¶åˆ›å»ºçš„topicï¼Œå¤šä¸ªä»¥é€—å·åˆ†éš”ï¼Œé»˜è®¤<span class="token punctuation">:</span> []spring.hornetq.hostï¼ƒæŒ‡å®šHornetQ broker çš„hostï¼Œé»˜è®¤<span class="token punctuation">:</span> localhostspring.hornetq.modeï¼ƒæŒ‡å®šHornetQ çš„éƒ¨ç½²æ¨¡å¼ï¼Œé»˜è®¤æ˜¯auto-detectedï¼Œä¹Ÿå¯ä»¥æŒ‡å®šnative æˆ–è€… embedded.spring.hornetq.portï¼ƒæŒ‡å®šHornetQ broker ç«¯å£ï¼Œé»˜è®¤<span class="token punctuation">:</span> 5445ï¼ƒhttp<span class="token key attr-name">spring.hateoas.apply-to-primary-object-mapper</span> <span class="token value attr-value">  ï¼ƒè®¾å®šæ˜¯å¦å¯¹object mapperä¹Ÿæ”¯æŒHATEOASï¼Œé»˜è®¤ä¸º: true</span><span class="token key attr-name">spring.http.converters.preferred-json-mapper</span> <span class="token value attr-value">  ï¼ƒæ˜¯å¦ä¼˜å…ˆä½¿ç”¨JSON mapperæ¥è½¬æ¢.</span><span class="token key attr-name">spring.http.encoding.charset</span> <span class="token value attr-value">ï¼ƒæŒ‡å®šhttpè¯·æ±‚å’Œç›¸åº”çš„Charsetï¼Œé»˜è®¤: UTF-8</span>spring.http.encoding.enabledï¼ƒæ˜¯å¦å¼€å¯httpçš„ç¼–ç æ”¯æŒï¼Œé»˜è®¤ä¸ºtruespring.http.encoding.forceï¼ƒæ˜¯å¦å¼ºåˆ¶å¯¹httpè¯·æ±‚å’Œå“åº”è¿›è¡Œç¼–ç ï¼Œé»˜è®¤ä¸ºtrueï¼ƒjersey<span class="token key attr-name">spring.jersey.filter.order</span> <span class="token value attr-value">ï¼ƒæŒ‡å®šJersey filterçš„orderï¼Œé»˜è®¤ä¸º: 0</span>spring.jersey.initï¼ƒæŒ‡å®šä¼ é€’ç»™Jerseyçš„åˆå§‹åŒ–å‚æ•°.spring.jersey.typeï¼ƒæŒ‡å®šJerseyçš„é›†æˆç±»å‹ï¼Œå¯ä»¥æ˜¯servletæˆ–è€…filter.ï¼ƒjmsspring.jms.jndi-nameï¼ƒæŒ‡å®šConnection factory JNDI åç§°.spring.jms.listener.acknowledge-modeï¼ƒæŒ‡å®šackæ¨¡å¼ï¼Œé»˜è®¤è‡ªåŠ¨ack.spring.jms.listener.auto-startupï¼ƒæ˜¯å¦å¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨jmsï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> truespring.jms.listener.concurrencyï¼ƒæŒ‡å®šæœ€å°çš„å¹¶å‘æ¶ˆè´¹è€…æ•°é‡.spring.jms.listener.max-concurrencyï¼ƒæŒ‡å®šæœ€å¤§çš„å¹¶å‘æ¶ˆè´¹è€…æ•°é‡.spring.jms.pub-sub-domainï¼ƒæ˜¯å¦ä½¿ç”¨é»˜è®¤çš„destination typeæ¥æ”¯æŒ publish/subscribeï¼Œé»˜è®¤<span class="token punctuation">:</span> falsejmxspring.jmx.default-domainï¼ƒæŒ‡å®šJMX domain name.spring.jmx.enabledï¼ƒæ˜¯å¦æš´éœ²jmxï¼Œé»˜è®¤ä¸ºtruespring.jmx.serverï¼ƒæŒ‡å®šMBeanServer bean name. é»˜è®¤ä¸º<span class="token punctuation">:</span> mbeanServer)ï¼ƒjooqspring.jooq.sql-dialectï¼ƒæŒ‡å®šJOOQä½¿ç”¨çš„SQLDialectï¼Œæ¯”å¦‚POSTGRES.ï¼ƒMessagesspring.messages.basename ï¼ƒæŒ‡å®šmessageçš„basenameï¼Œå¤šä¸ªä»¥é€—å·åˆ†éš”ï¼Œå¦‚æœä¸åŠ åŒ…åçš„è¯ï¼Œé»˜è®¤ä»classpathè·¯å¾„å¼€å§‹ï¼Œé»˜è®¤<span class="token punctuation">:</span> messagesspring.messages.cache-seconds ï¼ƒè®¾å®šåŠ è½½çš„èµ„æºæ–‡ä»¶ç¼“å­˜å¤±æ•ˆæ—¶é—´ï¼Œ-1çš„è¯ä¸ºæ°¸ä¸è¿‡æœŸï¼Œé»˜è®¤ä¸º-1<span class="token key attr-name">spring.messages.encoding</span> <span class="token value attr-value">    ï¼ƒè®¾å®šMessage bundlesçš„ç¼–ç ï¼Œé»˜è®¤: UTF-8</span>ï¼ƒJPAspring.jpa.databaseï¼ƒæŒ‡å®šç›®æ ‡æ•°æ®åº“.spring.jpa.database-platformï¼ƒæŒ‡å®šç›®æ ‡æ•°æ®åº“çš„ç±»å‹.spring.jpa.generate-ddlï¼ƒæ˜¯å¦åœ¨å¯åŠ¨æ—¶åˆå§‹åŒ–schemaï¼Œé»˜è®¤ä¸ºfalsespring.jpa.hibernate.ddl-autoï¼ƒæŒ‡å®šDDL mode (none, validate, update, create, create-drop). å½“ä½¿ç”¨å†…åµŒæ•°æ®åº“æ—¶ï¼Œé»˜è®¤æ˜¯create-dropï¼Œå¦åˆ™ä¸ºnone.spring.jpa.hibernate.naming-strategyï¼ƒæŒ‡å®šå‘½åç­–ç•¥.spring.jpa.open-in-viewï¼ƒæ˜¯å¦æ³¨å†ŒOpenEntityManagerInViewInterceptorï¼Œç»‘å®šJPA EntityManageråˆ°è¯·æ±‚çº¿ç¨‹ä¸­ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> truespring.jpa.propertiesï¼ƒæ·»åŠ é¢å¤–çš„å±æ€§åˆ°JPA provider.spring.jpa.show-sqlï¼ƒæ˜¯å¦å¼€å¯sqlçš„logï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> falseï¼ƒjsonspring.jackson.date-formatï¼ƒæŒ‡å®šæ—¥æœŸæ ¼å¼ï¼Œæ¯”å¦‚yyyy-MM-dd HH<span class="token punctuation">:</span>mm<span class="token punctuation">:</span>ssï¼Œæˆ–è€…å…·ä½“çš„æ ¼å¼åŒ–ç±»çš„å…¨é™å®šåspring.jackson.deserializationï¼ƒæ˜¯å¦å¼€å¯Jacksonçš„ååºåˆ—åŒ–spring.jackson.generatorï¼ƒæ˜¯å¦å¼€å¯jsonçš„generators.spring.jackson.joda-date-time-formatï¼ƒæŒ‡å®šJoda date/timeçš„æ ¼å¼ï¼Œæ¯”å¦‚yyyy-MM-dd HH<span class="token punctuation">:</span>mm<span class="token punctuation">:</span>ss). å¦‚æœæ²¡æœ‰é…ç½®çš„è¯ï¼Œdateformatä¼šä½œä¸ºbackupspring.jackson.localeï¼ƒæŒ‡å®šjsonä½¿ç”¨çš„Locale.spring.jackson.mapperï¼ƒæ˜¯å¦å¼€å¯Jacksoné€šç”¨çš„ç‰¹æ€§.spring.jackson.parserï¼ƒæ˜¯å¦å¼€å¯jacksonçš„parserç‰¹æ€§.spring.jackson.property-naming-strategyï¼ƒæŒ‡å®šPropertyNamingStrategy (CAMEL_CASE_TO_LOWER_CASE_WITH_UNDERSCORES)æˆ–è€…æŒ‡å®šPropertyNamingStrategyå­ç±»çš„å…¨é™å®šç±»å.spring.jackson.serializationï¼ƒæ˜¯å¦å¼€å¯jacksonçš„åºåˆ—åŒ–.spring.jackson.serialization-inclusionï¼ƒæŒ‡å®šåºåˆ—åŒ–æ—¶å±æ€§çš„inclusionæ–¹å¼ï¼Œå…·ä½“æŸ¥çœ‹JsonInclude.Includeæšä¸¾.spring.jackson.time-zoneï¼ƒæŒ‡å®šæ—¥æœŸæ ¼å¼åŒ–æ—¶åŒºï¼Œæ¯”å¦‚America/Los_Angelesæˆ–è€…GMT+10.ï¼ƒJTAspring.jta.allow-multiple-lrcï¼ƒæ˜¯å¦å…è®¸ multiple LRCï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> falsespring.jta.asynchronous2-pcï¼ƒæŒ‡å®šä¸¤é˜¶æ®µæäº¤æ˜¯å¦å¯ä»¥å¼‚æ­¥ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> falsespring.jta.background-recovery-intervalï¼ƒæŒ‡å®šå¤šå°‘åˆ†é’Ÿè·‘ä¸€æ¬¡recovery processï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> 1spring.jta.background-recovery-interval-secondsï¼ƒæŒ‡å®šå¤šä¹…è·‘ä¸€æ¬¡recovery processï¼Œé»˜è®¤<span class="token punctuation">:</span> 60spring.jta.current-node-only-recoveryï¼ƒæ˜¯å¦è¿‡æ»¤æ‰å…¶ä»–éæœ¬JVMçš„recoveryï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> truespring.jta.debug-zero-resource-transactionï¼ƒæ˜¯å¦è¿½è¸ªæ²¡æœ‰ä½¿ç”¨æŒ‡å®šèµ„æºçš„äº‹åŠ¡ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> falsespring.jta.default-transaction-timeoutï¼ƒè®¾å®šé»˜è®¤çš„äº‹åŠ¡è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º60spring.jta.disable-jmxï¼ƒæ˜¯å¦ç¦ç”¨jmxï¼Œé»˜è®¤ä¸ºfalsespring.jta.enabledï¼ƒæ˜¯å¦å¼€å¯JTA supportï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> truespring.jta.exception-analyzerï¼ƒè®¾ç½®æŒ‡å®šçš„å¼‚å¸¸åˆ†æç±»spring.jta.filter-log-statusï¼ƒä½¿ç”¨Bitronix Transaction Manageræ—¶ï¼Œæ˜¯å¦å†™mandatory logsï¼Œå¼€å¯çš„è¯ï¼Œå¯ä»¥èŠ‚çœç£ç›˜ç©ºé—´ï¼Œä½†æ˜¯è°ƒè¯•ä¼šå¤æ‚å†™ï¼Œé»˜è®¤ä¸ºfalsespring.jta.force-batching-enabledï¼ƒä½¿ç”¨Bitronix Transaction Manageræ—¶ï¼Œæ˜¯å¦æ‰¹é‡å†™ç£ç›˜ï¼Œé»˜è®¤ä¸ºtrue.spring.jta.forced-write-enabledï¼ƒä½¿ç”¨Bitronix Transaction Manageræ—¶ï¼Œæ˜¯å¦å¼ºåˆ¶å†™æ—¥å¿—åˆ°ç£ç›˜ï¼Œé»˜è®¤ä¸ºtruespring.jta.graceful-shutdown-intervalï¼ƒå½“ä½¿ç”¨Bitronix Transaction Managerï¼ŒæŒ‡å®šshutdownæ—¶ç­‰å¾…äº‹åŠ¡ç»“æŸçš„æ—¶é—´ï¼Œè¶…è¿‡åˆ™ä¸­æ–­ï¼Œé»˜è®¤ä¸º60spring.jta.jndi-transaction-synchronization-registry-nameï¼ƒå½“ä½¿ç”¨Bitronix Transaction Manageræ—¶ï¼Œåœ¨JNDIä¸‹å¾—äº‹åŠ¡åŒæ­¥registryï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> java<span class="token punctuation">:</span>comp/TransactionSynchronizationRegistryspring.jta.jndi-user-transaction-nameï¼ƒæŒ‡å®šåœ¨JNDIä½¿ç”¨Bitronix Transaction Managerçš„åç§°ï¼Œé»˜è®¤<span class="token punctuation">:</span>java<span class="token punctuation">:</span>comp/UserTransactionspring.jta.journalï¼ƒå½“ä½¿ç”¨Bitronix Transaction Managerï¼ŒæŒ‡å®šThe journalæ˜¯å¦diskè¿˜æ˜¯nullè¿˜æ˜¯ä¸€ä¸ªç±»çš„å…¨é™å®šåï¼Œé»˜è®¤diskspring.jta.log-dirï¼ƒTransaction logs directory.spring.jta.log-part1-filenameï¼ƒæŒ‡å®šThe journal fragmentæ–‡ä»¶1çš„åå­—ï¼Œé»˜è®¤<span class="token punctuation">:</span> btm1.tlogspring.jta.log-part2-filenameï¼ƒæŒ‡å®šThe journal fragmentæ–‡ä»¶2çš„åå­—ï¼Œé»˜è®¤<span class="token punctuation">:</span> btm2.tlogspring.jta.max-log-size-in-mbï¼ƒæŒ‡å®šjournal fragmentså¤§å°çš„æœ€å¤§å€¼. é»˜è®¤<span class="token punctuation">:</span> 2Mspring.jta.resource-configuration-filenameï¼ƒæŒ‡å®šBitronix Transaction Manageré…ç½®æ–‡ä»¶å.spring.jta.server-idï¼ƒæŒ‡å®šBitronix Transaction Managerå®ä¾‹çš„id.spring.jta.skip-corrupted-logsï¼ƒæ˜¯å¦å¿½ç•¥corrupted log filesæ–‡ä»¶ï¼Œé»˜è®¤ä¸ºfalse.spring.jta.transaction-manager-idï¼ƒæŒ‡å®šTransaction managerçš„å”¯ä¸€æ ‡è¯†.spring.jta.warn-about-zero-resource-transactionï¼ƒå½“ä½¿ç”¨Bitronix Transaction Manageræ—¶ï¼Œæ˜¯å¦å¯¹æ²¡æœ‰ä½¿ç”¨æŒ‡å®šèµ„æºçš„äº‹åŠ¡è¿›è¡Œè­¦å‘Šï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> trueï¼ƒmailspring.mail.default-encodingï¼ƒæŒ‡å®šé»˜è®¤MimeMessageçš„ç¼–ç ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> UTF-8spring.mail.hostï¼ƒæŒ‡å®šSMTP server host.spring.mail.jndi-nameï¼ƒæŒ‡å®šmailçš„jndiåç§°spring.mail.passwordï¼ƒæŒ‡å®šSMTP serverç™»é™†å¯†ç .spring.mail.portï¼ƒæŒ‡å®šSMTP server port.spring.mail.propertiesï¼ƒæŒ‡å®šJavaMail sessionå±æ€§.spring.mail.protocolï¼ƒæŒ‡å®šSMTP serverä½¿ç”¨çš„åè®®ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> smtpspring.mail.test-connectionï¼ƒæŒ‡å®šæ˜¯å¦åœ¨å¯åŠ¨æ—¶æµ‹è¯•é‚®ä»¶æœåŠ¡å™¨è¿æ¥ï¼Œé»˜è®¤ä¸ºfalsespring.mail.usernameï¼ƒæŒ‡å®šSMTP serverçš„ç”¨æˆ·å.ï¼ƒmobilespring.mobile.devicedelegatingviewresolver.enable-fallbackï¼ƒæ˜¯å¦æ”¯æŒfallbackçš„è§£å†³æ–¹æ¡ˆï¼Œé»˜è®¤falsespring.mobile.devicedelegatingviewresolver.enabledï¼ƒæ˜¯å¦å¼€å§‹device view resolverï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> falsespring.mobile.devicedelegatingviewresolver.mobile-prefixï¼ƒè®¾å®šmobileç«¯è§†å›¾çš„å‰ç¼€ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span>mobile/spring.mobile.devicedelegatingviewresolver.mobile-suffixï¼ƒè®¾å®šmobileè§†å›¾çš„åç¼€spring.mobile.devicedelegatingviewresolver.normal-prefixï¼ƒè®¾å®šæ™®é€šè®¾å¤‡çš„è§†å›¾å‰ç¼€spring.mobile.devicedelegatingviewresolver.normal-suffixï¼ƒè®¾å®šæ™®é€šè®¾å¤‡è§†å›¾çš„åç¼€spring.mobile.devicedelegatingviewresolver.tablet-prefixï¼ƒè®¾å®šå¹³æ¿è®¾å¤‡è§†å›¾å‰ç¼€ï¼Œé»˜è®¤<span class="token punctuation">:</span>tablet/spring.mobile.devicedelegatingviewresolver.tablet-suffixï¼ƒè®¾å®šå¹³æ¿è®¾å¤‡è§†å›¾åç¼€.spring.mobile.sitepreference.enabledï¼ƒæ˜¯å¦å¯ç”¨SitePreferenceHandlerï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> true<span class="token key attr-name">ï¼ƒMONGODBï¼ˆMongoæ€§èƒ½ï¼‰</span> <span class="token value attr-value"> </span><span class="token key attr-name">spring.data.mongodb.host</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒåˆ†è´ä¸»æœº  </span><span class="token key attr-name">spring.data.mongodb.port</span> <span class="token punctuation">=</span> <span class="token value attr-value">27017  ï¼ƒè¿æ¥ç«¯å£ï¼ˆé»˜è®¤ä¸º  27107 ï¼‰  </span><span class="token key attr-name">spring.data.mongodb.uri</span> <span class="token punctuation">=</span> <span class="token value attr-value">ï¼ƒè¿æ¥URL  </span>spring.mongodb.embedded.featuresï¼ƒæŒ‡å®šè¦å¼€å¯çš„ç‰¹æ€§ï¼Œé€—å·åˆ†éš”.spring.mongodb.embedded.versionï¼ƒæŒ‡å®šè¦ä½¿ç”¨çš„ç‰ˆæœ¬ï¼Œé»˜è®¤<span class="token punctuation">:</span> 2.6.10<span class="token key attr-name">ï¼ƒMANAGEMENT</span> <span class="token value attr-value">HTTP SERVERï¼ˆManagementServerPropertiesï¼‰  </span><span class="token key attr-name">management.add-application-context-header</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒåœ¨æ¯ä¸ªå“åº”ä¸­æ·»åŠ â€œX-Application-Contextâ€HTTPæ ‡å¤´ã€‚  </span><span class="token key attr-name">management.address</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒç®¡ç†ç«¯ç‚¹åº”è¯¥ç»‘å®šçš„ç½‘ç»œåœ°å€ã€‚  </span><span class="token key attr-name">management.context-path</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒç®¡ç†ç«¯ç‚¹ä¸Šä¸‹æ–‡è·¯å¾„ã€‚ä¾‹å¦‚`/æ‰§è¡Œå™¨`  </span><span class="token key attr-name">management.port</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒç®¡ç†ç«¯ç‚¹HTTPç«¯å£ã€‚é»˜è®¤ä½¿ç”¨ä¸åº”ç”¨ç¨‹åºç›¸åŒçš„ç«¯å£ã€‚  </span><span class="token key attr-name">management.security.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨</span><span class="token key attr-name">management.security.role</span> <span class="token punctuation">=</span> <span class="token value attr-value">ADMINï¼ƒè®¿é—®ç®¡ç†ç«¯ç‚¹æ‰€éœ€çš„è§’è‰²ã€‚  </span><span class="token key attr-name">management.security.sessions</span> <span class="token value attr-value">ï¼ƒä¼šè¯åˆ›å»ºç­–ç•¥ä½¿ç”¨ï¼ˆalways, never, if_required, statelessï¼‰ã€‚  </span>  <span class="token key attr-name">ï¼ƒHEALTH</span> <span class="token value attr-value">INDICATORSå¥åº·æŒ‡æ ‡ï¼ˆä»¥å‰çš„å¥åº·çŠ¶å†µ*ï¼‰  </span><span class="token key attr-name">management.health.db.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨æ•°æ®åº“è¿è¡ŒçŠ¶å†µæ£€æŸ¥ã€‚  </span><span class="token key attr-name">management.health.defaults.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨é»˜è®¤å¥åº·æŒ‡æ ‡ã€‚  </span><span class="token key attr-name">management.health.diskspace.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨ç£ç›˜ç©ºé—´è¿è¡ŒçŠ¶å†µæ£€æŸ¥ã€‚  </span><span class="token key attr-name">management.health.diskspace.path</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒç”¨äºè®¡ç®—å¯ç”¨ç£ç›˜ç©ºé—´çš„è·¯å¾„ã€‚  </span><span class="token key attr-name">management.health.diskspace.threshold</span> <span class="token punctuation">=</span> <span class="token value attr-value">0ï¼ƒåº”è¯¥å¯ç”¨çš„æœ€å°ç£ç›˜ç©ºé—´ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚  </span><span class="token key attr-name">management.health.elasticsearch.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨elasticsearchè¿è¡ŒçŠ¶å†µæ£€æŸ¥ã€‚  </span><span class="token key attr-name">management.health.elasticsearch.indices</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒé€—å·åˆ†éš”çš„ç´¢å¼•åç§°ã€‚  </span><span class="token key attr-name">management.health.elasticsearch.response-timeout</span> <span class="token punctuation">=</span> <span class="token value attr-value">100ï¼ƒç­‰å¾…ç¾¤é›†å“åº”çš„æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚  </span><span class="token key attr-name">management.health.jms.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨JMSè¿è¡ŒçŠ¶å†µæ£€æŸ¥ã€‚  </span><span class="token key attr-name">management.health.mail.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨é‚®ä»¶è¿è¡ŒçŠ¶å†µæ£€æŸ¥ã€‚  </span><span class="token key attr-name">management.health.mongo.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨MongoDBè¿è¡ŒçŠ¶å†µæ£€æŸ¥ã€‚  </span><span class="token key attr-name">management.health.rabbit.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨RabbitMQå¥åº·æ£€æŸ¥ã€‚  </span><span class="token key attr-name">management.health.redis.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨Redisè¿è¡ŒçŠ¶å†µæ£€æŸ¥ã€‚  </span><span class="token key attr-name">management.health.solr.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨Solrè¿è¡ŒçŠ¶å†µæ£€æŸ¥ã€‚  </span><span class="token key attr-name">management.health.status.order</span> <span class="token value attr-value">ï¼ƒä»¥é€—å·åˆ†éš”çš„å¥åº·çŠ¶æ€åˆ—è¡¨ã€‚  </span><span class="token key attr-name">management.trace.include</span> <span class="token value attr-value">ï¼ƒè¦åŒ…å«åœ¨è·Ÿè¸ªä¸­çš„é¡¹ç›®ã€‚  </span><span class="token key attr-name">ï¼ƒMETRICS</span> <span class="token value attr-value">EXPORTï¼ˆMetricExportPropertiesï¼‰  </span><span class="token key attr-name">spring.metrics.export.aggregate.key-pattern</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒå‘Šè¯‰èšåˆå™¨å¦‚ä½•å¤„ç†æºå­˜å‚¨åº“ä¸­çš„å¯†é’¥çš„æ¨¡å¼ã€‚  </span><span class="token key attr-name">spring.metrics.export.aggregate.prefix</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒå…¨å±€å­˜å‚¨åº“çš„å‰ç¼€ï¼ˆå¦‚æœå¤„äºæ´»åŠ¨çŠ¶æ€ï¼‰ã€‚  </span><span class="token key attr-name">spring.metrics.export.delay-millis</span> <span class="token punctuation">=</span> <span class="token value attr-value">5000ï¼ƒè¾“å‡ºæ»´ç­”ä¹‹é—´çš„å»¶è¿Ÿï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚åº¦é‡æ ‡å‡†æŒ‰ç…§è®¡åˆ’å¯¼å‡ºåˆ°å¤–éƒ¨æºã€‚  </span><span class="token key attr-name">spring.metrics.export.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨metric æ ‡å‡†å¯¼å‡ºçš„æ ‡å¿—ï¼ˆå‡è®¾MetricWriterå¯ç”¨ï¼‰ã€‚  </span><span class="token key attr-name">spring.metrics.export.excludes</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒè¦æ’é™¤çš„metric æ ‡å‡†åç§°çš„æ¨¡å¼åˆ—è¡¨ã€‚åŒ…æ‹¬ååº”ç”¨ã€‚  </span><span class="token key attr-name">spring.metrics.export.includes</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒè¦åŒ…å«çš„metric æ ‡å‡†åç§°çš„æ¨¡å¼åˆ—è¡¨ã€‚  </span><span class="token key attr-name">spring.metrics.export.redis.key</span> <span class="token value attr-value">ï¼ƒRediså­˜å‚¨åº“å¯¼å‡ºå¯†é’¥ï¼ˆå¦‚æœæœ‰æ•ˆï¼‰ã€‚  </span>spring.metrics.export.redis.prefixï¼ƒå¦‚æœå¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œrediså­˜å‚¨åº“çš„å‰ç¼€ã€‚  <span class="token key attr-name">spring.metrics.export.send-latest</span> <span class="token value attr-value">ï¼ƒæ ¹æ®ä¸å¯¼å‡ºä¸å˜çš„metric å€¼çš„æ ‡å¿—å…³é—­æ‰€æœ‰å¯ç”¨çš„ä¼˜åŒ–ã€‚  </span><span class="token key attr-name">spring.metrics.export.statsd.host</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒæ¥æ”¶å¯¼å‡ºmetric çš„statsd serverçš„ä¸»æœºã€‚  </span><span class="token key attr-name">spring.metrics.export.statsd.port</span> <span class="token punctuation">=</span> <span class="token value attr-value">8125ï¼ƒæ¥æ”¶å¯¼å‡ºmetricçš„statsd serverçš„ç«¯å£ã€‚  </span><span class="token key attr-name">spring.metrics.export.statsd.prefix</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒç»Ÿè®¡å¯¼å‡ºmetricçš„å‰ç¼€ã€‚  </span><span class="token key attr-name">spring.metrics.export.triggersã€‚*</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒæ¯ä¸ªMetricWriter beanåç§°çš„ç‰¹å®šè§¦å‘å™¨å±æ€§ã€‚  </span>ï¼ƒmultipartmultipart.enabledï¼ƒæ˜¯å¦å¼€å¯æ–‡ä»¶ä¸Šä¼ æ”¯æŒï¼Œé»˜è®¤ä¸ºtruemultipart.file-size-thresholdï¼ƒè®¾å®šæ–‡ä»¶å†™å…¥ç£ç›˜çš„é˜ˆå€¼ï¼Œå•ä½ä¸ºMBæˆ–KBï¼Œé»˜è®¤ä¸º0multipart.locationï¼ƒæŒ‡å®šæ–‡ä»¶ä¸Šä¼ è·¯å¾„.multipart.max-file-sizeï¼ƒæŒ‡å®šæ–‡ä»¶å¤§å°æœ€å¤§å€¼ï¼Œé»˜è®¤1MBmultipart.max-request-sizeï¼ƒæŒ‡å®šæ¯æ¬¡è¯·æ±‚çš„æœ€å¤§å€¼ï¼Œé»˜è®¤ä¸º10MBï¼ƒmustcachespring.mustache.cacheï¼ƒæ˜¯å¦Enable template caching.spring.mustache.charsetï¼ƒæŒ‡å®šTemplateçš„ç¼–ç .spring.mustache.check-template-locationï¼ƒæ˜¯å¦æ£€æŸ¥é»˜è®¤çš„è·¯å¾„æ˜¯å¦å­˜åœ¨.spring.mustache.content-typeï¼ƒæŒ‡å®šContent-Type.spring.mustache.enabledï¼ƒæ˜¯å¦å¼€å¯mustcacheçš„æ¨¡æ¿æ”¯æŒ.spring.mustache.prefixï¼ƒæŒ‡å®šæ¨¡æ¿çš„å‰ç¼€ï¼Œé»˜è®¤<span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>/templates/spring.mustache.suffixï¼ƒæŒ‡å®šæ¨¡æ¿çš„åç¼€ï¼Œé»˜è®¤<span class="token punctuation">:</span> .htmlspring.mustache.view-namesï¼ƒæŒ‡å®šè¦ä½¿ç”¨æ¨¡æ¿çš„è§†å›¾å.<span class="token key attr-name">ï¼ƒMVCï¼ˆSPRING</span> <span class="token value attr-value">MVCç›¸å…³çš„ä¸€äº›é…ç½®ï¼‰  </span><span class="token key attr-name">http.mappers.json-pretty-print</span> <span class="token punctuation">=</span> <span class="token value attr-value">false  ï¼ƒæ‰“å°JSON  </span><span class="token key attr-name">http.mappers.json-sort-keys</span> <span class="token punctuation">=</span> <span class="token value attr-value">false  ï¼ƒæ’åºé”®  </span><span class="token key attr-name">spring.mvc.locale</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒè®¾ç½®å›ºå®šè¯­è¨€ç¯å¢ƒï¼Œä¾‹å¦‚en_UK  </span><span class="token key attr-name">spring.mvc.date-format</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒè®¾ç½®å›ºå®šçš„æ—¥æœŸæ ¼å¼ï¼Œä¾‹å¦‚dd / MM / yyyy  </span>spring.mvc.async.request-timeout ï¼ƒè®¾å®šasyncè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®çš„è¯ï¼Œä»¥å…·ä½“å®ç°çš„è¶…æ—¶æ—¶é—´ä¸ºå‡†ï¼Œæ¯”å¦‚tomcatçš„servlet3çš„è¯æ˜¯10ç§’.<span class="token key attr-name">spring.mvc.favicon.enabled</span> <span class="token value attr-value">ï¼ƒæ˜¯å¦æ”¯æŒfavicon.icoï¼Œé»˜è®¤ä¸º: true</span><span class="token key attr-name">spring.mvc.ignore-default-model-on-redirect</span> <span class="token value attr-value"> ï¼ƒåœ¨é‡å®šå‘æ—¶æ˜¯å¦å¿½ç•¥é»˜è®¤modelçš„å†…å®¹ï¼Œé»˜è®¤ä¸ºtrue</span>spring.mvc.localeï¼ƒæŒ‡å®šä½¿ç”¨çš„Locale.<span class="token key attr-name">spring.mvc.message-codes-resolver-format</span> <span class="token value attr-value">ï¼ƒæŒ‡å®šmessage codesçš„æ ¼å¼åŒ–ç­–ç•¥(PREFIX_ERROR_CODE,POSTFIX_ERROR_CODE).</span><span class="token key attr-name">spring.view.prefix</span> <span class="token punctuation">=</span>   <span class="token value attr-value">ï¼ƒMVCè§†å›¾å‰ç¼€  </span><span class="token key attr-name">spring.view.suffix</span> <span class="token punctuation">=</span>   <span class="token value attr-value">ï¼ƒ...å’Œåç¼€  </span><span class="token key attr-name">spring.resources.cache-period</span> <span class="token punctuation">=</span>             <span class="token value attr-value">ï¼ƒå‘é€åˆ°æµè§ˆå™¨çš„æ ‡é¢˜ç¼“å­˜è¶…æ—¶  </span><span class="token key attr-name">spring.resources.add-mappings</span> <span class="token punctuation">=</span> <span class="token value attr-value">true         ï¼ƒå¦‚æœ åº”è¯¥æ·»åŠ é»˜è®¤æ˜ å°„   </span>ï¼ƒliquibaseliquibase.change-logï¼ƒChange log é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸ºclasspath<span class="token punctuation">:</span>/db/changelog/db.changelog-master.yamlliquibase.check-change-log-locationï¼ƒæ˜¯å¦åšæŒchange logçš„ä½ç½®æ˜¯å¦å­˜åœ¨ï¼Œé»˜è®¤ä¸ºtrue.liquibase.contextsï¼ƒé€—å·åˆ†éš”çš„è¿è¡Œæ—¶contextåˆ—è¡¨.liquibase.default-schemaï¼ƒé»˜è®¤çš„schema.liquibase.drop-firstï¼ƒæ˜¯å¦é¦–å…ˆdrop schemaï¼Œé»˜è®¤ä¸ºfalseliquibase.enabledï¼ƒæ˜¯å¦å¼€å¯liquibaseï¼Œé»˜è®¤ä¸ºtrue.liquibase.passwordï¼ƒç›®æ ‡æ•°æ®åº“å¯†ç liquibase.urlï¼ƒè¦è¿ç§»çš„JDBC URLï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šçš„è¯ï¼Œå°†ä½¿ç”¨é…ç½®çš„ä¸»æ•°æ®æº.liquibase.userï¼ƒç›®æ ‡æ•°æ®ç”¨æˆ·åï¼ƒloggingæ—¥å¿—<span class="token key attr-name">logging.path</span> <span class="token punctuation">=</span>  <span class="token value attr-value">ï¼ƒæ–‡ä»¶è·¯å¾„</span><span class="token key attr-name">logging.file</span> <span class="token punctuation">=</span> <span class="token value attr-value">myapp.log   ï¼ƒæ–‡ä»¶åç§°</span><span class="token key attr-name">logging.config</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒå¦‚æœä½ å³æƒ³å®Œå…¨æŒæ§æ—¥å¿—é…ç½®ï¼Œä½†åˆä¸æƒ³ç”¨logback.xmlä½œä¸ºLogbacké…ç½®çš„åå­—ï¼Œå¯ä»¥é€šè¿‡logging.configå±æ€§æŒ‡å®šè‡ªå®šä¹‰çš„åå­—</span><span class="token key attr-name">logging.level.root</span><span class="token punctuation">=</span><span class="token value attr-value">INFO  ï¼ƒæ—¥å¿—çº§åˆ«  ä»æ§åˆ¶å°æ‰“å°å‡ºæ¥çš„æ—¥å¿—çº§åˆ«åªæœ‰ERROR, WARN è¿˜æœ‰INFOï¼Œå¦‚æœä½ æƒ³è¦æ‰“å°debugçº§åˆ«çš„æ—¥å¿—ï¼Œå¯ä»¥é…ç½®debug=true</span><span class="token key attr-name">logging.level.org.springframework.web</span><span class="token punctuation">=</span><span class="token value attr-value">DEBUG</span><span class="token key attr-name">logging.level.org.hibernate</span><span class="token punctuation">=</span><span class="token value attr-value">ERROR</span>ï¼ƒrabbitmqspring.rabbitmq.addressesï¼ƒæŒ‡å®šclientè¿æ¥åˆ°çš„serverçš„åœ°å€ï¼Œå¤šä¸ªä»¥é€—å·åˆ†éš”.spring.rabbitmq.dynamicï¼ƒæ˜¯å¦åˆ›å»ºAmqpAdmin bean. é»˜è®¤ä¸º<span class="token punctuation">:</span> true)spring.rabbitmq.hostï¼ƒæŒ‡å®šRabbitMQ host.é»˜è®¤ä¸º<span class="token punctuation">:</span> localhost)spring.rabbitmq.listener.acknowledge-modeï¼ƒæŒ‡å®šAcknowledgeçš„æ¨¡å¼.spring.rabbitmq.listener.auto-startupï¼ƒæ˜¯å¦åœ¨å¯åŠ¨æ—¶å°±å¯åŠ¨mqï¼Œé»˜è®¤<span class="token punctuation">:</span> true)spring.rabbitmq.listener.concurrencyï¼ƒæŒ‡å®šæœ€å°çš„æ¶ˆè´¹è€…æ•°é‡.spring.rabbitmq.listener.max-concurrencyï¼ƒæŒ‡å®šæœ€å¤§çš„æ¶ˆè´¹è€…æ•°é‡.spring.rabbitmq.listener.prefetchï¼ƒæŒ‡å®šä¸€ä¸ªè¯·æ±‚èƒ½å¤„ç†å¤šå°‘ä¸ªæ¶ˆæ¯ï¼Œå¦‚æœæœ‰äº‹åŠ¡çš„è¯ï¼Œå¿…é¡»å¤§äºç­‰äºtransactionæ•°é‡.spring.rabbitmq.listener.transaction-sizeï¼ƒæŒ‡å®šä¸€ä¸ªäº‹åŠ¡å¤„ç†çš„æ¶ˆæ¯æ•°é‡ï¼Œæœ€å¥½æ˜¯å°äºç­‰äºprefetchçš„æ•°é‡.spring.rabbitmq.passwordï¼ƒæŒ‡å®šbrokerçš„å¯†ç .spring.rabbitmq.portï¼ƒæŒ‡å®šRabbitMQ çš„ç«¯å£ï¼Œé»˜è®¤<span class="token punctuation">:</span> 5672)spring.rabbitmq.requested-heartbeatï¼ƒæŒ‡å®šå¿ƒè·³è¶…æ—¶ï¼Œ0ä¸ºä¸æŒ‡å®š.spring.rabbitmq.ssl.enabledï¼ƒæ˜¯å¦å¼€å§‹SSLï¼Œé»˜è®¤<span class="token punctuation">:</span> false)spring.rabbitmq.ssl.key-storeï¼ƒæŒ‡å®šæŒæœ‰SSL certificateçš„key storeçš„è·¯å¾„spring.rabbitmq.ssl.key-store-passwordï¼ƒæŒ‡å®šè®¿é—®key storeçš„å¯†ç .spring.rabbitmq.ssl.trust-storeï¼ƒæŒ‡å®šæŒæœ‰SSL certificatesçš„Trust store.spring.rabbitmq.ssl.trust-store-passwordï¼ƒæŒ‡å®šè®¿é—®trust storeçš„å¯†ç .spring.rabbitmq.usernameï¼ƒæŒ‡å®šç™»é™†brokerçš„ç”¨æˆ·å.spring.rabbitmq.virtual-hostï¼ƒæŒ‡å®šè¿æ¥åˆ°brokerçš„Virtual host.ï¼ƒredisspring.redis.databaseï¼ƒæŒ‡å®šè¿æ¥å·¥å‚ä½¿ç”¨çš„Database indexï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> 0spring.redis.hostï¼ƒæŒ‡å®šRedis server hostï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> localhostspring.redis.passwordï¼ƒæŒ‡å®šRedis serverçš„å¯†ç spring.redis.pool.max-activeï¼ƒæŒ‡å®šè¿æ¥æ± æœ€å¤§çš„æ´»è·ƒè¿æ¥æ•°ï¼Œ-1è¡¨ç¤ºæ— é™ï¼Œé»˜è®¤ä¸º8spring.redis.pool.max-idleï¼ƒæŒ‡å®šè¿æ¥æ± æœ€å¤§çš„ç©ºé—²è¿æ¥æ•°ï¼Œ-1è¡¨ç¤ºæ— é™ï¼Œé»˜è®¤ä¸º8spring.redis.pool.max-waitï¼ƒæŒ‡å®šå½“è¿æ¥æ± è€—å°½æ—¶ï¼Œæ–°è·å–è¿æ¥éœ€è¦ç­‰å¾…çš„æœ€å¤§æ—¶é—´ï¼Œä»¥æ¯«ç§’å•ä½ï¼Œ-1è¡¨ç¤ºæ— é™ç­‰å¾…spring.redis.pool.min-idleï¼ƒæŒ‡å®šè¿æ¥æ± ä¸­ç©ºé—²è¿æ¥çš„æœ€å°æ•°é‡ï¼Œé»˜è®¤ä¸º0spring.redis.portï¼ƒæŒ‡å®šredisæœåŠ¡ç«¯ç«¯å£ï¼Œé»˜è®¤<span class="token punctuation">:</span> 6379spring.redis.sentinel.masterï¼ƒæŒ‡å®šredis serverçš„åç§°spring.redis.sentinel.nodesï¼ƒæŒ‡å®šsentinelèŠ‚ç‚¹ï¼Œé€—å·åˆ†éš”ï¼Œæ ¼å¼ä¸ºhost<span class="token punctuation">:</span>port.spring.redis.timeoutï¼ƒæŒ‡å®šè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œæ¯«ç§’å•ä½ï¼Œé»˜è®¤ä¸º0ï¼ƒresourcespring.resources.add-mappingsï¼ƒæ˜¯å¦å¼€å¯é»˜è®¤çš„èµ„æºå¤„ç†ï¼Œé»˜è®¤ä¸ºtruespring.resources.cache-periodï¼ƒè®¾å®šèµ„æºçš„ç¼“å­˜æ—¶æ•ˆï¼Œä»¥ç§’ä¸ºå•ä½.spring.resources.chain.cacheï¼ƒæ˜¯å¦å¼€å¯ç¼“å­˜ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> truespring.resources.chain.enabledï¼ƒæ˜¯å¦å¼€å¯èµ„æº handling chainï¼Œé»˜è®¤ä¸ºfalsespring.resources.chain.html-application-cacheï¼ƒæ˜¯å¦å¼€å¯h5åº”ç”¨çš„cache manifesté‡å†™ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> falsespring.resources.chain.strategy.content.enabledï¼ƒæ˜¯å¦å¼€å¯å†…å®¹ç‰ˆæœ¬ç­–ç•¥ï¼Œé»˜è®¤ä¸ºfalsespring.resources.chain.strategy.content.pathsï¼ƒæŒ‡å®šè¦åº”ç”¨çš„ç‰ˆæœ¬çš„è·¯å¾„ï¼Œå¤šä¸ªä»¥é€—å·åˆ†éš”ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span>[/**]spring.resources.chain.strategy.fixed.enabledï¼ƒæ˜¯å¦å¼€å¯å›ºå®šçš„ç‰ˆæœ¬ç­–ç•¥ï¼Œé»˜è®¤ä¸ºfalsespring.resources.chain.strategy.fixed.pathsï¼ƒæŒ‡å®šè¦åº”ç”¨ç‰ˆæœ¬ç­–ç•¥çš„è·¯å¾„ï¼Œå¤šä¸ªä»¥é€—å·åˆ†éš”spring.resources.chain.strategy.fixed.versionï¼ƒæŒ‡å®šç‰ˆæœ¬ç­–ç•¥ä½¿ç”¨çš„ç‰ˆæœ¬å·spring.resources.static-locationsï¼ƒæŒ‡å®šé™æ€èµ„æºè·¯å¾„ï¼Œé»˜è®¤ä¸ºclasspath<span class="token punctuation">:</span>[/META-INF/resources/,/resources/, /static/, /public/]ä»¥åŠcontext<span class="token punctuation">:</span>/<span class="token key attr-name">ï¼ƒsecurity</span> <span class="token value attr-value">    spring securityæ˜¯springbootæ”¯æŒçš„æƒé™æ§åˆ¶ç³»ç»Ÿã€‚</span>security.basic.authorize-modeï¼ƒè¦ä½¿ç”¨æƒé™æ§åˆ¶æ¨¡å¼.security.basic.enabledï¼ƒæ˜¯å¦å¼€å¯åŸºæœ¬çš„é‰´æƒï¼Œé»˜è®¤ä¸ºtruesecurity.basic.pathï¼ƒéœ€è¦é‰´æƒçš„pathï¼Œå¤šä¸ªçš„è¯ä»¥é€—å·åˆ†éš”ï¼Œé»˜è®¤ä¸º[/**]security.basic.realmï¼ƒHTTP basic realm çš„åå­—ï¼Œé»˜è®¤ä¸ºSpringsecurity.enable-csrfï¼ƒæ˜¯å¦å¼€å¯cross-site request forgeryæ ¡éªŒï¼Œé»˜è®¤ä¸ºfalse.security.filter-orderï¼ƒSecurity filter chainçš„orderï¼Œé»˜è®¤ä¸º0security.headers.cacheï¼ƒæ˜¯å¦å¼€å¯httpå¤´éƒ¨çš„cacheæ§åˆ¶ï¼Œé»˜è®¤ä¸ºfalse.security.headers.content-typeï¼ƒæ˜¯å¦å¼€å¯X-Content-Type-Optionså¤´éƒ¨ï¼Œé»˜è®¤ä¸ºfalse.security.headers.frameï¼ƒæ˜¯å¦å¼€å¯X-Frame-Optionså¤´éƒ¨ï¼Œé»˜è®¤ä¸ºfalse.security.headers.hstsï¼ƒæŒ‡å®šHTTP Strict Transport Security (HSTS)æ¨¡å¼(none, domain, all).security.headers.xssï¼ƒæ˜¯å¦å¼€å¯cross-site scripting (XSS) ä¿æŠ¤ï¼Œé»˜è®¤ä¸ºfalse.security.ignoredï¼ƒæŒ‡å®šä¸é‰´æƒçš„è·¯å¾„ï¼Œå¤šä¸ªçš„è¯ä»¥é€—å·åˆ†éš”.security.oauth2.client.access-token-uriï¼ƒæŒ‡å®šè·å–access tokençš„URI.security.oauth2.client.access-token-validity-secondsï¼ƒæŒ‡å®šaccess tokenå¤±æ•ˆæ—¶é•¿.security.oauth2.client.additional-information.[key]ï¼ƒè®¾å®šè¦æ·»åŠ çš„é¢å¤–ä¿¡æ¯.security.oauth2.client.authentication-schemeï¼ƒæŒ‡å®šä¼ è¾“ä¸è®°åä»¤ç‰Œ(bearer token)çš„æ–¹å¼(form, header, none,query)ï¼Œé»˜è®¤ä¸ºheadersecurity.oauth2.client.authoritiesï¼ƒæŒ‡å®šæˆäºˆå®¢æˆ·ç«¯çš„æƒé™.security.oauth2.client.authorized-grant-typesï¼ƒæŒ‡å®šå®¢æˆ·ç«¯å…è®¸çš„grant types.security.oauth2.client.auto-approve-scopesï¼ƒå¯¹å®¢æˆ·ç«¯è‡ªåŠ¨æˆæƒçš„scope.security.oauth2.client.client-authentication-schemeï¼ƒä¼ è¾“authentication credentialsçš„æ–¹å¼(form, header, none, query)ï¼Œé»˜è®¤ä¸ºheaderæ–¹å¼security.oauth2.client.client-idï¼ƒæŒ‡å®šOAuth2 client ID.security.oauth2.client.client-secretï¼ƒæŒ‡å®šOAuth2 client secret. é»˜è®¤æ˜¯ä¸€ä¸ªéšæœºçš„secret.security.oauth2.client.grant-typeï¼ƒæŒ‡å®šè·å–èµ„æºçš„access tokençš„æˆæƒç±»å‹.security.oauth2.client.idï¼ƒæŒ‡å®šåº”ç”¨çš„client ID.security.oauth2.client.pre-established-redirect-uriï¼ƒæœåŠ¡ç«¯pre-establishedçš„è·³è½¬URI.security.oauth2.client.refresh-token-validity-secondsï¼ƒæŒ‡å®šrefresh tokençš„æœ‰æ•ˆæœŸ.security.oauth2.client.registered-redirect-uriï¼ƒæŒ‡å®šå®¢æˆ·ç«¯è·³è½¬URIï¼Œå¤šä¸ªä»¥é€—å·åˆ†éš”.security.oauth2.client.resource-idsï¼ƒæŒ‡å®šå®¢æˆ·ç«¯ç›¸å…³çš„èµ„æºidï¼Œå¤šä¸ªä»¥é€—å·åˆ†éš”.security.oauth2.client.scopeï¼ƒclientçš„scopesecurity.oauth2.client.token-nameï¼ƒæŒ‡å®štokençš„åç§°security.oauth2.client.use-current-uriï¼ƒæ˜¯å¦ä¼˜å…ˆä½¿ç”¨è¯·æ±‚ä¸­URIï¼Œå†ä½¿ç”¨pre-establishedçš„è·³è½¬URI. é»˜è®¤ä¸ºtruesecurity.oauth2.client.user-authorization-uriï¼ƒç”¨æˆ·è·³è½¬å»è·å–access tokençš„URI.security.oauth2.resource.idï¼ƒæŒ‡å®šresourceçš„å”¯ä¸€æ ‡è¯†.security.oauth2.resource.jwt.key-uriï¼ƒJWT tokençš„URI. å½“keyä¸ºå…¬é’¥æ—¶ï¼Œæˆ–è€…valueä¸æŒ‡å®šæ—¶æŒ‡å®š.security.oauth2.resource.jwt.key-valueï¼ƒJWT tokenéªŒè¯çš„value. å¯ä»¥æ˜¯å¯¹ç§°åŠ å¯†æˆ–è€…PEMencoded RSAå…¬é’¥. å¯ä»¥ä½¿ç”¨URIä½œä¸ºvalue.security.oauth2.resource.prefer-token-infoï¼ƒæ˜¯å¦ä½¿ç”¨token infoï¼Œé»˜è®¤ä¸ºtruesecurity.oauth2.resource.service-idï¼ƒæŒ‡å®šservice IDï¼Œé»˜è®¤ä¸ºresource.security.oauth2.resource.token-info-uriï¼ƒtokenè§£ç çš„URI.security.oauth2.resource.token-typeï¼ƒæŒ‡å®šå½“ä½¿ç”¨userInfoUriæ—¶ï¼Œå‘é€çš„tokenç±»å‹.security.oauth2.resource.user-info-uriï¼ƒæŒ‡å®šuser infoçš„URIsecurity.oauth2.sso.filter-orderï¼ƒå¦‚æœæ²¡æœ‰æ˜¾ç¤ºæä¾›WebSecurityConfigurerAdapteræ—¶æŒ‡å®šçš„Filter order.security.oauth2.sso.login-pathï¼ƒè·³è½¬åˆ°SSOçš„ç™»å½•è·¯å¾„é»˜è®¤ä¸º/login.security.require-sslï¼ƒæ˜¯å¦å¯¹æ‰€æœ‰è¯·æ±‚å¼€å¯SSLï¼Œé»˜è®¤ä¸ºfalse.security.sessionsï¼ƒæŒ‡å®šSessionçš„åˆ›å»ºç­–ç•¥(always, never, if_required, stateless).security.user.nameï¼ƒæŒ‡å®šé»˜è®¤çš„ç”¨æˆ·åï¼Œé»˜è®¤ä¸ºuser.security.user.passwordï¼ƒé»˜è®¤çš„ç”¨æˆ·å¯†ç .security.user.roleï¼ƒé»˜è®¤ç”¨æˆ·çš„æˆæƒè§’è‰².ï¼ƒsendgridspring.sendgrid.passwordï¼ƒæŒ‡å®šSendGrid password.spring.sendgrid.proxy.hostï¼ƒæŒ‡å®šSendGrid proxy host.spring.sendgrid.proxy.portï¼ƒæŒ‡å®šSendGrid proxy port.spring.sendgrid.usernameï¼ƒæŒ‡å®šSendGrid username.ï¼ƒserveré…ç½®server.addressï¼ƒæŒ‡å®šserverç»‘å®šçš„åœ°å€server.compression.enabledï¼ƒæ˜¯å¦å¼€å¯å‹ç¼©ï¼Œé»˜è®¤ä¸ºfalse.server.compression.excluded-user-agentsï¼ƒæŒ‡å®šä¸å‹ç¼©çš„user-agentï¼Œå¤šä¸ªä»¥é€—å·åˆ†éš”ï¼Œé»˜è®¤å€¼ä¸º<span class="token punctuation">:</span>text/html,text/xml,text/plain,text/cssserver.compression.mime-typesï¼ƒæŒ‡å®šè¦å‹ç¼©çš„MIME typeï¼Œå¤šä¸ªä»¥é€—å·åˆ†éš”.server.compression.min-response-sizeï¼ƒæ‰§è¡Œå‹ç¼©çš„é˜ˆå€¼ï¼Œé»˜è®¤ä¸º2048<span class="token key attr-name">server.context-parameters.[param</span> <span class="token value attr-value">name]ï¼ƒè®¾ç½®servlet context å‚æ•°</span>server.context-pathï¼ƒè®¾å®šåº”ç”¨çš„context-path.server.display-nameï¼ƒè®¾å®šåº”ç”¨çš„å±•ç¤ºåç§°ï¼Œé»˜è®¤<span class="token punctuation">:</span> applicationserver.jsp-servlet.class-nameï¼ƒè®¾å®šç¼–è¯‘JSPç”¨çš„servletï¼Œé»˜è®¤<span class="token punctuation">:</span> org.apache.jasper.servlet.JspServlet)<span class="token key attr-name">server.jsp-servlet.init-parameters.[param</span> <span class="token value attr-value">name]ï¼ƒè®¾ç½®JSP servlet åˆå§‹åŒ–å‚æ•°.</span>server.jsp-servlet.registeredï¼ƒè®¾å®šJSP servletæ˜¯å¦æ³¨å†Œåˆ°å†…åµŒçš„servletå®¹å™¨ï¼Œé»˜è®¤trueserver.portï¼ƒè®¾å®šhttpç›‘å¬ç«¯å£server.servlet-pathï¼ƒè®¾å®šdispatcher servletçš„ç›‘å¬è·¯å¾„ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> /<span class="token key attr-name">ï¼ƒSHELL</span> <span class="token value attr-value">     REMOTE SHELL  </span><span class="token key attr-name">shell.auth</span> <span class="token punctuation">=</span> <span class="token value attr-value">simpleï¼ƒè®¤è¯ç±»å‹ã€‚æ ¹æ®ç¯å¢ƒè‡ªåŠ¨æ£€æµ‹ã€‚  </span><span class="token key attr-name">shell.auth.jaas.domain</span> <span class="token punctuation">=</span><span class="token value attr-value">my-domainï¼ƒJAASåŸŸã€‚  </span><span class="token key attr-name">shell.auth.key.path</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒè®¤è¯å¯†é’¥çš„è·¯å¾„ã€‚è¿™åº”è¯¥æŒ‡å‘ä¸€ä¸ªæœ‰æ•ˆçš„â€œ.pemâ€æ–‡ä»¶ã€‚  </span><span class="token key attr-name">shell.auth.simple.user.name</span> <span class="token punctuation">=</span> <span class="token value attr-value">userï¼ƒç™»å½•ç”¨æˆ·ã€‚  </span><span class="token key attr-name">shell.auth.simple.user.password</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒç™»å½•å¯†ç ã€‚  </span><span class="token key attr-name">shell.auth.spring.roles</span> <span class="token punctuation">=</span> <span class="token value attr-value">ADMINï¼ƒç”¨äºç™»å½•åˆ°CRaSHæ§åˆ¶å°çš„æ‰€éœ€è§’è‰²çš„é€—å·åˆ†éš”åˆ—è¡¨ã€‚  </span><span class="token key attr-name">shell.command-path-patterns</span> <span class="token punctuation">=</span> <span class="token value attr-value">classpath *ï¼š/ commands / **ï¼Œclasspath *ï¼š/ crash / commands / **ï¼ƒç”¨äºæŸ¥æ‰¾å‘½ä»¤çš„æ¨¡å¼ã€‚  </span><span class="token key attr-name">shell.command-refresh-interval</span> <span class="token punctuation">=</span> <span class="token value attr-value">-1ï¼ƒæ‰«ææ›´æ”¹å¹¶åœ¨å¿…è¦æ—¶æ›´æ–°å‘½ä»¤ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚  </span><span class="token key attr-name">shell.config-path-patterns</span> <span class="token punctuation">=</span> <span class="token value attr-value">ï¼ƒç”¨äºæŸ¥æ‰¾é…ç½®çš„æ¨¡å¼ã€‚  </span><span class="token key attr-name">shell.disabled-commands</span> <span class="token value attr-value">ï¼ƒç¦ç”¨å‘½ä»¤çš„é€—å·åˆ†éš”åˆ—è¡¨ã€‚  </span><span class="token key attr-name">shell.disabled-plugins</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒç¦ç”¨é€—å·åˆ†éš”çš„æ’ä»¶åˆ—è¡¨ã€‚æ ¹æ®ç¯å¢ƒï¼ŒæŸäº›æ’ä»¶é»˜è®¤æ˜¯ç¦ç”¨çš„ã€‚  </span><span class="token key attr-name">shell.ssh.auth-timeout</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒç”¨æˆ·æç¤ºé‡æ–°ç™»å½•åçš„æ¯«ç§’æ•°ã€‚  </span><span class="token key attr-name">shell.ssh.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">trueï¼ƒå¯ç”¨CRaSH SSHæ”¯æŒã€‚  </span><span class="token key attr-name">shell.ssh.idle-timeout</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒå…³é—­æœªä½¿ç”¨çš„è¿æ¥ä¹‹åçš„æ¯«ç§’æ•°ã€‚  </span><span class="token key attr-name">shell.ssh.key-path</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒSSHæœåŠ¡å™¨å¯†é’¥çš„è·¯å¾„ã€‚  </span><span class="token key attr-name">shell.ssh.port</span> <span class="token punctuation">=</span> <span class="token value attr-value">2000ï¼ƒSSHç«¯å£ã€‚  </span><span class="token key attr-name">shell.telnet.enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">falseï¼ƒå¯ç”¨CRaSH telnetæ”¯æŒã€‚å¦‚æœTelnetPluginå¯ç”¨ï¼Œåˆ™é»˜è®¤å¯ç”¨ã€‚  </span><span class="token key attr-name">shell.telnet.port</span> <span class="token punctuation">=</span> <span class="token value attr-value">5000ï¼ƒTelnetç«¯å£ã€‚  </span>ï¼ƒsocialspring.social.auto-connection-viewsï¼ƒæ˜¯å¦å¼€å¯è¿æ¥çŠ¶æ€çš„è§†å›¾ï¼Œé»˜è®¤ä¸ºfalsespring.social.facebook.app-idï¼ƒæŒ‡å®šåº”ç”¨idspring.social.facebook.app-secretï¼ƒæŒ‡å®šåº”ç”¨å¯†ç spring.social.linkedin.app-idï¼ƒæŒ‡å®šåº”ç”¨idspring.social.linkedin.app-secretï¼ƒæŒ‡å®šåº”ç”¨å¯†ç spring.social.twitter.app-idï¼ƒæŒ‡å®šåº”ç”¨ID.spring.social.twitter.app-secretï¼ƒæŒ‡å®šåº”ç”¨å¯†ç ï¼ƒsslé…ç½®server.ssl.ciphersï¼ƒæ˜¯å¦æ”¯æŒSSL ciphers.server.ssl.client-authï¼ƒè®¾å®šclient authenticationæ˜¯wanted è¿˜æ˜¯ needed.server.ssl.enabledï¼ƒæ˜¯å¦å¼€å¯sslï¼Œé»˜è®¤<span class="token punctuation">:</span> trueserver.ssl.key-aliasï¼ƒè®¾å®škey storeä¸­keyçš„åˆ«å.server.ssl.key-passwordï¼ƒè®¿é—®key storeä¸­keyçš„å¯†ç .server.ssl.key-storeï¼ƒè®¾å®šæŒæœ‰SSL certificateçš„key storeçš„è·¯å¾„ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ª.jksæ–‡ä»¶.server.ssl.key-store-passwordï¼ƒè®¾å®šè®¿é—®key storeçš„å¯†ç .server.ssl.key-store-providerï¼ƒè®¾å®škey storeçš„æä¾›è€….server.ssl.key-store-typeï¼ƒè®¾å®škey storeçš„ç±»å‹.server.ssl.protocolï¼ƒä½¿ç”¨çš„SSLåè®®ï¼Œé»˜è®¤<span class="token punctuation">:</span> TLSserver.ssl.trust-storeï¼ƒæŒæœ‰SSL certificatesçš„Trust store.server.ssl.trust-store-passwordï¼ƒè®¿é—®trust storeçš„å¯†ç .server.ssl.trust-store-providerï¼ƒè®¾å®štrust storeçš„æä¾›è€….server.ssl.trust-store-typeï¼ƒæŒ‡å®štrust storeçš„ç±»å‹.<span class="token key attr-name">ï¼ƒtomcatæœåŠ¡å™¨é…ç½®ï¼ˆServerPropertiesï¼‰</span> <span class="token value attr-value"> </span><span class="token key attr-name">server.port</span> <span class="token punctuation">=</span> <span class="token value attr-value">8080   ï¼ƒç«¯å£</span><span class="token key attr-name">server.address</span> <span class="token punctuation">=</span>  <span class="token value attr-value">ï¼ƒè¯¥æœåŠ¡ç»‘å®šIPåœ°å€ï¼Œå¯åŠ¨æœåŠ¡å™¨æ—¶å¦‚æœ¬æœºä¸æ˜¯è¯¥IPåœ°å€åˆ™æŠ›å‡ºå¼‚å¸¸å¯åŠ¨å¤±è´¥ï¼Œåªæœ‰ç‰¹æ®Šéœ€æ±‚çš„æƒ…å†µä¸‹æ‰é…ç½®</span><span class="token key attr-name">server.session-timeout</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒä¼šè¯è¶…æ—¶ç§’æ•°  é»˜è®¤30</span><span class="token key attr-name">server.context-path</span> <span class="token punctuation">=</span>   <span class="token value attr-value">ï¼ƒä¸Šä¸‹æ–‡è·¯å¾„ï¼Œé»˜è®¤ä¸º  '/'  </span><span class="token key attr-name">server.servlet-path</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒservletè·¯å¾„ï¼Œé»˜è®¤ä¸º  '/'  </span><span class="token key attr-name">server.tomcat.access-log-pattern</span> <span class="token punctuation">=</span><span class="token value attr-value">ï¼ƒè®¿é—®æ—¥å¿—çš„æ—¥å¿—æ¨¡å¼  </span><span class="token key attr-name">server.tomcat.access-log-enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">false  ï¼ƒå¯ç”¨è®¿é—®æ—¥å¿—è®°å½•  </span><span class="token key attr-name">server.tomcat.protocol-header</span> <span class="token punctuation">=</span> <span class="token value attr-value">x -forwarded-proto ï¼ƒsslè½¬å‘æ ‡å¤´  </span>server.tomcat.accesslog.patternï¼ƒè®¾å®šaccess logsçš„æ ¼å¼ï¼Œé»˜è®¤<span class="token punctuation">:</span> commonserver.tomcat.accesslog.prefixï¼ƒè®¾å®šLog æ–‡ä»¶çš„å‰ç¼€ï¼Œé»˜è®¤<span class="token punctuation">:</span> access_logserver.tomcat.accesslog.suffixï¼ƒè®¾å®šLog æ–‡ä»¶çš„åç¼€ï¼Œé»˜è®¤<span class="token punctuation">:</span> .log<span class="token key attr-name">server.tomcat.background-processor-delay</span> <span class="token punctuation">=</span> <span class="token value attr-value">30 ; ï¼ƒ åå°çº¿ç¨‹æ–¹æ³•çš„Delayå¤§å°: 30</span>server.tomcat.basedirï¼ƒè®¾å®šTomcatçš„base ç›®å½•ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šåˆ™ä½¿ç”¨ä¸´æ—¶ç›®å½•.server.tomcat.internal-proxiesï¼ƒè®¾å®šä¿¡ä»»çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œé»˜è®¤<span class="token punctuation">:</span>â€œ10\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;| 192\.168\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;|<span class="token key attr-name">ï¼ƒ169\.254\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;|</span> <span class="token value attr-value">127\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;| 172\.1[6-9]&#123;1&#125;\.\d&#123;1,3&#125;\ï¼ƒ.\d&#123;1,3&#125;| 172\.2[0-9]&#123;1&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;|172\.3[0-1]&#123;1&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;â€</span>server.tomcat.max-http-header-sizeï¼ƒè®¾å®šhttp headerçš„æœ€å°å€¼ï¼Œé»˜è®¤<span class="token punctuation">:</span> 0server.tomcat.max-threadsï¼ƒè®¾å®štomcatçš„æœ€å¤§å·¥ä½œçº¿ç¨‹æ•°ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> 0server.tomcat.port-headerï¼ƒè®¾å®šhttp headerä½¿ç”¨çš„ï¼Œç”¨æ¥è¦†ç›–åŸæ¥portçš„value.server.tomcat.protocol-headerï¼ƒè®¾å®šHeaderåŒ…å«çš„åè®®ï¼Œé€šå¸¸æ˜¯ X-Forwarded-Protoï¼Œå¦‚æœremoteIpHeaderæœ‰å€¼ï¼Œåˆ™å°†è®¾ç½®ä¸ºRemoteIpValve.server.tomcat.protocol-header-https-valueï¼ƒè®¾å®šä½¿ç”¨SSLçš„headerçš„å€¼ï¼Œé»˜è®¤https.server.tomcat.remote-ip-headerï¼ƒè®¾å®šremote IPçš„headerï¼Œå¦‚æœremoteIpHeaderæœ‰å€¼ï¼Œåˆ™è®¾ç½®ä¸ºRemoteIpValveserver.tomcat.uri-encodingï¼ƒè®¾å®šURIçš„è§£ç å­—ç¬¦é›†.<span class="token key attr-name">ï¼ƒTHYMELEAFï¼ˆThymeleaf</span> <span class="token value attr-value">æ¨¡æ¿ï¼‰  </span><span class="token key attr-name">spring.thymeleaf.prefix</span> <span class="token punctuation">=</span>    <span class="token value attr-value">ï¼ƒç±»è·¯å¾„ï¼š/æ¨¡æ¿/  æ£€æŸ¥æ¨¡æ¿ä½ç½®</span><span class="token key attr-name">spring.thymeleaf.suffix</span> <span class="token value attr-value">=  </span><span class="token key attr-name">spring.thymeleaf.mode</span> <span class="token punctuation">=</span> <span class="token value attr-value">HTML5  ï¼ƒæ¨¡æ¿çš„æ¨¡å¼</span><span class="token key attr-name">spring.thymeleaf.encoding</span> <span class="token punctuation">=</span> <span class="token value attr-value">UTF- 8  </span><span class="token key attr-name">spring.thymeleaf.content-type</span> <span class="token punctuation">=</span> <span class="token value attr-value">text / htmlï¼ƒ; charset = &lt;ç¼–ç >  </span><span class="token key attr-name">spring.thymeleaf.cache</span> <span class="token punctuation">=</span> <span class="token value attr-value">true  ï¼ƒè¿™ä¸ªå¼€å‘é…ç½®ä¸ºfalseï¼Œé¿å…æ”¹äº†æ¨¡æ¿è¿˜è¦é‡å¯æœåŠ¡å™¨ </span>ï¼ƒundertowserver.undertow.access-log-dirï¼ƒè®¾å®šUndertow access log çš„ç›®å½•ï¼Œé»˜è®¤<span class="token punctuation">:</span> logsserver.undertow.access-log-enabledï¼ƒæ˜¯å¦å¼€å¯access logï¼Œé»˜è®¤<span class="token punctuation">:</span> falseserver.undertow.access-log-patternï¼ƒè®¾å®šaccess logsçš„æ ¼å¼ï¼Œé»˜è®¤<span class="token punctuation">:</span> commonserver.undertow.accesslog.dirï¼ƒè®¾å®šaccess log çš„ç›®å½•.server.undertow.buffer-sizeï¼ƒè®¾å®šbufferçš„å¤§å°.server.undertow.buffers-per-regionï¼ƒè®¾å®šæ¯ä¸ªregionçš„bufferæ•°server.undertow.direct-buffersï¼ƒè®¾å®šå †å¤–å†…å­˜server.undertow.io-threadsï¼ƒè®¾å®šI/Oçº¿ç¨‹æ•°.server.undertow.worker-threadsï¼ƒè®¾å®šå·¥ä½œçº¿ç¨‹æ•°ï¼ƒvelocityspring.velocity.allow-request-overrideï¼ƒæŒ‡å®šHttpServletRequestçš„å±æ€§æ˜¯å¦å¯ä»¥è¦†ç›–controllerçš„modelçš„åŒåé¡¹spring.velocity.allow-session-overrideï¼ƒæŒ‡å®šHttpSessionçš„å±æ€§æ˜¯å¦å¯ä»¥è¦†ç›–controllerçš„modelçš„åŒåé¡¹spring.velocity.cacheï¼ƒæ˜¯å¦å¼€å¯æ¨¡æ¿ç¼“å­˜spring.velocity.charsetï¼ƒè®¾å®šæ¨¡æ¿ç¼–ç spring.velocity.check-template-locationï¼ƒæ˜¯å¦æ£€æŸ¥æ¨¡æ¿è·¯å¾„æ˜¯å¦å­˜åœ¨.spring.velocity.content-typeï¼ƒè®¾å®šContentTypeçš„å€¼spring.velocity.date-tool-attributeï¼ƒè®¾å®šæš´éœ²ç»™velocityä¸Šä¸‹æ–‡ä½¿ç”¨çš„DateToolçš„åspring.velocity.enabledï¼ƒè®¾å®šæ˜¯å¦å…è®¸mvcä½¿ç”¨velocityspring.velocity.expose-request-attributesï¼ƒæ˜¯å¦åœ¨mergeæ¨¡æ¿çš„æ—¶å€™ï¼Œå°†requestå±æ€§éƒ½æ·»åŠ åˆ°modelä¸­spring.velocity.expose-session-attributesï¼ƒæ˜¯å¦åœ¨mergeæ¨¡æ¿çš„æ—¶å€™ï¼Œå°†HttpSessionå±æ€§éƒ½æ·»åŠ åˆ°modelä¸­spring.velocity.expose-spring-macro-helpersï¼ƒè®¾å®šæ˜¯å¦ä»¥springMacroRequestContextçš„åæ¥æš´éœ²RequestContextç»™Springâ€™s macroç±»åº“ä½¿ç”¨spring.velocity.number-tool-attributeï¼ƒè®¾å®šæš´éœ²ç»™velocityä¸Šä¸‹æ–‡çš„NumberToolçš„åspring.velocity.prefer-file-system-accessï¼ƒæ˜¯å¦ä¼˜å…ˆä»æ–‡ä»¶ç³»ç»ŸåŠ è½½æ¨¡æ¿ä»¥æ”¯æŒçƒ­åŠ è½½ï¼Œé»˜è®¤ä¸ºtruespring.velocity.prefixï¼ƒè®¾å®švelocityæ¨¡æ¿çš„å‰ç¼€.spring.velocity.propertiesï¼ƒè®¾ç½®velocityçš„é¢å¤–å±æ€§.spring.velocity.request-context-attributeï¼ƒè®¾å®šRequestContext attributeçš„å.spring.velocity.resource-loader-pathï¼ƒè®¾å®šæ¨¡æ¿è·¯å¾„ï¼Œé»˜è®¤ä¸º<span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>/templates/spring.velocity.suffixï¼ƒè®¾å®švelocityæ¨¡æ¿çš„åç¼€.spring.velocity.toolbox-config-locationï¼ƒè®¾å®šVelocity Toolboxé…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œæ¯”å¦‚ /WEB-INF/toolbox.xml.spring.velocity.view-namesï¼ƒè®¾å®šéœ€è¦è§£æçš„è§†å›¾åç§°.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="application-properties"><a href="#application-properties" class="headerlink" title="application.properties"></a>application.properties</h3><p>Â·å„ç§é…ç½®éƒ½æœ‰é»˜è®¤,å¯ä»¥åœ¨resources/application.propertiesä¿®æ”¹,application.propertiesæ–‡ä»¶æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨åˆ›å»º<br>Â·é»˜è®¤é…ç½®æœ€ç»ˆéƒ½æ˜¯æ˜ å°„åˆ°æŸä¸ªç±»ä¸Š,æŠŠå…‰æ ‡æ”¾åœ¨è¯¥å±æ€§,ctrl+bå°±å¯ä»¥å®šä½è¯¥é…ç½®æ˜ å°„åˆ°çš„ç±»</p><h3 id="å¸¸ç”¨é…ç½®ä¸€è§ˆ"><a href="#å¸¸ç”¨é…ç½®ä¸€è§ˆ" class="headerlink" title="å¸¸ç”¨é…ç½®ä¸€è§ˆ"></a>å¸¸ç”¨é…ç½®ä¸€è§ˆ</h3><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token comment">#ç«¯å£å·</span><span class="token key attr-name">server.port</span><span class="token punctuation">=</span><span class="token value attr-value">10000</span><span class="token comment">#åº”ç”¨çš„ä¸Šä¸‹æ–‡è·¯å¾„(é¡¹ç›®è·¯å¾„)</span><span class="token key attr-name">server.servlet.context-path</span><span class="token punctuation">=</span><span class="token value attr-value">/allModel</span><span class="token comment">#æŒ‡å®š POJO æ‰«æåŒ…æ¥è®© mybatis è‡ªåŠ¨æ‰«æåˆ°è‡ªå®šä¹‰çš„ POJO</span><span class="token key attr-name">mybatis.type-aliases-package</span><span class="token punctuation">=</span><span class="token value attr-value">com.cxs.allmodel.model</span><span class="token comment">#æŒ‡å®š mapper.xml çš„è·¯å¾„</span><span class="token comment">#(application ä¸Šé…ç½®äº†@MapperScan(æ‰«é¢ mapper ç±»çš„è·¯å¾„)å’Œ pom.xml ä¸­æ”¾è¡Œäº† mapper.xml åï¼Œ</span><span class="token comment"># é… ç½® mapper-locations æ²¡ æœ‰ æ„ ä¹‰ ã€‚ å¦‚ æœ mapper ç±» å’Œ mapper.xml ä¸ åœ¨ åŒ ä¸€ ä¸ª è·¯ å¾„ ä¸‹ æ—¶ ï¼Œ</span><span class="token key attr-name">mapper-locations</span> <span class="token value attr-value">å°±æœ‰ç”¨äº†)</span><span class="token key attr-name">mybatis.mapper-locations</span><span class="token punctuation">=</span><span class="token value attr-value">classpath:com/cxs/allmodel/mapper</span><span class="token comment">#session å¤±æ•ˆæ—¶é—´(å•ä½ s)</span><span class="token key attr-name">spring.session.timeout</span><span class="token punctuation">=</span><span class="token value attr-value">18000</span><span class="token comment">#æ•°æ®åº“è¿æ¥é…ç½®</span><span class="token comment">#mysql æ•°æ®åº“ url</span><span class="token key attr-name">mysql.one.jdbc-url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://127.0.0.1:3306/test?serverTimezone=Asia/Shanghai&amp;useSSL=false</span><span class="token comment">#mysql æ•°æ®åº“ç”¨æˆ·å</span><span class="token key attr-name">mysql.one.username</span><span class="token punctuation">=</span><span class="token comment">#æ•°æ®åº“å¯†ç </span><span class="token key attr-name">mysql.one.password</span><span class="token punctuation">=</span><span class="token comment">#çº¿ç¨‹æ± å…è®¸çš„æœ€å¤§è¿æ¥æ•°</span><span class="token key attr-name">mysql.one.maximum-pool-size</span><span class="token punctuation">=</span><span class="token value attr-value">15</span><span class="token comment">#æ—¥å¿—æ‰“å°:æ—¥å¿—çº§åˆ« trace&lt;debug&lt;info&lt;warn&lt;error&lt;fatal é»˜è®¤çº§åˆ«ä¸º infoï¼Œå³é»˜è®¤æ‰“å° info åŠå…¶ä»¥</span>ä¸Šçº§åˆ«çš„æ—¥å¿—<span class="token comment">#logging.level è®¾ç½®æ—¥å¿—çº§åˆ«ï¼Œåé¢è·Ÿç”Ÿæ•ˆçš„åŒºåŸŸï¼Œæ¯”å¦‚ root è¡¨ç¤ºæ•´ä¸ªé¡¹ç›®ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸ºæŸä¸ªåŒ…ä¸‹ï¼Œ</span>ä¹Ÿå¯ä»¥å…·ä½“åˆ°æŸä¸ªç±»åï¼ˆæ—¥å¿—çº§åˆ«çš„å€¼ä¸åŒºåˆ†å¤§å°å†™ï¼‰<span class="token key attr-name">logging.level.com.cxs.allmodel.</span><span class="token punctuation">=</span><span class="token value attr-value">debug</span><span class="token key attr-name">logging.level.com.cxs.allmodel.mapper</span><span class="token punctuation">=</span><span class="token value attr-value">debug</span><span class="token key attr-name">logging.level.org.springframework.web</span><span class="token punctuation">=</span><span class="token value attr-value">info</span><span class="token key attr-name">logging.level.org.springframework.transaction</span><span class="token punctuation">=</span><span class="token value attr-value">info</span><span class="token key attr-name">logging.level.org.apache.ibatis</span><span class="token punctuation">=</span><span class="token value attr-value">info</span><span class="token key attr-name">logging.level.org.mybatis</span><span class="token punctuation">=</span><span class="token value attr-value">info</span><span class="token key attr-name">logging.level.com.github.pagehelper</span> <span class="token punctuation">=</span> <span class="token value attr-value">info</span><span class="token key attr-name">logging.level.root</span><span class="token punctuation">=</span><span class="token value attr-value">info</span><span class="token comment">#æ—¥å¿—è¾“å‡ºè·¯å¾„</span><span class="token key attr-name">logging.file</span><span class="token punctuation">=</span><span class="token value attr-value">/tmp/api/allmodel.log</span><span class="token comment">#é…ç½® pagehelper åˆ†é¡µæ’ä»¶</span><span class="token key attr-name">pagehelper.helperDialect</span><span class="token punctuation">=</span><span class="token value attr-value">mysql</span><span class="token key attr-name">pagehelper.reasonable</span><span class="token punctuation">=</span><span class="token value attr-value">true</span><span class="token key attr-name">pagehelper.supportMethodsArguments</span><span class="token punctuation">=</span><span class="token value attr-value">true</span><span class="token key attr-name">pagehelper.params</span><span class="token punctuation">=</span><span class="token value attr-value">count=countSql</span><span class="token comment">#è®¾ç½®ç»Ÿä¸€å­—ç¬¦é›†</span><span class="token key attr-name">spring.http.encoding.charset</span><span class="token punctuation">=</span><span class="token value attr-value">utf8</span><span class="token comment">#redis è¿æ¥é…ç½®</span><span class="token comment"># redis æ‰€åœ¨ä¸»æœº ip åœ°å€</span><span class="token key attr-name">spring.redis.host</span><span class="token punctuation">=</span><span class="token comment">#redis æœåŠ¡å™¨å¯†ç </span><span class="token key attr-name">spring.redis.password</span><span class="token punctuation">=</span><span class="token comment">#redis æœåŠ¡å™¨ç«¯å£å·</span><span class="token key attr-name">spring.redis.port</span><span class="token punctuation">=</span><span class="token comment">#redis æ•°æ®åº“çš„ç´¢å¼•ç¼–å·(0 åˆ° 15)</span><span class="token key attr-name">spring.redis.database</span><span class="token punctuation">=</span><span class="token value attr-value">14</span><span class="token comment">## è¿æ¥æ± çš„æœ€å¤§æ´»åŠ¨è¿æ¥æ•°é‡ï¼Œä½¿ç”¨è´Ÿå€¼æ— é™åˆ¶</span><span class="token comment">#spring.redis.pool.max-active=8</span><span class="token comment">#</span><span class="token comment">## è¿æ¥æ± çš„æœ€å¤§ç©ºé—²è¿æ¥æ•°é‡ï¼Œä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ— é™æ•°é‡çš„ç©ºé—²è¿æ¥</span><span class="token comment">#spring.redis.pool.max-idle=8</span><span class="token comment">#</span><span class="token comment">## è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼Œä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶</span><span class="token comment">#spring.redis.pool.max-wait=-1ms</span><span class="token comment">#</span><span class="token comment">## æœ€å°ç©ºé—²è¿æ¥æ•°é‡ï¼Œä½¿ç”¨æ­£å€¼æ‰æœ‰æ•ˆæœ</span><span class="token comment">#spring.redis.pool.min-idle=0</span><span class="token comment">## æ˜¯å¦å¯ç”¨ SSL è¿æ¥. ##spring.redis.ssl=false</span><span class="token comment">#</span><span class="token comment">## è¿æ¥è¶…æ—¶ï¼Œæ¯«ç§’ä¸ºå•ä½</span><span class="token comment">#spring.redis.timeout= 18000ms</span><span class="token comment">#</span><span class="token comment">## é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œé›†ç¾¤æœ€å¤§è½¬å‘çš„æ•°é‡</span><span class="token comment">#spring.redis.cluster.max-redirects=</span><span class="token comment">#</span><span class="token comment">## é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œé€—å·åˆ†éš”çš„é”®å€¼å¯¹ï¼ˆä¸»æœºï¼šç«¯å£ï¼‰å½¢å¼çš„æœåŠ¡å™¨åˆ—è¡¨</span><span class="token comment">#spring.redis.cluster.nodes=</span><span class="token comment">#</span><span class="token comment">## å“¨å…µæ¨¡å¼ä¸‹ï¼ŒRedis ä¸»æœåŠ¡å™¨åœ°å€</span><span class="token comment">#spring.redis.sentinel.master=</span><span class="token comment">#</span><span class="token comment">## å“¨å…µæ¨¡å¼ä¸‹ï¼Œé€—å·åˆ†éš”çš„é”®å€¼å¯¹ï¼ˆä¸»æœºï¼šç«¯å£ï¼‰å½¢å¼çš„æœåŠ¡å™¨åˆ—è¡¨</span><span class="token comment">#spring.redis.sentinel.nodes= 127.0.0.1:5050,127.0.0.1:5060</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="SpringBootåœ¨å“ªé…ç½®è¯»å–application-properties"><a href="#SpringBootåœ¨å“ªé…ç½®è¯»å–application-properties" class="headerlink" title="SpringBootåœ¨å“ªé…ç½®è¯»å–application.properties"></a>SpringBootåœ¨å“ªé…ç½®è¯»å–application.properties</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_SEARCH_LOCATIONS</span><span class="token operator">=</span><span class="token string">"classpath:/,classpath:/config/"</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token constant">DEFAULT_NAMES</span><span class="token operator">=</span><span class="token string">"application"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Â·å¦‚æœæˆ‘ä»¬æŠŠapplication.propertiesæ”¾åœ¨resource\configç›®å½•ä¸‹,ä¾ç„¶æ˜¯ç®¡ç”¨çš„</p><h4 id="è‡ªåŠ¨è£…é…-éµå®ˆæŒ‰éœ€åŠ è½½åŸåˆ™"><a href="#è‡ªåŠ¨è£…é…-éµå®ˆæŒ‰éœ€åŠ è½½åŸåˆ™" class="headerlink" title="è‡ªåŠ¨è£…é… éµå®ˆæŒ‰éœ€åŠ è½½åŸåˆ™"></a>è‡ªåŠ¨è£…é… éµå®ˆæŒ‰éœ€åŠ è½½åŸåˆ™</h4><p>Â·è‡ªåŠ¨é…ç½®éµå®ˆæŒ‰éœ€åŠ è½½åŸåˆ™,ä¹Ÿå°±æ˜¯è¯´,å¼•å…¥äº†é‚£ä¸ªåœºæ™¯starterå°±ä¼šåŠ è½½è¯¥åœºæ™¯å…³è”çš„jaråŒ…,æ²¡æœ‰å¼•å…¥çš„starteråˆ™ä¸ä¼šåŠ è½½å…¶å…³è”jar</p><h2 id="å®¹å™¨åŠŸèƒ½"><a href="#å®¹å™¨åŠŸèƒ½" class="headerlink" title="å®¹å™¨åŠŸèƒ½"></a>å®¹å™¨åŠŸèƒ½</h2><h3 id="Springæ³¨å…¥ç»„ä»¶çš„æ³¨è§£"><a href="#Springæ³¨å…¥ç»„ä»¶çš„æ³¨è§£" class="headerlink" title="Springæ³¨å…¥ç»„ä»¶çš„æ³¨è§£"></a>Springæ³¨å…¥ç»„ä»¶çš„æ³¨è§£</h3><p>Â·@Component @Controller @Service @Repository<br>Â·è¿™äº›åœ¨Springä¸­çš„ä¼ ç»Ÿæ³¨è§£ä»»ç„¶æœ‰æ•ˆ,é€šè¿‡è¿™äº›æ³¨è§£å¯ä»¥ç»™å®¹å™¨æ³¨å…¥ç»„ä»¶</p><h4 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h4><p>Â·å›é¡¾ä¼ ç»Ÿæ–¹å¼å¦‚ä½•é€šè¿‡é…ç½®æ–‡ä»¶æ³¨å…¥ç»„ä»¶</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster03<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.springboot.bean.Monster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç‰›é­”ç‹~<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5000<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>skill<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>èŠ­è•‰æ‰‡~<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1000<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·ä½¿ç”¨SpringBootçš„@Configurationæ·»åŠ /æ³¨å…¥ç»„ä»¶</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanConfig</span><span class="token punctuation">&#123;</span>  <span class="token annotation punctuation">@Bean</span>  <span class="token keyword">public</span> <span class="token class-name">Monster</span> <span class="token function">monster01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Monster</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"ç‰›é­”ç‹"</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token string">"èŠ­è•‰æ‰‡"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·è§£æ<br>1.@Bean:ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶<br>2.monster01():é»˜è®¤æ–¹æ³•åä½œä¸ºç»„ä»¶çš„id<br>3.Monster:è¿”å›ç±»å‹å°±æ˜¯ç»„ä»¶çš„ç±»å‹<br>4.@Bean(â€œmonster_nmwâ€):é‡æ–°æŒ‡å®šç»„ä»¶çš„id=â€monster_nmwâ€<br>5.é…ç½®ç±»é‡Œé¢ä½¿ç”¨@Beanæ ‡æ³¨åœ¨æ–¹æ³•ä¸Šç»™å®¹å™¨æ³¨å†Œç»„ä»¶,é»˜è®¤æ˜¯å•å®ä¾‹çš„<br>Â·åœ¨debugæ—¶,beanDefinitionMapåªæ˜¯å­˜æ”¾äº†beanå®šä¹‰ä¿¡æ¯,çœŸæ­£å­˜æ”¾Beanå®ä¾‹çš„åœ¨singletonObjectsçš„Mapä¸­,å¯¹äºéå•ä¾‹,æ˜¯<br>æ¯æ¬¡åŠ¨æ€åå°„ç”Ÿæˆçš„å®ä¾‹</p><h4 id="Configurationæ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#Configurationæ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="@Configurationæ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>@Configurationæ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><p>Â·é…ç½®ç±»æœ¬èº«ä¹Ÿæ˜¯ç»„ä»¶,å› æ­¤ä¹Ÿå¯ä»¥è·å–,æµ‹è¯•,ä¿®æ”¹</p><h4 id="SpringBoot2æ–°å¢ç‰¹æ€§-proxyBeanMethodsæŒ‡å®šFullæ¨¡å¼-å’Œ-Liteæ¨¡å¼"><a href="#SpringBoot2æ–°å¢ç‰¹æ€§-proxyBeanMethodsæŒ‡å®šFullæ¨¡å¼-å’Œ-Liteæ¨¡å¼" class="headerlink" title="SpringBoot2æ–°å¢ç‰¹æ€§:proxyBeanMethodsæŒ‡å®šFullæ¨¡å¼ å’Œ Liteæ¨¡å¼"></a>SpringBoot2æ–°å¢ç‰¹æ€§:proxyBeanMethodsæŒ‡å®šFullæ¨¡å¼ å’Œ Liteæ¨¡å¼</h4><p>Â·é€šè¿‡æŸ¥èµ„æ–™æˆ‘çš„æ€»ç»“<br>1.åªæœ‰åœ¨@Configurationå£°æ˜çš„ç±»ä¸­çš„@Beanå£°æ˜çš„æ‰æ˜¯Fullæ¨¡å¼,Fullæ¨¡å¼å¯ä»¥å£°æ˜Beanä¹‹é—´çš„ä¾èµ–å…³ç³»<br>2.ä½•æ—¶ä¸ºLiteæ¨¡å¼<br>Â·ç±»ä¸Šæ ‡æ³¨æœ‰@Componentæ³¨è§£<br>Â·ç±»ä¸Šæ ‡æ³¨æœ‰@ComponentScanæ³¨è§£<br>Â·è‹¥ç±»ä¸Šæ²¡æœ‰ä»»ä½•æ³¨è§£ï¼Œä½†ç±»å†…å­˜åœ¨@Beanæ–¹æ³•<br>Â·ç±»ä¸Šæ ‡æ³¨æœ‰@Importæ³¨è§£<br>Â·ç±»ä¸Šæ ‡æ³¨æœ‰@ImportResourceæ³¨è§£<br>Â·@Configuration(proxyBeanMethods = false)<br>3.Liteæ¨¡å¼çš„@Beanæ–¹æ³•ä¸èƒ½å£°æ˜Beanä¹‹é—´çš„ä¾èµ–å…³ç³»<br>4.Full(proxyBeanMethods = true):ä¿è¯æ¯ä¸ª@Beanæ–¹æ³•è¢«è°ƒç”¨å¤šå°‘æ¬¡è¿”å›çš„ç»„ä»¶éƒ½æ˜¯å•å®ä¾‹çš„,æ˜¯ä»£ç†æ–¹æ³•<br>5.Lite(proxyBeanMethods = false):æ¯ä¸ª@Beanæ–¹æ³•è¢«è°ƒç”¨å¤šå°‘æ¬¡è¿”å›çš„ç»„ä»¶éƒ½æ˜¯æ–°åˆ›å»ºçš„,æ˜¯éä»£ç†æ–¹æ³•<br>6.ç‰¹åˆ«è¯´æ˜:proxyBeanMethodsæ˜¯åœ¨è°ƒç”¨@Beanæ–¹æ³•æ‰ç”Ÿæ•ˆ,å› æ­¤,éœ€è¦å…ˆè·å–BeanConfigç»„ä»¶,åœ¨è°ƒç”¨æ–¹æ³•,è€Œä¸æ˜¯ç›´æ¥é€šè¿‡SpringBoot<br>ä¸»ç¨‹åºå¾—åˆ°çš„å®¹å™¨æ¥è·å–bean,æ³¨æ„ç›´æ¥é€šè¿‡ioc.getBean()è·å–Bean,proxyBeanMethodså€¼å¹¶æ²¡æœ‰ç”Ÿæ•ˆ<br>7.å¦‚ä½•é€‰æ‹©:ç»„ä»¶ä¾èµ–å¿…é¡»ä½¿ç”¨Fullæ¨¡å¼é»˜è®¤,å¦‚æœä¸éœ€è¦ç»„ä»¶ä¾èµ–ä½¿ç”¨Liteæ¨¡å¼<br>8.Liteæ¨¡å¼ä¹Ÿç§°è½»é‡çº§æ¨¡å¼,å› ä¸ºä¸æ£€æµ‹ä¾èµ–å…³ç³»,è¿è¡Œé€Ÿåº¦å—<br>9.proxyBeanMethods = falseé»˜è®¤æ˜¯trueåªæœ‰è®¾ç½®ä¸ºfalseæ—¶æ‰ä¸ºliteæ¨¡å¼</p><h4 id="Importæ³¨è§£"><a href="#Importæ³¨è§£" class="headerlink" title="@Importæ³¨è§£"></a>@Importæ³¨è§£</h4><p>Â·æ¼”ç¤ºåœ¨SpringBoot,å¦‚ä½•é€šè¿‡@Importæ¥æ³¨å…¥ç»„ä»¶</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">//æ³¨æ„@Import æ–¹å¼æ³¨å…¥çš„ç»„ä»¶, é»˜è®¤ç»„ä»¶çš„åå­—å°±æ˜¯å…¨ç±»å</span><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">Dog</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Cat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// @Configuration//æ ‡è¯†è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»: ç­‰ä»· é…ç½®æ–‡ä»¶</span><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"======è·å–@import æ³¨å…¥çš„ç»„ä»¶======"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Dog</span> dog <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">Dog</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é€šè¿‡@import æ³¨å…¥çš„ç»„ä»¶, ç»„ä»¶çš„åå­— å°±æ˜¯ å…¨ç±»å</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> beanNamesForType <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBeanNamesForType</span><span class="token punctuation">(</span><span class="token class-name">Dog</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> s <span class="token operator">:</span> beanNamesForType<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"s= "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">Cat</span> cat <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">Cat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"dog= "</span> <span class="token operator">+</span> dog <span class="token operator">+</span> <span class="token string">" cat= "</span> <span class="token operator">+</span> cat<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·è§£é‡Š@Importæ³¨è§£ç”¨åœ¨é…ç½®ç±»ä¸Š,ç”¨äºå¼•å…¥å…¶ä»–é…ç½®ç±»,å°†å®ƒä»¬çš„é…ç½®åˆå¹¶åˆ°å½“å‰çš„é…ç½®ä¸­ã€‚è¿™å¯¹äºæ¨¡å—åŒ–é…ç½®å’Œç»„ç»‡é…ç½®ç±»éå¸¸æœ‰ç”¨</p><h4 id="Conditional"><a href="#Conditional" class="headerlink" title="@Conditional"></a>@Conditional</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/%7B5656BBDE-21CF-464c-BD48-923DB72322FD%7D.png"></div></div><p>Â·æ¡ä»¶è£…é…,æ»¡è¶³ConditionalæŒ‡å®šçš„æ¡ä»¶,åˆ™è¿›è¡Œç»„ä»¶æ³¨å…¥</p><pre class="line-numbers language-javas" data-language="javas"><code class="language-javas">@ConditionalOnBean(name &#x3D; &quot;monster_nmw&quot;)@Beanpublic Dog dog01() &#123;return new Dog();&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·è§£é‡Š<br>1.è¡¨ç¤ºåªæœ‰å®¹å™¨ä¸­æ³¨å…¥äº†name=monster_nmwçš„ç»„ä»¶,ä¸‹é¢çš„ç»„ä»¶(dog01)æ‰ä¼šè¢«æ³¨å…¥<br>2.@ConditionalOnBean(name = â€œmonster_nmwâ€)ä¹Ÿå¯ä»¥æ”¾åœ¨ç±»åå¤„<br>3.è¡¨ç¤ºå¯¹è¯¥é…ç½®ç±»ä¸­æ‰€æœ‰éƒ½è¦æ³¨å…¥çš„ç»„ä»¶éƒ½è¿›è¡Œæ¡ä»¶çº¦æŸ</p><h4 id="ImportResource"><a href="#ImportResource" class="headerlink" title="@ImportResource"></a>@ImportResource</h4><p>Â·ä½œç”¨:åŸç”Ÿé…ç½®æ–‡ä»¶å¼•å…¥,ä¹Ÿå°±æ˜¯å¯ä»¥ç›´æ¥å¯¼å…¥Springä¼ ç»Ÿçš„beans.xml,å¯ä»¥è®¤ä¸ºæ˜¯SpringBootå¯¹Springå®¹å™¨æ–‡ä»¶çš„å…¼å®¹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ImportResource</span><span class="token punctuation">(</span><span class="token string">"classpath:beans.xml"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="é…ç½®ç»‘å®š"><a href="#é…ç½®ç»‘å®š" class="headerlink" title="é…ç½®ç»‘å®š"></a>é…ç½®ç»‘å®š</h3><p>Â·ä¸€å¥è¯:ä½¿ç”¨Javaè¯»å–åˆ°SpringBootæ ¸å¿ƒé…ç½®æ–‡ä»¶application.propertiesçš„å†…å®¹,å¹¶ä¸”æŠŠå®ƒå°è£…åˆ°JavaBeanä¸­</p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">furn01.id</span><span class="token punctuation">=</span><span class="token value attr-value">100</span><span class="token key attr-name">furn01.name</span><span class="token punctuation">=</span><span class="token value attr-value">soft_chair!!</span><span class="token key attr-name">furn01.price</span><span class="token punctuation">=</span><span class="token value attr-value">45678.9</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javas" data-language="javas"><code class="language-javas">@Component@ConfigurationProperties(prefix&#x3D;&quot;furn01&quot;)public class Furn &#123;private Integer id;private String name;private Double price;public Integer getId() &#123;return id;&#125;public void setId(Integer id) &#123;this.id &#x3D; id;&#125;public String getName() &#123;return name;&#125;public void setName(String name) &#123;this.name &#x3D; name;&#125;public Double getPrice() &#123;return price;&#125;public void setPrice(Double price) &#123;this.price &#x3D; price;&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·è§£æ<br>1.@Componentå°†Furnæ³¨å†Œä¸ºä¸€ä¸ªç»„ä»¶<br>2.@ConfigurationProperties(prefix=â€furn01â€)æŒ‡å®šåœ¨application.propertieså‰ç¼€,è¿™æ ·Furnç»„ä»¶å°±ä¼šå°†å±æ€§æ–‡ä»¶ä¸­<br>çš„å€¼ç»‘å®šäº†ã€‚<br>Â·æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚<br>1.å¦‚æœ application.properties æœ‰ä¸­æ–‡, éœ€è¦è½¬æˆ unicode ç¼–ç å†™å…¥, å¦åˆ™å‡ºç°ä¹±ç </p><h2 id="Lombok"><a href="#Lombok" class="headerlink" title="Lombok"></a>Lombok</h2><h3 id="Lombokä½œç”¨"><a href="#Lombokä½œç”¨" class="headerlink" title="Lombokä½œç”¨"></a>Lombokä½œç”¨</h3><p>Â·ç®€åŒ–JavaBeanå¼€å‘,å¯ä»¥ä½¿ç”¨Lombokçš„æ³¨è§£è®©ä»£ç æ›´åŠ ç®€æ´<br>Â·Javaé¡¹ç›®ä¸­,å¾ˆå¤šæ²¡æœ‰æŠ€æœ¯å«é‡åˆå¿…é¡»å­˜åœ¨çš„ä»£ç :POJOçš„getter/setter/toString,å¼‚å¸¸å¤„ç†,I/Oæµçš„å…³é—­æ“ä½œç­‰ç­‰,è¿™äº›ä»£ç <br>æ—¢æ²¡æœ‰æŠ€æœ¯å«é‡,åˆå½±å“ç€ä»£ç çš„ç¾è§‚</p><h3 id="Lombokå¸¸ç”¨æ³¨è§£"><a href="#Lombokå¸¸ç”¨æ³¨è§£" class="headerlink" title="Lombokå¸¸ç”¨æ³¨è§£"></a>Lombokå¸¸ç”¨æ³¨è§£</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/%7B7037D992-72F3-4491-A36F-6731AB50A9C0%7D.png"></div></div><p>Â·å®ä¾‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ToString</span><span class="token comment">//@Data: lombok æ³¨è§£, ä¼šåœ¨ç¼–è¯‘æ—¶ç”Ÿæˆ setter / getter</span><span class="token annotation punctuation">@Data</span><span class="token comment">//@NoArgsConstructor:lombok æ³¨è§£, ä¼šåœ¨ç¼–è¯‘æ—¶ç”Ÿæˆæ— å‚æ„é€ å™¨</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token comment">//@AllArgsConstructor: lombok æ³¨è§£, ä¼šåœ¨ç¼–è¯‘æ—¶ç”Ÿæˆå…¨å‚æ„é€ å™¨</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"furn01"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Furn</span> <span class="token punctuation">&#123;</span><span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token class-name">Double</span> price<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·Lombokæ”¯æŒæ—¥å¿—è¾“å‡º(å»ºè®®ä½¿ç”¨slf4j)</p><h2 id="Spring-Initailizr"><a href="#Spring-Initailizr" class="headerlink" title="Spring Initailizr"></a>Spring Initailizr</h2><h3 id="Spring-Initailizrä½œç”¨"><a href="#Spring-Initailizrä½œç”¨" class="headerlink" title="Spring Initailizrä½œç”¨"></a>Spring Initailizrä½œç”¨</h3><p>Â·ç¨‹åºå‘˜é€šè¿‡Maven Archetype æ¥ç”ŸæˆMavené¡¹ç›®,é¡¹ç›®åŸå‹ç›¸å¯¹ç®€é™‹,éœ€è¦æ‰‹åŠ¨é…ç½®,æ¯”è¾ƒçµæ´»<br>Â·2. é€šè¿‡ Spring å®˜æ–¹æä¾›çš„ Spring Initializr æ¥æ„å»º Maven é¡¹ç›®ï¼Œèƒ½å®Œç¾æ”¯æŒ IDEA å’Œ Eclipseï¼Œ<br>è®©ç¨‹åºå‘˜æ¥é€‰æ‹©éœ€è¦çš„å¼€å‘åœºæ™¯(starter)ï¼Œè¿˜èƒ½è‡ªåŠ¨ç”Ÿæˆå¯åŠ¨ç±»å’Œå•å…ƒæµ‹è¯•ä»£ç ã€‚</p><h2 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h2><h3 id="yamlä»‹ç»"><a href="#yamlä»‹ç»" class="headerlink" title="yamlä»‹ç»"></a>yamlä»‹ç»</h3><p>Â·åŸºæœ¬è¯´æ˜:<br>1.YAMLä»¥æ•°æ®åšä¸ºä¸­å¿ƒ,è€Œä¸æ˜¯ä»¥æ ‡è®°è¯­è¨€ä¸ºé‡ç‚¹<br>2.YAMLä»ç„¶æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€,ä½†æ˜¯å’Œä¼ ç»Ÿçš„æ ‡è®°è¯­è¨€ä¸ä¸€æ ·,æ˜¯ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„æ ‡è®°è¯­è¨€<br>3.YAMLéå¸¸é€‚åˆç”¨æ¥åšä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„é…ç½®æ–‡ä»¶[springboot:application.yml]</p><h4 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h4><p>Â·å­—é¢é‡:å•ä¸ªçš„,ä¸å¯å†åˆ†çš„å€¼ã€‚data,boolean,string,number,null</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">monsters</span><span class="token punctuation">:</span>  <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">100</span>  <span class="token key atrule">name</span><span class="token punctuation">:</span> ç‰›é­”ç‹  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">500</span>  <span class="token key atrule">isMarried</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">birth</span><span class="token punctuation">:</span> 2000/10/10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·å¯¹è±¡:é”®å€¼å¯¹çš„é›†åˆ,æ¯”å¦‚ map,hash,set,object</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">monsters</span><span class="token punctuation">:</span>  <span class="token key atrule">car</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> å®é©¬    <span class="token key atrule">price</span><span class="token punctuation">:</span> <span class="token number">9999.9</span>  <span class="token key atrule">skill</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> èŠ­è•‰æ‰‡    <span class="token punctuation">-</span> ç‰›é­”æ‹³  <span class="token key atrule">hobby</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> å–é…’<span class="token punctuation">,</span>åƒè‚‰ <span class="token punctuation">]</span>  <span class="token key atrule">wife</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> <span class="token key atrule">key01</span><span class="token punctuation">:</span> ç‰é¢ç‹ç‹¸<span class="token punctuation">,</span><span class="token key atrule">key02</span><span class="token punctuation">:</span> é“æ‰‡å…¬ä¸» <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·æ•°ç»„:ä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å€¼,æ¯”å¦‚array,list,queue</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">hobby</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> æ‰“ç¯®çƒ  <span class="token punctuation">-</span> æ‰“ä¹’ä¹“çƒ  <span class="token punctuation">-</span> è¸¢è¶³<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="yamlåº”ç”¨å®ä¾‹"><a href="#yamlåº”ç”¨å®ä¾‹" class="headerlink" title="yamlåº”ç”¨å®ä¾‹"></a>yamlåº”ç”¨å®ä¾‹</h4><p>Â·@ConfigurationProperties æ³¨è§£å¯ä»¥ç”¨æ¥ç»‘å®š properties æ–‡ä»¶å’Œ YAML æ–‡ä»¶ä¸­çš„æ•°æ®ã€‚<br>è¿™ä¸ªæ³¨è§£ç”¨äºå°†å¤–éƒ¨é…ç½®ç»‘å®šåˆ°ä¸€ä¸ª POJOï¼ˆPlain Old Java Objectï¼‰ä¸Šã€‚æ— è®ºæ˜¯ä½¿ç”¨ .properties æ–‡ä»¶è¿˜æ˜¯ .yaml æ–‡ä»¶ï¼Œ<br>Spring Boot éƒ½æ”¯æŒä½¿ç”¨ @ConfigurationProperties æ³¨è§£æ¥åŠ è½½é…ç½®æ•°æ®ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"monsters"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@ToString</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Monsters</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> isMarried<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Date</span> birth<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Car</span> car<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> skill<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> hobby<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> wife<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Double</span><span class="token punctuation">></span></span> salaries<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Car</span><span class="token punctuation">></span><span class="token punctuation">></span></span> cars<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">monsters</span><span class="token punctuation">:</span>  <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">100</span>  <span class="token key atrule">name</span><span class="token punctuation">:</span> ç‰›é­”ç‹  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">500</span>  <span class="token key atrule">isMarried</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">birth</span><span class="token punctuation">:</span> 2000/10/10  <span class="token key atrule">car</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> å®é©¬    <span class="token key atrule">price</span><span class="token punctuation">:</span> <span class="token number">9999.9</span>  <span class="token key atrule">skill</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> èŠ­è•‰æ‰‡    <span class="token punctuation">-</span> ç‰›é­”æ‹³  <span class="token key atrule">hobby</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> å–é…’<span class="token punctuation">,</span>åƒè‚‰ <span class="token punctuation">]</span>  <span class="token key atrule">wife</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> <span class="token key atrule">key01</span><span class="token punctuation">:</span> ç‰é¢ç‹ç‹¸<span class="token punctuation">,</span><span class="token key atrule">key02</span><span class="token punctuation">:</span> é“æ‰‡å…¬ä¸» <span class="token punctuation">&#125;</span>  <span class="token key atrule">salaries</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> <span class="token number">100.1</span>    <span class="token punctuation">-</span> <span class="token number">200.2</span>  <span class="token key atrule">cars</span><span class="token punctuation">:</span>    <span class="token key atrule">grade01</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token punctuation">&#123;</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ä¿æ—¶æ·<span class="token punctuation">,</span><span class="token key atrule">price</span><span class="token punctuation">:</span> <span class="token number">99999</span> <span class="token punctuation">&#125;</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> æ³•æ‹‰åˆ©        <span class="token key atrule">price</span><span class="token punctuation">:</span> <span class="token number">100101</span>    <span class="token key atrule">grade02</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token punctuation">&#123;</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> å®é©¬<span class="token punctuation">,</span><span class="token key atrule">price</span><span class="token punctuation">:</span> <span class="token number">20000</span> <span class="token punctuation">&#125;</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> å¥¥è¿ª        <span class="token key atrule">price</span><span class="token punctuation">:</span> <span class="token number">1010</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="yamlä½¿ç”¨ç»†èŠ‚"><a href="#yamlä½¿ç”¨ç»†èŠ‚" class="headerlink" title="yamlä½¿ç”¨ç»†èŠ‚"></a>yamlä½¿ç”¨ç»†èŠ‚</h4><p>Â·å¦‚æœapplication.propertieså’Œapplication.ymlæœ‰ç›¸åŒçš„å‰ç¼€å€¼ç»‘å®š,åˆ™application.propertiesä¼˜å…ˆçº§é«˜,å¼€å‘æ—¶,åº”å½“é¿å…<br>Â·å­—ç¬¦ä¸²æ— éœ€åŠ å¼•å·,è¿™ä¸ªå‰é¢å·²ç»ç”¨è¿‡,å¦‚æœç”¨â€â€æˆ–è€…â€™â€™åŒ…èµ·æ¥ä¹Ÿå¯ä»¥<br>Â·è§£å†³yamlé…ç½®æ–‡ä»¶,ä¸æç¤ºå­—æ®µä¿¡æ¯é—®é¢˜<br>1.åœ¨pom.xmlæ–‡ä»¶ä¸­å¼•å…¥</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-configuration-processor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="WEBå¼€å‘-é‡‘æ³°èµ„æºè®¿é—®"><a href="#WEBå¼€å‘-é‡‘æ³°èµ„æºè®¿é—®" class="headerlink" title="WEBå¼€å‘-é‡‘æ³°èµ„æºè®¿é—®"></a>WEBå¼€å‘-é‡‘æ³°èµ„æºè®¿é—®</h2><h3 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>Â·åªè¦é™æ€èµ„æºæ”¾åœ¨ç±»è·¯å¾„ä¸‹:/static,/public,/resourceså¯ä»¥è¢«ç›´æ¥è®¿é—®,å¯¹åº”æ–‡ä»¶WebProperties.java</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">CLASSPATH_RESOURCE_LOCATIONS</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token string">"classpath:/META-INF/resources/"</span><span class="token punctuation">,</span><span class="token string">"classpath:/resources/"</span><span class="token punctuation">,</span> <span class="token string">"classpath:/static/"</span><span class="token punctuation">,</span> <span class="token string">"classpath:/public/"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">/** * Locations of static resources. Defaults to classpath:[/META-INF/resources/, * /resources/, /static/, /public/]. */</span><span class="token keyword">private</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> staticLocations <span class="token operator">=</span> <span class="token constant">CLASSPATH_RESOURCE_LOCATIONS</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·å¸¸è§é™æ€èµ„æº:js,css,å›¾ç‰‡(.jpg,png,.gif,.bmp,.svg)å­—ä½“æ–‡ä»¶(Fonts)ç­‰<br>Â·è®¿é—®æ–¹å¼:é»˜è®¤:é¡¹ç›®æ ¹è·¯å¾„/+é™æ€èµ„æºå,æ¯”å¦‚<a href="http://localhost:8080/hi.jpg">http://localhost:8080/hi.jpg</a></p><h4 id="é™æ€èµ„æºè®¿é—®æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#é™æ€èµ„æºè®¿é—®æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="é™æ€èµ„æºè®¿é—®æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>é™æ€èµ„æºè®¿é—®æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><p>Â·é™æ€èµ„æºè®¿é—®åŸç†:é™æ€æ˜ å°„æ˜¯/<em>*,ä¹Ÿå°±æ˜¯å¯¹æ‰€æœ‰è¯·æ±‚æ‹¦æˆª,è¯·æ±‚è¿›æ¥,å…ˆçœ‹Controllerèƒ½ä¸èƒ½å¤„ç†,ä¸èƒ½å¤„ç†å¾—è¯·æ±‚äº¤ç»™é™æ€èµ„æºå¤„ç†å™¨<br>å¦‚æœé™æ€èµ„æºæ‰¾ä¸åˆ°åˆ™å“åº”404é¡µé¢<br>Â·æ”¹å˜é™æ€èµ„æºè®¿é—®å‰ç¼€ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸Œæœ› <a href="http://localhost:8080/qgq/">http://localhost:8080/qgq/</a></em> å»è¯·æ±‚é™æ€èµ„æº,<br>åº”ç”¨åœºæ™¯ï¼šé™æ€èµ„æºè®¿é—®å‰ç¼€å’Œæ§åˆ¶å™¨è¯·æ±‚è·¯å¾„å†²çª</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">mvc</span><span class="token punctuation">:</span>    <span class="token key atrule">static-path-pattern</span><span class="token punctuation">:</span> /qgq/*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Â·æ”¹å˜é»˜è®¤å¾—é™æ€èµ„æºè·¯å¾„,æ¯”å¦‚å¸Œæœ›åœ¨ç±»è·¯å¾„ä¸‹å¢åŠ qgqingç›®å½•,ä½œä¸ºé™æ€èµ„æºè·¯å¾„</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">mvc</span><span class="token punctuation">:</span>    <span class="token key atrule">static-path-pattern</span><span class="token punctuation">:</span> /qgq/*  <span class="token key atrule">web</span><span class="token punctuation">:</span>    <span class="token key atrule">resources</span><span class="token punctuation">:</span>      <span class="token key atrule">static-locations</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> classpath<span class="token punctuation">:</span>/qgqing/<span class="token punctuation">,</span>classpath<span class="token punctuation">:</span>/public/<span class="token punctuation">,</span>classpath<span class="token punctuation">:</span>/static/ <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·å¦‚æœä½ é…ç½® static-locations, åŸæ¥çš„è®¿é—®è·¯å¾„å°±è¢«è¦†ç›–ï¼Œå¦‚æœéœ€è¦ä¿ç•™ï¼Œä½ å†æŒ‡å®šä¸€ä¸‹å³å¯</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">mvc</span><span class="token punctuation">:</span>    <span class="token key atrule">static-path-pattern</span><span class="token punctuation">:</span> /qgq/*  <span class="token key atrule">web</span><span class="token punctuation">:</span>    <span class="token key atrule">resources</span><span class="token punctuation">:</span>      <span class="token key atrule">static-locations</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">"classpath:/qgqing/"</span><span class="token punctuation">,</span><span class="token string">"classpath:/META-INF/resources/"</span><span class="token punctuation">,</span> <span class="token string">"classpath:/resources/"</span><span class="token punctuation">,</span> <span class="token string">"classpath:/static/"</span><span class="token punctuation">,</span> <span class="token string">"classpath:/public/"</span> <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Rest-åˆ†æ ¼è¯·æ±‚å¤„ç†"><a href="#Rest-åˆ†æ ¼è¯·æ±‚å¤„ç†" class="headerlink" title="Rest åˆ†æ ¼è¯·æ±‚å¤„ç†"></a>Rest åˆ†æ ¼è¯·æ±‚å¤„ç†</h2><h3 id="å›é¡¾ä¸€ä¸‹springMVCçš„Reståˆ†æ ¼è¯·æ±‚å¤„ç†"><a href="#å›é¡¾ä¸€ä¸‹springMVCçš„Reståˆ†æ ¼è¯·æ±‚å¤„ç†" class="headerlink" title="å›é¡¾ä¸€ä¸‹springMVCçš„Reståˆ†æ ¼è¯·æ±‚å¤„ç†"></a>å›é¡¾ä¸€ä¸‹springMVCçš„Reståˆ†æ ¼è¯·æ±‚å¤„ç†</h3><p>Â·éœ€è¦åœ¨web.xmlé‡Œé¢é…ç½®HiddenMethodFilter<br>Â·å°†Postè¯·æ±‚è½¬åŒ–ä¸ºå…¶ä»–çš„è¯·æ±‚<br>Â·çœŸæ­£çš„æ˜¯é€šè¿‡_methodä¼ é€’æ˜¯ä»€ä¹ˆç±»å‹çš„è¯·æ±‚</p><h3 id="åŸºæœ¬ä»‹ç»-1"><a href="#åŸºæœ¬ä»‹ç»-1" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>Â·GET-è·å–æ€ªç‰©<br>Â·DELETE-åˆ é™¤æ€ªç‰©<br>Â·PUT-ä¿®æ”¹æ€ªç‰©<br>Â·POST-ä¿å­˜æ€ªç‰©</p><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MonsterController</span> <span class="token punctuation">&#123;</span><span class="token comment">// @RequestMapping(value = "/monster",method = RequestMethod.GET)</span><span class="token comment">// ç•™ä¸€ä¸ªæ€è€ƒé¢˜: ä¸ºä»€ä¹ˆè¿™é‡Œ return "GET-æŸ¥è¯¢å¦–æ€ª", è¿”å›çš„æ˜¯å­—ç¬¦ä¸², è€Œä¸æ˜¯è½¬å‘åˆ°</span>å¯¹åº”çš„èµ„æºæ–‡ä»¶<span class="token operator">?</span><span class="token comment">// åé¢åœ¨æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚å†è§£ç­”ï¼Œå°ä¼™ä¼´ä»¬å…ˆæ€è€ƒ</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/monster"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMonster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token string">"GET-æŸ¥è¯¢å¦–æ€ª"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// @RequestMapping(value = "/monster",method = RequestMethod.POST)</span><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/monster"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">saveMonster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token string">"POST-æ·»åŠ å¦–æ€ª"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// @RequestMapping(value = "/monster",method = RequestMethod.PUT)</span><span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span><span class="token string">"/monster"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">putMonster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token string">"PUT-ä¿®æ”¹å¦–æ€ª"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"/monster"</span><span class="token punctuation">)</span><span class="token comment">// @RequestMapping(value = "/monster",method = RequestMethod.DELETE)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">deleteMonster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token string">"DELETE-åˆ é™¤å¦–æ€ª"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Reståˆ†æ ¼è¯·æ±‚-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#Reståˆ†æ ¼è¯·æ±‚-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="Reståˆ†æ ¼è¯·æ±‚-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>Reståˆ†æ ¼è¯·æ±‚-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><p>Â·å¦‚æœè¦SpringBootæ”¯æŒé¡µé¢è¡¨å•çš„ReståŠŸèƒ½,åˆ™éœ€è¦æ³¨æ„å¦‚ä¸‹ç»†èŠ‚<br>1.Reståˆ†æ ¼è¯·æ±‚æ ¸å¿ƒFilter:HiddenHttpMethodFilter,è¡¨å•è¯·æ±‚ä¼šè¢«HiddenHttpMethodFilteræ‹¦æˆª,è·å–åˆ°è¡¨å•_method<br>çš„å€¼,å†åˆ¤æ–­æ˜¯PUT/DELETE<br>2.å¦‚æœè¦SpringBootæ”¯æŒé¡µé¢è¡¨å•çš„ReståŠŸèƒ½,éœ€è¦å†application.ymlå¯ç”¨filteråŠŸèƒ½,å¦åˆ™æ— æ•ˆ</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">mvc</span><span class="token punctuation">:</span>    <span class="token comment">#    static-path-pattern: /qgq/*</span>    <span class="token key atrule">hiddenmethod</span><span class="token punctuation">:</span>      <span class="token key atrule">filter</span><span class="token punctuation">:</span>        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#å¼€å¯é¡µé¢è¡¨å•çš„ReståŠŸèƒ½</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javas" data-language="javas"><code class="language-javas">@RestControllerpublic class MonsterController &#123;&#x2F;&#x2F;è§£è¯»ï¼šå› ä¸º@ResController æ˜¯ä¸€ä¸ªå¤åˆæ³¨è§£, å«æœ‰@ResponseBody, æ‰€ä»¥springboot åº•å±‚(springmvc), åœ¨å¤„ç†&#x2F;&#x2F; return &quot;xxx&quot; æ—¶, ä¼šä»¥@ResponseBody æ³¨è§£è¿›è¡Œè§£æå¤„ç†, å³è¿”å›å­—ç¬¦ä¸² &quot;xxx&quot;, è€Œä¸ä¼šä½¿ç”¨è§†å›¾è§£æå™¨æ¥å¤„ç†.&#x2F;&#x2F; å¯ä»¥è¯•ä¸€ä¸‹, å¦‚æœæˆ‘ä»¬æŠŠ @RestController æ”¹æˆ @Controller , å½“ä½ è®¿é—®getMonster() æ—¶, å¦‚æœä½ æœ‰ xxx.html&#x2F;&#x2F; å°±ä¼šè½¬å‘åˆ° xxx.html , å¦‚æœæ²¡æœ‰ xxx.html , å°±ä¼šæŠ¥ 404&#x2F;&#x2F; æç¤º: åœ¨æµ‹è¯•æ—¶, è®² xxx.html æ”¾åœ¨ main\resources\public\xxx.html è¿›è¡Œæµ‹è¯•, å¹¶åœ¨application.yml é…ç½®è§†å›¾è§£æå™¨@GetMapping(&quot;&#x2F;monster&quot;)public String getMonster() &#123;return &quot;GET-æŸ¥è¯¢å¦–æ€ª&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ¥æ”¶å‚æ•°ç›¸å…³æ³¨è§£"><a href="#æ¥æ”¶å‚æ•°ç›¸å…³æ³¨è§£" class="headerlink" title="æ¥æ”¶å‚æ•°ç›¸å…³æ³¨è§£"></a>æ¥æ”¶å‚æ•°ç›¸å…³æ³¨è§£</h2><h3 id="åŸºæœ¬ä»‹ç»-2"><a href="#åŸºæœ¬ä»‹ç»-2" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>Â·SpringBootæ¥æ”¶å®¢æˆ·ç«¯æäº¤æ•°æ®/å‚æ•°ä¼šä½¿ç”¨åˆ°ç›¸å…³æ³¨è§£<br>Â·è¯¦è§£ @PathVariable @RequestHeader @ModelAttribute @RequestParam @MatrixVariable @CookieValue @RequestBody<br>1.@PathVariable</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">/**/monster/&#123;id&#125;/&#123;name&#125;è§£è¯»1.&#123;id&#125;,&#123;name&#125;å°±æ˜¯å ä½å˜é‡2.@PathVariable("name"):è¿™é‡Œçš„nameå’Œ&#123;name&#125;å‘½åä¿æŒä¸€è‡´3.@PathVariable Map&lt;String, String> map æŠŠæ‰€æœ‰ä¼ é€’çš„å€¼ä¼ å…¥ map*/@GetMapping("/monster/&#123;id&#125;/&#123;name&#125;")public String pathVariable(@PathVariable("id") Integer id, @PathVariable("name") String name_, @PathVariable Map&lt;String, String>&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2.@RequestHeader</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/requestHeader"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">requestHeader</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span><span class="token string">"Host"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> host<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestHeader</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> header<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>3.@RequestParam</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hi?name= éŸ© é¡º å¹³ &amp;fruit=apple&amp;fruit=pear<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@RequestParam- è· å– è¯· æ±‚ å‚ æ•°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/hi"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hi</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"fruit"</span><span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> fruit<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> paras<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>4.@CookieValue</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/cookie"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">cookie</span><span class="token punctuation">(</span><span class="token annotation punctuation">@CookieValue</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"cookie_key"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> cookie_value<span class="token punctuation">,</span> <span class="token annotation punctuation">@CookieValue</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"username"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">Cookie</span> cookie<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>@RequestBodyï¼š<br>ç”¨äºå°† HTTP è¯·æ±‚çš„ä¸»ä½“éƒ¨åˆ†æ˜ å°„åˆ°æ–¹æ³•çš„å‚æ•°ä¸Šã€‚<br>ä¸»è¦ç”¨äºæ¥æ”¶ POSTã€PUT ç­‰è¯·æ±‚ä¸­çš„æ•°æ®ã€‚<br>é€šå¸¸ç”¨äºæ¥æ”¶ JSONã€XML æˆ–å…¶ä»–æ ¼å¼çš„æ•°æ®ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º Java å¯¹è±¡ã€‚<br>é€‚ç”¨äºæ§åˆ¶å™¨æ–¹æ³•çš„å‚æ•°ï¼Œä¾‹å¦‚ @PostMapping æˆ– @PutMapping æ³¨è§£çš„æ–¹æ³•ä¸­ã€‚<br>ç”¨äºæ¥æ”¶è¯·æ±‚ä¸»ä½“ä¸­çš„æ•°æ®ã€‚</p><p>@RequestAttributeï¼š<br>ç”¨äºä»è¯·æ±‚å±æ€§ä¸­è·å–æ•°æ®ï¼Œå¹¶æ³¨å…¥åˆ°æ§åˆ¶å™¨æ–¹æ³•çš„å‚æ•°ä¸­ã€‚<br>è¯·æ±‚å±æ€§æ˜¯å­˜å‚¨åœ¨ HttpServletRequest å¯¹è±¡ä¸­çš„æ•°æ®ï¼Œå¯ä»¥åœ¨æ•´ä¸ªè¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­ä¼ é€’ã€‚<br>ä¸»è¦ç”¨äºä»è¯·æ±‚ä¸­è·å–é¢å¤–çš„å…ƒæ•°æ®æˆ–ä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·èº«ä»½éªŒè¯ä¿¡æ¯ã€ä¼šè¯ä¿¡æ¯ç­‰ã€‚<br>é€‚ç”¨äºæ§åˆ¶å™¨æ–¹æ³•çš„å‚æ•°ï¼Œé€šè¿‡æŒ‡å®šè¯·æ±‚å±æ€§çš„åç§°æ¥è·å–æ•°æ®ã€‚<br>ç”¨äºæ¥æ”¶è¯·æ±‚å±æ€§ä¸­çš„æ•°æ®ã€‚</p><h3 id="å¤æ‚å‚æ•°"><a href="#å¤æ‚å‚æ•°" class="headerlink" title="å¤æ‚å‚æ•°"></a>å¤æ‚å‚æ•°</h3><h4 id="åŸºæœ¬ä»‹ç»-3"><a href="#åŸºæœ¬ä»‹ç»-3" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h4><p>Â·å†å¼€å‘ä¸­,SpringBootå†å“åº”å®¢æˆ·ç«¯è¯·æ±‚æ—¶,ä¹Ÿæ”¯æŒå¤æ‚å‚æ•°<br>Â·Mapã€Modelã€Errors/BindingResultã€RedirectAttributesã€ServletResponseã€SessionStatusã€<br>UriComponentsBuilderã€ServletUriComponentsBuilderã€HttpSession<br>Â·Map,Modelæ•°æ®ä¼šè¢«æ”¾åœ¨requeståŸŸ,åº•å±‚request.setAttribute<br>Â·RedirectAttributes é‡å®šå‘æºå¸¦æ•°æ®</p><h4 id="Mapæ¼”ç¤º"><a href="#Mapæ¼”ç¤º" class="headerlink" title="Mapæ¼”ç¤º"></a>Mapæ¼”ç¤º</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/register"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> map<span class="token punctuation">,</span><span class="token class-name">Model</span> model<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"hspedu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"job"</span><span class="token punctuation">,</span> <span class="token string">"java æ¶æ„å¸ˆ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"sal"</span><span class="token punctuation">,</span> <span class="token number">999999.9</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¯ä»¥å°† cookie åŠ å…¥åˆ° response å¯¹è±¡,è¿”å›ç»™å®¢æˆ·ç«¯</span><span class="token class-name">Cookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">"pwd"</span><span class="token punctuation">,</span><span class="token string">"666666"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>response<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token string">"forward:/registerOk"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@ResponseBody</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/registerOk"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">registerOk</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"request åŸŸä¸­ user= "</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"request åŸŸä¸­ job= "</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"job"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"request åŸŸä¸­ sal= "</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"sal"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è§£è¯»:SpringBootä¼šè‡ªåŠ¨å°†Mapå’ŒModelä¸­çš„æ•°æ®æ”¾å…¥requeståŸŸä¸­</p><h3 id="è‡ªå®šä¹‰å¯¹è±¡å‚æ•°-è‡ªåŠ¨å°è£…"><a href="#è‡ªå®šä¹‰å¯¹è±¡å‚æ•°-è‡ªåŠ¨å°è£…" class="headerlink" title="è‡ªå®šä¹‰å¯¹è±¡å‚æ•°-è‡ªåŠ¨å°è£…"></a>è‡ªå®šä¹‰å¯¹è±¡å‚æ•°-è‡ªåŠ¨å°è£…</h3><p>Â·å†å¼€å‘ä¸­,SpringBootå†å“åº”å®¢æˆ·ç«¯è¯·æ±‚æ—¶,ä¹Ÿæ”¯æŒè‡ªå®šä¹‰å¯¹è±¡å‚æ•°<br>Â·å®Œæˆè‡ªåŠ¨ç±»å‹è½¬æ¢ä¸æ ¼å¼åŒ–<br>Â·æ”¯æŒçº§è”å°è£…</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>æ·»åŠ å¦–æ€ª<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>æ·»åŠ å¦–æ€ª-åéª‘[æµ‹è¯•å°è£… POJOï¼›]<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/savemonster<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    ç¼–å·ï¼š <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>    å§“åï¼š <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç‰›é­”ç‹<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>    å¹´é¾„ï¼š <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>120<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>    å©šå¦ï¼š <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>isMarried<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>    ç”Ÿæ—¥ï¼š <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>birth<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2000/11/11<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>    åéª‘ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>car.name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>æ³•æ‹‰åˆ©<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>    ä»·æ ¼ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>car.price<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>99999.9<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ä¿å­˜<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ToString</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">&#123;</span><span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token class-name">Double</span> price<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@ToString</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Monster</span> <span class="token punctuation">&#123;</span><span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token class-name">Boolean</span> isMarried<span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token class-name">Date</span> birth<span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token class-name">Car</span> car<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/savemonster"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">saveMonster</span><span class="token punctuation">(</span><span class="token class-name">Monster</span> monster<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"monster= "</span> <span class="token operator">+</span> monster<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è‡ªå®šä¹‰è½¬æ¢å™¨"><a href="#è‡ªå®šä¹‰è½¬æ¢å™¨" class="headerlink" title="è‡ªå®šä¹‰è½¬æ¢å™¨"></a>è‡ªå®šä¹‰è½¬æ¢å™¨</h2><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/9010e4959aa58a09c84a32eccf8f7e63.png"></div></div><h3 id="åŸºæœ¬ä»‹ç»-4"><a href="#åŸºæœ¬ä»‹ç»-4" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>Â·SpringBootå†å“åº”å®¢æˆ·ç«¯è¯·æ±‚æ—¶,å°†æäº¤çš„æ•°æ®å°è£…ç§°å¯¹è±¡æ—¶,ä½¿ç”¨äº†å†…ç½®çš„è½¬æ¢å™¨<br>Â·ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è½¬æ¢å™¨<br>Â·å®ä¾‹</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--åéª‘ï¼š&lt;input name="car.name" value="æ³•æ‹‰åˆ©"/>&lt;br/>--></span><span class="token comment">&lt;!--ä»·æ ¼ï¼š&lt;input name="car.price" value="99999.9"/>--></span><span class="token comment">&lt;!-- ä½¿ç”¨è‡ªå®šä¹‰è½¬æ¢å™¨å…³è” car, å­—ç¬¦ä¸²æ•´ä½“æäº¤ --></span>åéª‘: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>car<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ä¿æ—¶æ·,66666.6<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token function">webMvcConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//æ³¨å†Œå“Ÿä¸ªString->car,ä½¿ç”¨åå°„+æ³¨è§£+io+åŠ¨æ€ä»£ç†,å°†è¯¥è½¬æ¢å™¨æ³¨å†Œåˆ°è½¬æ¢å™¨çš„å®¹å™¨ä¸­</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addFormatters</span><span class="token punctuation">(</span><span class="token class-name">FormatterRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                registry<span class="token punctuation">.</span><span class="token function">addConverter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Car</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token annotation punctuation">@Override</span>                    <span class="token keyword">public</span> <span class="token class-name">Car</span> <span class="token function">convert</span><span class="token punctuation">(</span><span class="token class-name">String</span> source<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                            <span class="token class-name">Car</span> car <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            car<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            car<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">return</span> car                        <span class="token punctuation">&#125;</span>                        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">addFormatters</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¤„ç†JSON"><a href="#å¤„ç†JSON" class="headerlink" title="å¤„ç†JSON"></a>å¤„ç†JSON</h2><h3 id="éœ€æ±‚-è¿”å›JSONæ ¼å¼æ•°æ®"><a href="#éœ€æ±‚-è¿”å›JSONæ ¼å¼æ•°æ®" class="headerlink" title="éœ€æ±‚:è¿”å›JSONæ ¼å¼æ•°æ®"></a>éœ€æ±‚:è¿”å›JSONæ ¼å¼æ•°æ®</h3><p>Â·SpringBootæ”¯æŒè¿”å›JSONæ ¼å¼æ•°æ®,åœ¨å¯ç”¨WEBå¼€å‘åœºæ™¯æ—¶,å·²ç»å¼•å…¥äº†ç›¸å…³ä¾èµ–</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·æ³¨è§£:@ResponseBody:è¿”å›JSONæ ¼å¼çš„æ•°æ®</p><h2 id="å†…å®¹åå•†"><a href="#å†…å®¹åå•†" class="headerlink" title="å†…å®¹åå•†"></a>å†…å®¹åå•†</h2><h3 id="åŸºæœ¬ä»‹ç»-5"><a href="#åŸºæœ¬ä»‹ç»-5" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>Â·æ ¹æ®å®¢æˆ·ç«¯æ¥æ”¶èƒ½åŠ›ä¸åŒ,SpringBootè¿”å›ä¸åŒåª’ä½“ç±»å‹çš„æ•°æ®<br>Â·æ¯”å¦‚:å®¢æˆ·ç«¯Httpè¯·æ±‚Accept:application/xmlåˆ™è¿”å›xmlæ•°æ® å®¢æˆ·ç«¯Httpè¯·æ±‚Accept:application/jsonåˆ™è¿”å›jsonæ•°æ®</p><h3 id="åº”ç”¨å®ä¾‹"><a href="#åº”ç”¨å®ä¾‹" class="headerlink" title="åº”ç”¨å®ä¾‹"></a>åº”ç”¨å®ä¾‹</h3><p>Â· ä½¿ç”¨Postmanå‘é€æ–¹Httpè¯·æ±‚,æ ¹æ®è¯·æ±‚å¤´ä¸åŒ,è¿”å›å¯¹åº”çš„jsonæ•°æ®,æˆ–è€…xmlæ•°æ®<br>Â· åœ¨pom.xmlå¢åŠ å¤„ç†xmlçš„ä¾èµ–</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.fasterxml.jackson.dataformat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jackson-dataformat-xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><p>Â·Postmanå¯ä»¥é€šè¿‡ä¿®æ”¹Acceptçš„å€¼,æ¥è¿”å›ä¸åŒçš„æ•°æ®æ ¼å¼<br>Â·å¯¹äºæµè§ˆå™¨,æˆ‘ä»¬æ— æ³•ä¿®æ”¹å…¶Acceptçš„å€¼,æ€ä¹ˆåŠ?è§£å†³æ–¹æ¡ˆ:å¼€å¯æ”¯æŒåŸºäºè¯·æ±‚å‚æ•°çš„å†…å®¹åå•†åŠŸèƒ½<br>Â·ä¿®æ”¹ application.yml, å¼€å¯åŸºäºè¯·æ±‚å‚æ•°çš„å†…å®¹åå•†åŠŸèƒ½</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">contentnegotiation</span><span class="token punctuation">:</span>  <span class="token key atrule">favor-parameter</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment">#å¼€å¯åŸºäºè¯·æ±‚å‚æ•°çš„å†…å®¹åå•†åŠŸèƒ½</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Â·ç„¶ååœ¨è¯·æ±‚çš„urlåœ°å€ä¸ŠåŠ å…¥å‚æ•°format=json/xml<br>Â·æ³¨æ„,å‚æ•°formatæ˜¯è§„å®šå¥½çš„,åœ¨å¼€å»è¯·æ±‚å‚æ•°çš„å†…å®¹åå•†åŠŸèƒ½å,SpringBootåº•å±‚ä¼šé€šè¿‡formatæ¥æ¥æ”¶å‚æ•°,ç„¶åè¿”å›å¯¹äºçš„åª’ä½“ç±»å‹</p><h2 id="Thymeleaf"><a href="#Thymeleaf" class="headerlink" title="Thymeleaf"></a>Thymeleaf</h2><h3 id="åŸºæœ¬ä»‹ç»-6"><a href="#åŸºæœ¬ä»‹ç»-6" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>Â·Thymeleaf æ˜¯ä¸€ä¸ªè·Ÿ Velocityã€FreeMarker ç±»ä¼¼çš„æ¨¡æ¿å¼•æ“ï¼Œå¯å®Œå…¨æ›¿ä»£ JSP<br>Â·Thymeleaf æ˜¯ä¸€ä¸ª java ç±»åº“ï¼Œä»–æ˜¯ä¸€ä¸ª xml/xhtml/html5 çš„æ¨¡æ¿å¼•æ“ï¼Œå¯ä»¥ä½œä¸º mvc çš„ web åº”ç”¨çš„ view å±‚<br>Â·å› æ­¤ä½¿ç”¨äº† Thymeleaf , å¹¶ä¸æ˜¯å‰åç«¯åˆ†ç¦»</p><h3 id="thå±æ€§"><a href="#thå±æ€§" class="headerlink" title="thå±æ€§"></a>thå±æ€§</h3><p>â— th:text ï¼šè®¾ç½®å½“å‰å…ƒç´ çš„æ–‡æœ¬å†…å®¹ï¼Œç›¸åŒåŠŸèƒ½çš„è¿˜æœ‰ th:utextï¼Œä¸¤è€…çš„åŒºåˆ«åœ¨äºå‰<br>è€…ä¸ä¼šè½¬ä¹‰ html æ ‡ç­¾ï¼Œåè€…ä¼šã€‚ä¼˜å…ˆçº§ä¸é«˜ï¼šorder=7<br>â— th:valueï¼šè®¾ç½®å½“å‰å…ƒç´ çš„ value å€¼ï¼Œç±»ä¼¼ä¿®æ”¹æŒ‡å®šå±æ€§çš„è¿˜æœ‰ th:srcï¼Œth:hrefã€‚ä¼˜å…ˆ<br>çº§ä¸é«˜ï¼šorder=6<br>â— th:eachï¼šéå†å¾ªç¯å…ƒç´ ï¼Œå’Œ th:text æˆ– th:value ä¸€èµ·ä½¿ç”¨ã€‚æ³¨æ„è¯¥å±æ€§ä¿®é¥°çš„æ ‡ç­¾ä½<br>ç½®ï¼Œè¯¦ç»†å¾€åçœ‹ã€‚ä¼˜å…ˆçº§å¾ˆé«˜ï¼šorder=2<br>â— th:ifï¼šæ¡ä»¶åˆ¤æ–­ï¼Œç±»ä¼¼çš„è¿˜æœ‰ th:unlessï¼Œth:switchï¼Œth:caseã€‚ä¼˜å…ˆçº§è¾ƒé«˜ï¼šorder=3<br>â— th:insertï¼šä»£ç å—å¼•å…¥ï¼Œç±»ä¼¼çš„è¿˜æœ‰ th:replaceï¼Œth:includeï¼Œä¸‰è€…çš„åŒºåˆ«è¾ƒå¤§ï¼Œè‹¥ä½¿<br>ç”¨ä¸æ°å½“ä¼šç ´å html ç»“æ„ï¼Œå¸¸ç”¨äºå…¬å…±ä»£ç å—æå–çš„åœºæ™¯ã€‚ä¼˜å…ˆçº§æœ€é«˜ï¼šorder=1<br>â— th:fragmentï¼šå®šä¹‰ä»£ç å—ï¼Œæ–¹ä¾¿è¢« th:insert å¼•ç”¨ã€‚ä¼˜å…ˆçº§æœ€ä½ï¼šorder=8<br>â— th:objectï¼šå£°æ˜å˜é‡ï¼Œä¸€èˆ¬å’Œ*{}ä¸€èµ·é…åˆä½¿ç”¨ï¼Œè¾¾åˆ°å·æ‡’çš„æ•ˆæœã€‚ä¼˜å…ˆçº§ä¸€èˆ¬ï¼šorder=4<br>â— th:attrï¼šä¿®æ”¹ä»»æ„å±æ€§ï¼Œå®é™…å¼€å‘ä¸­ç”¨çš„è¾ƒå°‘ï¼Œå› ä¸ºæœ‰ä¸°å¯Œçš„å…¶ä»– th å±æ€§å¸®å¿™ï¼Œç±»<br>ä¼¼çš„è¿˜æœ‰ th:attrappendï¼Œth:attrprependã€‚ä¼˜å…ˆçº§ä¸€èˆ¬ï¼šorder=5</p><h2 id="æ‹¦æˆªå™¨-HandlerInterceptor"><a href="#æ‹¦æˆªå™¨-HandlerInterceptor" class="headerlink" title="æ‹¦æˆªå™¨-HandlerInterceptor"></a>æ‹¦æˆªå™¨-HandlerInterceptor</h2><h3 id="åŸºæœ¬ä»‹ç»-7"><a href="#åŸºæœ¬ä»‹ç»-7" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>Â·åœ¨Spring Booté¡¹ç›®ä¸­,æ‹¦æˆªå™¨æ˜¯å¼€å‘ä¸­å¸¸ç”¨æ‰‹æ®µ,è¦æ¥åšç™»å½•éªŒè¯,æ€§èƒ½æ£€æŸ¥,æ—¥å¿—è®°å½•ç­‰<br>Â·åŸºæœ¬æ­¥éª¤<br>1.ç¼–å†™ä¸€ä¸ªæ‹¦æˆªå™¨å®ç°HandlerInterceptoræ¥å£<br>2.æ‹¦æˆªå™¨æ³¨å†Œåˆ°é…ç½®ç±»ä¸­(å®ç°WebMvcConfigureçš„addInterceptors)<br>3.æŒ‡å®šæ‹¦æˆªè§„åˆ™</p><h3 id="æ‹¦æˆªå™¨åº”ç”¨å®ä¾‹"><a href="#æ‹¦æˆªå™¨åº”ç”¨å®ä¾‹" class="headerlink" title="æ‹¦æˆªå™¨åº”ç”¨å®ä¾‹"></a>æ‹¦æˆªå™¨åº”ç”¨å®ä¾‹</h3><p>Â·ä½¿ç”¨æ‹¦æˆªå™¨é˜²æ­¢ç”¨æˆ·éæ³•ç™»å½•,ä½¿ç”¨æ‹¦æˆªå™¨å°±ä¸éœ€è¦åœ¨æ¯ä¸ªæ–¹æ³•éªŒè¯äº†</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ä¸ºäº†çœ‹åˆ°è®¿é—®çš„uriï¼Œå°†å…¶è¾“å‡º</span>        <span class="token class-name">String</span> requestURI <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"preHandleæ‹¦æˆªåˆ°çš„è¯·æ±‚çš„URI=&#123;&#125;"</span><span class="token punctuation">,</span>requestURI<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¿›è¡Œç™»å½•æ ¡éªŒ</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> loginAdmin <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"loginAdmin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">!=</span>loginAdmin<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//è¯´æ˜è¯¥ç”¨æˆ·å·²ç»æˆåŠŸç™»å½•è¿‡äº†</span>            <span class="token comment">//æ”¾è¡Œ</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//æ‹¦æˆª,ä»æ–°è¿”å›åˆ°ç™»å½•é¡µé¢</span>        request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span><span class="token string">"ä½ æ²¡æœ‰ç™»å½•/è¯·é‡æ–°ç™»å½•~~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">ModelAndView</span> modelAndView<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"postHandleæ‰§è¡Œäº†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"afterCompletionæ‰§è¡ŒåŠ›"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token function">webMvcConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"addInterceptors~~~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//æ³¨å†Œæ‹¦æˆªå™¨</span>                registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoginInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span><span class="token string">"/login"</span><span class="token punctuation">,</span><span class="token string">"/images/**"</span><span class="token punctuation">,</span><span class="token string">"/upload.html"</span><span class="token punctuation">,</span><span class="token string">"/upload"</span><span class="token punctuation">,</span><span class="token string">"/sql"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åæ€"><a href="#åæ€" class="headerlink" title="åæ€"></a>åæ€</h3><p>Spring Boot ä¸­çš„æ‹¦æˆªå™¨ï¼š<br>åœ¨ Spring Boot ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ HandlerInterceptor æ¥å£æ¥å®šä¹‰æ‹¦æˆªå™¨ã€‚<br>é€šå¸¸ï¼Œä½ ä¼šå°†æ‹¦æˆªå™¨å®šä¹‰ä¸ºä¸€ä¸ª Beanï¼Œå¹¶åœ¨é…ç½®ç±»ä¸­æ³¨å†Œå®ƒä»¬ã€‚<br>åœ¨é…ç½®ç±»ä¸­ä½¿ç”¨ addInterceptor() æ–¹æ³•å°†æ‹¦æˆªå™¨æ·»åŠ åˆ° WebMvcConfigurer ä¸­ã€‚<br>Spring Boot ä¼šè‡ªåŠ¨é…ç½® Spring MVCï¼Œå› æ­¤æ‹¦æˆªå™¨å¯ä»¥ç›´æ¥ç”Ÿæ•ˆã€‚</p><p>Spring MVC ä¸­çš„æ‹¦æˆªå™¨ï¼š<br>åœ¨ä¼ ç»Ÿçš„ Spring MVC ä¸­ï¼Œæ‹¦æˆªå™¨åŒæ ·ä½¿ç”¨ HandlerInterceptor æ¥å£æ¥å®šä¹‰ã€‚<br>ä½ éœ€è¦åœ¨ Spring MVC çš„é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ XML æ–‡ä»¶ï¼‰ä¸­é…ç½®æ‹¦æˆªå™¨ã€‚<br>åœ¨ XML é…ç½®ä¸­ï¼Œä½ éœ€è¦ä½¿ç”¨ <mvc:interceptors> å…ƒç´ æ¥å£°æ˜æ‹¦æˆªå™¨ï¼Œå¹¶æŒ‡å®šæ‹¦æˆªå™¨çš„ä½ç½®å’Œé¡ºåºã€‚</mvc:interceptors></p><h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><p><a href="https://100qin10086.github.io/posts/73d27226.html">å¼•ç”¨æ–‡ç« </a></p><h3 id="ç†è§£"><a href="#ç†è§£" class="headerlink" title="ç†è§£"></a>ç†è§£</h3><p>Â·æœ€é‡è¦çš„ä¸€æ­¥:<br>MultipartFile header.transferTo(new File(â€œxxxâ€));<br>Â·ä¿®æ”¹æ–‡ä»¶ä¸Šä¼ é…ç½®å‚æ•°</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>    <span class="token key atrule">multipart</span><span class="token punctuation">:</span>      <span class="token key atrule">max-file-size</span><span class="token punctuation">:</span> 5MB      <span class="token key atrule">max-request-size</span><span class="token punctuation">:</span> 50MB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·è§£å†³æ–‡ä»¶è¦†ç›–é—®é¢˜, å¦‚æœæ–‡ä»¶åç›¸åŒ, ä¼šå‡ºç°è¦†ç›–é—®é¢˜, å¦‚ä½•è§£å†³<br>Â·è§£å†³æ–‡ä»¶åˆ†ç›®å½•å­˜æ”¾é—®é¢˜, å¦‚æœå°†æ–‡ä»¶éƒ½ä¸Šä¼ åˆ°ä¸€ä¸ªç›®å½•ä¸‹ï¼Œå½“ä¸Šä¼ æ–‡ä»¶å¾ˆå¤šæ—¶ï¼Œä¼šé€ æˆè®¿é—®æ–‡ä»¶é€Ÿåº¦å˜æ…¢ï¼Œ<br>å› æ­¤å¯ä»¥å°†æ–‡ä»¶ä¸Šä¼ åˆ°ä¸åŒç›®å½• æ¯”å¦‚ ä¸€å¤©ä¸Šä¼ çš„æ–‡ä»¶ï¼Œç»Ÿä¸€æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ å¹´/æœˆ/æ—¥, æ¯”å¦‚ 2022/11/11 ç›®å½•</p><h2 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>Â·é»˜è®¤æƒ…å†µä¸‹,SpringBootæä¾›/errorå¤„ç†æ‰€æœ‰é”™è¯¯çš„æ˜ å°„</p><h3 id="æ‹¦æˆªå™¨VSè¿‡æ»¤å™¨"><a href="#æ‹¦æˆªå™¨VSè¿‡æ»¤å™¨" class="headerlink" title="æ‹¦æˆªå™¨VSè¿‡æ»¤å™¨"></a>æ‹¦æˆªå™¨VSè¿‡æ»¤å™¨</h3><p>Â·è¿‡æ»¤å™¨å®ç°çš„æ˜¯javax.servlet.Filteræ¥å£,è€Œè¿™ä¸ªæ¥å£æ˜¯åœ¨Servletè§„èŒƒä¸­å®šä¹‰çš„,ä¹Ÿå°±æ˜¯è¯´è¿‡æ»¤å™¨Filterçš„ä½¿ç”¨è¦ä¾èµ–äºTomcatç­‰<br>å®¹å™¨,Filteråªèƒ½åœ¨webç¨‹åºä¸­ä½¿ç”¨<br>Â·æ‹¦æˆªå™¨å®ƒæ˜¯ä¸€ä¸ªSpringç»„ä»¶,å¹¶ç”±Springå®¹å™¨ç®¡ç†,å¹¶ä¸ä¾èµ–Tomcatç­‰å®¹å™¨,æ˜¯å¯ä»¥å•ç‹¬ä½¿ç”¨çš„,ä¸ä»…èƒ½åº”ç”¨åœ¨webç¨‹åºä¸­,ä¹Ÿå¯ä»¥ç”¨äºApplicationç­‰<br>ç¨‹åºä¸­ã€‚<br>Â·è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨çš„è§¦å‘æ—¶æœºä¹Ÿä¸åŒ<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/36a8a72a4d779fc7761d66a7b021b314.png"></div></div><br>1.è¿‡æ»¤å™¨Filteræ˜¯åœ¨è¯·æ±‚è¿›å…¥å®¹å™¨å,ä½†åœ¨è¿›å…¥servletä¹‹å‰è¿›è¡Œé¢„å¤„ç†,è¯·æ±‚ç»“æŸæ˜¯åœ¨servletå¤„ç†å®Œä»¥å<br>2.æ‹¦æˆªå™¨ Interceptoræ˜¯åœ¨è¯·æ±‚è¿›å…¥servletå,åœ¨è¿›å…¥Controllerä¹‹å‰è¿›è¡Œé¢„å¤„ç†çš„,Controllerä¸­æ¸²æŸ“äº†å¯¹åº”çš„è§†å›¾ä¹‹åè¯·æ±‚ç»“æŸ</p><h3 id="è‡ªå®šä¹‰å¼‚å¸¸é¡µé¢"><a href="#è‡ªå®šä¹‰å¼‚å¸¸é¡µé¢" class="headerlink" title="è‡ªå®šä¹‰å¼‚å¸¸é¡µé¢"></a>è‡ªå®šä¹‰å¼‚å¸¸é¡µé¢</h3><p>Â·åœ¨resource/templates/error/ä¸‹åˆ›å»º404.html,500.html,4xx.html,5xx.htmlå½“å‘ç”Ÿç›¸åº”é”™è¯¯æ—¶,æ˜¾ç¤ºè‡ªå®šä¹‰çš„é¡µé¢ä¿¡æ¯</p><h3 id="å…¨å±€å¼‚å¸¸"><a href="#å…¨å±€å¼‚å¸¸" class="headerlink" title="å…¨å±€å¼‚å¸¸"></a>å…¨å±€å¼‚å¸¸</h3><p>Â·è¯´æ˜<br>1.@ControllerAdvice+@ExceptionHandlerå¤„ç†å…¨å±€å¼‚å¸¸<br>2.æ¼”ç¤ºå…¨å±€å¼‚å¸¸ä½¿ç”¨, å½“å‘ç”Ÿ ArithmeticExceptionã€NullPointerException æ—¶ï¼Œä¸ä½¿ç”¨é»˜è®¤å¼‚å¸¸æœºåˆ¶åŒ¹é…çš„ xxx.html ,<br>è€Œæ˜¯æ˜¾ç¤ºå…¨å±€å¼‚å¸¸æœºåˆ¶æŒ‡å®šçš„é”™è¯¯é¡µé¢</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@ControllerAdvice</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span> <span class="token punctuation">&#123;</span><span class="token comment">//å¯ä»¥å¤„ç†çš„å¼‚å¸¸ï¼Œå¯ä»¥æœ‰å¤šä¸ª</span><span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">ArithmeticException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">NullPointerException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handleArithException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"å¼‚å¸¸ï¼š&#123;&#125;"</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"mes"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token string">"/error/global"</span><span class="token punctuation">;</span> <span class="token comment">//è§†å›¾åœ°å€</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è‡ªå®šä¹‰å¼‚å¸¸"><a href="#è‡ªå®šä¹‰å¼‚å¸¸" class="headerlink" title="è‡ªå®šä¹‰å¼‚å¸¸"></a>è‡ªå®šä¹‰å¼‚å¸¸</h3><p>Â·å¦‚æœ Spring Boot æä¾›çš„å¼‚å¸¸ä¸èƒ½æ»¡è¶³å¼€å‘éœ€æ±‚ï¼Œç¨‹åºå‘˜ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å¼‚å¸¸<br>Â·@ResponseStatus+è‡ªå®šä¹‰å¼‚å¸¸</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ResponseStatus</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">FORBIDDEN</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccessException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token class-name">AccessException</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token class-name">AccessException</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ³¨å…¥Servlet-Filter-Listener"><a href="#æ³¨å…¥Servlet-Filter-Listener" class="headerlink" title="æ³¨å…¥Servlet,Filter,Listener"></a>æ³¨å…¥Servlet,Filter,Listener</h2><h3 id="åŸºæœ¬ä»‹ç»-8"><a href="#åŸºæœ¬ä»‹ç»-8" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>Â·è€ƒè™‘åˆ°å®é™…å¼€å‘ä¸šåŠ¡éå¸¸å¤æ‚å’Œå…¼å®¹,Spring-Bootæ”¯æŒå°†Servlet,Filter,Listeneræ³¨å…¥Springå®¹å™¨,æˆä¸ºSpring bean<br>Â·ä¹Ÿå°±æ˜¯è¯´Spring-Bootå¼€æ”¾äº†å’ŒåŸç”ŸWEBç»„ä»¶(Servlet,Filter,Listener)çš„å…¼å®¹</p><h3 id="åº”ç”¨å®ä¾‹1-ä½¿ç”¨æ³¨è§£æ–¹å¼æ³¨å…¥Servlet-Filter-Listener"><a href="#åº”ç”¨å®ä¾‹1-ä½¿ç”¨æ³¨è§£æ–¹å¼æ³¨å…¥Servlet-Filter-Listener" class="headerlink" title="åº”ç”¨å®ä¾‹1-ä½¿ç”¨æ³¨è§£æ–¹å¼æ³¨å…¥Servlet,Filter,Listener"></a>åº”ç”¨å®ä¾‹1-ä½¿ç”¨æ³¨è§£æ–¹å¼æ³¨å…¥Servlet,Filter,Listener</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/servlet01"</span><span class="token punctuation">,</span><span class="token string">"/servlet02"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Servlet_</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"hello,Servlet_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token annotation punctuation">@ServletComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">"com.qgq.springboot"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ConfigurableApplicationContext</span> ioc <span class="token operator">=</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·æ³¨æ„:æ³¨å…¥çš„åŸç”Ÿçš„Servletä¸ä¼šè¢«Spring-Bootæ‹¦æˆªå™¨æ‹¦æˆª</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@WebFilter</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/css/*"</span><span class="token punctuation">,</span><span class="token string">"/images/*"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Filter_</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"--Filter_init--æ–¹æ³•è¢«æ‰§è¡Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Filter</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>filterConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"66666"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"--Filter_doFilter--æ–¹æ³•è¢«æ‰§è¡Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿè¿‡æ»¤å™¨å¤„ç†çš„èµ„æºï¼Œæˆ‘ä»¬è¾“å‡ºä¸€ä¸ªuri</span>        <span class="token class-name">HttpServletRequest</span> servletRequest1 <span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span>servletRequest<span class="token punctuation">;</span>        <span class="token class-name">String</span> requestURI <span class="token operator">=</span> servletRequest1<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è¿‡æ»¤å™¨å¤„ç†çš„uri=&#123;&#125;"</span><span class="token punctuation">,</span>requestURI<span class="token punctuation">)</span><span class="token punctuation">;</span>        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span>servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"--Filter_destroy--æ–¹æ³•è¢«æ‰§è¡Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Filter</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·æ³¨æ„è¿‡æ»¤å™¨é…ç½®çš„urlPatterns,ä¹Ÿä¼šç»è¿‡Spring-Bootæ‹¦æˆªå™¨</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@WebListener</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Listener_</span> <span class="token keyword">implements</span> <span class="token class-name">ServletContextListener</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextInitialized</span><span class="token punctuation">(</span><span class="token class-name">ServletContextEvent</span> sce<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//è¿™é‡Œå¯ä»¥åŠ å…¥é¡¹ç›®åˆå§‹åŒ–çš„ç›¸å…³ä¸šåŠ¡ä»£ç </span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Listener_contextInitializedé¡¹ç›®åˆå§‹åŒ–"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ServletContextListener</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">contextInitialized</span><span class="token punctuation">(</span>sce<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextDestroyed</span><span class="token punctuation">(</span><span class="token class-name">ServletContextEvent</span> sce<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//è¿™é‡Œå¯ä»¥åŠ å…¥ç›¸åº”ä»£ç ...</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Listener_contextInitializedé¡¹ç›®è¢«é”€æ¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ServletContextListener</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">contextDestroyed</span><span class="token punctuation">(</span>sce<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åº”ç”¨å®ä¾‹2-ä½¿ç”¨RegistrationBeanæ–¹å¼æ³¨å…¥"><a href="#åº”ç”¨å®ä¾‹2-ä½¿ç”¨RegistrationBeanæ–¹å¼æ³¨å…¥" class="headerlink" title="åº”ç”¨å®ä¾‹2-ä½¿ç”¨RegistrationBeanæ–¹å¼æ³¨å…¥"></a>åº”ç”¨å®ä¾‹2-ä½¿ç”¨RegistrationBeanæ–¹å¼æ³¨å…¥</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RegisterConfig_</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//ä½¿ç”¨RegistrationBeanæ–¹å¼æ³¨å…¥</span>    <span class="token comment">//æ³¨å…¥Servlet</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">ServletRegistrationBean</span> <span class="token function">servlet_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºåŸç”Ÿçš„Servletå¯¹è±¡</span>        <span class="token class-name">Servlet_</span> servlet_ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Servlet_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æŠŠservlet_å¯¹è±¡å…³è”åˆ°ServletRegistrationBean å¯¹è±¡</span>        <span class="token comment">//"/servlet01","servlet02" å°±æ˜¯æ³¨å…¥çš„Servletçš„url-pattern</span>        <span class="token comment">//åŒ¹é…ä¸Šä¹‹åè¿‡æ»¤å™¨ï¼Œæ‹¦æˆªå™¨ç»Ÿç»Ÿä¸èµ·ä½œç”¨tomcat->servlet</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ServletRegistrationBean</span><span class="token punctuation">(</span>servlet_<span class="token punctuation">,</span><span class="token string">"/servlet01"</span><span class="token punctuation">,</span><span class="token string">"/servlet02"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æ³¨å…¥Servlet</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">FilterRegistrationBean</span> <span class="token function">filter_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">Filter_</span> filter_ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Filter_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Filter</span><span class="token punctuation">></span></span> filterFilterRegistrationBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>filter_<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ç›®å‰è¦åšçš„è®¾ç½®filterçš„UrlPatterns</span>        filterFilterRegistrationBean<span class="token punctuation">.</span><span class="token function">setUrlPatterns</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"/css/*"</span><span class="token punctuation">,</span><span class="token string">"/images/*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> filterFilterRegistrationBean<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æ³¨å…¥Linster</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">ServletListenerRegistrationBean</span> <span class="token function">listener_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºåŸç”ŸListener</span>        <span class="token class-name">Listener_</span> listener_ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Listener_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ServletListenerRegistrationBean</span><span class="token punctuation">(</span>listener_<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚-1"><a href="#æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚-1" class="headerlink" title="æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><p>Â·è¯·æ±‚Servletæ—¶,ä¸ºä»€ä¹ˆä¸ä¼šåˆ°è¾¾æ‹¦æˆªå™¨<br>1.è¯·æ±‚Servletæ—¶,ä¸ä¼šåˆ°è¾¾DispatcherServlet,å› æ­¤ä¹Ÿä¼šè¾¾åˆ°æ‹¦æˆªå™¨</p><h2 id="æ•°æ®åº“æ“ä½œ"><a href="#æ•°æ®åº“æ“ä½œ" class="headerlink" title="æ•°æ®åº“æ“ä½œ"></a>æ•°æ®åº“æ“ä½œ</h2><h3 id="JDBC-HikariDataSource"><a href="#JDBC-HikariDataSource" class="headerlink" title="JDBC+HikariDataSource"></a>JDBC+HikariDataSource</h3><p>Â·HikariDataSource:ç›®å‰å¸‚é¢ä¸Šéå¸¸ä¼˜ç§€çš„æ•°æ®åº“æº,æ˜¯SpringBoot2é»˜è®¤æ•°æ®æº<br>Â·è¿›è¡Œæ•°æ®åº“å¼€å‘,åœ¨pom.xmlå¼•å…¥data-jdbc starter<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>Â·Spring Bootä¸çŸ¥é“é¡¹ç›®è¦æ“ä½œMySqlè¿˜æ˜¯Oracle,éœ€è¦åœ¨pom.xmlæŒ‡å®šå¯¼å…¥æ•°æ®åº“é©±åŠ¨,å¹¶æŒ‡å®šå¯¹åº”ç‰ˆæœ¬<br>Â·åœ¨application.ymlé…ç½®æ“ä½œæ•°æ®æºçš„ä¿¡æ¯<br><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">datasource</span><span class="token punctuation">:</span> <span class="token comment">#é…ç½®æ•°æ®æºï¼Œmybatisé…ç½®è¿‡</span>  <span class="token comment"># è¯´æ˜ï¼šå¦‚æœæ²¡æœ‰æŒ‡å®šuseSSL=trueï¼Œå¯åŠ¨é¡¹ç›®ä¼šçˆ†çº¢ï¼Œç¯å¢ƒçš„é—®é¢˜</span>  <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/spring_boot<span class="token punctuation">?</span>useSSL=true<span class="token important">&amp;userUnicode=true&amp;characterEncoding=UTF-</span><span class="token number">8</span>  <span class="token key atrule">username</span><span class="token punctuation">:</span> root  <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">1234</span>  <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootTest</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationTests</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//ä¼šè®®ï¼Œåœ¨å­¦springæ—¶ï¼Œæœ‰ä¸ªjdbcTemplate</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//rowMapperæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥å°†æŸ¥è¯¢çš„ç»“æœï¼Œå°è£…åˆ°ä½ æŒ‡å®šçš„Monsterå¯¹è±¡ä¸­</span>        <span class="token class-name">RowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Furn</span><span class="token punctuation">></span></span> rowMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeanPropertyRowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token class-name">Furn</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Furn</span><span class="token punctuation">></span></span> query <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"select * from `furn`"</span><span class="token punctuation">,</span> rowMapper<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Furn</span> furn <span class="token operator">:</span> query<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>furn<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//çœ‹çœ‹åº•å±‚ä½¿ç”¨çš„æ˜¯è¯´ä»€ä¹ˆæ•°æ®æºç±»å‹</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jdbcTemplate<span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="æ•´åˆDruidåˆ°Spring-Boot"><a href="#æ•´åˆDruidåˆ°Spring-Boot" class="headerlink" title="æ•´åˆDruidåˆ°Spring-Boot"></a>æ•´åˆDruidåˆ°Spring-Boot</h3><h4 id="åŸºæœ¬ä»‹ç»-9"><a href="#åŸºæœ¬ä»‹ç»-9" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h4><p>Â·Druid:æ€§èƒ½ä¼˜ç§€ï¼ŒDruid æä¾›æ€§èƒ½å“è¶Šçš„è¿æ¥æ± åŠŸèƒ½å¤–ã€Java åŸºç¡€ã€‘ï¼Œè¿˜é›†æˆäº† SQL ç›‘<br>æ§ï¼Œé»‘åå•æ‹¦æˆªç­‰åŠŸèƒ½ï¼Œå¼ºå¤§çš„ç›‘æ§ç‰¹æ€§ï¼Œé€šè¿‡ Druid æä¾›çš„ç›‘æ§åŠŸèƒ½ï¼Œå¯ä»¥æ¸…æ¥šçŸ¥é“è¿<br>æ¥æ± å’Œ SQL çš„å·¥ä½œæƒ…å†µï¼Œæ‰€ä»¥æ ¹æ®é¡¹ç›®éœ€è¦ï¼Œæˆ‘ä»¬ä¹Ÿè¦æŒæ¡ Druid å’Œ SpringBootæ•´åˆã€‚</p><h3 id="DruidåŸºæœ¬ä½¿ç”¨"><a href="#DruidåŸºæœ¬ä½¿ç”¨" class="headerlink" title="DruidåŸºæœ¬ä½¿ç”¨"></a>DruidåŸºæœ¬ä½¿ç”¨</h3><p>Â·ä¿®æ”¹ pom.xml , å¼•å…¥ druidä¾èµ–<br>Â·åˆ›å»º DruidDataSourceConfig.java é…ç½®<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DruidDataSourceConfig</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//ç¼–å†™æ–¹æ³•ï¼Œæ³¨å…¥DruidDataSource</span>    <span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">"spring.datasource"</span><span class="token punctuation">)</span>    <span class="token comment">//è¿˜è¦è¯´æ˜ä¸€ä¸‹ä¸ºä»€ä¹ˆæˆ‘ä»¬æ³¨å…¥è‡ªå·±çš„DataSourceï¼ŒåŸæ¥çš„HiKariCPå°±å¤±æ•ˆäº†</span>    <span class="token comment">//1.é»˜è®¤çš„æ•°æ®æºæ˜¯å¦‚ä½•é…ç½®çš„@ConditionalOnMissingBean(&#123; DataSource.class, XADataSource.class &#125;)</span>    <span class="token comment">//  è§£è¯»é€šè¿‡@ConditionalOnMissingBean(&#123; DataSource.class, XADataSource.class &#125;)ï¼Œåˆ¤æ–­å¦‚æœå®¹å™¨æœ‰DataSource Beanï¼Œå°±ä¸æ³¨å…¥é»˜è®¤çš„HiKariDataSource</span>    <span class="token comment">//2.debug æºç </span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1.é…ç½®äº†@ConfigurationProperties("spring.datasource")</span>        <span class="token comment">//  å°±å¯ä»¥è¯»å–åˆ°application.ymlçš„é…ç½®</span>        <span class="token comment">//2.æˆ‘ä»¬å°±ä¸éœ€è¦è°ƒç”¨DruidDataSource å¯¹è±¡çš„setXxxï¼Œä¼šè‡ªåŠ¨å…³è”è°ƒç”¨</span>        <span class="token class-name">DruidDataSource</span> druidDataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åŠ å…¥ç›‘æ§åŠŸèƒ½ï¼ŒåŠ å…¥äº†sqlé˜²ç«å¢™ç›‘æ§</span>        druidDataSource<span class="token punctuation">.</span><span class="token function">setFilters</span><span class="token punctuation">(</span><span class="token string">"stat,wall"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> druidDataSource<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="Druid-ç›‘æ§åŠŸèƒ½-SQL-ç›‘æ§"><a href="#Druid-ç›‘æ§åŠŸèƒ½-SQL-ç›‘æ§" class="headerlink" title="Druid ç›‘æ§åŠŸèƒ½-SQL ç›‘æ§"></a>Druid ç›‘æ§åŠŸèƒ½-SQL ç›‘æ§</h4><p>Â·é…ç½®druidçš„ç›‘æ§é¡µåŠŸèƒ½<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">ServletRegistrationBean</span> <span class="token function">statViewServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">StatViewServlet</span> statViewServlet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StatViewServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ServletRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StatViewServlet</span><span class="token punctuation">></span></span> registrationBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>statViewServlet<span class="token punctuation">,</span><span class="token string">"/druid/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è®¾ç½®init-parameter è®¾ç½®ç”¨æˆ·åå’Œå¯†ç </span>        registrationBean<span class="token punctuation">.</span><span class="token function">addInitParameter</span><span class="token punctuation">(</span><span class="token string">"loginUsername"</span><span class="token punctuation">,</span><span class="token string">"qgq"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        registrationBean<span class="token punctuation">.</span><span class="token function">addInitParameter</span><span class="token punctuation">(</span><span class="token string">"loginPassword"</span><span class="token punctuation">,</span><span class="token string">"666666"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> registrationBean<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>Â·è®¿é—® <a href="http://localhost:10000/druid/index.html">http://localhost:10000/druid/index.html</a><br>Â·ä¿® æ”¹DruidDataSourceConfig.java,æ³¨å…¥/å¢åŠ WebStatFilter ç”¨äºé‡‡é›† web-jdbc å…³è”ç›‘æ§çš„æ•°æ®<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Bean</span>   <span class="token comment">//é…ç½®WebStartFilterï¼Œç”¨äºé‡‡é›†web-jdbcå…³è”çš„ç›‘æ§æ•°æ®</span>   <span class="token keyword">public</span> <span class="token class-name">FilterRegistrationBean</span> <span class="token function">webStartFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>       <span class="token comment">//åˆ›å»ºä¸€ä¸ªWebStartFilter</span>       <span class="token class-name">WebStatFilter</span> webStatFilter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebStatFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WebStatFilter</span><span class="token punctuation">></span></span> filterregistrationBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>webStatFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//é»˜è®¤å¯¹æ‰€æœ‰çš„urlè¯·æ±‚ç›‘æ§</span>       filterregistrationBean<span class="token punctuation">.</span><span class="token function">setUrlPatterns</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"/*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//æ’é™¤æŒ‡å®šçš„url</span>       filterregistrationBean<span class="token punctuation">.</span><span class="token function">addInitParameter</span><span class="token punctuation">(</span><span class="token string">"exclusions"</span><span class="token punctuation">,</span><span class="token string">"*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> filterregistrationBean<span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="Druid-Spring-Boot-Starter"><a href="#Druid-Spring-Boot-Starter" class="headerlink" title="Druid Spring Boot Starter"></a>Druid Spring Boot Starter</h3><p>Â·åŸºæœ¬ä»‹ç»<br>1.å‰é¢æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯è‡ªå·±å¼•å…¥druid+é…ç½®ç±»æ–¹å¼æ•´åˆDruidå’Œç›‘æ§<br>2.Druid Spring Boot Starter å¯ä»¥è®©ç¨‹åºå‘˜åœ¨ Spring Boot é¡¹ç›®ä¸­æ›´åŠ è½»æ¾é›†æˆ Druid å’Œç›‘æ§<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.1.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>Â·ä¿®æ”¹application.ymlå¢åŠ é…ç½®å‚æ•°<br><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">druid</span><span class="token punctuation">:</span>  <span class="token key atrule">stat-view-servlet</span><span class="token punctuation">:</span>    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">login-username</span><span class="token punctuation">:</span> qgq    <span class="token key atrule">login-password</span><span class="token punctuation">:</span> <span class="token number">6666</span>    <span class="token key atrule">reset-enable</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token key atrule">web-stat-filter</span><span class="token punctuation">:</span> <span class="token comment">#é…ç½®webç›‘æ§</span>    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">url-pattern</span><span class="token punctuation">:</span> /*    <span class="token key atrule">exclusions</span><span class="token punctuation">:</span> <span class="token string">"*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*"</span>  <span class="token key atrule">filter</span><span class="token punctuation">:</span>    <span class="token key atrule">stat</span><span class="token punctuation">:</span> <span class="token comment">#sqlç›‘æ§</span>      <span class="token key atrule">slow-sql-millis</span><span class="token punctuation">:</span> <span class="token number">1000</span>      <span class="token key atrule">log-slow-sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">wall</span><span class="token punctuation">:</span> <span class="token comment">#é…ç½®sqlé˜²ç«å¢™</span>      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>      <span class="token key atrule">config</span><span class="token punctuation">:</span>        <span class="token key atrule">drop-table-allow</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>        <span class="token key atrule">select-all-column-allow</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="SpringBootæ•´åˆMyBatiså’ŒMyBatis-plus"><a href="#SpringBootæ•´åˆMyBatiså’ŒMyBatis-plus" class="headerlink" title="SpringBootæ•´åˆMyBatiså’ŒMyBatis-plus"></a>SpringBootæ•´åˆMyBatiså’ŒMyBatis-plus</h2><h3 id="Mybatis"><a href="#Mybatis" class="headerlink" title="Mybatis"></a>Mybatis</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Mapper</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MonsterMapper</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token class-name">Monster</span> <span class="token function">getMonsterById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>        <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.mybatis.mapper.MonsterMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getMonsterById<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.mybatis.bean.Monster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select * from monster where id=#&#123;id&#125;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MonsterService</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token class-name">Monster</span> <span class="token function">getMonsterById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MonsterServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">MonsterService</span> <span class="token punctuation">&#123;</span><span class="token annotation punctuation">@Autowired</span><span class="token class-name">MonsterMapper</span> monsterMapper<span class="token punctuation">;</span><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token class-name">Monster</span> <span class="token function">getMonsterById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> monsterMapper<span class="token punctuation">.</span><span class="token function">getMonsterById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">mybatis</span><span class="token punctuation">:</span><span class="token comment"># mapper-locations æŒ‡å®š Xxxmapper.xml æ–‡ä»¶çš„ä½ç½®</span><span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="mybatis-plus"><a href="#mybatis-plus" class="headerlink" title="mybatis-plus"></a>mybatis-plus</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MonsterMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Monster</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MonsterService</span> <span class="token keyword">extends</span> <span class="token class-name">IService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Monster</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MonsterServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MonsterMapper</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">MonsterService</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title&gt;&lt;/a&gt;&lt;div class=&quot;note purple no-icon flat&quot;&gt;&lt;p&gt;SpringBootå¤ä¹  &lt;/p&gt;
&lt;/div&gt;&lt;/h1&gt;&lt;h2 id=&quot;SpringBootåŸºæœ¬ä»‹ç»</summary>
      
    
    
    
    <category term="åˆ†å¸ƒå¼å¾®æœåŠ¡" scheme="https://100qin10086.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    
    <category term="æ¡†æ¶" scheme="https://100qin10086.github.io/tags/%E6%A1%86%E6%9E%B6/"/>
    
    <category term="Java" scheme="https://100qin10086.github.io/tags/Java/"/>
    
    <category term="åˆ†å¸ƒå¼å¾®æœåŠ¡" scheme="https://100qin10086.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>MyBatiså¤ä¹ </title>
    <link href="https://100qin10086.github.io/posts/d27b3349.html"/>
    <id>https://100qin10086.github.io/posts/d27b3349.html</id>
    <published>2024-04-05T01:26:49.000Z</published>
    <updated>2024-05-06T14:13:59.606Z</updated>
    
    <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a><div class="note purple no-icon flat"><p>MyBatiså¤ä¹  </p></div></h1><h2 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h2><p>1.MyBatis æ˜¯ä¸€ä¸ªæŒä¹…åŒ–æ¡†æ¶<br>2.MyBatisåœ¨Javaå’Œsqlä¹‹é—´æä¾›æ›´çµæ´»çš„æ˜ å°„æ–¹æ¡ˆ<br>3.mybatiså¯ä»¥å°†å¯¹æ•°æ®è¡¨çš„æ“ä½œ(sqlï¼Œæ–¹æ³•)ç­‰ç­‰ç›´æ¥å‰¥ç¦»,å†™é“xmlé…ç½®æ–‡ä»¶,å®ç°å’ŒJavaä»£ç çš„è§£è€¦<br>4.mybatisé€šè¿‡SQLæ“ä½œDB,å»ºåº“å»ºè¡¨éœ€è¦ç¨‹åºå‘˜å®Œæˆ</p><h2 id="å·¥ä½œç¤ºæ„å›¾"><a href="#å·¥ä½œç¤ºæ„å›¾" class="headerlink" title="å·¥ä½œç¤ºæ„å›¾"></a>å·¥ä½œç¤ºæ„å›¾</h2><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/55ad232c87405828af5a922eee19c2bb.png"></div></div><h2 id="MyBatiså¿«é€Ÿå…¥é—¨"><a href="#MyBatiså¿«é€Ÿå…¥é—¨" class="headerlink" title="MyBatiså¿«é€Ÿå…¥é—¨"></a>MyBatiså¿«é€Ÿå…¥é—¨</h2><p>Â·åœ¨resourceç›®å½•ä¸‹åˆ›å»ºmybatis-config.xml(xmlé…ç½®æ–‡ä»¶ä¸­åŒ…å«äº†å¯¹MyBatisç³»ç»Ÿçš„æ ¸å¿ƒè®¾ç½®)</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">configuration</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Config 3.0//EN"</span>        <span class="token string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mysql.cj.jdbc.Driver<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span>                          <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbc:mysql://127.0.0.1:3306/mybatis?useSSL=true<span class="token entity named-entity" title="&amp;">&amp;amp;</span>useUnicode=true<span class="token entity named-entity" title="&amp;">&amp;amp;</span>characterEncoding=UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1234<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·åˆ›å»ºä¸€ä¸ªXXXMapperæ¥å£,é‡Œé¢å†™ä¸Šæ“ä½œæ•°æ®åº“çš„æ–¹æ³•<br>Â·ç›®å‰åœ¨è¯¥XXXMapperåŒç›®å½•ä¸‹åˆ›å»ºXXXMapper.xmlæ–‡ä»¶</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>        <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--è§£è¯»1.è¿™æ˜¯ä¸€ä¸ªmapperæ–‡ä»¶2.è¯¥æ–‡ä»¶å¯ä»¥å»å®ç°å¯¹åº”æ¥å£çš„æ–¹æ³•3.namespaceæŒ‡å®šè¯¥xmlæ–‡ä»¶å’Œå“ªä¸ªæ¥å£å¯¹åº”!!!--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.mapper.MonsterMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--        1.id="addMonster":è¡¨ç¤ºå®ç°äº†å’Œè¯¥xmlæ–‡ä»¶æ˜ å°„çš„Mapperæ¥å£çš„æŠ½è±¡æ–¹æ³•çš„å®ç°    2.parameterType="Monster"æ”¾å…¥å½¢å‚çš„ç±»å‹,éœ€è¦å†™æ ¹è·¯å¾„,å¦‚æœåœ¨MyBatis-config.xmlæ–‡ä»¶é…ç½®è¿‡å°±å¯ä»¥å†™åˆ«å    3. useGeneratedKeys="true" æ‰§è¡Œæ’å…¥è¯­å¥æ—¶,æ˜¯å¦éœ€è¦æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”®ï¼ŒkeyProperty="id"ä¸»é”®çš„å€¼    4..#&#123;age&#125;, #&#123;birthday&#125;, #&#123;email&#125;, #&#123;gender&#125;, $&#123;name&#125;, #&#123;salary&#125;æ˜¯ä»ä¼ å…¥çš„monsterå¯¹è±¡å±æ€§æ¥çš„    --></span>    <span class="token comment">&lt;!--è¿™æ˜¯myBatis-config.xmlé‡Œé¢çš„é…ç½®--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.entity.Monster<span class="token punctuation">"</span></span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Monster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAlias</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.entity.Monk<span class="token punctuation">"</span></span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Monk<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAlias</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!--å¦‚æœä¸€ä¸ªåŒ…æœ‰å¾ˆå¤šçš„ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¼•å…¥åŒ…ï¼Œè¿™æ ·æ”¹åŒ…ä¸‹é¢çš„æ‰€æœ‰ç±»åï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨--></span>        <span class="token comment">&lt;!--&lt;package name="com.qgq.entity"/>--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>addMonster<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Monster<span class="token punctuation">"</span></span> <span class="token attr-name">useGeneratedKeys</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        INSERT INTO `monster`(`age`, `birthday`, `email`, `gender`, `name`, `salary`)        values (#&#123;age&#125;, #&#123;birthday&#125;, #&#123;email&#125;, #&#123;gender&#125;, #&#123;name&#125;, #&#123;salary&#125;);    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·åœ¨mybatis-config.xmlæ–‡ä»¶ä¸­é…ç½®æˆ‘ä»¬éœ€è¦å…³è”çš„Mapper.xmlæ–‡ä»¶</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--&lt;mapper resource="com/qgq/mapper/MonsterMapper.xml">&lt;/mapper>--></span>    <span class="token comment">&lt;!--&lt;mapper resource="com/qgq/mapper/MonkMapper.xml">&lt;/mapper>--></span>    <span class="token comment">&lt;!--è§£è¯»    1.å¦‚æœæ˜¯é€šè¿‡æ³¨è§£çš„æ–¹å¼ï¼Œå¯ä¸å†ä½¿ç”¨MonsterMapper.xml    2.ä½†æ˜¯éœ€è¦åœ¨mybatis-config.xmlæ³¨å†Œå«æ³¨è§£çš„çš„ç±»    3.å¦‚æœæ²¡æœ‰å¼•å…¥ä¸èƒ½ä½¿ç”¨    --></span>    <span class="token comment">&lt;!--&lt;mapper class="com.qgq.mapper.MonsterAnnotation">&lt;/mapper>--></span>    <span class="token comment">&lt;!--å½“ä¸€ä¸ªæŠ¥ä¸‹åæœ‰å¾ˆå¤šçš„Mapper.xmlæ–‡ä»¶å’ŒåŸºäºæ³¨è§£å®ç°çš„æ¥å£æ—¶ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥åŒ…æ–¹å¼è¿›è¡Œæ³¨å†Œ--></span>    <span class="token comment">&lt;!--å°†ä¸‹é¢çš„æ‰€æœ‰çš„xmlæ–‡ä»¶å’Œæ³¨è§£æ¥å£éƒ½è¿›è¡Œæ³¨å†Œ--></span>    <span class="token comment">&lt;!--æ³¨æ„ä½¿ç”¨packageæ—¶æ¥å£å’Œxmlæ˜ å°„æ–‡ä»¶å¿…é¡»æ”¾åœ¨ä¸€ä¸ªåŒ…ä¸‹é¢ï¼Œå¹¶ä¸”åå­—ä¸€å®šè¦ç›¸åŒ--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.mapper<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">1.å¦‚æœæ˜¯é€šè¿‡æ³¨è§£çš„æ–¹å¼ï¼Œå¯ä¸å†ä½¿ç”¨MonsterMapper.xml2.ä½†æ˜¯éœ€è¦åœ¨mybatis-config.xmlæ³¨å†Œå«æ³¨è§£çš„çš„ç±»3.å¦‚æœæ²¡æœ‰å¼•å…¥ä¸èƒ½ä½¿ç”¨import org.apache.ibatis.annotations.*;public interface MonsterMapper &#123;        @Select(&quot;SELECT * FROM monsters WHERE id &#x3D; #&#123;id&#125;&quot;)    Monster getMonsterById(@Param(&quot;id&quot;) int id);        @Insert(&quot;INSERT INTO monsters (name) VALUES (#&#123;name&#125;)&quot;)    @Options(useGeneratedKeys &#x3D; true, keyProperty &#x3D; &quot;id&quot;)    void insertMonster(Monster monster);        &#x2F;&#x2F; å¯ä»¥å®šä¹‰æ›´å¤šçš„æ•°æ®åº“æ“ä½œæ–¹æ³•&#125;&lt;configuration&gt;    &lt;!-- å…¶ä»–é…ç½® --&gt;    &lt;mappers&gt;        &lt;mapper class&#x3D;&quot;com.example.MonsterMapper&quot;&#x2F;&gt;    &lt;&#x2F;mappers&gt;&lt;&#x2F;configuration&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·åˆ›å»ºMyBatisUtilså·¥å…·ç±»,å¯ä»¥å¾—åˆ°SqlSession</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBatisUtils</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory<span class="token punctuation">;</span>    <span class="token keyword">static</span><span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> resource<span class="token operator">=</span><span class="token string">"mybatis-config.xml"</span><span class="token punctuation">;</span>            <span class="token class-name">InputStream</span><span class="token operator">=</span> resourceAsStream<span class="token operator">=</span><span class="token class-name">Responses</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SqlSession</span> <span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MonsterMapperTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">SqlSession</span> sqlSession<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">MonsterMapper</span> monsterMapper<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Before</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        sqlSession <span class="token operator">=</span> <span class="token class-name">MybatisUtils</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è·å–åˆ°MonsterMapperå¯¹è±¡---ä»£ç†å¯¹è±¡</span>        <span class="token comment">//åº•å±‚æ˜¯ä½¿ç”¨äº†åŠ¨æ€ä»£ç†æœºåˆ¶</span>        monsterMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">MonsterMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>monsterMapper<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findMonsterByAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Monster</span><span class="token punctuation">></span></span> monster<span class="token operator">=</span>monsterMapper<span class="token punctuation">.</span><span class="token function">findMonsterByAge</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Monster</span> monster1 <span class="token operator">:</span> monster<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>monster1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>sqlSession<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ“ä½œæˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//è¿™æ˜¯ä½¿ç”¨åŸç”Ÿçš„APIè°ƒç”¨,äº†è§£å³å¯</span><span class="token comment">//ä½¿ç”¨sqlSession</span> <span class="token comment">//å±æ€§</span>    <span class="token keyword">private</span> <span class="token class-name">SqlSession</span> sqlSession<span class="token punctuation">;</span>    <span class="token comment">//ç¼–å†™æ–¹æ³•å®Œæˆåˆå§‹åŒ–</span>    <span class="token annotation punctuation">@Before</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        sqlSession <span class="token operator">=</span> <span class="token class-name">MybatisUtils</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//sqlSessionè¿”å›çš„å¯¹è±¡æ˜¯DefaultSqlSession</span>    <span class="token punctuation">&#125;</span>     <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">mybatisNativeCrud</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">int</span> insert <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"com.qgq.mapper.MonsterMapper.addMonster"</span><span class="token punctuation">,</span> monster<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">int</span> delete <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">"com.qgq.mapper.MonsterMapper.delMonster"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">int</span> update <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">"com.qgq.mapper.MonsterMapper.updateMonster"</span><span class="token punctuation">,</span> monster<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">Monster</span> monster <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Monster</span><span class="token punctuation">)</span> sqlSession<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token string">"com.qgq.mapper.MonsterMapper.getMonsterById"</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Monster</span><span class="token punctuation">></span></span> objects <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token string">"com.qgq.mapper.MonsterMapper.finaAllMonster"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>sqlSession<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·è§£æ<br>1.ä½¿ç”¨sqlSessionæ—¶ç”¨sqlSessionè°ƒç”¨sqlSessionçš„CRUDæ–¹æ³•,ä½†æ˜¯ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯è‡ªå·±Mapperå¯¹è±¡çš„å…¨ç±»å+æ–¹æ³•å<br>2.æœ€åsqlSession.commit()ä»¥åŠsqlSession.close();</p><h3 id="æ—¥å¿—è¾“å‡º-æŸ¥çœ‹SQL"><a href="#æ—¥å¿—è¾“å‡º-æŸ¥çœ‹SQL" class="headerlink" title="æ—¥å¿—è¾“å‡º-æŸ¥çœ‹SQL"></a>æ—¥å¿—è¾“å‡º-æŸ¥çœ‹SQL</h3><p>Â·åœ¨å¼€å‘MyBatisç¨‹åºæ—¶,æ¯”å¦‚æ‰§è¡Œæµ‹è¯•æ–¹æ³•,ç¨‹åºå‘˜å¾€å¾€éœ€è¦æŸ¥çœ‹ç¨‹åºå‘˜åº•å±‚å‘ç»™MySQLçš„sqlè¯­å¥,æ€ä¹ˆæ“ä½œ<br>Â·åœ¨mybatis-config.xmlä¸­é…ç½®,åŠ å…¥æ—¥å¿—è¾“å‡ºé…ç½®,æ–¹ä¾¿åˆ†æSQLè¯­å¥</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logImpl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>STDOUT_LOGGING<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="MyBatis-æ³¨è§£æ–¹å¼æ“ä½œ"><a href="#MyBatis-æ³¨è§£æ–¹å¼æ“ä½œ" class="headerlink" title="MyBatis-æ³¨è§£æ–¹å¼æ“ä½œ"></a>MyBatis-æ³¨è§£æ–¹å¼æ“ä½œ</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MonsterAnnotation</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æ·»åŠ æ–¹æ³•,å°†æˆ‘ä»¬çš„ sql è¯­å¥ç›´æ¥å†™åœ¨@Insert æ³¨è§£å³å¯</span>    <span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO monster (age,birthday,email,gender,name,salary) "</span> <span class="token operator">+</span> <span class="token string">"VALUES(#&#123;age&#125;,#&#123;birthday&#125;,#&#123;email&#125;,#&#123;gender&#125;,#&#123;name&#125;,#&#123;salary&#125;)"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addMonster</span><span class="token punctuation">(</span><span class="token class-name">Monster</span> monster<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//æ ¹æ® id åˆ é™¤ä¸€ä¸ª Monster</span>    <span class="token annotation punctuation">@Delete</span><span class="token punctuation">(</span><span class="token string">"DELETE FROM monster "</span> <span class="token operator">+</span> <span class="token string">"WHERE id=#&#123;id&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delMonster</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//ä¿®æ”¹ Monster</span>    <span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">"UPDATE monster SET age=#&#123;age&#125;, birthday=#&#123;birthday&#125;, "</span> <span class="token operator">+</span> <span class="token string">"email = #&#123;email&#125;,gender= #&#123;gender&#125;, "</span> <span class="token operator">+</span> <span class="token string">"name=#&#123;name&#125;, salary=#&#123;salary&#125; "</span> <span class="token operator">+</span> <span class="token string">"WHERE id=#&#123;id&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateMonster</span><span class="token punctuation">(</span><span class="token class-name">Monster</span> monster<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//æŸ¥è¯¢-æ ¹æ® id</span>    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM monster WHERE "</span> <span class="token operator">+</span> <span class="token string">"id = #&#123;id&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Monster</span> <span class="token function">getMonsterById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//æŸ¥è¯¢æ‰€æœ‰çš„ Monster</span>    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM monster "</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Monster</span><span class="token punctuation">></span></span> <span class="token function">findAllMonster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- è¿™é‡Œä¼šå¼•å…¥(æ³¨å†Œ)æˆ‘ä»¬çš„ Mapper.xml æ–‡ä»¶ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com/hspedu/mapper/MonsterMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!--è€éŸ©è§£è¯»    1. å¦‚æœæ˜¯é€šè¿‡æ³¨è§£çš„æ–¹å¼ï¼Œå¯ä¸å†ä½¿ç”¨ MonsterMapper.xml    2. ä½†æ˜¯éœ€è¦åœ¨ mybatis-config.xml æ³¨å†Œå«æ³¨è§£çš„ç±»    --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.mapper.MonsterAnnotation<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ³¨æ„äº‹é¡¹å’Œè¯´æ˜"><a href="#æ³¨æ„äº‹é¡¹å’Œè¯´æ˜" class="headerlink" title="æ³¨æ„äº‹é¡¹å’Œè¯´æ˜"></a>æ³¨æ„äº‹é¡¹å’Œè¯´æ˜</h3><p>Â·å¦‚æœæ˜¯é€šè¿‡æ³¨è§£çš„æ–¹å¼,å°±ä¸åœ¨ä½¿ç”¨MonsterMapper.xmlæ–‡ä»¶,ä½†æ˜¯éœ€è¦åœ¨mybatis-config.xmlæ–‡ä»¶ä¸­æ³¨å†Œå«æ³¨è§£çš„ç±»/æ¥å£<br>Â·ä½¿ç”¨æ³¨è§£æ–¹å¼,æ·»åŠ æ—¶,å¦‚æœè¦è¿”å›è‡ªå¢é•¿idå€¼,å¯ä»¥ä½¿ç”¨@Optionæ³¨è§£</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"INSERT INTO `monster` (`age`, `birthday`, `email`, `gender`, `name`, `salary`) "</span> <span class="token operator">+</span><span class="token string">"VALUES (#&#123;age&#125;, #&#123;birthday&#125;, #&#123;email&#125;, #&#123;gender&#125;, #&#123;name&#125;, #&#123;salary&#125;)"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Options</span><span class="token punctuation">(</span>useGeneratedKeys <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> keyProperty <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> keyColumn <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addMonster</span><span class="token punctuation">(</span><span class="token class-name">Monster</span> monster<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="mybatis-config-xmlé…ç½®æ–‡ä»¶è¯¦è§£"><a href="#mybatis-config-xmlé…ç½®æ–‡ä»¶è¯¦è§£" class="headerlink" title="mybatis-config.xmlé…ç½®æ–‡ä»¶è¯¦è§£"></a>mybatis-config.xmlé…ç½®æ–‡ä»¶è¯¦è§£</h2><p>Â·mybatisçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶(mybatis-config.xml),æ¯”å¦‚jdbcè¿æ¥ä¿¡æ¯,ç»„æµ‹mapperç­‰ç­‰ã€‚<br>Â·MyBatisçš„é…ç½®æ–‡ä»¶é…ç½®æ–‡æ¡£çš„é¡¶å±‚æœºæ„<br>Â·configuration(é…ç½®)<br>Â·properties(å±æ€§)<br>Â·settings(è®¾ç½®)<br>Â·typeAliases(ç±»å‹åˆ«å)<br>Â·typeHandlers(ç±»å‹å¤„ç†å™¨)<br>Â·plugins(æ’ä»¶)<br>Â·environments(ç¯å¢ƒé…ç½®)<br>Â·environment(ç¯å¢ƒå˜é‡)<br>Â·transactionManager(äº‹åŠ¡ç®¡ç†å™¨)<br>Â·dataSource(æ•°æ®æº)<br>Â·databaseIdProvider(æ•°æ®åº“å‚å•†æ ‡è¯†)<br>Â·mappers(æ˜ å°„å™¨)<br>Â·è§£è¯»<br>1.properties å±æ€§:é€šè¿‡è¯¥å±æ€§,å¯ä»¥æŒ‡å®šä¸€ä¸ªå¤–éƒ¨çš„jdbc.propertiesæ–‡ä»¶,å¼•å…¥æˆ‘ä»¬çš„jdbcè¿æ¥ä¿¡æ¯</p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">jdbc.user</span><span class="token punctuation">=</span><span class="token value attr-value">root</span><span class="token key attr-name">jdbc.password</span><span class="token punctuation">=</span><span class="token value attr-value">1234</span><span class="token key attr-name">jdbc.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://127.0.0.1:3306/mybatis?userSSL=true&amp;amp;userUnicode=true&amp;amp;characterEncoding=UTF-8</span><span class="token key attr-name">jdbc.driver</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbc.properties<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!--äº‹åŠ¡ç®¡ç†å™¨--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token comment">&lt;!--é…ç½®æ•°æ®æº            è§£è¯»            1.æˆ‘ä»¬ä½¿ç”¨å¤–éƒ¨çš„å±æ€§æ–‡ä»¶æ¥è®¾ç½®ç›¸å…³çš„å€¼            2.è¿™ä¸ªå±æ€§æ–‡ä»¶éœ€è¦ç»Ÿä¸€çš„æ”¾åœ¨resourceä¸‹ï¼Œä¹Ÿå°±æ˜¯ç±»åŠ è½½è·¯å¾„            --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!--é…ç½®é©±åŠ¨--></span>                <span class="token comment">&lt;!--&lt;property name="driver" value="com.mysql.jdbc.Driver"/>--></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.driver&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token comment">&lt;!--é…ç½®è¿æ¥mysql-url                1.jdbc:mysql åè®®                2.127.0.0.1:3306:æŒ‡å®šè¿æ¥mysqlçš„ipï¼‹ç«¯å£                3.mybatis è¿æ¥çš„DB                4.useSSL=true è¡¨ç¤ºä½¿ç”¨çš„æ˜¯true                5.&amp;amp; è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ª&amp;ç¬¦ é˜²æ­¢è§£æé”™è¯¯                6.userUnicode=true; ä½¿ç”¨unicode ä½œç”¨æ˜¯é˜²æ­¢ç¼–ç é”™è¯¯                7.characterEncoding=UTF-8 æŒ‡å®šä½¿ç”¨utf-8,é˜²æ­¢ä¸­æ–‡ä¹±ç                 ä¸ç”¨èƒŒ,ç›´æ¥ä½¿ç”¨                --></span>                <span class="token comment">&lt;!--&lt;property name="url" value="jdbc:mysql://127.0.0.1:3306/mybatis?useSSL=true&amp;amp;userUnicode=true&amp;amp;characterEncoding=UTF-8"/>--></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.url&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.username&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.password&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2.settingså…¨å±€å‚æ•°å®šä¹‰<br>3.typeAliasesåˆ«åå¤„ç†å™¨<br>Â·åˆ«åæ—¶ä¸ºJavaç±»å‹å‘½åçš„ä¸€ä¸ªçŸ­åå­—,å®ƒåªå’ŒXMLé…ç½®æœ‰å…³,ç”¨æ¥å‡å°‘ç±»å‹é‡å¤çš„éƒ¨åˆ†<br>Â·å¦‚æœæˆ‘ä»¬æŒ‡å®šäº†åˆ«å,æˆ‘ä»¬çš„MapperXxxx.xmlæ–‡ä»¶å°±å¯ä»¥åšç›¸åº”çš„ç®€åŒ–å¤„ç†</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--é…ç½®åˆ«å,ä¸»è¦ä½œç”¨æ˜¯ç®€å†™--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.entity.Monster<span class="token punctuation">"</span></span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Monster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAlias</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--å¦‚æœä¸€ä¸ªä¿é™©é¢æœ‰å¾ˆå¤šçš„ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¼•å…¥åŒ…ï¼Œè¿™æ ·æ”¹åŒ…ä¸‹é¢çš„æ‰€æœ‰ç±»åï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.entity<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>4.typeHandlersç±»å‹å¤„ç†å™¨<br>Â·ç”¨äºJavaç±»å‹å’Œjdbcç±»å‹æ˜ å°„<br>Â·MyBatisçš„æ˜ å°„åŸºæœ¬ä»¥åŠæ»¡è¶³,ä¸å¤ªéœ€è¦é‡æ–°å®šä¹‰<br>5.environmentsç¯å¢ƒ<br>Â·resourceæ³¨å†ŒMapperæ–‡ä»¶:XXXMapper.xmlæ–‡ä»¶(å¸¸ç”¨)</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com/qgq/mapper/MonsterMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com/qgq/mapper/MonkMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·class:æ¥å£æ³¨è§£å®ç°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IdenCardMapperAnnotation</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æ ¹æ®idè·å–åˆ°çœä»½è¯</span>    <span class="token comment">//è¿™ä¸ªæ–¹æ³•ä¸éœ€è¦è¿”å›ä»»ä½•çº§è”å¯¹è±¡</span>    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM `idencard` WHERE id=#&#123;id&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">IdenCard</span> <span class="token function">getIdenCardById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.mapper.IdenCardMapperAnnotation<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span>```  Â·packageæ–¹å¼æ³¨å†Œ:```xml<span class="token comment">&lt;!-- è€éŸ©è§£è¯»1. å½“ä¸€ä¸ªåŒ…ä¸‹æœ‰å¾ˆå¤šçš„ Mapper.xml æ–‡ä»¶å’ŒåŸºäºæ³¨è§£å®ç°çš„æ¥å£æ—¶ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥åŒ…æ–¹å¼è¿›è¡Œæ³¨å†Œ2. å°†ä¸‹é¢çš„æ‰€æœ‰ xml æ–‡ä»¶å’Œæ³¨è§£æ¥å£ éƒ½è¿›è¡Œæ³¨å†Œ--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.mapper<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="XxxxMapper-xml-SQLæ˜ å°„æ–‡ä»¶"><a href="#XxxxMapper-xml-SQLæ˜ å°„æ–‡ä»¶" class="headerlink" title="XxxxMapper.xml-SQLæ˜ å°„æ–‡ä»¶"></a>XxxxMapper.xml-SQLæ˜ å°„æ–‡ä»¶</h2><p>Â·MyBatis çš„çœŸæ­£å¼ºå¤§åœ¨äºå®ƒçš„è¯­å¥æ˜ å°„(åœ¨ XxxMapper.xml é…ç½®), ç”±äºå®ƒçš„å¼‚å¸¸å¼ºå¤§,å¦‚æœæ‹¿å®ƒè·Ÿå…·æœ‰ç›¸åŒåŠŸèƒ½çš„<br>JDBC ä»£ç è¿›è¡Œå¯¹æ¯”ä½ ä¼šç«‹å³å‘ç°çœæ‰äº†å°†è¿‘ 95% çš„ä»£ç ã€‚MyBatis è‡´åŠ›äºå‡å°‘ä½¿ç”¨æˆæœ¬ï¼Œè®©ç”¨æˆ·èƒ½æ›´ä¸“æ³¨äº SQL ä»£ç ã€‚<br>Â·SQL æ˜ å°„æ–‡ä»¶å¸¸ç”¨çš„å‡ ä¸ªé¡¶çº§å…ƒç´ ï¼ˆæŒ‰ç…§åº”è¢«å®šä¹‰çš„é¡ºåºåˆ—å‡ºï¼‰<br>cache â€“ è¯¥å‘½åç©ºé—´çš„ç¼“å­˜é…ç½®ã€‚<br>cache-ref â€“ å¼•ç”¨å…¶å®ƒå‘½åç©ºé—´çš„ç¼“å­˜é…ç½®ã€‚<br>resultMap â€“ æè¿°å¦‚ä½•ä»æ•°æ®åº“ç»“æœé›†ä¸­åŠ è½½å¯¹è±¡ï¼Œæ˜¯æœ€å¤æ‚ä¹Ÿæ˜¯æœ€å¼ºå¤§çš„å…ƒç´ ã€‚<br>parameterType - å°†ä¼šä¼ å…¥è¿™æ¡è¯­å¥çš„å‚æ•°çš„ç±»å…¨é™å®šåæˆ–åˆ«å<br>sql â€“ å¯è¢«å…¶å®ƒè¯­å¥å¼•ç”¨çš„å¯é‡ç”¨è¯­å¥å—ã€‚<br>insert â€“ æ˜ å°„æ’å…¥è¯­å¥ã€‚<br>update â€“ æ˜ å°„æ›´æ–°è¯­å¥ã€‚<br>delete â€“ æ˜ å°„åˆ é™¤è¯­å¥ã€‚<br>select â€“ æ˜ å°„æŸ¥è¯¢è¯­å¥ã€‚<br>Â·parameterTypeåº”ç”¨æ¡ˆä¾‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é€šè¿‡ id æˆ–è€…åå­—æŸ¥è¯¢</span><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Monster</span><span class="token punctuation">></span></span> <span class="token function">findMonsterByNameORId</span><span class="token punctuation">(</span><span class="token class-name">Monster</span> monster<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"findMonsterByNameORId"</span> parameterType<span class="token operator">=</span><span class="token string">"Monster"</span>resultType<span class="token operator">=</span><span class="token string">"Monster"</span><span class="token operator">></span><span class="token constant">SELECT</span> <span class="token operator">*</span> <span class="token constant">FROM</span> monster<span class="token class-name">WHERE</span> id<span class="token operator">=</span>#<span class="token punctuation">&#123;</span>id<span class="token punctuation">&#125;</span> <span class="token class-name">OR</span> name<span class="token operator">=</span>#<span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">></span><span class="token comment">//æŸ¥è¯¢åå­—ä¸­å«ä¹‰'ç²¾'å¦–æ€ª</span><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Monster</span><span class="token punctuation">></span></span> <span class="token function">findMonsterByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> çœ‹çœ‹æ¨¡ç³ŠæŸ¥è¯¢çš„ä½¿ç”¨ å–å€¼ éœ€è¦ $<span class="token punctuation">&#123;</span>value<span class="token punctuation">&#125;</span> å–å€¼<span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"findMonsterByName"</span> parameterType<span class="token operator">=</span><span class="token string">"String"</span> resultType<span class="token operator">=</span><span class="token string">"Monster"</span><span class="token operator">></span><span class="token constant">SELECT</span> <span class="token operator">*</span> <span class="token constant">FROM</span> monster<span class="token constant">WHERE</span> name <span class="token constant">LIKE</span> '<span class="token operator">%</span>$<span class="token punctuation">&#123;</span>value<span class="token punctuation">&#125;</span><span class="token operator">%</span>' <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·ä¼ å…¥HashMap(é‡ç‚¹)<br>1.HashMapä¼ å…¥å‚æ•°æ›´åŠ çµæ´»,æ¯”å¦‚å¯ä»¥çµæ´»çš„å¢åŠ æŸ¥è¯¢çš„å±æ€§,è€Œä¸å—é™äºMonsterè¿™ä¸ªPojoå±æ€§æœ¬èº«</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æŸ¥è¯¢ id > 10 å¹¶ä¸” salary å¤§äº 40, è¦æ±‚ä¼ å…¥çš„å‚æ•°æ˜¯ HashMap</span><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Monster</span><span class="token punctuation">></span></span> <span class="token function">findMonsterByIdAndSalary_PrameterHashMap</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> map<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> å®ç° findMonsterByIdAndSalary_PrameterHashMap <span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"findMonsterByIdAndSalary_PrameterHashMap"</span> parameterType<span class="token operator">=</span><span class="token string">"map"</span> resultType<span class="token operator">=</span><span class="token string">"Monster"</span><span class="token operator">></span><span class="token constant">SELECT</span> <span class="token operator">*</span> <span class="token constant">FROM</span> monster<span class="token constant">WHERE</span> id <span class="token operator">></span> #<span class="token punctuation">&#123;</span>id<span class="token punctuation">&#125;</span> <span class="token constant">AND</span> salary <span class="token operator">></span> #<span class="token punctuation">&#123;</span>salary<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·ä¼ å…¥å’Œè¿”å›éƒ½æ˜¯HashMap</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æŸ¥è¯¢ id > 10 å¹¶ä¸” salary å¤§äº 40, è¦æ±‚ä¼ å…¥çš„å‚æ•°æ˜¯ HashMap</span><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span><span class="token punctuation">></span></span><span class="token function">findMonsterByIdAndSalary_PrameterHashMap_ReturnHashMap</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> map<span class="token punctuation">)</span><span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"findMonsterByIdAndSalary_PrameterHashMap_ReturnHashMap"</span> parameterType<span class="token operator">=</span><span class="token string">"map"</span>resultType<span class="token operator">=</span><span class="token string">"map"</span> <span class="token operator">></span><span class="token class-name">SELECT</span> id<span class="token punctuation">,</span>name <span class="token constant">FROM</span> monster<span class="token constant">WHERE</span> id <span class="token operator">></span> #<span class="token punctuation">&#123;</span>id<span class="token punctuation">&#125;</span> <span class="token constant">AND</span> salary <span class="token operator">></span> #<span class="token punctuation">&#123;</span>salary<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">></span>```  Â·<span class="token function">resultMap</span><span class="token punctuation">(</span>ç»“æœé›†æ˜ å°„<span class="token punctuation">)</span><span class="token number">1.</span>åŸºæœ¬ä»‹ç»<span class="token operator">:</span>å½“å®ä½“ç±»çš„å±æ€§å’Œè¡¨çš„å­—æ®µåå­—ä¸ä¸€è‡´æ—¶<span class="token punctuation">,</span>æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡resultMapè¿›è¡Œæ˜ å°„<span class="token punctuation">,</span>ä»è€Œå±è”½å®ä½“ç±»å±æ€§åå’Œè¡¨çš„å­—æ®µåçš„ä¸åŒ<span class="token number">2.</span>æ¡ˆä¾‹æ¼”ç¤º```sql<span class="token constant">CREATE</span> <span class="token constant">TABLE</span> `user` <span class="token punctuation">(</span>`user_id` <span class="token constant">INT</span> <span class="token constant">NOT</span> <span class="token class-name">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span> `user_email` <span class="token function">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token constant">DEFAULT</span> ''<span class="token punctuation">,</span> `user_name` <span class="token function">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token constant">DEFAULT</span> ''<span class="token punctuation">,</span><span class="token class-name">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span>`user_id`<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token constant">CHARSET</span><span class="token operator">=</span>utf8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span><span class="token keyword">private</span> <span class="token class-name">Integer</span> user_id<span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token class-name">String</span> useremail<span class="token punctuation">;</span>éŸ©é¡ºå¹³ <span class="token class-name">Java</span> å·¥ç¨‹å¸ˆ<span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> user_id<span class="token punctuation">,</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> useremail<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>user_id <span class="token operator">=</span> user_id<span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>useremail <span class="token operator">=</span> useremail<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getUser_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> user_id<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUser_id</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> user_id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>user_id <span class="token operator">=</span> user_id<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> username<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUseremail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> useremail<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUseremail</span><span class="token punctuation">(</span><span class="token class-name">String</span> useremail<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>useremail <span class="token operator">=</span> useremail<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token string">"User&#123;"</span> <span class="token operator">+</span><span class="token string">"user_id="</span> <span class="token operator">+</span> user_id <span class="token operator">+</span><span class="token string">", username='"</span> <span class="token operator">+</span> username <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span><span class="token string">", useremail='"</span> <span class="token operator">+</span> useremail <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span><span class="token char">'&#125;'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findAllUserMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_name<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_email<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>useremail<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findAllUser<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findAllUserMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        SELECT * FROM user    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚<br>1.è§£å†³è¡¨å­—æ®µå’Œå¯¹è±¡å±æ€§åä¸ä¸€è‡´,ä¹Ÿæ”¯æŒä½¿ç”¨å­—æ®µåˆ«å,ä½†æ˜¯å¤ç”¨æ€§ä¸å¥½</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findAllUser<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    SELECT user_id,user_name AS username, user_email AS useremail FROM user<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>2.å¦‚æœæ˜¯MyBatis-Pluså¤„ç†å°±æ¯”è¾ƒç®€å•,å¯ä»¥ä½¿ç”¨æ³¨è§£@TableFileldæ¥è§£å†³å®ä½“å­—æ®µåå’Œè¡¨å­—æ®µåä¸ä¸€è‡´çš„é—®é¢˜,è¿˜å¯ä»¥ä½¿ç”¨@TableName<br>æ¥è§£å†³</p><h2 id="åŠ¨æ€SQLè¯­å¥-æ›´å¤æ‚çš„æŸ¥è¯¢ä¸šåŠ¡éœ€æ±‚"><a href="#åŠ¨æ€SQLè¯­å¥-æ›´å¤æ‚çš„æŸ¥è¯¢ä¸šåŠ¡éœ€æ±‚" class="headerlink" title="åŠ¨æ€SQLè¯­å¥-æ›´å¤æ‚çš„æŸ¥è¯¢ä¸šåŠ¡éœ€æ±‚"></a>åŠ¨æ€SQLè¯­å¥-æ›´å¤æ‚çš„æŸ¥è¯¢ä¸šåŠ¡éœ€æ±‚</h2><h3 id="ä¸ºä»€ä¹ˆéœ€è¦åŠ¨æ€SQL"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åŠ¨æ€SQL" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åŠ¨æ€SQL"></a>ä¸ºä»€ä¹ˆéœ€è¦åŠ¨æ€SQL</h3><p>1.åŠ¨æ€SQLæ˜¯MyBatisçš„å¼ºå¤§ç‰¹æ€§ä¹‹ä¸€<br>2.ä½¿ç”¨JDBCæˆ–å…¶ä»–ç±»ä¼¼çš„æ¡†æ¶,æ ¹æ®ä¸åŒæ¡ä»¶æ‹¼æ¥SQLè¯­å¥éå¸¸éº»çƒ¦,ä¾‹å¦‚æ‹¼æ¥æ—¶è¦ç¡®ä¿ä¸èƒ½å¿˜è®°æ·»åŠ å¿…è¦çš„ç©ºæ ¼ï¼Œè¿˜è¦æ³¨æ„å»æ‰åˆ—è¡¨æœ€åä¸€ä¸ªåˆ—åçš„é€—å·<br>3.SQLæ˜ å°„è¯­å¥ä¸­çš„å¼ºå¤§çš„åŠ¨æ€SQLè¯­å¥,å¯ä»¥å¾ˆå“ˆçš„è§£å†³è¿™ä¸ªé—®é¢˜</p><h3 id="åŠ¨æ€SQLå¿…è¦æ€§"><a href="#åŠ¨æ€SQLå¿…è¦æ€§" class="headerlink" title="åŠ¨æ€SQLå¿…è¦æ€§"></a>åŠ¨æ€SQLå¿…è¦æ€§</h3><p>1.æ¯”å¦‚æˆ‘ä»¬æŸ¥è¯¢Monster æ—¶ï¼Œå¦‚æœç¨‹åºå‘˜è¾“å…¥çš„age ä¸å¤§äº0, æˆ‘ä»¬çš„sqlè¯­å¥å°±ä¸å¸¦age ã€‚<br>2.æ›´æ–° Monster å¯¹è±¡æ—¶ï¼Œæ²¡æœ‰è®¾ç½®çš„æ–°çš„å±æ€§å€¼ï¼Œå°±ä¿æŒåŸæ¥çš„å€¼ï¼Œè®¾ç½®äº†æ–°çš„å€¼ï¼Œæ‰æ›´æ–°.</p><h3 id="åŠ¨æ€SQLå¸¸ç”¨æ ‡ç­¾"><a href="#åŠ¨æ€SQLå¸¸ç”¨æ ‡ç­¾" class="headerlink" title="åŠ¨æ€SQLå¸¸ç”¨æ ‡ç­¾"></a>åŠ¨æ€SQLå¸¸ç”¨æ ‡ç­¾</h3><p>1.if(åˆ¤æ–­)<br>2.where(æ‹¼æ¥ whereå­å¥)<br>3.choose/when/otherwise(ç±»ä¼¼Javaçš„switchè¯­å¥,æ³¨æ„æ˜¯å•åˆ†æ”¯)<br>4.foreach(ç±»ä¼¼sqlè¯­å¥ä¸­çš„in)<br>5.trim(æ›¿æ¢å…³é”®å­—/å®šåˆ¶å…ƒç´ çš„åŠŸèƒ½)<br>6.set(åœ¨updateçš„setä¸­,å¯ä»¥ä¿è¯è¿›å…¥setæ ‡ç­¾çš„å±æ€§è¢«ä¿®æ”¹,è€Œæ²¡æœ‰è¿›å…¥setçš„,ä¿æŒåŸæ¥çš„å€¼)</p><h3 id="æ¡ˆä¾‹æ¼”ç¤º"><a href="#æ¡ˆä¾‹æ¼”ç¤º" class="headerlink" title="æ¡ˆä¾‹æ¼”ç¤º"></a>æ¡ˆä¾‹æ¼”ç¤º</h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--è¯·æŸ¥è¯¢ age å¤§äº 10 çš„æ‰€æœ‰å¦–æ€ªï¼Œå¦‚æœç¨‹åºå‘˜è¾“å…¥çš„ age ä¸å¤§äº 0, åˆ™è¾“å‡ºæ‰€æœ‰çš„å¦–æ€ª--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findMonsterByAge<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Monster<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Integer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        parameterType="Integer">        SELECT * FROM monster WHERE 1=1        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>age > 0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            AND age > #&#123;age&#125;        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    éœ€æ±‚ï¼šæŸ¥è¯¢ id å¤§äº 20 çš„ï¼Œå¹¶ä¸”åå­—æ˜¯ "ç‰›é­”ç‹" çš„æ‰€æœ‰å¦–æ€ª, æ³¨æ„ï¼Œå¦‚æœåå­—ä¸ºç©ºï¼Œæˆ–è€…è¾“å…¥çš„ id å°äº 0, åˆ™ä¸æ‹¼æ¥ sql è¯­å¥--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findMonsterByIdAndName<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Monster<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Monster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        SELECT * FROM monster        <span class="token comment">&lt;!-- ä½¿ç”¨ where æ ‡ç­¾å¼€å§‹æ‹¼æ¥        where æ ‡ç­¾çš„å¥½å¤„æ˜¯. ä¼šè‡ªåŠ¨çš„åŠ å…¥ where å­å¥. mybatis ä¼šè‡ªåŠ¨çš„å»æ‰å¤šä½™çš„ AND        --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id > 0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                AND id > #&#123;id&#125;            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name != null and name != ''<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                AND name = #&#123;name&#125;            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    å¦‚æœç»™çš„ name ä¸ä¸ºç©ºï¼Œå°±æŒ‰åå­—æŸ¥è¯¢å¦–æ€ªï¼Œå¦‚æœæŒ‡å®šçš„ id>0ï¼Œå°±æŒ‰ id æ¥æŸ¥è¯¢å¦–æ€ªï¼Œè¦æ±‚ä½¿ç”¨ choose/when/otherwise æ ‡ç­¾å®ç°, ä¼ å…¥å‚æ•°è¦æ±‚ä½¿ç”¨ Map--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findMonsterByIdAndName_choose<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Monster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        SELECT * FROM monster        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>choose</span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!-- è¿™é‡Œ test="name" è¿™ name å°±æ˜¯ä½  ä¼ å…¥çš„ map å‚æ•°å¯¹åº”çš„ key --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name != null and name != ''<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                WHERE name = #&#123;name&#125;            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>when</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id > 0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                WHERE id > #&#123;id&#125;            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>when</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>otherwise</span><span class="token punctuation">></span></span>                WHERE 1 = 1            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>otherwise</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>choose</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    æŸ¥è¯¢ monster_id ä¸º 20, 22, 34 çš„å¦–--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findMonsterById_forEach<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Monster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        SELECT * FROM monster        <span class="token comment">&lt;!-- å…ˆåˆ¤æ–­ä¼ å…¥çš„ id å¯¹åº”çš„é›†åˆæ˜¯å¦ä¸ºç©ºmap.put("ids",Arrays.asList(10,20,50))--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ids != null and ids != ''<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">></span></span>                id IN                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ids<span class="token punctuation">"</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">open</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(<span class="token punctuation">"</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span> <span class="token attr-name">close</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    #&#123;id&#125;                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·set æ ‡ç­¾åº”ç”¨å®ä¾‹(é‡ç‚¹)<br>éœ€æ±‚:è¯·å¯¹æŒ‡å®š id çš„å¦–æ€ªè¿›è¡Œ ä¿®æ”¹ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®æ–°çš„å±æ€§ï¼Œåˆ™ä¿æŒåŸæ¥çš„å€¼</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateMonster_set<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    UPDATE monster    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>age != null and age != ''<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            age = #&#123;age&#125;,        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>birthday != null and birthday != ''<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            birthday = #&#123;birthday&#125;,        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email != null and email != ''<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            email = #&#123;email&#125;,        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gender != null and gender != ''<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            gender = #&#123;gender&#125;,        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name != null and name != ''<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            name = #&#123;name&#125;,        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>salary != null and salary != ''<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            salary = #&#123;salary&#125;,        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">></span></span>    WHERE id = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ˜ å°„å…³ç³»ä¸€å¯¹ä¸€"><a href="#æ˜ å°„å…³ç³»ä¸€å¯¹ä¸€" class="headerlink" title="æ˜ å°„å…³ç³»ä¸€å¯¹ä¸€"></a>æ˜ å°„å…³ç³»ä¸€å¯¹ä¸€</h2><h3 id="åŸºæœ¬ä»‹ç»-1"><a href="#åŸºæœ¬ä»‹ç»-1" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>Â·é¡¹ç›®ä¸­1å¯¹1çš„å…³ç³»æ˜¯ä¸€ä¸ªåŸºæœ¬çš„æ˜ å°„å…³ç³»,æ¯”å¦‚:Person(äºº)â€”IDCard(èº«ä»½è¯)<br>Â·å®ä¾‹</p><pre class="line-numbers language-SQL" data-language="SQL"><code class="language-SQL">CREATE TABLE person(id INT PRIMARY KEY AUTO_INCREMENT,NAME VARCHAR(32) NOT NULL DEFAULT &#39;&#39;,card_id INT ,FOREIGN KEY (card_id) REFERENCES idencard(id))CHARSET utf8;CREATE TABLE idencard(id INT PRIMARY KEY AUTO_INCREMENT,card_sn VARCHAR(32) NOT NULL DEFAULT &#39;&#39; )CHARSET utf8 ;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Getter</span><span class="token annotation punctuation">@Setter</span><span class="token annotation punctuation">@ToString</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * id INT PRIMARY KEY AUTO_INCREMENT,     * `name` VARCHAR(32) NOT NULL DEFAULT '',     * card_id INT ,     */</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token comment">//å› ä¸ºæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªçº§è”æ“ä½œï¼Œä¸€ä¸ªäººéœ€è¦å¯¹åº”ä¸€ä¸ªçœä»½è¯</span>    <span class="token comment">//è¿™é‡Œéœ€è¦ç›´æ¥å®šä¹‰ä¸€ä¸ªIdenCardå¯¹è±¡å±æ€§</span>    <span class="token keyword">private</span> <span class="token class-name">IdenCard</span> card<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Setter</span><span class="token annotation punctuation">@Getter</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@ToString</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IdenCard</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * id INT PRIMARY KEY AUTO_INCREMENT,     * card_sn VARCHAR(32) NOT NULL DEFAULT ''     */</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> card_sn<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Person</span> person<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PersonResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Person<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!--&lt;result property="id" column="id">&lt;/result>--></span>        <span class="token comment">&lt;!--ä¼˜åŒ–ä¸€ä¸ªidï¼Œæ ‡è®°å‡ºä½œä¸ºidçš„ç»“æœå¯ä»¥å¸®åŠ©æé«˜æ•´ä½“æ€§èƒ½        property="id" è¡¨ç¤ºpersonå±æ€§idï¼Œé€šå¸¸æ˜¯ä¸»é”®        column="id" è¡¨ç¤ºå¯¹åº”è¡¨çš„å­—æ®µ        --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IdenCard<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!--associationä¸€ä¸ªå¤æ‚ç±»å‹çš„å…³è”            1.property="card"è¡¨ç¤ºå¯¹Personå¯¹è±¡çš„ card å±æ€§            2.javaType="IdenCard"è¡¨ç¤ºcardå±æ€§çš„ç±»å‹            --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card_sn<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card_sn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getPersonById<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PersonResultMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        SELECT *        FROM `person`,        `idencard`        WHERE `person`.wife_id = `idencard`.id = #&#123;id&#125;;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ˜ å°„å…³ç³»å¤šå¯¹ä¸€"><a href="#æ˜ å°„å…³ç³»å¤šå¯¹ä¸€" class="headerlink" title="æ˜ å°„å…³ç³»å¤šå¯¹ä¸€"></a>æ˜ å°„å…³ç³»å¤šå¯¹ä¸€</h2><h3 id="åŸºæœ¬ä»‹ç»-2"><a href="#åŸºæœ¬ä»‹ç»-2" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>Â·é¡¹ç›®ä¸­å¤šå¯¹ä¸€çš„å…³ç³»æ˜¯ä¸€ä¸ªåŸºæœ¬çš„æ˜ å°„å…³ç³»,å¤šå¯¹1,ä¹Ÿå¯ä»¥ç†è§£æˆæ˜¯1å¯¹å¤š<br>Â·Userâ€”-pet:ä¸€ä¸ªç”¨æˆ·å¯ä»¥å…»å¤šåªå® ç‰©<br>Â·Depâ€”-Emp:ä¸€ä¸ªéƒ¨é—¨å¯ä»¥æœ‰å¤šä¸ªå‘˜å·¥<br>Â·å®ä¾‹</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mybatis_user<span class="token punctuation">(</span>id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token punctuation">)</span><span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mybatis_pet<span class="token punctuation">(</span>id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>nickname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span><span class="token punctuation">,</span>user_id <span class="token keyword">INT</span> <span class="token punctuation">,</span><span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>user_id<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> mybatis_user<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Getter</span><span class="token annotation punctuation">@Setter</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Pet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> nickname<span class="token punctuation">;</span>    <span class="token comment">//ä¸€ä¸ªpetå¯¹åº”ä¸€ä¸ªä¸»äººUserå¯¹è±¡</span>    <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Setter</span><span class="token annotation punctuation">@Getter</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token comment">//å› ä¸ºä¸€ä¸ªuserå¯¹è±¡å¯ä»¥å…»å¤šä¸ªå® ç‰©ï¼Œä½¿ç”¨é›†åˆä½“ç°è¿™ä¸ªå…³ç³»</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pet</span><span class="token punctuation">></span></span> pets<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PetMapper</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//é€šè¿‡Userçš„idæ¥è·å–petå¯¹è±¡ï¼Œå¯èƒ½æœ‰å¤šä¸ªï¼Œå› æ­¤ä½¿ç”¨Listæ¥æ”¶</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pet</span><span class="token punctuation">></span></span> <span class="token function">getPetByUserId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//é€šè¿‡petçš„idè·å–petå¯¹è±¡,åŒæ—¶ä¼šæŸ¥è¯¢åˆ°petå¯¹è±¡å…³è”çš„Userå¯¹è±¡</span>    <span class="token keyword">public</span> <span class="token class-name">Pet</span> <span class="token function">getPetById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.mapper.PetMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--é…ç½®public List&lt;Pet> getPetByUserId(Integer userId)    1.é€šè¿‡Userçš„idæ¥è·å–petå¯¹è±¡ï¼Œå¯èƒ½æœ‰å¤šä¸ªï¼Œå› æ­¤ä½¿ç”¨Listæ¥æ”¶    2.å®Œæˆçš„æ€è·¯å’Œä¹‹å‰çš„å¤§ä½“ç›¸åŒ    --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PetResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Pet<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nickname<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nickname<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_id<span class="token punctuation">"</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.mapper.UserMapper.getUserById<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getPetByUserId<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PetResultMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        SELECT * FROM mybatis_pet WHERE `user_id`=#&#123;userid&#125;;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getPetById<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PetResultMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        SELECT * FROM mybatis_pet WHERE `id`=#&#123;id&#125;;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//é€šè¿‡idæ¥è·å–Userå¯¹è±¡</span>    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.mapper.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    è§£è¯»            1.å‰é¢ä¸€å¯¹ä¸€å¦‚ä½•å®ç°            2.public User getUserById(Integer id);            3.å…ˆé€šè¿‡useridæŸ¥è¯¢å¾—åˆ°ç”¨æˆ·çš„ä¿¡æ¯ï¼Œåœ¨é€šè¿‡user-idæŸ¥è¯¢å¯¹åº”çš„å® ç‰©ä¿¡æ¯ï¼Œå¹¶æ˜ å°„åˆ°User-List&lt;pet>    --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UserResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!--    æ³¨æ„ï¼Œå¤æ‚ç±»å‹çš„å…³è”ï¼Œç”¨association                     å¤æ‚ç±»å‹çš„é›†åˆï¼Œç”¨collection                ofType="Pet" æŒ‡å®šè¿”å›çš„é›†åˆä¸­å­˜æ”¾çš„æ•°æ®ç±»å‹Pet                collection è¡¨ç¤ºæ˜¯ä¸€ä¸ªpetsé›†åˆ                property="pets" è¡¨ç¤ºçº§è”çš„å±æ€§                column="id"è¡¨ç¤ºselectè¯­å¥è¿”å›å­—æ®µå¯¹åº”çš„å€¼                ofType="Pet"è¿”å›çš„ç±»å‹                --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pets<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Pet<span class="token punctuation">"</span></span>                    <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.mapper.PetMapper.getPetByUserId<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserById<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UserResultMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        SELECT * FROM mybatis_user WHERE `id`=#&#123;id&#125;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>å¤æ‚ç±»å‹çš„å…³è”,ç”¨association<br>è´Ÿè½½ç±»å‹çš„é›†åˆ,ç”¨collection</p><h2 id="ç¼“å­˜-æé«˜æ£€ç´¢æ•ˆç‡çš„åˆ©å™¨"><a href="#ç¼“å­˜-æé«˜æ£€ç´¢æ•ˆç‡çš„åˆ©å™¨" class="headerlink" title="ç¼“å­˜-æé«˜æ£€ç´¢æ•ˆç‡çš„åˆ©å™¨"></a>ç¼“å­˜-æé«˜æ£€ç´¢æ•ˆç‡çš„åˆ©å™¨</h2><h3 id="ä¸€çº§ç¼“å­˜"><a href="#ä¸€çº§ç¼“å­˜" class="headerlink" title="ä¸€çº§ç¼“å­˜"></a>ä¸€çº§ç¼“å­˜</h3><h4 id="åŸºæœ¬ä»‹ç»-3"><a href="#åŸºæœ¬ä»‹ç»-3" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h4><p>Â·åœ¨é»˜è®¤æƒ…å†µä¸‹,mybatisæ˜¯å¯ç”¨ä¸€çº§ç¼“å­˜çš„/æœ¬åœ°ç¼“å­˜/local Cache,å®ƒæ˜¯SqlSessionçº§åˆ«çš„<br>Â·åŒä¸€ä¸ªSqlSessionæ¥å£å¯¹è±¡è°ƒç”¨äº†ç›¸åŒçš„selectè¯­å¥,ä¼šç›´æ¥ä»ç¼“å­˜é‡Œé¢è·å–,è€Œä¸æ˜¯å»æŸ¥è¯¢æ•°æ®åº“<br>Â·éœ€æ±‚:å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡æŸ¥è¯¢id=1çš„Monsterå,å†æ¬¡æŸ¥è¯¢id=1çš„monsterå¯¹è±¡,å°±ä¼šç›´æ¥ä»ä¸€çº§ç¼“å­˜è·å–,è€Œä¸æ˜¯å†æ¬¡å‘å‡ºsql<br>Â·ä¸€çº§ç¼“å­˜åŸç†å›¾<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/a6732dd39f89538c74f3d1d7f5695507.png"></div></div><br>Â·Debugä¸€çº§ç¼“å­˜æ‰§è¡Œæµç¨‹<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/9c8b265bfb00802df8202f71191f6a6b.png"></div></div><br>Â·ä¸€çº§ç¼“å­˜å¤±æ•ˆåˆ†æ<br>1.å…³é—­ sqlSession ä¼šè¯å, å†æ¬¡æŸ¥è¯¢ï¼Œä¼šåˆ°æ•°æ®åº“æŸ¥è¯¢<br>2.å½“æ‰§è¡Œ sqlSession.clearCache() ä¼šä½¿ä¸€çº§ç¼“å­˜å¤±æ•ˆ<br>3.å½“å¯¹åŒä¸€ä¸ª monster ä¿®æ”¹ï¼Œè¯¥å¯¹è±¡åœ¨ä¸€çº§ç¼“å­˜ä¼šå¤±æ•ˆ</p><h3 id="äºŒçº§ç¼“å­˜"><a href="#äºŒçº§ç¼“å­˜" class="headerlink" title="äºŒçº§ç¼“å­˜"></a>äºŒçº§ç¼“å­˜</h3><h4 id="åŸºæœ¬ä»‹ç»-4"><a href="#åŸºæœ¬ä»‹ç»-4" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h4><p>Â·äºŒçº§ç¼“å­˜å’Œä¸€çº§ç¼“å­˜éƒ½æ˜¯ä¸ºäº†æé«˜æ£€ç´¢æ•ˆç‡çš„æŠ€æœ¯<br>Â·æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ä½œç”¨åŸŸçš„èŒƒå›´ä¸ä¸€æ ·,ä¸€çº§ç¼“å­˜çš„ä½œç”¨åŸŸæ˜¯sqlSessionä¼šè¯çº§åˆ«,åœ¨ä¸€æ¬¡ä¼šè¯æœ‰æ•ˆ,è€ŒäºŒçº§ç¼“å­˜ä½œç”¨åŸŸæ˜¯å…¨å±€èŒƒå›´,<br>é’ˆå¯¹ä¸åŒä¼šè¯éƒ½æœ‰æ•ˆ<br>Â·äºŒçº§ç¼“å­˜åŸç†å›¾<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/9c8b265bfb00802df8202f71191f6a6b.png"></div></div></p><h4 id="äºŒçº§ç¼“å­˜å¿«é€Ÿå…¥é—¨"><a href="#äºŒçº§ç¼“å­˜å¿«é€Ÿå…¥é—¨" class="headerlink" title="äºŒçº§ç¼“å­˜å¿«é€Ÿå…¥é—¨"></a>äºŒçº§ç¼“å­˜å¿«é€Ÿå…¥é—¨</h4><p>1.åœ¨mybatis-config.xmlé…ç½®ä¸­å¼€å¯äºŒçº§ç¼“å­˜<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- è¿™é‡Œå°±æ˜¯å¼•å…¥ jdbc.properties æ–‡ä»¶ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbc.properties<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- å¼€å¯äºŒçº§ç¼“å­˜ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cacheEnabled<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>2.ä½¿ç”¨äºŒçº§ç¼“å­˜æ—¶entityç±»å®ç°åºåˆ—åŒ–æ¥å£(serializable),å› ä¸ºäºŒçº§ç¼“å­˜å¯èƒ½ä½¿ç”¨åˆ°åºåˆ—åŒ–æŠ€æœ¯<br>3.ç¼“å­˜æ‰§è¡Œé¡ºåºæ˜¯:äºŒçº§ç¼“å­˜â€”&gt;ä¸€çº§ç¼“å­˜â€”&gt;æ•°æ®åº“</p><h2 id="EhCacheç¼“å­˜"><a href="#EhCacheç¼“å­˜" class="headerlink" title="EhCacheç¼“å­˜"></a>EhCacheç¼“å­˜</h2><h3 id="åŸºæœ¬ä»‹ç»-5"><a href="#åŸºæœ¬ä»‹ç»-5" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>1.EhCacheæ˜¯ä¸€ä¸ªçº¯Javaçš„ç¼“å­˜æ¡†æ¶,å…·æœ‰å¿«é€Ÿ,ç²¾å¹²ç­‰ç‰¹ç‚¹<br>2.MyBatis æœ‰è‡ªå·±é»˜è®¤çš„äºŒçº§ç¼“å­˜(å‰é¢æˆ‘ä»¬å·²ç»ä½¿ç”¨è¿‡äº†)ï¼Œä½†æ˜¯åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¾€å¾€ä½¿ç”¨çš„æ˜¯æ›´åŠ ä¸“ä¸šçš„ç¬¬ä¸‰æ–¹ç¼“å­˜äº§å“<br>ä½œä¸º MyBatis çš„äºŒçº§ç¼“å­˜,EhCache å°±æ˜¯éå¸¸ä¼˜ç§€çš„ç¼“å­˜äº§å“</p><h3 id="é…ç½®å’Œä½¿ç”¨EhCache"><a href="#é…ç½®å’Œä½¿ç”¨EhCache" class="headerlink" title="é…ç½®å’Œä½¿ç”¨EhCache"></a>é…ç½®å’Œä½¿ç”¨EhCache</h3><p>Â·<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>net.sf.ehcache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>ehcache-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.6.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>slf4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.7.25<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis.caches<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-ehcache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>Â· mybatis-config.xmlä»ç„¶æ‰“å¼€äºŒçº§ç¼“å­˜<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- å¼€å¯äºŒçº§ç¼“å­˜,é»˜è®¤å°±æ˜¯æ‰“å¼€ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cacheEnabled<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>Â·é…ç½®æ–‡ä»¶<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ehcache</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--diskStoreï¼šä¸ºç¼“å­˜è·¯å¾„ï¼Œehcache åˆ†ä¸ºå†…å­˜å’Œç£ç›˜ä¸¤çº§ï¼Œæ­¤å±æ€§å®šä¹‰ç£ç›˜çš„ç¼“å­˜ä½ç½®ã€‚    å‚æ•°è§£é‡Šå¦‚ä¸‹ï¼š    user.home â€“ ç”¨æˆ·ä¸»ç›®å½•    user.dir â€“ ç”¨æˆ·å½“å‰å·¥ä½œç›®å½•    java.io.tmpdir â€“ é»˜è®¤ä¸´æ—¶æ–‡ä»¶è·¯å¾„    --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>diskStore</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.io.tmpdir/Tmp_EhCache<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!--defaultCacheï¼šé»˜è®¤ç¼“å­˜ç­–ç•¥ï¼Œå½“ ehcache æ‰¾ä¸åˆ°å®šä¹‰çš„ç¼“å­˜æ—¶ï¼Œåˆ™ä½¿ç”¨è¿™ä¸ªç¼“å­˜ç­–ç•¥ã€‚    åªèƒ½å®šä¹‰ä¸€ä¸ªã€‚    --></span>    <span class="token comment">&lt;!--name:ç¼“å­˜åç§°ã€‚    maxElementsInMemory:ç¼“å­˜æœ€å¤§æ•°ç›®    maxElementsOnDiskï¼šç¡¬ç›˜æœ€å¤§ç¼“å­˜ä¸ªæ•°ã€‚    eternal:å¯¹è±¡æ˜¯å¦æ°¸ä¹…æœ‰æ•ˆï¼Œä¸€ä½†è®¾ç½®äº†ï¼Œtimeout å°†ä¸èµ·ä½œç”¨ã€‚    overflowToDisk:æ˜¯å¦ä¿å­˜åˆ°ç£ç›˜ï¼Œå½“ç³»ç»Ÿå®•æœºæ—¶    timeToIdleSeconds:è®¾ç½®å¯¹è±¡åœ¨å¤±æ•ˆå‰çš„å…è®¸é—²ç½®æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ã€‚ä»…å½“ eternal=false    å¯¹è±¡ä¸æ˜¯æ°¸ä¹…æœ‰æ•ˆæ—¶ä½¿ç”¨ï¼Œå¯é€‰å±æ€§ï¼Œé»˜è®¤å€¼æ˜¯ 0ï¼Œä¹Ÿå°±æ˜¯å¯é—²ç½®æ—¶é—´æ— ç©·å¤§ã€‚    éŸ©é¡ºå¹³ Java å·¥ç¨‹å¸ˆ    timeToLiveSeconds:è®¾ç½®å¯¹è±¡åœ¨å¤±æ•ˆå‰å…è®¸å­˜æ´»æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ã€‚æœ€å¤§æ—¶é—´ä»‹äºåˆ›å»ºæ—¶    é—´å’Œå¤±æ•ˆæ—¶é—´ä¹‹é—´ã€‚ä»…å½“ eternal=false å¯¹è±¡ä¸æ˜¯æ°¸ä¹…æœ‰æ•ˆæ—¶ä½¿ç”¨ï¼Œé»˜è®¤æ˜¯ 0.ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡å­˜æ´»    æ—¶é—´æ— ç©·å¤§ã€‚    diskPersistentï¼šæ˜¯å¦ç¼“å­˜è™šæ‹Ÿæœºé‡å¯æœŸæ•°æ® Whether the disk store persists between    restarts of the Virtual Machine. The default value is false. diskSpoolBufferSizeMBï¼šè¿™ä¸ªå‚æ•°è®¾ç½® DiskStoreï¼ˆç£ç›˜ç¼“å­˜ï¼‰çš„ç¼“å­˜åŒºå¤§å°ã€‚é»˜è®¤æ˜¯    30MBã€‚æ¯ä¸ª Cache éƒ½åº”è¯¥æœ‰è‡ªå·±çš„ä¸€ä¸ªç¼“å†²åŒºã€‚    diskExpiryThreadIntervalSecondsï¼šç£ç›˜å¤±æ•ˆçº¿ç¨‹è¿è¡Œæ—¶é—´é—´éš”ï¼Œé»˜è®¤æ˜¯ 120 ç§’ã€‚    memoryStoreEvictionPolicyï¼šå½“è¾¾åˆ° maxElementsInMemory é™åˆ¶æ—¶ï¼ŒEhcache å°†ä¼šæ ¹    æ®æŒ‡å®šçš„ç­–ç•¥å»æ¸…ç†å†…å­˜ã€‚é»˜è®¤ç­–ç•¥æ˜¯ LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ã€‚ä½ å¯ä»¥è®¾ç½®ä¸º FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰    æˆ–æ˜¯ LFUï¼ˆè¾ƒå°‘ä½¿ç”¨ï¼‰ã€‚    clearOnFlushï¼šå†…å­˜æ•°é‡æœ€å¤§æ—¶æ˜¯å¦æ¸…é™¤ã€‚    memoryStoreEvictionPolicy:å¯é€‰ç­–ç•¥æœ‰ï¼šLRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œé»˜è®¤ç­–ç•¥ï¼‰ã€FIFOï¼ˆå…ˆ    è¿›å…ˆå‡ºï¼‰ã€LFUï¼ˆæœ€å°‘è®¿é—®æ¬¡æ•°ï¼‰ã€‚    FIFOï¼Œfirst in first outï¼Œè¿™ä¸ªæ˜¯å¤§å®¶æœ€ç†Ÿçš„ï¼Œå…ˆè¿›å…ˆå‡ºã€‚    LFUï¼Œ Less Frequently Usedï¼Œå°±æ˜¯ä¸Šé¢ä¾‹å­ä¸­ä½¿ç”¨çš„ç­–ç•¥ï¼Œç›´ç™½ä¸€ç‚¹å°±æ˜¯è®²ä¸€ç›´ä»¥æ¥    æœ€å°‘è¢«ä½¿ç”¨çš„ã€‚å¦‚ä¸Šé¢æ‰€è®²ï¼Œç¼“å­˜çš„å…ƒç´ æœ‰ä¸€ä¸ª hit å±æ€§ï¼Œhit å€¼æœ€å°çš„å°†ä¼šè¢«æ¸…å‡ºç¼“å­˜ã€‚    LRUï¼ŒLeast Recently Usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ï¼Œç¼“å­˜çš„å…ƒç´ æœ‰ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œå½“ç¼“å­˜å®¹é‡    æ»¡äº†ï¼Œè€Œåˆéœ€è¦è…¾å‡ºåœ°æ–¹æ¥ç¼“å­˜æ–°çš„å…ƒç´ çš„æ—¶å€™ï¼Œé‚£ä¹ˆç°æœ‰ç¼“å­˜å…ƒç´ ä¸­æ—¶é—´æˆ³ç¦»å½“å‰æ—¶é—´æœ€è¿œçš„    å…ƒç´ å°†è¢«æ¸…å‡ºç¼“å­˜ã€‚    --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>defaultCache</span>            <span class="token attr-name">eternal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>            <span class="token attr-name">maxElementsInMemory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10000<span class="token punctuation">"</span></span>            <span class="token attr-name">overflowToDisk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>            <span class="token attr-name">diskPersistent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>            <span class="token attr-name">timeToIdleSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1800<span class="token punctuation">"</span></span>            <span class="token attr-name">timeToLiveSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>259200<span class="token punctuation">"</span></span>            <span class="token attr-name">memoryStoreEvictionPolicy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LRU<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ehcache</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!--eternal:å¯¹è±¡æ˜¯å¦æ°¸ä¹…æœ‰æ•ˆï¼Œä¸€ä½†è®¾ç½®äº†ï¼Œtimeout å°†ä¸èµ·ä½œç”¨ã€‚--></span>        <span class="token comment">&lt;!--maxElementsInMemory:ç¼“å­˜æœ€å¤§æ•°ç›®--></span>        <span class="token comment">&lt;!--maxElementsOnDiskï¼šç¡¬ç›˜æœ€å¤§ç¼“å­˜ä¸ªæ•°ã€‚--></span>        <span class="token comment">&lt;!--overflowToDisk:æ˜¯å¦ä¿å­˜åˆ°ç£ç›˜ï¼Œå½“ç³»ç»Ÿå®•æœºæ—¶--></span>        <span class="token comment">&lt;!--diskPersistentï¼šæ˜¯å¦ç¼“å­˜è™šæ‹Ÿæœºé‡å¯æœŸæ•°æ® Whether the disk store persists between--></span>        <span class="token comment">&lt;!--timeToIdleSeconds:è®¾ç½®å¯¹è±¡åœ¨å¤±æ•ˆå‰çš„å…è®¸é—²ç½®æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ã€‚ä»…å½“ eternal=false--></span>        <span class="token comment">&lt;!--å¯¹è±¡ä¸æ˜¯æ°¸ä¹…æœ‰æ•ˆæ—¶ä½¿ç”¨ï¼Œå¯é€‰å±æ€§ï¼Œé»˜è®¤å€¼æ˜¯ 0ï¼Œä¹Ÿå°±æ˜¯å¯é—²ç½®æ—¶é—´æ— ç©·å¤§--></span>        <span class="token comment">&lt;!--timeToLiveSeconds:è®¾ç½®å¯¹è±¡åœ¨å¤±æ•ˆå‰å…è®¸å­˜æ´»æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ã€‚æœ€å¤§æ—¶é—´ä»‹äºåˆ›å»ºæ—¶--></span>        <span class="token comment">&lt;!--memoryStoreEvictionPolicyæ¸…é™¤ç­–ç•¥--></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="MyBatisPlusé€†å‘"><a href="#MyBatisPlusé€†å‘" class="headerlink" title="MyBatisPlusé€†å‘"></a>MyBatisPlusé€†å‘</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>Â·åˆ›å»ºè¡¨ï¼Œä½¿ç”¨é€†å‘å·¥ç¨‹ç”Ÿæˆ Beanã€XxxMapper å’Œ XxxMapper<br>Â·ä¾‹<br><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> furn<span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span> <span class="token comment">## id</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token comment">## å®¶å±…å</span><span class="token identifier"><span class="token punctuation">`</span>maker<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token comment">## å‚å•†</span><span class="token identifier"><span class="token punctuation">`</span>price<span class="token punctuation">`</span></span> <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token comment">## ä»·æ ¼</span><span class="token identifier"><span class="token punctuation">`</span>sales<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token comment">## é”€é‡</span><span class="token identifier"><span class="token punctuation">`</span>stock<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token comment">## åº“å­˜</span><span class="token identifier"><span class="token punctuation">`</span>img_path<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token comment">## ç…§ç‰‡è·¯å¾„</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>Â·ä½¿ç”¨MyBatis Generatoré€†å‘å·¥ç¨‹ç”Ÿæˆbean mapper æ¥å£å’Œ mapper.xml<br>Â·åœ¨ä½¿ç”¨å‰å¼•å…¥MyBatis GeneratoråŒ…<br>Â·ä¿®æ”¹MyBatisPlusé€†å‘çš„é…ç½®æ–‡ä»¶<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">generatorConfiguration</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"</span>        <span class="token string">"http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generatorConfiguration</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>context</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DB2Tables<span class="token punctuation">"</span></span> <span class="token attr-name">targetRuntime</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MyBatis3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- ç”Ÿæˆæ²¡æœ‰æ³¨é‡Šçš„ bean--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>commentGenerator</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>suppressAllComments<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>commentGenerator</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- é…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdbcConnection</span> <span class="token attr-name">driverClass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mysql.cj.jdbc.Driver<span class="token punctuation">"</span></span> <span class="token attr-name">connectionURL</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbc:mysql://localhost:3306/home_furnishing?characterEncoding=utf8<span class="token punctuation">"</span></span> <span class="token attr-name">userId</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1234<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nullCatalogMeansCurrent<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jdbcConnection</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>javaTypeResolver</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>forceBigDecimals<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>javaTypeResolver</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- æŒ‡å®š javaBean ç”Ÿæˆçš„ä½ç½®--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>javaModelGenerator</span> <span class="token attr-name">targetPackage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.furn.bean<span class="token punctuation">"</span></span>                            <span class="token attr-name">targetProject</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.\src\main\java<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>enableSubPackages<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>trimStrings<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>javaModelGenerator</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- æŒ‡å®š sql æ˜ å°„æ–‡ä»¶ç”Ÿæˆçš„ä½ç½®--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sqlMapGenerator</span> <span class="token attr-name">targetPackage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mapper<span class="token punctuation">"</span></span> <span class="token attr-name">targetProject</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.\src\main\resources<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>enableSubPackages<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sqlMapGenerator</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- æŒ‡å®š dao æ¥å£ç”Ÿæˆçš„ä½ç½®, ä¹Ÿå°±æ˜¯ mapper æ¥å£--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>javaClientGenerator</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>XMLMAPPER<span class="token punctuation">"</span></span> <span class="token attr-name">targetPackage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.furn.dao<span class="token punctuation">"</span></span>                             <span class="token attr-name">targetProject</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.\src\main\java<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>enableSubPackages<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>javaClientGenerator</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- æŒ‡å®šè¦é€†å‘ç”Ÿæˆçš„è¡¨å’Œç”Ÿæˆç­–ç•¥--></span>       ` <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">tableName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>furn<span class="token punctuation">"</span></span> <span class="token attr-name">domainObjectName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Furn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span>`    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>generatorConfiguration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>Â·ç›´æ¥è¿è¡Œè¯¥ç¨‹åºå°±ä¼šç”Ÿæˆéœ€è¦çš„bean,dao,Mapper.xmlæ–‡ä»¶<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">XMLParserException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InvalidConfigurationException</span><span class="token punctuation">,</span> <span class="token class-name">SQLException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>         <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> warnings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">boolean</span> overwrite <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token comment">//æŒ‡å®šé…ç½®æ–‡ä»¶</span>         <span class="token class-name">File</span> configFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"mbg.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token class-name">ConfigurationParser</span> cp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConfigurationParser</span><span class="token punctuation">(</span>warnings<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token class-name">Configuration</span> config <span class="token operator">=</span> cp<span class="token punctuation">.</span><span class="token function">parseConfiguration</span><span class="token punctuation">(</span>configFile<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token class-name">DefaultShellCallback</span> callback <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultShellCallback</span><span class="token punctuation">(</span>overwrite<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token class-name">MyBatisGenerator</span> myBatisGenerator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyBatisGenerator</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> warnings<span class="token punctuation">)</span><span class="token punctuation">;</span>         myBatisGenerator<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"é€†å‘ç”Ÿæˆ OK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title&gt;&lt;/a&gt;&lt;div class=&quot;note purple no-icon flat&quot;&gt;&lt;p&gt;MyBatiså¤ä¹  &lt;/p&gt;
&lt;/div&gt;&lt;/h1&gt;&lt;h2 id=&quot;åŸºæœ¬ä»‹ç»&quot;&gt;&lt;a href=&quot;#åŸº</summary>
      
    
    
    
    <category term="ä¸»æµæ¡†æ¶" scheme="https://100qin10086.github.io/categories/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6/"/>
    
    
    <category term="MyBatis" scheme="https://100qin10086.github.io/tags/MyBatis/"/>
    
    <category term="æ¡†æ¶" scheme="https://100qin10086.github.io/tags/%E6%A1%86%E6%9E%B6/"/>
    
    <category term="Java" scheme="https://100qin10086.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVCå¤ä¹ </title>
    <link href="https://100qin10086.github.io/posts/a4c26199.html"/>
    <id>https://100qin10086.github.io/posts/a4c26199.html</id>
    <published>2024-03-29T00:29:05.000Z</published>
    <updated>2024-05-06T14:13:59.610Z</updated>
    
    <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a><div class="note purple no-icon flat"><p>SpringMVC-åŸºæœ¬ä»‹ç» </p></div></h1><h2 id="SpringMVC-ç‰¹ç‚¹-amp-æ¦‚è¿°"><a href="#SpringMVC-ç‰¹ç‚¹-amp-æ¦‚è¿°" class="headerlink" title="SpringMVC ç‰¹ç‚¹&amp;æ¦‚è¿°"></a>SpringMVC ç‰¹ç‚¹&amp;æ¦‚è¿°</h2><p>1.SpringMVC æ˜¯ WEB å±‚æ¡†æ¶ã€è€éŸ©è§£è¯»:SpringMVCæ¥ç®¡äº†Webå±‚ç»„ä»¶,æ¯”å¦‚æ§åˆ¶å™¨,è§†å›¾,è§†å›¾è§£æ, è¿”å›ç»™ç”¨æˆ·çš„æ•°æ®æ ¼å¼,<br>åŒæ—¶æ”¯æŒ MVC çš„å¼€å‘æ¨¡å¼/å¼€å‘æ¶æ„ã€‚<br>2.SpringMVC é€šè¿‡æ³¨è§£ï¼Œè®© POJO æˆä¸ºæ§åˆ¶å™¨ï¼Œä¸éœ€è¦ç»§æ‰¿ç±»æˆ–è€…å®ç°æ¥å£<br>3.SpringMVC é‡‡ç”¨ä½è€¦åˆçš„ç»„ä»¶è®¾è®¡æ–¹å¼ï¼Œå…·æœ‰æ›´å¥½æ‰©å±•å’Œçµæ´»æ€§ã€‚<br>4.æ”¯æŒ REST æ ¼å¼çš„ URL è¯·æ±‚<br>5.Spring MVC åªæ˜¯ Spring å¤„ç† WEB å±‚è¯·æ±‚çš„ä¸€ä¸ªæ¨¡å—/ç»„ä»¶, Spring MVC çš„åŸºçŸ³æ˜¯Servlet[Java WEB]ã€‚<br>6.Spring Boot æ˜¯ä¸ºäº†ç®€åŒ–å¼€å‘è€…çš„ä½¿ç”¨, æ¨å‡ºçš„å°ç¥æ¡†æ¶(çº¦å®šä¼˜äºé…ç½®ï¼Œç®€åŒ–äº† Springçš„é…ç½®æµç¨‹), SpringBoot<br>åŒ…å«å¾ˆå¤šç»„ä»¶/æ¡†æ¶ï¼ŒSpringå°±æ˜¯æœ€æ ¸å¿ƒçš„å†…å®¹ä¹‹ä¸€ï¼Œä¹ŸåŒ…å« SpringMVCã€‚<br>7.ä»–ä»¬çš„å…³ç³»å¤§æ¦‚æ˜¯: Spring Boot &gt; Spring &gt; Spring MVC</p><h3 id="SpringMVCç™»å½•æµç¨‹åˆ†æ"><a href="#SpringMVCç™»å½•æµç¨‹åˆ†æ" class="headerlink" title="SpringMVCç™»å½•æµç¨‹åˆ†æ"></a>SpringMVCç™»å½•æµç¨‹åˆ†æ</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/53e2f22491771143335f4cec92d8cbeb.png"></div></div><p>Â·åŸºæœ¬æµç¨‹<br>1.åˆ›å»ºsrc/application-mvc.xmlæ–‡ä»¶(å°±æ˜¯springçš„å®¹å™¨æ–‡ä»¶),æ–‡ä»¶åè‡ªå·±å®š<br>2.WEB-INF/web.xmlé…ç½®</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--1.ä¸­å¤®æ§åˆ¶å™¨2.è´Ÿè´£å¤„ç†æ‰€æœ‰çš„åº”ç”¨è¯·æ±‚--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlets</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>springDispatcherServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>org.springframework.web.servlet.DispatcherServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>contextConfigLocation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!-- springmvc çš„é…ç½®æ–‡ä»¶å’Œä»¥å‰ spring çš„é…ç½®æ–‡ä»¶ç±»ä¼¼ --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>classpath:applicationContext-mvc.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- åœ¨ web é¡¹ç›®å¯åŠ¨æ—¶ï¼Œå°±åŠ è½½è¿™ä¸ª servlet å®ä¾‹ 1 è¡¨ç¤ºåŠ è½½çš„é¡ºåºå·--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>load-on-startup</span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>load-on-startup</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>springDispatcherServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- ä¸ºäº†æ”¯æŒ rest é£æ ¼çš„ url è¿™é‡Œçš„ url-patther éœ€è¦å†™æˆ / --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlets</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="SpringMVCæ‰§è¡Œæµç¨‹"><a href="#SpringMVCæ‰§è¡Œæµç¨‹" class="headerlink" title="SpringMVCæ‰§è¡Œæµç¨‹"></a>SpringMVCæ‰§è¡Œæµç¨‹</h2><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/3a91be113516534d29d133158909c565.png"></div></div><h2 id="RequestMapping"><a href="#RequestMapping" class="headerlink" title="@RequestMapping"></a>@RequestMapping</h2><h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h3><p>Â·@RequestMappingæ³¨è§£å¯ä»¥æŒ‡å®šæ§åˆ¶å™¨/å¤„ç†å™¨å¾—æŸä¸ªæ–¹æ³•å¾—è¯·æ±‚å¾—urlã€‚<br>Â·@RequestMappingå¯ä»¥ä¿®é¥°ç±»å’Œæ–¹æ³•,å½“åŒæ—¶ä¿®é¥°ç±»å’Œæ–¹æ³•æ—¶,è¯·æ±‚å¾—urlå°±æ˜¯ç»„åˆ/ç±»è¯·æ±‚å€¼/æ–¹æ³•è¯·æ±‚å€¼<br>Â·@RequestMappingè¿˜å¯ä»¥æŒ‡å®šè¯·æ±‚å¾—æ–¹å¼(post/get/put/delete),è¯·æ±‚å¾—æ–¹å¼éœ€è¦å’ŒæŒ‡å®šå¾—ä¸€æ ·,å¦åˆ™æŠ¥é”™<br>Â·SpringMVCæ§åˆ¶å™¨é»˜è®¤æ”¯æŒGETå’ŒPOSTä¸¤ç§æ–¹å¼,ä¹Ÿå°±æ˜¯ä½ ä¸æŒ‡å®šmethod,å¯ä»¥æ¥æ”¶GETå’ŒPOSTè¯·æ±‚<br>Â·å½“æ˜ç¡®æŒ‡å®šäº† method , åˆ™éœ€è¦æŒ‰æŒ‡å®šæ–¹å¼è¯·æ±‚, å¦åˆ™ä¼šæŠ¥é”™</p><h3 id="RequestMapping-å¯æŒ‡å®š-params-å’Œ-headers-æ”¯æŒç®€å•è¡¨è¾¾å¼"><a href="#RequestMapping-å¯æŒ‡å®š-params-å’Œ-headers-æ”¯æŒç®€å•è¡¨è¾¾å¼" class="headerlink" title="@RequestMapping å¯æŒ‡å®š params å’Œ headers æ”¯æŒç®€å•è¡¨è¾¾å¼"></a>@RequestMapping å¯æŒ‡å®š params å’Œ headers æ”¯æŒç®€å•è¡¨è¾¾å¼</h3><p>Â·param1:è¡¨ç¤ºè¯·æ±‚å¿…é¡»åŒ…å«åä¸ºparam1å¾—è¯·æ±‚å‚æ•°<br>Â·!=param1: è¡¨ç¤ºè¯·æ±‚ä¸èƒ½åŒ…å«åä¸º param1 çš„è¯·æ±‚å‚æ•°<br>Â·param1 != value1: è¡¨ç¤ºè¯·æ±‚åŒ…å«åä¸º param1 çš„è¯·æ±‚å‚æ•°ï¼Œä½†å…¶å€¼ä¸èƒ½ä¸º value1</p><h4 id="åº”ç”¨å®ä¾‹"><a href="#åº”ç”¨å®ä¾‹" class="headerlink" title="åº”ç”¨å®ä¾‹"></a>åº”ç”¨å®ä¾‹</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/find"</span><span class="token punctuation">,</span> params <span class="token operator">=</span> <span class="token string">"bookId"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">String</span> bookId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æŸ¥è¯¢ä¹¦ç± bookId= "</span> <span class="token operator">+</span> bookId<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="RequestMappingæ”¯æŒAntåˆ†æ ¼èµ„æºåœ°å€"><a href="#RequestMappingæ”¯æŒAntåˆ†æ ¼èµ„æºåœ°å€" class="headerlink" title="@RequestMappingæ”¯æŒAntåˆ†æ ¼èµ„æºåœ°å€"></a>@RequestMappingæ”¯æŒAntåˆ†æ ¼èµ„æºåœ°å€</h3><p>Â· ?:åŒ¹é…æ–‡ä»¶åä¸­å¾—ä¸€ä¸ªå­—ç¬¦<br>Â· <em>:åŒ¹é…æ–‡ä»¶åä¸­å¾—ä»»æ„å­—ç¬¦<br>Â· *</em>:åŒ¹é…å¤šå±‚è·¯å¾„</p><h3 id="RequestMapping-å¯é…åˆ-PathVariable-æ˜ å°„-URL-ç»‘å®šå¾—å ä½ç¬¦"><a href="#RequestMapping-å¯é…åˆ-PathVariable-æ˜ å°„-URL-ç»‘å®šå¾—å ä½ç¬¦" class="headerlink" title="@RequestMapping å¯é…åˆ @PathVariable æ˜ å°„ URL ç»‘å®šå¾—å ä½ç¬¦"></a>@RequestMapping å¯é…åˆ @PathVariable æ˜ å°„ URL ç»‘å®šå¾—å ä½ç¬¦</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/reg/&#123;username&#125;/&#123;userid&#125;"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"userid"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¥æ”¶åˆ°çš„å‚æ•°--"</span><span class="token operator">+</span><span class="token string">"username= "</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">"--"</span><span class="token operator">+</span><span class="token string">"userid= "</span><span class="token operator">+</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Rest-ä¼˜é›…å¾—urlè¯·æ±‚åˆ†æ ¼"><a href="#Rest-ä¼˜é›…å¾—urlè¯·æ±‚åˆ†æ ¼" class="headerlink" title="Rest-ä¼˜é›…å¾—urlè¯·æ±‚åˆ†æ ¼"></a>Rest-ä¼˜é›…å¾—urlè¯·æ±‚åˆ†æ ¼</h2><p>Â·Rest:(èµ„æº)è¡¨ç°å±‚çŠ¶æ€è½¬åŒ–ã€‚æ˜¯ç›®å‰æµè¡Œçš„è¯·æ±‚æ–¹å¼ã€‚å®ƒç»“æ„æ¸…æ™°, å¾ˆå¤šç½‘ç«™é‡‡ç”¨<br>Â·ä¼ ç»Ÿçš„ url æ˜¯é€šè¿‡å‚æ•°æ¥è¯´æ˜ crud çš„ç±»å‹ï¼Œrest æ˜¯é€šè¿‡ get/post/put/delete æ¥è¯´æ˜ crud çš„ç±»å‹<br>Â·å½“å‰å¾—æµè§ˆå™¨åªæ”¯æŒpost/getè¯·æ±‚,å› æ­¤ä¸ºäº†å¾—åˆ°put/deleteå¾—è¯·æ±‚æ–¹å¼éœ€è¦ä½¿ç”¨Springæä¾›å¾—HiddenHttpMethodFilterè¿‡æ»¤å™¨è¿›è¡Œè½¬æ¢<br>Â·HiddenHttpMethodFilter:æµè§ˆå™¨formè¡¨å•åªæ”¯æŒGETä¸POSTè¯·æ±‚,è€ŒDELETE,PUTç­‰methodå¹¶ä¸æ”¯æŒ,Springæ·»åŠ äº†ä¸€ä¸ªè¿‡æ»¤å™¨,<br>å¯ä»¥å°†è¿™äº›è¯·æ±‚è½¬æ¢ä¸ºæ ‡å‡†çš„httpæ–¹æ³•<br>Â·è¿™ä¸ªè¿‡æ»¤å™¨éœ€è¦åœ¨web.xmlä¸­é…ç½®</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filters</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>hiddenHttpMethodFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">></span></span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>hiddenHttpMethodFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filters</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·åœ¨springå¾—é…ç½®xmlä¸­æ·»åŠ ä¸¤ä¸ªå¸¸è§„é…ç½®</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mvcs</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- èƒ½æ”¯æŒ SpringMVC é«˜çº§åŠŸèƒ½ï¼Œæ¯”å¦‚ JSR303 æ ¡éªŒï¼Œæ˜ å°„åŠ¨æ€è¯·æ±‚ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>annotation-driven</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mvc:</span>annotation-driven</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- å°† SpringMVC ä¸èƒ½å¤„ç†çš„è¯·æ±‚äº¤ç»™ Tomcat, æ¯”å¦‚è¯·æ±‚ css,js ç­‰--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>default-servlet-handler</span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mvcs</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>1.HiddenHttpMethodFilter,åœ¨å°†postè½¬æˆdelete/putè¯·æ±‚æ—¶,æ˜¯æŒ‰_methodå‚æ•°åæ¥è¯»å–å¾—</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_method<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="SpringMVCæ˜ å°„è¯·æ±‚æ•°æ®"><a href="#SpringMVCæ˜ å°„è¯·æ±‚æ•°æ®" class="headerlink" title="SpringMVCæ˜ å°„è¯·æ±‚æ•°æ®"></a>SpringMVCæ˜ å°„è¯·æ±‚æ•°æ®</h2><h3 id="è·å–å‚æ•°å€¼"><a href="#è·å–å‚æ•°å€¼" class="headerlink" title="è·å–å‚æ•°å€¼"></a>è·å–å‚æ•°å€¼</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/vote1"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"name"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¾—åˆ°çš„username= "</span> <span class="token operator">+</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·è§£è¯»:<br>1.@RequestParamè¡¨ç¤ºè¯´æ˜ä¸€ä¸ªæ¥å—åˆ°å¾—å‚æ•°<br>2.value=name:æ¥æ”¶å¾—å‚æ•°åæ˜¯name<br>3.required=false:è¡¨ç¤ºè¯¥å‚æ•°å¯ä»¥æœ‰,ä¹Ÿå¯ä»¥æ²¡æœ‰</p><h3 id="è·å–httpè¯·æ±‚æ¶ˆæ¯å¤´"><a href="#è·å–httpè¯·æ±‚æ¶ˆæ¯å¤´" class="headerlink" title="è·å–httpè¯·æ±‚æ¶ˆæ¯å¤´"></a>è·å–httpè¯·æ±‚æ¶ˆæ¯å¤´</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/vote2"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span><span class="token string">"Accept-Encoding"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> ae<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span><span class="token string">"Host"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> host<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¥æ”¶åˆ°çš„ Accept-Encoding="</span> <span class="token operator">+</span> ae<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Host="</span> <span class="token operator">+</span> host<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¿”å›ä¸€ä¸ªç»“æœ</span>        <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è·å–-javabean-å½¢å¼çš„æ•°æ®"><a href="#è·å–-javabean-å½¢å¼çš„æ•°æ®" class="headerlink" title="è·å– javabean å½¢å¼çš„æ•°æ®"></a>è·å– javabean å½¢å¼çš„æ•°æ®</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/vote3"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token class-name">Master</span> master<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>master<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vote/vote03<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    ä¸»äººå·:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    ä¸»äººå:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    å® ç‰©å·:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pet.id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    å® ç‰©å:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pet.name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>æ·»åŠ ä¸»äººå’Œå® ç‰©<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è§£è¯»:è¿™é‡Œå¾—å­—æ®µåç§°å’Œå¯¹è±¡å¾—å±æ€§åä¿æŒä¸€è‡´,çº§è”æ·»åŠ å±æ€§ä¹Ÿæ˜¯ä¸€æ ·ä¿æŒåå­—å¯¹åº”å…³ç³»</p><h3 id="ä½¿ç”¨æ³¨æ„äº‹é¡¹"><a href="#ä½¿ç”¨æ³¨æ„äº‹é¡¹" class="headerlink" title="ä½¿ç”¨æ³¨æ„äº‹é¡¹"></a>ä½¿ç”¨æ³¨æ„äº‹é¡¹</h3><p>1.æ”¯æŒçº§è”æ•°æ®è·å–<br>2.è¡¨å•å¾—æ§ä»¶åç§°nameéœ€è¦å’Œjavabeanå¯¹è±¡å­—æ®µå¯¹åº”</p><h2 id="è·å–servlet-api"><a href="#è·å–servlet-api" class="headerlink" title="è·å–servlet api"></a>è·å–servlet api</h2><p>1.å¼€å‘ä¸­,æˆ‘ä»¬å¯èƒ½éœ€è¦ç”¨åˆ°åŸç”Ÿå¾—servlet api</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/vote4"</span><span class="token punctuation">)</span>  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test04</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token class-name">String</span> username <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">String</span> pwd <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"pwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">HttpSession</span> session1 <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pwd<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//æ³¨æ„ï¼šé€šè¿‡å‚æ•°ä¼ å…¥çš„sessionå’Œé€šè¿‡åŸç”Ÿæ–¹å¼å¾—åˆ°çš„session1æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span>      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>session1<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//è¿”å›ç»“æœ</span>      <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ¨¡å‹æ•°æ®"><a href="#æ¨¡å‹æ•°æ®" class="headerlink" title="æ¨¡å‹æ•°æ®"></a>æ¨¡å‹æ•°æ®</h2><h3 id="æ¨¡å‹æ•°æ®å¤„ç†-æ•°æ®æ”¾å…¥request"><a href="#æ¨¡å‹æ•°æ®å¤„ç†-æ•°æ®æ”¾å…¥request" class="headerlink" title="æ¨¡å‹æ•°æ®å¤„ç†-æ•°æ®æ”¾å…¥request"></a>æ¨¡å‹æ•°æ®å¤„ç†-æ•°æ®æ”¾å…¥request</h3><p>1.ä½¿ç”¨requestæ”¾å…¥åŸŸä¸­</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">,</span> <span class="token string">"åŒ—äº¬"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2.é€šè¿‡è¯·æ±‚å¾—æ–¹æ³•å‚æ•°Map<String,Object>æ”¾å…¥requeståŸŸ</String,Object></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/vote06"</span><span class="token punctuation">)</span>   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test06</span><span class="token punctuation">(</span><span class="token class-name">Master</span> master<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> map<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       <span class="token comment">//è§£è¯»</span>       <span class="token comment">//1.éœ€æ±‚æ˜¯é€šè¿‡mapå¯¹è±¡ï¼Œæ·»åŠ å±æ€§åˆ°requestä¸­</span>       <span class="token comment">//2.åŸç†åˆ†æï¼Œå°†masteræ”¾å…¥åˆ°requeståŸŸä¸­ï¼Œç„¶åéå†mapï¼Œå‘ç°mapä¸­æœ‰æ•°æ®ï¼Œç„¶åæ”¾å…¥åˆ°request</span>       map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">,</span> <span class="token string">"LZ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> <span class="token string">"vote_ok"</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3.é€šè¿‡è¿”å›ModelAndViewå¯¹è±¡å®ç°requeståŸŸæ•°æ®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/vote07"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">test07</span><span class="token punctuation">(</span><span class="token class-name">Master</span> master<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ModelAndView</span> modelAndView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ”¾å…¥å±æ€§åˆ°ModelAndViewå¯¹è±¡</span>        modelAndView<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">,</span> <span class="token string">"LZ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å°†Masteræ”¾å…¥åˆ°requeståŸŸä¸­ï¼Œä¼šå¯¹ModelAndViewè¿›è¡Œæ‰«æï¼ŒModelAndViewä¸­æœ‰æ•°æ®ï¼Œå°±æ·»åŠ åˆ°requeståŸŸä¸­</span>        <span class="token comment">//è¿™é‡ŒæŒ‡å®šè·³è½¬çš„å±å…”åç§°</span>        modelAndView<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"vote_ok"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¿”å›ç»“æœ</span>        <span class="token keyword">return</span> modelAndView<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä½¿ç”¨æ³¨æ„äº‹é¡¹-1"><a href="#ä½¿ç”¨æ³¨æ„äº‹é¡¹-1" class="headerlink" title="ä½¿ç”¨æ³¨æ„äº‹é¡¹"></a>ä½¿ç”¨æ³¨æ„äº‹é¡¹</h3><p>1.ä»æœ¬è´¨çœ‹è¯·æ±‚å“åº”å¾—æ–¹æ³•return â€œxxâ€,æ˜¯è¿”å›äº†ä¸€ä¸ªå­—ç¬¦ä¸²,å…¶å®æœ¬è´¨æ˜¯è¿”å›äº†ä¸€ä¸ªModelAndViewå¯¹è±¡,åªæ˜¯é»˜è®¤è¢«å°è£…èµ·æ¥äº†<br>2.ModelAndViewå³å¯ä»¥åŒ…å«modelæ•°æ®,ä¹Ÿå¯ä»¥åŒ…å«è§†å›¾ä¿¡æ¯<br>3.ModelAndViewå¯¹è±¡å¾—addObjectæ–¹æ³•å¯ä»¥æ·»åŠ key-valæ•°æ®,é»˜è®¤åœ¨requeståŸŸä¸­<br>4.ModelAndViewå¯¹è±¡å¾—setViewæ–¹æ³•å¯ä»¥æŒ‡å®šè§†å›¾åç§°</p><h2 id="ModelAttributeå®ç°prepareæ–¹æ³•"><a href="#ModelAttributeå®ç°prepareæ–¹æ³•" class="headerlink" title="@ModelAttributeå®ç°prepareæ–¹æ³•"></a>@ModelAttributeå®ç°prepareæ–¹æ³•</h2><p>Â·åŸºæœ¬è¯´æ˜<br>1.åœ¨å¼€å‘ä¸­,æœ‰æ—¶éœ€è¦ä½¿ç”¨æŸä¸ªå‰ç½®æ–¹æ³•,ç»™ç›®æ ‡æ–¹æ³•å‡†å¤‡ä¸€ä¸ªæ¨¡å‹å¯¹è±¡<br>2.@ModelAttributeæ³¨è§£å¯ä»¥å®ç°è¿™æ ·å¾—éœ€æ±‚<br>3.åœ¨æŸä¸ªhandlerå¾—æ–¹æ³•ä¸Šå¢åŠ äº†@ModelAttributeæ³¨è§£å,é‚£ä¹ˆåœ¨è°ƒç”¨è¯¥Handlerå¾—ä»»ä½•ä¸€ä¸ªæ–¹æ³•æ—¶,éƒ½ä¼šå…ˆè°ƒç”¨è¿™ä¸ªæ–¹æ³•</p><h2 id="è§†å›¾å’Œè§†å›¾è§£æå™¨"><a href="#è§†å›¾å’Œè§†å›¾è§£æå™¨" class="headerlink" title="è§†å›¾å’Œè§†å›¾è§£æå™¨"></a>è§†å›¾å’Œè§†å›¾è§£æå™¨</h2><h3 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>1.åœ¨springMVCä¸­å¾—ç›®æ ‡æ–¹æ³•æœ€ç»ˆè¿”å›éƒ½æ˜¯ä¸€ä¸ªè§†å›¾(æœ‰å„ç§è§†å›¾)<br>2.è¿”å›å¾—è§†å›¾éƒ½ä¼šç”±ä¸€ä¸ªè§†å›¾è§£æå™¨æ¥å¤„ç†</p><h3 id="è‡ªå®šä¹‰è§†å›¾"><a href="#è‡ªå®šä¹‰è§†å›¾" class="headerlink" title="è‡ªå®šä¹‰è§†å›¾"></a>è‡ªå®šä¹‰è§†å›¾</h3><p>1.åœ¨é»˜è®¤æƒ…å†µä¸‹,æˆ‘ä»¬å¦æ˜¯è¿”å›é»˜è®¤å¾—è§†å›¾,ç„¶åè¿™ä¸ªè¿”å›å¾—è§†å›¾äº¤ç”±SpringMVCå¾—InternalResourceViewResolveræ¥å¤„ç†,è¿™ä¸ªåœ¨é…ç½®å¾—xml<br>2.é…ç½®springDispatcherServlet-servlet.xml,å¢åŠ è‡ªå®šä¹‰è§†å›¾è§£æå™¨</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.web.servlet.view.BeanNameViewResolver<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>order<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>99<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Â·è§£è¯»:<br>1.ä¸Šé¢å¾—é…ç½®æ˜¯ä¸€ä¸ªå¯ä»¥è§£æè‡ªå®šä¹‰å¾—è§†å›¾å¾—è§£æå™¨<br>2.name=â€orderâ€è¡¨ç¤ºç»™è¿™ä¸ªè§£æå™¨è®¾ç½®ä¼˜å…ˆçº§,é»˜è®¤ä¼˜å…ˆçº§å¾ˆä½,å€¼ä¸ºInteger.MAX_VALUE</p><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>Â·@Componentè¡¨ç¤ºè¯¥è§†å›¾ä¼šè¢«åŠ è½½åˆ°å®¹å™¨,idä¸ºmyView</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"qgqView"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyView</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractView</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">renderMergedOutputModel</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> model<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å®Œæˆè§†å›¾æ¸²æŸ“</span>        <span class="token comment">// å¹¶ä¸”å¯ä»¥ç¡®å®šæˆ‘ä»¬è¦è·³è½¬çš„é¡µé¢[è¯·æ±‚è½¬å‘] /WEB-INF/pages/my_view.jsp</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿›å…¥åˆ°è‡ªå·±çš„è§†å›¾ã€‚ã€‚ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//1.ä¸‹é¢çš„å°±æ˜¯è¿›è¡Œè¯·æ±‚è½¬å‘åˆ°/WEB-INF/pages/my_view.jsp</span>        <span class="token comment">//2./WEB-INF/pages/my_view.jspä¼šè¢«springmvcè§£ææˆ/springmvc//WEB-INF/pages/my_view.jsp</span>        request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"/WEB-INF/pages/my_view.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/buy"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">buy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----buy()-----"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"qgqView"</span><span class="token punctuation">;</span><span class="token comment">// è§†å›¾åè¦å’Œè‡ªå®šä¹‰è§†å›¾åçš„valueä¿æŒä¸€è‡´</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è‡ªå®šä¹‰è§†å›¾å·¥ä½œæµç¨‹å°ç»“"><a href="#è‡ªå®šä¹‰è§†å›¾å·¥ä½œæµç¨‹å°ç»“" class="headerlink" title="è‡ªå®šä¹‰è§†å›¾å·¥ä½œæµç¨‹å°ç»“"></a>è‡ªå®šä¹‰è§†å›¾å·¥ä½œæµç¨‹å°ç»“</h3><p>Â·è‡ªå®šä¹‰è§†å›¾:åˆ›å»ºä¸€ä¸ªViewå¾—bean,è¯¥beanéœ€è¦ç»§æ‰¿è‡ªAbstractView,å¹¶å®ç°renderMergedOutputModelæ–¹æ³•<br>Â·å¹¶æŠŠè‡ªå®šä¹‰ View åŠ å…¥åˆ° IOC å®¹å™¨ä¸­,è¿™ä¸ªé€šè¿‡æ³¨è§£å®ç°@Component(value=â€xxxâ€),è¿™ä¸ªè¿”å›å¾—è§†å›¾è¦å’Œè‡ªå®šä¹‰è§†å›¾åå¾—valueä¿æŒä¸€è‡´<br>Â·æˆ‘å¾—ç†è§£,è‡ªå®šä¹‰è§†å›¾å…¶å®æ˜¯é’ˆå¯¹äºæŸä¸€ä¸ªè§†å›¾ç±»å¾—è¯·æ±‚è½¬å‘<br>Â·è‡ªå®šä¹‰è§†å›¾å¾—è§†å›¾å¤„ç†å™¨,ä½¿ç”¨BeanNameViewResolver,è¿™ä¸ªè§†å›¾å¤„ç†å™¨ä¹Ÿéœ€è¦é…ç½®åˆ°iocå®¹å™¨<br>Â·å®ç°äº†AbstractViewç›¸å½“äºä¸€ä¸ªè‡ªå®šä¹‰è§†å›¾ç±»,è‡ªå®šä¹‰è§†å›¾ç±»éœ€è¦é€šè¿‡è‡ªå®šä¹‰è§†å›¾è§£æå™¨å–è°ƒç”¨<br>Â·BeanNameViewResolver çš„è°ƒç”¨ä¼˜å…ˆçº§éœ€è¦è®¾ç½®ä¸€ä¸‹ï¼Œè®¾ç½® order æ¯” Integer.MAX_VALå°çš„å€¼.<br>ä»¥ç¡®ä¿å…¶åœ¨ InternalResourceViewResolver ä¹‹å‰è¢«è°ƒç”¨</p><h3 id="è‡ªå®šä¹‰è§†å›¾çš„å·¥ä½œæµç¨‹"><a href="#è‡ªå®šä¹‰è§†å›¾çš„å·¥ä½œæµç¨‹" class="headerlink" title="è‡ªå®šä¹‰è§†å›¾çš„å·¥ä½œæµç¨‹"></a>è‡ªå®šä¹‰è§†å›¾çš„å·¥ä½œæµç¨‹</h3><p>1.SpringMVCè°ƒç”¨ç›®æ ‡æ–¹æ³•,è¿”å›è‡ªå®šä¹‰Viewåœ¨iocå®¹å™¨ä¸­çš„id<br>2.SpringMVCè°ƒç”¨BeanNameViewResolverè§£æè§†å›¾:ä»iocå®¹å™¨ä¸­è·å–è¿”å›idå€¼å¯¹åº”çš„bean,å³è‡ªå®šä¹‰çš„Viewçš„å¯¹è±¡<br>3.SpringMVC è°ƒç”¨è‡ªå®šä¹‰è§†å›¾çš„ renderMergedOutputModel æ–¹æ³•æ¸²æŸ“è§†å›¾<br>4.å¦‚æœåœ¨ SpringMVC è°ƒç”¨ç›®æ ‡æ–¹æ³•, è¿”å›è‡ªå®šä¹‰ View åœ¨ IOC å®¹å™¨ä¸­çš„ id,ä¸å­˜åœ¨ï¼Œ åˆ™ä»ç„¶æŒ‰ç…§é»˜è®¤çš„è§†å›¾å¤„ç†å™¨æœºåˆ¶å¤„ç†</p><h3 id="ç›®æ ‡æ–¹æ³•ç›´æ¥æŒ‡å®šè½¬å‘æˆ–é‡å®šå‘"><a href="#ç›®æ ‡æ–¹æ³•ç›´æ¥æŒ‡å®šè½¬å‘æˆ–é‡å®šå‘" class="headerlink" title="ç›®æ ‡æ–¹æ³•ç›´æ¥æŒ‡å®šè½¬å‘æˆ–é‡å®šå‘"></a>ç›®æ ‡æ–¹æ³•ç›´æ¥æŒ‡å®šè½¬å‘æˆ–é‡å®šå‘</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/order"</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=======order()====="</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿™é‡Œç›´æ¥æŒ‡å®š è½¬å‘åˆ°å“ªä¸ªé¡µé¢</span><span class="token comment">//return "forward:/WEB-INF/pages/my_view.jsp";</span><span class="token comment">//é‡å®šå‘, å¦‚æœæ˜¯é‡å®šå‘ï¼Œå°±ä¸èƒ½é‡å®šå‘åˆ° /WEB-INF ç›®å½•ä¸­</span><span class="token keyword">return</span> <span class="token string">"redirect:/login.jsp"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ•°æ®æ ¼å¼åŒ–"><a href="#æ•°æ®æ ¼å¼åŒ–" class="headerlink" title="æ•°æ®æ ¼å¼åŒ–"></a>æ•°æ®æ ¼å¼åŒ–</h2><h3 id="åŸºæœ¬è¯´æ˜"><a href="#åŸºæœ¬è¯´æ˜" class="headerlink" title="åŸºæœ¬è¯´æ˜"></a>åŸºæœ¬è¯´æ˜</h3><p>1.åœ¨æˆ‘ä»¬æäº¤æ•°æ®(æ¯”å¦‚è¡¨å•æ—¶)SpringMVCæ€æ ·å¯¹æäº¤çš„æ•°æ®è¿›è¡Œè½¬æ¢å’Œå¤„ç†çš„<br>Â·åŸºæœ¬æ•°æ®ç±»å‹å¯ä»¥å’Œå­—ç¬¦ä¸²ä¹‹é—´è‡ªåŠ¨å®Œæˆè½¬æ¢<br>Â·æ—¥æœŸå’Œè´§å¸çš„ä¸¤ä¸ªæ³¨è§£ @DateTimeFormat @NumberFormat</p><h2 id="éªŒè¯åŠå›½é™…åŒ–"><a href="#éªŒè¯åŠå›½é™…åŒ–" class="headerlink" title="éªŒè¯åŠå›½é™…åŒ–"></a>éªŒè¯åŠå›½é™…åŒ–</h2><p>Â·å¯¹è¾“å…¥çš„æ•°æ®(æ¯”å¦‚è¡¨å•æ•°æ®),è¿›è¡Œå¿…è¦çš„éªŒè¯,å¹¶ç»™å‡ºç›¸åº”çš„æç¤ºä¿¡æ¯<br>Â·å¯¹äºéªŒè¯è¡¨å•æ•°æ®,springMVCæä¾›äº†å¾ˆå¤šå®ç”¨çš„æ³¨è§£,è¿™äº›æ³¨è§£ç”±JSR 303éªŒè¯æ¡†æ¶æä¾›<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/53b4a19a3b418e775d541af129e984e0.png"></div></div><br>Â·è¿˜æœ‰ä»¥ä¸‹æ³¨è§£<br>@Email : è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ—¶ç”µå­é‚®ç®±åœ°å€<br>@Length : è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…<br>@NotEmpty  : å¿…é¡»ä¸ºç©º<br>@Range  : å¿…é¡»åœ¨åˆé€‚çš„èŒƒå›´å†…</p><h3 id="å®ä¾‹-1"><a href="#å®ä¾‹-1" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Monster</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>    <span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"å¹´é¾„å¿…é¡»å¡«å†™1-100[è‡ªå®šä¹‰]"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Range</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>max <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>    <span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"åå­—ä¸èƒ½ä¸ºç©º[è‡ªå®šä¹‰]"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"ç”Ÿæ—¥ä¸èƒ½ä¸ºç©º[è‡ªå®šä¹‰]"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@DateTimeFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">"yyy-MM-dd"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Date</span> birthday<span class="token punctuation">;</span>    <span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"è–ªæ°´ä¸èƒ½ä¸ºç©º[è‡ªå®šä¹‰]"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@NumberFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">"##,###.##"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Float</span> salary<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/save"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token class-name">Monster</span> monster<span class="token punctuation">,</span><span class="token class-name">Errors</span> errors<span class="token punctuation">,</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> map<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----monster-----"</span><span class="token operator">+</span>monster<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===== map ======"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> entry <span class="token operator">:</span> map<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"key= "</span> <span class="token operator">+</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" value="</span> <span class="token operator">+</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===== errors ======"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//åˆ¤æ–­æ˜¯å¦æœ‰é”™è¯¯</span>            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ObjectError</span><span class="token punctuation">></span></span> allErrors <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">getAllErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ObjectError</span> error <span class="token operator">:</span> allErrors<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"error="</span> <span class="token operator">+</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//è¿”å›æ·»åŠ é¡µé¢</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> <span class="token string">"datavalid/monster_addUI"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token string">"datavalid/success"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·è§£æ<br>1.@Valid Monster monsterè¡¨ç¤ºå¯¹Monsteræ¥æ”¶çš„æ•°æ®è¿›è¡Œæ ¡éªŒ<br>2.Errors errorsè¡¨ç¤ºå¦‚æœæ ¡éªŒå‡ºç°é”™è¯¯,å°†æ ¡éªŒçš„é”™è¯¯ä¿¡æ¯ä¿å­˜errors<br>3.Map mapè¡¨ç¤ºå¦‚æœå‡ºç°é”™è¯¯,å°†æ ¡éªŒçš„é”™è¯¯ä¿¡æ¯ä¿å­˜åˆ°map,åŒæ—¶ä¿å­˜monsterå¯¹è±¡<br>Â·è¿è¡Œç»“æœ:æ›´èƒ½è¯´æ˜mapä¿å­˜é”™è¯¯ä¿¡æ¯å’Œå¯¹è±¡</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">key=monster value=Monster&#123;id=null, email='jack@sohu.com', age=900, name='',birthday=Thu Nov 11 00:00:00 CST 1999, salary=11.11&#125;key=org.springframework.validation.BindingResult.monstervalue=org.springframework.validation.BeanPropertyBindingResult: 2 errorsField error in object 'monster' on field 'age': rejected value [900]; codes[Range.monster.age,Range.age,Range.java.lang.Integer,Range]; arguments[org.springframework.context.support.DefaultMessageSourceResolvable: codes[monster.age,age]; arguments []; default message [age],100,1]; default message[éœ€è¦åœ¨ 1 å’Œ 100 ä¹‹é—´]Field error in object 'monster' on field 'name': rejected value []; codes[NotEmpty.monster.name,NotEmpty.name,NotEmpty.java.lang.String,NotEmpty];arguments[org.springframework.context.support.DefaultMessageSourceResolvable: codes[monster.name,name]; arguments []; default message [name]]; default message[ä¸èƒ½ä¸ºç©º]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/72550a7d83a945929dbc442dfff47cf0.png"></div></div><p>Â·å¦‚æœæŒ‰ç…§åŸæ¥çš„é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°å‰ç«¯,é¡µé¢å¾ˆéš¾çœ‹,æ‰€ä»¥å°±å¼•å‡ºäº†å›½é™…åŒ–é”™è¯¯ä¿¡æ¯<br>1.é¦–å…ˆé…ç½®å›½é™…åŒ–é”™è¯¯ä¿¡æ¯çš„èµ„æºå¤„ç†bean,åœ¨é…ç½®xmlä¸­</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>messageSource<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>        <span class="token punctuation">"</span>org.springframework.context.support.ResourceBundleMessageSource<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- é…ç½®å›½é™…åŒ–æ–‡ä»¶åå­—    å¦‚æœä½ è¿™æ ·é…çš„è¯ï¼Œè¡¨ç¤º messageSource å›åˆ° src/i18nXXX.properties å»è¯»å–é”™è¯¯    ä¿¡æ¯    --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>basename<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>i18n<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2.åˆ›å»ºå›½é™…åŒ–æ–‡ä»¶</p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">NotEmpty.monster.name</span><span class="token punctuation">=</span><span class="token value attr-value">ç”¨æˆ·åä¸èƒ½ä¸ºç©º</span><span class="token comment">#ç±»å‹ä¸åŒ¹é…æ˜¯1-150</span><span class="token comment">#èŒƒå›´ä¸åŒ¹é…æ˜¯1-100</span><span class="token key attr-name">typeMismatch.monster.age</span><span class="token punctuation">=</span><span class="token value attr-value">å¹´é¾„è¦æ±‚åœ¨1-150ä¹‹é—´</span><span class="token key attr-name">typeMismatch.monster.birthday</span><span class="token punctuation">=</span><span class="token value attr-value">ç”Ÿæ—¥æ ¼å¼ä¸æ­£ç¡®ï¼Œ</span><span class="token key attr-name">typeMismatch.monster.salary</span><span class="token punctuation">=</span><span class="token value attr-value">è–ªæ°´æ ¼å¼ä¸æ­£ç¡®</span><span class="token key attr-name">Range.monster.age</span><span class="token punctuation">=</span><span class="token value attr-value">å¹´é¾„å¿…é¡»åœ¨1-100ä¹‹é—´[è‡ªå®šä¹‰]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3.æœ€åå›æ˜¾é”™è¯¯</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">form:</span>errors</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">form:</span>errors</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">form:</span>errors</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>birthday<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç»†èŠ‚è¯´æ˜"><a href="#ç»†èŠ‚è¯´æ˜" class="headerlink" title="ç»†èŠ‚è¯´æ˜"></a>ç»†èŠ‚è¯´æ˜</h3><p>1.åœ¨éœ€è¦éªŒè¯çš„Javabean/POJOçš„å­—æ®µä¸ŠåŠ ä¸Šç›¸åº”çš„éªŒè¯æ³¨è§£<br>2.ç›®æ ‡æ–¹æ³•ä¸Š,åœ¨JavaBean/POJOç±»å‹çš„å‚æ•°å‰,æ·»åŠ @Validæ³¨è§£,å‘ŠçŸ¥SpringMVCè¯¥beanæ˜¯éœ€è¦éªŒè¯çš„<br>3.åœ¨@Validæ³¨è§£ä¹‹å,æ·»åŠ ä¸€ä¸ªErrorsæˆ–BindingResultç±»å‹çš„å‚æ•°,å¯ä»¥è·å–åˆ°éªŒè¯çš„é”™è¯¯ä¿¡æ¯<br>4.éœ€è¦ä½¿ç”¨<form:errors path="email">&lt;/form:errors&gt;æ ‡ç­¾æ¥æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯,è¿™ä¸ªæ ‡ç­¾,éœ€è¦å†™åœ¨<form:form>æ ‡ç­¾å†…ç”Ÿæ•ˆ<br>5.é”™è¯¯æ¶ˆæ¯çš„å›½é™…åŒ–æ–‡ä»¶ i18n.properties,ä¸­æ–‡æ˜¯éœ€è¦Unicodeç¼–ç </form:form></form:errors></p><h2 id="ä¸­æ–‡ä¹±ç "><a href="#ä¸­æ–‡ä¹±ç " class="headerlink" title="ä¸­æ–‡ä¹±ç "></a>ä¸­æ–‡ä¹±ç </h2><p>Â·è¯´æ˜:<br>å½“è¡¨å•æäº¤æ•°ä¸ºä¸­æ–‡æ—¶,ä¼šå‡ºç°ä¹±ç </p><h3 id="ä¸¤ç§è§£å†³æ–¹æ¡ˆ"><a href="#ä¸¤ç§è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸¤ç§è§£å†³æ–¹æ¡ˆ"></a>ä¸¤ç§è§£å†³æ–¹æ¡ˆ</h3><p>1.ä½¿ç”¨åŸç”Ÿçš„javaWebè§£å†³æ–¹æ¡ˆ:å†™ä¸€ä¸ªè¿‡æ»¤å™¨,å¹¶å°†å…¶é…ç½®åœ¨web.xmlæœ€å‰é¢</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCharacterFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//è¿™é‡ŒåŠ å…¥å¯¹ä¸­æ–‡ç¼–ç çš„å¤„ç†</span>        servletRequest<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ–¹å½¢è¯·æ±‚</span>        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span>servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2.ä½¿ç”¨Springæä¾›çš„è¿‡æ»¤å™¨å¤„ç†ä¸­æ–‡<br>Â·ç›´æ¥å»web.xmlé…ç½®å³å¯ä¸ç”¨å†™Javaè¿‡æ»¤å™¨ã€å¤ä¹ ä¸€ä¸‹,Reståˆ†æ ¼çš„è¯·æ±‚ä¹Ÿéœ€è¦åœ¨web.xmlä¸­é…ç½®è¿‡æ»¤å™¨hiddenHttpMethodFilterã€‘</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token generics"><span class="token punctuation">&lt;</span>filter<span class="token punctuation">></span></span>       <span class="token operator">&lt;</span>filter<span class="token operator">-</span>name<span class="token operator">></span><span class="token class-name">CharacterEncodingFilter</span><span class="token operator">&lt;</span><span class="token operator">/</span>filter<span class="token operator">-</span>name<span class="token operator">></span>       <span class="token operator">&lt;</span>filter<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">></span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span>CharacterEncodingFilter</span><span class="token operator">&lt;</span><span class="token operator">/</span>filter<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">></span>       <span class="token operator">&lt;</span>init<span class="token operator">-</span>param<span class="token operator">></span>           <span class="token operator">&lt;</span>param<span class="token operator">-</span>name<span class="token operator">></span>encoding<span class="token operator">&lt;</span><span class="token operator">/</span>param<span class="token operator">-</span>name<span class="token operator">></span>           <span class="token operator">&lt;</span>param<span class="token operator">-</span>value<span class="token operator">></span><span class="token constant">UTF</span><span class="token operator">-</span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>param<span class="token operator">-</span>value<span class="token operator">></span>       <span class="token operator">&lt;</span><span class="token operator">/</span>init<span class="token operator">-</span>param<span class="token operator">></span>   <span class="token operator">&lt;</span><span class="token operator">/</span>filter<span class="token operator">></span>   <span class="token operator">&lt;</span>filter<span class="token operator">-</span>mapping<span class="token operator">></span>       <span class="token operator">&lt;</span>filter<span class="token operator">-</span>name<span class="token operator">></span><span class="token class-name">CharacterEncodingFilter</span><span class="token operator">&lt;</span><span class="token operator">/</span>filter<span class="token operator">-</span>name<span class="token operator">></span>       <span class="token operator">&lt;</span>url<span class="token operator">-</span>pattern<span class="token operator">></span><span class="token comment">/*&lt;/url-pattern>   &lt;/filter-mapping></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¤„ç†jsonå’ŒHttpMessageConverter"><a href="#å¤„ç†jsonå’ŒHttpMessageConverter" class="headerlink" title="å¤„ç†jsonå’ŒHttpMessageConverter"></a>å¤„ç†jsonå’ŒHttpMessageConverter<T></T></h2><p>Â·åœ¨é¡¹ç›®å¼€å‘ä¸­,æˆ‘ä»¬å¾€å¾€éœ€è¦æœåŠ¡å™¨è¿”å›çš„æ•°æ®æ ¼å¼æ˜¯æŒ‰ç…§jsonæ¥è¿”å›çš„<br>Â·æŒ‡å®šè¿”å›çš„æ•°æ®æ ¼å¼json,é è¿™ä¸ª@ResponseBody<br>Â·ä½¿ç”¨SpringMVCçš„@RequestBodyå°†å®¢æˆ·ç«¯æäº¤çš„jsonæ•°æ®,å°è£…æˆjavaBeanå¯¹è±¡</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/save2"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ResponseBody</span><span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">save2</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     <span class="token comment">//å°†å‰å°ä¼ è¿‡æ¥çš„æ•°æ® ä»¥ json çš„æ ¼å¼ç›¸åº”å›æµè§ˆå™¨</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user~= "</span> <span class="token operator">+</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> user <span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·@ResponseBodyå¯ä»¥ç›´æ¥å†™åœ¨controllerä¸Š,è¿™æ ·å¯¹æ‰€æœ‰æ–¹æ³•ç”Ÿæ•ˆ<br>Â·å¯ä»¥å°†@ResponseBody+@Controllerç›´æ¥å†™æˆ</p><h2 id="æ–‡ä»¶ä¸‹è½½"><a href="#æ–‡ä»¶ä¸‹è½½" class="headerlink" title="æ–‡ä»¶ä¸‹è½½"></a>æ–‡ä»¶ä¸‹è½½</h2><p>Â·åœ¨SpringMVC,é€šè¿‡è¿”å›ResponseEntity<T>çš„ç±»å‹,å¯ä»¥å®ç°æ–‡ä»¶ä¸‹è½½çš„åŠŸèƒ½<br>Â·ä¹Ÿå°±æ˜¯åªéœ€è¦å°†ResponseEntityå¯¹è±¡è¿”å›å³å¯,ResponseEntityçš„ä¸‰ä¸ªå±æ€§<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">T</span> body<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> headers<span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span> status<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> headers<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">)</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><br>Â·å®ä¾‹<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/downFile"</span><span class="token punctuation">)</span>   <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token function">downFile</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>       <span class="token comment">//1.å…ˆè·å–åˆ°ä¸‹è½½æ–‡ä»¶çš„inputStreamæµ</span>       <span class="token class-name">InputStream</span> resourceAsStream <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"/img/2.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//2.å¼€è¾Ÿä¸€ä¸ªå­˜æ”¾æ–‡ä»¶çš„byteæ•°ç»„ï¼Œè¿™é‡Œä½¿ç”¨byte[]æ˜¯å¯ä»¥æ”¯æŒäºŒè¿›åˆ¶æ•°æ®ï¼ˆå›¾ç‰‡ã€‚è§†é¢‘ï¼‰ï¼Œå¤§å°å’Œè¦è¯»å–çš„æ–‡ä»¶ä¸€æ ·å¤§</span>       <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>resourceAsStream<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token comment">//3.å°†è¦ä¸‹è½½çš„æ•°æ®è¯»å…¥åˆ°byte[]</span>       resourceAsStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//public ResponseEntity(@Nullable T body, @Nullable MultiValueMap&lt;String, String> headers, HttpStatus status) &#123;</span>       <span class="token comment">// this(body, headers, (Object) status);</span>       <span class="token comment">// &#125;</span>       <span class="token comment">//4.æ„å»ºè¿”å›çš„HttpStatus</span>       <span class="token class-name">HttpStatus</span> ok <span class="token operator">=</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">;</span>       <span class="token comment">//5.åˆ›å»ºheaders</span>       <span class="token class-name">HttpHeaders</span> httpHeaders <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//æŒ‡å®šè¿”å›çš„æ•°æ®ï¼Œå®¢æˆ·ç«¯åº”å½“</span>       httpHeaders<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span><span class="token string">"attachment;filename=2.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//æ„å»ºä¸€ä¸ªResponseEntity 1. è¯»å–æ–‡ä»¶å¹¶æ”¾å…¥åˆ°ä¸€ä¸ªå­—èŠ‚æ•°ç»„2.httpå“åº”å¤´çš„headers 3.httpå“åº”çŠ¶æ€</span>       <span class="token class-name">ResponseEntity</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> responseEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> httpHeaders<span class="token punctuation">,</span> ok<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> responseEntity<span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>Â·è§£æ<br>1.content-type æŒ‡ç¤ºå“åº”å†…å®¹çš„æ ¼å¼<br>2.content-disposition æŒ‡ç¤ºå¦‚ä½•å¤„ç†å“åº”å†…å®¹ã€‚<br>ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š<br>Â·inlineï¼šç›´æ¥åœ¨é¡µé¢æ˜¾ç¤º<br>Â·attchmentï¼šä»¥é™„ä»¶å½¢å¼ä¸‹è½½</T></p><h2 id="SpringMVCæ–‡ä»¶ä¸Šä¼ "><a href="#SpringMVCæ–‡ä»¶ä¸Šä¼ " class="headerlink" title="SpringMVCæ–‡ä»¶ä¸Šä¼ "></a>SpringMVCæ–‡ä»¶ä¸Šä¼ </h2><p>1.SpringMVCä¸ºæ–‡ä»¶ä¸Šä¼ æä¾›äº†ç›´æ¥çš„æ”¯æŒ,è¿™ç§æ”¯æŒæ˜¯é€šè¿‡å³æ’å³ç”¨çš„MultipartResolverå®ç°çš„Springç”¨<br>Jakarta Commons FileUpload æŠ€ æœ¯ å® ç° äº† ä¸€ ä¸ªMultipartResolver å®ç°ç±»ï¼šCommonsMultipartResovler<br>2.SpringMVCä¸Šä¸‹æ–‡ä¸­é»˜è®¤æ²¡æœ‰è£…é…MultipartResovler,å› æ­¤é»˜è®¤æƒ…å†µä¸‹ä¸èƒ½å¤„ç†æ–‡ä»¶çš„ä¸Šä¼ å·¥ä½œ,å¦‚æœæƒ³ä½¿ç”¨Springçš„æ–‡ä»¶ä¸Šä¼ <br>åŠŸèƒ½,éœ€åœ¨ä¸Šä¸‹æ–‡ä¸­é…ç½®MultipartResolverã€‚<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span>bean <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span> id<span class="token operator">=</span><span class="token string">"multipartResolver"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><h3 id="æ–‡ä»¶ä¸Šä¼ æ¼”ç¤º"><a href="#æ–‡ä»¶ä¸Šä¼ æ¼”ç¤º" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ¼”ç¤º"></a>æ–‡ä»¶ä¸Šä¼ æ¼”ç¤º</h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fileUpload<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    æ–‡ä»¶ä»‹ç»:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>introduce<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    é€‰æ‹©æ–‡ä»¶:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ä¸Šä¼ æ–‡ä»¶<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileUploadHandler</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//ç¼–å†™æ–¹æ³•ï¼Œå¤„ç†æ–‡ä»¶ä¸Šä¼ çš„è¯·æ±‚</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/fileUpload"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">fileUpload</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"file"</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span><span class="token class-name">String</span> introduce <span class="token punctuation">,</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//æ¥æ”¶åˆ°æäº¤çš„æ–‡ä»¶å</span>        <span class="token class-name">String</span> originalFilename <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä½ ä¸Šä¼ çš„æ–‡ä»¶åæ˜¯"</span><span class="token operator">+</span>originalFilename<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ–‡ä»¶çš„ä»‹ç»"</span><span class="token operator">+</span>introduce<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å¾—åˆ°è¦æŠŠä¸Šä¼ æ–‡ä»¶ä¿å­˜åˆ°é‚£ä¸ªè·¯å¾„</span>        <span class="token class-name">String</span> fileFullPath <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token string">"/img/"</span> <span class="token operator">+</span> originalFilename<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºæ–‡ä»¶</span>        <span class="token class-name">File</span> saveToFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>fileFullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å°†ä¸Šä¼ çš„æ–‡ä»¶ï¼Œè½¬å­˜åˆ°saveToFile</span>        file<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span>saveToFile<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·å…³é”®åœ°æ–¹:å°†ä¸Šä¼ çš„MultipartFile.transferToåˆ°è¦ä¿å­˜çš„åœ°å€ä¸­</p><h2 id="è‡ªå®šä¹‰æ‹¦æˆªå™¨"><a href="#è‡ªå®šä¹‰æ‹¦æˆªå™¨" class="headerlink" title="è‡ªå®šä¹‰æ‹¦æˆªå™¨"></a>è‡ªå®šä¹‰æ‹¦æˆªå™¨</h2><h3 id="ä»€ä¹ˆæ˜¯æ‹¦æˆªå™¨"><a href="#ä»€ä¹ˆæ˜¯æ‹¦æˆªå™¨" class="headerlink" title="ä»€ä¹ˆæ˜¯æ‹¦æˆªå™¨"></a>ä»€ä¹ˆæ˜¯æ‹¦æˆªå™¨</h3><p>Â·Spring MVC ä¹Ÿå¯ä»¥ä½¿ç”¨æ‹¦æˆªå™¨å¯¹è¯·æ±‚è¿›è¡Œæ‹¦æˆªå¤„ç†ï¼Œç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰æ‹¦æˆªå™¨æ¥å®ç°ç‰¹å®šçš„åŠŸèƒ½.<br>Â·è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨å¿…é¡»å®ç° HandlerInterceptor æ¥å£<br>Â·è‡ªå®šä¹‰æ‹¦æˆªå™¨çš„ä¸‰ä¸ªæ–¹æ³•<br>1.preHandle()ï¼šè¿™ä¸ªæ–¹æ³•åœ¨ä¸šåŠ¡å¤„ç†å™¨å¤„ç†è¯·æ±‚ä¹‹å‰è¢«è°ƒç”¨ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­å¯¹ç”¨æˆ·è¯·æ±‚request è¿›è¡Œå¤„ç†ã€‚<br>2.postHandle()ï¼šè¿™ä¸ªæ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•å¤„ç†å®Œè¯·æ±‚åæ‰§è¡Œ<br>3.afterCompletion()ï¼šè¿™ä¸ªæ–¹æ³•åœ¨å®Œå…¨å¤„ç†å®Œè¯·æ±‚åè¢«è°ƒç”¨ï¼Œå¯ä»¥åœ¨è¯¥æ–¹æ³•ä¸­è¿›è¡Œä¸€äº›èµ„æºæ¸…ç†çš„æ“ä½œ</p><h3 id="è‡ªå®šä¹‰æ‹¦æˆªå™¨æ‰§è¡Œæµç¨‹åˆ†æå›¾"><a href="#è‡ªå®šä¹‰æ‹¦æˆªå™¨æ‰§è¡Œæµç¨‹åˆ†æå›¾" class="headerlink" title="è‡ªå®šä¹‰æ‹¦æˆªå™¨æ‰§è¡Œæµç¨‹åˆ†æå›¾"></a>è‡ªå®šä¹‰æ‹¦æˆªå™¨æ‰§è¡Œæµç¨‹åˆ†æå›¾</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/55ad232c87405828af5a922eee19c2bb.png"></div></div><h3 id="è‡ªå®šä¹‰æ‹¦æˆªå™¨æµç¨‹è¯´æ˜"><a href="#è‡ªå®šä¹‰æ‹¦æˆªå™¨æµç¨‹è¯´æ˜" class="headerlink" title="è‡ªå®šä¹‰æ‹¦æˆªå™¨æµç¨‹è¯´æ˜"></a>è‡ªå®šä¹‰æ‹¦æˆªå™¨æµç¨‹è¯´æ˜</h3><p>Â·å¦‚æœ preHandle æ–¹æ³• è¿”å› false, åˆ™ä¸å†æ‰§è¡Œç›®æ ‡æ–¹æ³•, å¯ä»¥åœ¨æ­¤æŒ‡å®šè¿”å›é¡µé¢<br>Â·postHandle åœ¨ç›®æ ‡æ–¹æ³•è¢«æ‰§è¡Œåæ‰§è¡Œ. å¯ä»¥åœ¨æ–¹æ³•ä¸­è®¿é—®åˆ°ç›®æ ‡æ–¹æ³•è¿”å›çš„ModelAndView å¯¹è±¡<br>Â·è‹¥ preHandle è¿”å› true, åˆ™ afterCompletion æ–¹æ³• åœ¨æ¸²æŸ“è§†å›¾ä¹‹å<br>Â·è‹¥ preHandle è¿”å› false, åˆ™ afterCompletion æ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨<br>Â·åœ¨é…ç½®æ‹¦æˆªå™¨æ—¶ï¼Œå¯ä»¥æŒ‡å®šè¯¥æ‹¦æˆªå™¨å¯¹å“ªäº›è¯·æ±‚ç”Ÿæ•ˆï¼Œå“ªäº›è¯·æ±‚ä¸ç”Ÿæ•ˆ</p><h3 id="å¦‚ä½•é…ç½®è‡ªå®šä¹‰æ‹¦æˆªå™¨"><a href="#å¦‚ä½•é…ç½®è‡ªå®šä¹‰æ‹¦æˆªå™¨" class="headerlink" title="å¦‚ä½•é…ç½®è‡ªå®šä¹‰æ‹¦æˆªå™¨"></a>å¦‚ä½•é…ç½®è‡ªå®šä¹‰æ‹¦æˆªå™¨</h3><p>Â·åœ¨é…ç½®.xmlé‡Œé¢é…ç½®<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>interceptors</span><span class="token punctuation">></span></span>       <span class="token comment">&lt;!--       1.ç¬¬ä¸€ç§é…ç½®æ–¹å¼                  2.ä½¿ç”¨refåº”ç”¨åˆ°å¯¹åº”çš„myInterceptor01                  3.è¿™ç§æ–¹å¼ä¼šæ‹¦æˆªæ‰€æœ‰çš„ç›®æ ‡æ–¹æ³•       --></span>       <span class="token comment">&lt;!--        &lt;ref bean="myInterceptor01">&lt;/ref>--></span>       <span class="token comment">&lt;!--       1.ç¬¬äºŒç§æ–¹å¼é…ç½®æ‹¦æˆªå™¨       --></span>       <span class="token comment">&lt;!--        &lt;mvc:interceptor>--></span>       <span class="token comment">&lt;!--            &lt;mvc:mapping path="/hi">&lt;/mvc:mapping>--></span>       <span class="token comment">&lt;!--            &lt;ref bean="myInterceptor01">&lt;/ref>--></span>       <span class="token comment">&lt;!--        &lt;/mvc:interceptor>--></span>       <span class="token comment">&lt;!--       1.ç¬¬ä¸‰ç§æ–¹å¼é…ç½®æ‹¦æˆªå™¨[é€šé…ç¬¦]        --></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>interceptor</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>mapping</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/h*<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>exclude-mapping</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/hello<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myInterceptor01<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ref</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mvc:</span>interceptor</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mvc:</span>interceptors</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="å¤šä¸ªæ‹¦æˆªå™¨"><a href="#å¤šä¸ªæ‹¦æˆªå™¨" class="headerlink" title="å¤šä¸ªæ‹¦æˆªå™¨"></a>å¤šä¸ªæ‹¦æˆªå™¨</h3><p>Â·å¦‚æœç¬¬ 1 ä¸ªæ‹¦æˆªå™¨çš„ preHandle() è¿”å› false , åé¢éƒ½ä¸åœ¨æ‰§<br>Â·å¦‚æœç¬¬2ä¸ªæ‹¦æˆªå™¨çš„preHandle()è¿”å›false,å°±ç›´æ¥æ‰§è¡Œç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨çš„afterCompletion()æ–¹æ³•, å¦‚æœæ‹¦æˆªå™¨æ›´å¤šï¼Œè§„åˆ™ç±»ä¼¼</p><h3 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h3><p>Â·å±€éƒ¨å¼‚å¸¸<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyExceptionHandler</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * è§£è¯»     * 1.localException æ–¹æ³•å¤„ç†å±€éƒ¨å¼‚å¸¸     * 2.è¿™é‡Œå¤„ç†ArithmeticException.class, NullPointerException.class     * 3.Exception ex:ç”Ÿæˆçš„å¼‚å¸¸å¯¹è±¡ï¼Œä¼šä¼ é€’ç»™exï¼Œé€šè¿‡exå¯ä»¥å¾—åˆ°ç›¸å…³çš„ä¿¡æ¯     *   ï¼Œè¿™é‡Œå¯ä»¥åŠ å…¥è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘     * @return     */</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">ArithmeticException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">localException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å±€éƒ¨å¼‚å¸¸ä¿¡æ¯æ˜¯~"</span><span class="token operator">+</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"reason"</span><span class="token punctuation">,</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"exception_mes"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * è§£è¯»     * 1.ç¼–å†™æ–¹æ³•ï¼Œæ¨¡æ‹Ÿå¼‚å¸¸ï¼Œç®—æœ¯å¼‚å¸¸     * 2.å¦‚æœæˆ‘ä»¬ä¸åšå¼‚å¸¸å¤„ç†ï¼Œæ˜¯ç”±tomcaté»˜è®¤æ˜¾ç¤º     * @param num     * @return     */</span>    <span class="token comment">//ç¼–å†™æ–¹æ³•ï¼Œæ¨¡æ‹Ÿå¼‚å¸¸</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/testException01"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> num<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">9</span><span class="token operator">/</span>num<span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/testGlobalException"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">global</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//1.è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿäº†ä¸€ä¸ªå¼‚å¸¸NumberFormatException</span>        <span class="token comment">//2.è¯¥å¼‚å¸¸æ²¡æœ‰åœ¨å±€éƒ¨å¼‚å¸¸å¤„ç†ï¼ŒæŒ‰ç…§å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œå°±ä¼šäº¤ç»™å…¨å±€å¼‚å¸¸å¤„ç†ç±»å¤„ç†</span>        <span class="token keyword">int</span> num<span class="token operator">=</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/testException02"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AgeException</span><span class="token punctuation">(</span><span class="token string">"å¹´é¾„å¿…é¡»åœ¨1-120ä¹‹é—´~~~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/testException03"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ints <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ints<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/testException04"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test04</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> str<span class="token operator">=</span><span class="token string">"aksn"</span><span class="token punctuation">;</span>        <span class="token comment">//è¿™é‡Œä¼šæŠ›å‡ºStringIndexOutOfBoundsException</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>Â·å…¨å±€å¼‚å¸¸<br>å†…éƒ¨è‹¥æ‰¾ä¸åˆ°@ExceptionHandler æ³¨è§£çš„è¯ï¼Œä¼šæ‰¾ @ControllerAdvice ç±»çš„@ExceptionHandler æ³¨è§£æ–¹æ³•,<br>è¿™æ ·å°±ç›¸å½“äºä¸€ä¸ªå…¨å±€å¼‚å¸¸å¤„ç†å™¨<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * å¦‚æœåœ¨å’ä¸Šæ ‡æ³¨äº†@ControllerAdviceï¼Œå°±æ˜¯ä¸€ä¸ªå…¨å±€å¼‚å¸¸å¤„ç†ç±» */</span><span class="token annotation punctuation">@ControllerAdvice</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyGlobalException</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * è§£è¯»     * 1.å…¨å±€å¼‚å¸¸å°±ä¸ç®¡æ˜¯é‚£ä¸ªHandleræŠ›å‡ºçš„å¼‚å¸¸ï¼Œéƒ½å¯ä»¥æ•è·ï¼Œ@ExceptionHandler(&#123;å¼‚å¸¸ç±»å‹&#125;)     * 22.è¿™é‡Œå¤„ç†çš„å…¨å±€å¼‚å¸¸æ˜¯NumberFormatException.class,ClassCastException.class     * 3.Exception ex æ¥æ”¶æŠ›å‡ºçš„å¼‚å¸¸å¯¹è±¡     * @return     */</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">NumberFormatException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">ClassCastException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">AgeException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">globalException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…¨å±€å¼‚å¸¸å¤„ç†"</span><span class="token operator">+</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"reason"</span><span class="token punctuation">,</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"exception_mes"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>Â·è‡ªå®šä¹‰å¼‚å¸¸<br>é€šè¿‡@ResponseStatus æ³¨è§£, å¯ä»¥è‡ªå®šä¹‰å¼‚å¸¸çš„è¯´æ˜<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//reason = "å¹´é¾„éœ€è¦åœ¨1-120ä¹‹é—´"è¿™ä¸ªä¿¡æ¯æ˜¯ç»™tomcatæ˜¾ç¤ºçš„</span><span class="token annotation punctuation">@ResponseStatus</span><span class="token punctuation">(</span>reason <span class="token operator">=</span> <span class="token string">"å¹´é¾„éœ€è¦åœ¨1-120ä¹‹é—´"</span><span class="token punctuation">,</span>value <span class="token operator">=</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">BAD_REQUEST</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AgeException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">AgeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">AgeException</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/testException02"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AgeException</span><span class="token punctuation">(</span><span class="token string">"å¹´é¾„å¿…é¡»åœ¨1-120ä¹‹é—´~~~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>Â·ç»Ÿä¸€å¼‚å¸¸<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.web.servlet.handler.SimpleMappingExceptionResolver<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>exceptionMappings<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>props</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.ArrayIndexOutOfBoundsException<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>arrEx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.Exception<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>arrEx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>props</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>Â·å¯¹æœªçŸ¥å¼‚å¸¸è¿›è¡Œç»Ÿä¸€å¤„ç†ï¼Œä½¿ç”¨ SimpleMappingExceptionResolver</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title&gt;&lt;/a&gt;&lt;div class=&quot;note purple no-icon flat&quot;&gt;&lt;p&gt;SpringMVC-åŸºæœ¬ä»‹ç» &lt;/p&gt;
&lt;/div&gt;&lt;/h1&gt;&lt;h2 id=&quot;SpringMVC-ç‰¹ç‚¹</summary>
      
    
    
    
    <category term="ä¸»æµæ¡†æ¶" scheme="https://100qin10086.github.io/categories/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6/"/>
    
    
    <category term="æ¡†æ¶" scheme="https://100qin10086.github.io/tags/%E6%A1%86%E6%9E%B6/"/>
    
    <category term="Java" scheme="https://100qin10086.github.io/tags/Java/"/>
    
    <category term="SpringMVC" scheme="https://100qin10086.github.io/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>Springå¤ä¹ </title>
    <link href="https://100qin10086.github.io/posts/d639ad3c.html"/>
    <id>https://100qin10086.github.io/posts/d639ad3c.html</id>
    <published>2024-03-24T09:47:42.000Z</published>
    <updated>2024-05-06T14:13:59.610Z</updated>
    
    <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a><div class="note purple no-icon flat"><p>Spring(è½»é‡çº§å®¹å™¨æ¡†æ¶)å¤ä¹  </p></div></h1><h2 id="Springå­¦ä¹ çš„æ ¸å¿ƒå†…å®¹"><a href="#Springå­¦ä¹ çš„æ ¸å¿ƒå†…å®¹" class="headerlink" title="Springå­¦ä¹ çš„æ ¸å¿ƒå†…å®¹"></a>Springå­¦ä¹ çš„æ ¸å¿ƒå†…å®¹</h2><p>Â·IOC(æ§åˆ¶åè½¬) springé€šè¿‡iocæŠ€æœ¯ç®¡ç†å„ç§å¯¹è±¡<br>Â·AOP(åˆ‡é¢å˜æˆ) springæ”¯æŒåˆ‡é¢ç¼–ç¨‹,æ–¹å¼æœ‰åŸºäºæ³¨è§£,åŸºäºxmlé…ç½®<br>Â·JdbcTemplate springæä¾›çš„è®¿é—®æ•°æ®åº“çš„æŠ€æœ¯<br>Â·å£°æ˜å¼äº‹åŠ¡ åŸºäºioc/aopå®ç°äº‹åŠ¡ç®¡ç†</p><h2 id="iocçš„å¼€å‘æ¨¡å¼"><a href="#iocçš„å¼€å‘æ¨¡å¼" class="headerlink" title="iocçš„å¼€å‘æ¨¡å¼"></a>iocçš„å¼€å‘æ¨¡å¼</h2><p>ç¨‹åº&lt;â€”-å®¹å™¨ å®¹å™¨åˆ›å»ºå¥½å¯¹è±¡,ç¨‹åºç›´æ¥ä½¿ç”¨</p><h2 id="ioc-æ§åˆ¶åè½¬"><a href="#ioc-æ§åˆ¶åè½¬" class="headerlink" title="ioc(æ§åˆ¶åè½¬)"></a>ioc(æ§åˆ¶åè½¬)</h2><p>1.springæ ¹æ®é…ç½®æ–‡ä»¶ xml/æ³¨è§£,åˆ›å»ºå¯¹è±¡,å¹¶æ”¾å…¥åˆ°å®¹å™¨(ConcurrentHashMap)ä¸­,å¹¶ä¸”å¯ä»¥å®Œæˆå¯¹è±¡ä¹‹é—´çš„ä¾èµ–â€™<br>2.å½“éœ€è¦ä½¿ç”¨æŸä¸ªå¯¹è±¡å®ä¾‹çš„æ—¶å€™,å°±ç›´æ¥ä»å®¹å™¨ä¸­è·å–å³å¯<br>3.ç¨‹åºå‘˜å¯ä»¥æ›´åŠ å…³æ³¨å¦‚ä½•ä½¿ç”¨å¯¹è±¡å®Œæˆç›¸åº”çš„ä¸šåŠ¡(ä»¥å‰æ˜¯new ==&gt;ç°åœ¨æ˜¯æ³¨è§£/é…ç½®æ–¹å¼)</p><h2 id="ç±»åŠ è½½è·¯å¾„"><a href="#ç±»åŠ è½½è·¯å¾„" class="headerlink" title="ç±»åŠ è½½è·¯å¾„"></a>ç±»åŠ è½½è·¯å¾„</h2><p>Â·æˆ‘çš„ç†è§£å°±æ˜¯ç¼–è¯‘åçš„è·¯å¾„</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">xx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">URL</span> resource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> path <span class="token operator">=</span> resource<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>file<span class="token operator">:</span><span class="token operator">/</span><span class="token class-name">D</span><span class="token operator">:</span><span class="token operator">/</span>proj<span class="token operator">/</span>daimasuixianglu<span class="token operator">/</span>out<span class="token operator">/</span>production<span class="token operator">/</span>daimasuixianglu<span class="token operator">/</span><span class="token operator">/</span><span class="token class-name">D</span><span class="token operator">:</span><span class="token operator">/</span>proj<span class="token operator">/</span>daimasuixianglu<span class="token operator">/</span>out<span class="token operator">/</span>production<span class="token operator">/</span>daimasuixianglu<span class="token operator">/</span><span class="token class-name">D</span><span class="token operator">:</span>\proj\daimasuixianglu\out\production\daimasuixianglu    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="SpringåŸç”Ÿå®¹å™¨åº•å±‚ç»“æ„"><a href="#SpringåŸç”Ÿå®¹å™¨åº•å±‚ç»“æ„" class="headerlink" title="SpringåŸç”Ÿå®¹å™¨åº•å±‚ç»“æ„"></a>SpringåŸç”Ÿå®¹å™¨åº•å±‚ç»“æ„</h2><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/%7BB50EA099-DAF5-4043-845D-6AA4A62D0964%7D.png"></div></div><h2 id="å¼•ç”¨-æ³¨å…¥å…¶å®ƒ-bean-å¯¹è±¡"><a href="#å¼•ç”¨-æ³¨å…¥å…¶å®ƒ-bean-å¯¹è±¡" class="headerlink" title="å¼•ç”¨/æ³¨å…¥å…¶å®ƒ bean å¯¹è±¡"></a>å¼•ç”¨/æ³¨å…¥å…¶å®ƒ bean å¯¹è±¡</h2><p>Â·åœ¨springçš„iocå®¹å™¨,å¯ä»¥é€šè¿‡refå®ç°beanå¯¹è±¡çš„ç›¸äº’å¼•ç”¨</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memberServiceImpl<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.service.MemberServiceImpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memberDAO<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memberDAOImpl<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memberDAOImpl<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.dao.MemberDAOImpl<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·åœ¨springçš„iocå®¹å™¨,å¯ä»¥ç›´æ¥é…ç½®å†…éƒ¨beanå¯¹è±¡</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memberServiceImpl02<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.service.MemberServiceImpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memberDAO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.dao.MemberDAOImpl<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·å¼•ç”¨/æ³¨å…¥é›†åˆ/æ•°ç»„ç±»å‹</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>master01<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.beans.Master<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>å¤ªä¸Šè€å›<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!-- ç»™ bean å¯¹è±¡çš„ list é›†åˆèµ‹å€¼ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monsterList<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster03<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster02<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- ç»™ bean å¯¹è±¡çš„ map é›†åˆèµ‹å€¼ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monsterMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>key</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>monsterKey01<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>key</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster01<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>key</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>monsterKey02<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>key</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster02<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- ç»™ bean å¯¹è±¡çš„ properties é›†åˆèµ‹å€¼ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pros<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>props</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>k1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Java å·¥ç¨‹å¸ˆ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>k2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>å‰ç«¯å·¥ç¨‹å¸ˆ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>k3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>å¤§æ•°æ®å·¥ç¨‹å¸ˆ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>props</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- ç»™ bean å¯¹è±¡çš„æ•°ç»„å±æ€§æ³¨å…¥å€¼ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monsterName<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>array</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>é“¶è§’å¤§ç‹<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>é‡‘è§’å¤§ç‹<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>array</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- ç»™ bean å¯¹è±¡çš„ set å±æ€§æ³¨å…¥å€¼ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monsterSet<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster01<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.beans.Monster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monsterId<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç‰å…”ç²¾<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>skill<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>é’»åœ°æ´<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="çº§è”å±æ€§èµ‹å€¼"><a href="#çº§è”å±æ€§èµ‹å€¼" class="headerlink" title="çº§è”å±æ€§èµ‹å€¼"></a>çº§è”å±æ€§èµ‹å€¼</h2><p>Â·springçš„iocå®¹å™¨,å¯ä»¥ç›´æ¥ç»™å¯¹è±¡å±æ€§çš„å±æ€§èµ‹å€¼,å³çº§è”å±æ€§</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>emp<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.beans.Emp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jack<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dept<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dept<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dept.name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Java å¼€å‘éƒ¨<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dept<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.beans.Dept<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é€šè¿‡é™æ€å…±å‚è·å–å¯¹è±¡"><a href="#é€šè¿‡é™æ€å…±å‚è·å–å¯¹è±¡" class="headerlink" title="é€šè¿‡é™æ€å…±å‚è·å–å¯¹è±¡"></a>é€šè¿‡é™æ€å…±å‚è·å–å¯¹è±¡</h2><p>Â·åœ¨springçš„iocå®¹å™¨,å¯ä»¥é€šè¿‡é™æ€å·¥å‚è·å–beanå¯¹è±¡</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyStaticFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">></span></span> monsterMap<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>      monsterMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      monsterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"monster_01"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Monster</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"é»„è¢æ€ª"</span><span class="token punctuation">,</span> <span class="token string">"ä¸€é˜³æŒ‡"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      monsterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"monster_02"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Monster</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"ä¹å¤´é‡‘é›•"</span><span class="token punctuation">,</span> <span class="token string">"å¦‚æ¥ç¥æŒ"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Monster</span> <span class="token function">getMonster</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> monsterMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my_monster<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.spring.factory.MyStaticFactory<span class="token punctuation">"</span></span> <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getMonster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster_01<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é€šè¿‡å®ä¾‹å·¥å‚è·å–å¯¹è±¡"><a href="#é€šè¿‡å®ä¾‹å·¥å‚è·å–å¯¹è±¡" class="headerlink" title="é€šè¿‡å®ä¾‹å·¥å‚è·å–å¯¹è±¡"></a>é€šè¿‡å®ä¾‹å·¥å‚è·å–å¯¹è±¡</h2><p>Â·åœ¨springçš„iocå®¹å™¨,å¯ä»¥é€šè¿‡å®ä¾‹å·¥å‚è·å–beanå¯¹è±¡</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyInstanceFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Monster</span><span class="token punctuation">></span></span> monster_map<span class="token punctuation">;</span>    <span class="token punctuation">&#123;</span>        monster_map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        monster_map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"monster_01"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Monster</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"çŒ´å­ç²¾"</span><span class="token punctuation">,</span> <span class="token string">"åƒäºº"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        monster_map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"monster_02"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Monster</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"ä¹å¤´é‡‘é›•"</span><span class="token punctuation">,</span> <span class="token string">"å¦‚æ¥ç¥æŒ"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Monster</span> <span class="token function">getMonster</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> monster_map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myInstanceFactory<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.spring.factory.MyInstanceFactory<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my_monster02<span class="token punctuation">"</span></span> <span class="token attr-name">factory-bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myInstanceFactory<span class="token punctuation">"</span></span> <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getMonster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster_01<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é€šè¿‡FactoryBeanè·å–å¯¹è±¡-é‡ç‚¹"><a href="#é€šè¿‡FactoryBeanè·å–å¯¹è±¡-é‡ç‚¹" class="headerlink" title="é€šè¿‡FactoryBeanè·å–å¯¹è±¡(é‡ç‚¹)"></a>é€šè¿‡FactoryBeanè·å–å¯¹è±¡(é‡ç‚¹)</h2><p>Â·åœ¨springçš„iocå®¹å™¨,é€šè¿‡FactoryBeanè·å–beanå¯¹è±¡(é‡ç‚¹)</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFactoryBean</span> <span class="token keyword">implements</span> <span class="token class-name">FactoryBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Monster</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> keyVal<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">></span></span> monster_map<span class="token punctuation">;</span>    <span class="token punctuation">&#123;</span>        monster_map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        monster_map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"monster_01"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Monster</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"é»„è¢æ€ª"</span><span class="token punctuation">,</span> <span class="token string">"ä¸€é˜³æŒ‡"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        monster_map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"monster_02"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Monster</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"ä¹å¤´é‡‘é›•"</span><span class="token punctuation">,</span> <span class="token string">"å¦‚æ¥ç¥æŒ"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setKeyVal</span><span class="token punctuation">(</span><span class="token class-name">String</span> keyVal<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>keyVal <span class="token operator">=</span> keyVal<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Monster</span> <span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// TODO Auto-generated method stub</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>monster_map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>keyVal<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Class</span> <span class="token function">getObjectType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// TODO Auto-generated method stub</span>        <span class="token keyword">return</span> <span class="token class-name">Monster</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// TODO Auto-generated method stub</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myFactoryBean<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.spring.factory.MyFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>keyVal<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster_01<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="beané…ç½®ä¿¡æ¯é‡ç”¨"><a href="#beané…ç½®ä¿¡æ¯é‡ç”¨" class="headerlink" title="beané…ç½®ä¿¡æ¯é‡ç”¨"></a>beané…ç½®ä¿¡æ¯é‡ç”¨</h2><p>Â·åœ¨springçš„iocå®¹å™¨,æä¾›äº†ä¸€ç§ç»§æ‰¿çš„æ–¹å¼æ¥å®ç°beané…ç½®ä¿¡æ¯çš„é‡ç”¨</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster10<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.beans.Monster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monsterId<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>èœˆèš£ç²¾<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>skill<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>èœ‡äºº<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster11<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.spring.beans.Monster<span class="token punctuation">"</span></span> <span class="token attr-name">parent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster10<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!--å½“æˆ‘ä»¬æŠŠæŸä¸ªbeanè®¾ç½®ä¸ºabstract="true"è¿™ä¸ªbeanåªèƒ½è¢«ç»§æ‰¿,è€Œä¸èƒ½è¢«å®ä¾‹åŒ–äº†--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster12<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.beans.Monster<span class="token punctuation">"</span></span> <span class="token attr-name">abstract</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monsterId<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>12<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç¾å¥³è›‡<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>skill<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>åƒäºº<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster13<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.beans.Monster<span class="token punctuation">"</span></span> <span class="token attr-name">parent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster12<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="beanåˆ›å»ºé¡ºåº"><a href="#beanåˆ›å»ºé¡ºåº" class="headerlink" title="beanåˆ›å»ºé¡ºåº"></a>beanåˆ›å»ºé¡ºåº</h2><p>Â·è¯´æ˜<br>1.åœ¨springçš„iocå®¹å™¨,é»˜è®¤æ˜¯æŒ‰ç…§é…ç½®çš„é¡ºåºåˆ›å»ºbeanå¯¹è±¡<br>2.å…ˆä¼šåˆ›å»ºstudent01è¿™ä¸ªbeanå¯¹è±¡,ç„¶ååˆ›å»ºdepartment01è¿™ä¸ªå¯¹è±¡</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>student01<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.bean.Student<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>department01<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.bean.Department<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3.å¦‚æœè¿™æ ·é…ç½®,å…ˆä¼šåˆ›å»ºdepartment01,<br>Â·è¡¥å…… depends-on è¢«ä¾èµ–é¡¹å…ˆäºä¾èµ–é¡¹è¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œåäºä¾èµ–é¡¹è¢«é”€æ¯<br>Â·ä¼šå…ˆåˆ›å»º department01 å¯¹è±¡ï¼Œå†åˆ›å»º student01</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>student01<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.bean.Student<span class="token punctuation">"</span></span> <span class="token attr-name">depends-on</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>department01<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>department01<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.bean.Department<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="beanå¯¹è±¡çš„å•ä¾‹å’Œå¤šåˆ©"><a href="#beanå¯¹è±¡çš„å•ä¾‹å’Œå¤šåˆ©" class="headerlink" title="beanå¯¹è±¡çš„å•ä¾‹å’Œå¤šåˆ©"></a>beanå¯¹è±¡çš„å•ä¾‹å’Œå¤šåˆ©</h2><p>Â·è¯´æ˜<br>1.åœ¨springçš„iocå®¹å™¨,åœ¨é»˜è®¤æ˜¯æŒ‰ç…§å•ä¾‹åˆ›å»ºçš„,å³é…ç½®ä¸€ä¸ªbeanå¯¹è±¡å,iocå®¹å™¨åªä¼šåˆ›å»ºä¸€ä¸ªbeanå®ä¾‹ã€‚<br>2.å¦‚æœ,æˆ‘ä»¬å¸Œæœ›iocå®¹å™¨é…ç½®çš„æŸä¸ªbeanå¯¹è±¡,æ˜¯ä»¥å¤šä¸ªå®ä¾‹å½¢å¼åˆ›å»ºçš„åˆ™å¯ä»¥é€šè¿‡é…ç½®scope=â€prototypeâ€æ¥æŒ‡å®š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>car<span class="token punctuation">"</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prototype<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.beans.Car<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="ä½¿ç”¨ç»†èŠ‚"><a href="#ä½¿ç”¨ç»†èŠ‚" class="headerlink" title="ä½¿ç”¨ç»†èŠ‚"></a>ä½¿ç”¨ç»†èŠ‚</h3><p>1.é»˜è®¤æ˜¯å•ä¾‹singleton,åœ¨å¯åŠ¨å®¹å™¨æ—¶,é»˜è®¤å°±ä¼šåˆ›å»º,å¹¶æ”¾å…¥åˆ°singletonObjectsé›†åˆ<br>2.å½“<bean scope="prototype">è®¾ç½®ä¸ºå¤šå®ä¾‹æœºåˆ¶å,è¯¥beanæ˜¯åœ¨getBean()æ—¶æ‰åˆ›å»º<br>3.å¦‚æœæ˜¯å•ä¾‹singleton,åŒæ—¶å¸Œæœ›åœ¨getBeanæ—¶æ‰åˆ›å»º,å¯ä»¥æŒ‡å®šæ‡’åŠ è½½lazy-init=â€trueâ€(æ³¨æ„é»˜è®¤æ˜¯false)<br>4.é€šå¸¸æƒ…å†µä¸‹, lazy-init å°±ä½¿ç”¨é»˜è®¤å€¼ false , åœ¨å¼€å‘çœ‹æ¥, ç”¨ç©ºé—´æ¢æ—¶é—´æ˜¯å€¼å¾—çš„, é™¤éæœ‰ç‰¹æ®Šçš„è¦æ±‚.<br>5.å¦‚æœscope=â€prototypeâ€è¿™æ—¶ä½ çš„lazy-initå±æ€§çš„å€¼ä¸ç®¡æ˜¯true,è¿˜æ˜¯falseéƒ½æ˜¯åœ¨getBeanæ—¶å€™,æ‰åˆ›å»ºå¯¹è±¡</bean></p><h2 id="beançš„ç”Ÿå‘½å‘¨æœŸ"><a href="#beançš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="beançš„ç”Ÿå‘½å‘¨æœŸ"></a>beançš„ç”Ÿå‘½å‘¨æœŸ</h2><p>Â·è¯´æ˜:beanå¯¹è±¡åˆ›å»ºæ˜¯ç”±JVMå®Œæˆçš„,ç„¶åæ‰§è¡Œå¦‚ä¸‹æ–¹æ³•<br>1.æ‰§è¡Œæ„é€ å™¨<br>2.æ‰§è¡Œsetç›¸å…³æ–¹æ³•<br>3.è°ƒç”¨beançš„åˆå§‹åŒ–çš„æ–¹æ³•(éœ€è¦é…ç½®)<br>4.ä½¿ç”¨bean<br>5.å½“å®¹å™¨å…³é—­æ—¶å€™,è°ƒç”¨beançš„é”€æ¯æ–¹æ³•(éœ€è¦é…ç½®)</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">House</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">House</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"House() æ„é€ å™¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"House setName()..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"House init().."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"House destory().."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä½¿ç”¨ç»†èŠ‚-1"><a href="#ä½¿ç”¨ç»†èŠ‚-1" class="headerlink" title="ä½¿ç”¨ç»†èŠ‚"></a>ä½¿ç”¨ç»†èŠ‚</h3><p>1.åˆå§‹åŒ–initæ–¹æ³•å’Œdestroyæ–¹æ³•,æ˜¯ç¨‹åºå‘˜æ¥æŒ‡å®šã€‚<br>2.é”€æ¯æ–¹æ³•å°±æ˜¯å½“å…³é—­å®¹å™¨æ—¶,æ‰ä¼šè¢«è°ƒç”¨ã€‚</p><h2 id="é…ç½®beançš„åç½®å¤„ç†å™¨"><a href="#é…ç½®beançš„åç½®å¤„ç†å™¨" class="headerlink" title="é…ç½®beançš„åç½®å¤„ç†å™¨"></a>é…ç½®beançš„åç½®å¤„ç†å™¨</h2><p>1.åœ¨springçš„iocå®¹å™¨,å¯ä»¥é…ç½®beançš„åç½®å¤„ç†å™¨<br>2.è¯¥å¤„ç†å™¨/å¯¹è±¡ä¼šåœ¨beanåˆå§‹åŒ–æ–¹æ³•è°ƒç”¨å‰å’Œåˆå§‹åŒ–æ–¹æ³•è°ƒç”¨åè¢«è°ƒç”¨</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBeanPostProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * åœ¨ bean åˆå§‹åŒ–ä¹‹å‰å®ŒæˆæŸäº›ä»»åŠ¡     * @param bean : å°±æ˜¯ ioc å®¹å™¨è¿”å›çš„ bean å¯¹è±¡, å¦‚æœè¿™é‡Œè¢«æ›¿æ¢ä¼šä¿®æ”¹ï¼Œåˆ™è¿”     * å›çš„ bean å¯¹è±¡ä¹Ÿä¼šè¢«ä¿®æ”¹     * @param beanName: å°±æ˜¯ ioc å®¹å™¨é…ç½®çš„ bean çš„åç§°     * @return Object: å°±æ˜¯è¿”å›çš„ bean å¯¹è±¡     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"postProcessBeforeInitialization è¢«è°ƒç”¨"</span><span class="token operator">+</span>beanName<span class="token operator">+</span><span class="token string">"--"</span><span class="token operator">+</span>bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * åœ¨ bean åˆå§‹åŒ–ä¹‹åå®ŒæˆæŸäº›ä»»åŠ¡     * @param bean : å°±æ˜¯ ioc å®¹å™¨è¿”å›çš„ bean å¯¹è±¡, å¦‚æœè¿™é‡Œè¢«æ›¿æ¢ä¼šä¿®æ”¹ï¼Œåˆ™è¿”       å›çš„ bean å¯¹è±¡ä¹Ÿä¼šè¢«ä¿®æ”¹     * @param beanName: å°±æ˜¯ ioc å®¹å™¨é…ç½®çš„ bean çš„åç§°     * @return Object: å°±æ˜¯è¿”å›çš„ bean å¯¹è±¡     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"postProcessAfterInitialization è¢«è°ƒç”¨"</span><span class="token operator">+</span>beanName<span class="token operator">+</span><span class="token string">"--"</span><span class="token operator">+</span>bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>house<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.beans.House<span class="token punctuation">"</span></span>          <span class="token attr-name">init-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>init<span class="token punctuation">"</span></span> <span class="token attr-name">destroy-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>destory<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>åŒ—äº¬è±ªå®…<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myBeanPostProcessor<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.beans.MyBeanPostProcessor<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å…¶ä»–è¯´æ˜"><a href="#å…¶ä»–è¯´æ˜" class="headerlink" title="å…¶ä»–è¯´æ˜"></a>å…¶ä»–è¯´æ˜</h3><p>1.æ€ä¹ˆæ‰§è¡Œåˆ°è¿™ä¸ªæ–¹æ³•?=&gt;ä½¿ç”¨AOP(åå°„+åŠ¨æ€ä»£ç†+IO+å®¹å™¨+æ³¨è§£)<br>2.æœ‰ä»€ä¹ˆç”¨?=&gt;å¯ä»¥å¯¹IOCå®¹å™¨ä¸­æ‰€æœ‰çš„å¯¹è±¡è¿›è¡Œç»Ÿä¸€å¤„ç†,æ¯”å¦‚ æ—¥å¿—å¤„ç†/æƒé™çš„æ ¡éªŒ/å®‰å…¨çš„éªŒè¯/äº‹åŠ¡ç®¡ç†<br>3.é’ˆå¯¹å®¹å™¨çš„æ‰€æœ‰å¯¹è±¡?æ˜¯çš„=&gt;åˆ‡é¢ç¼–ç¨‹ç‰¹ç‚¹</p><h2 id="é€šè¿‡å±æ€§æ–‡ä»¶ç»™beanæ³¨å…¥å€¼"><a href="#é€šè¿‡å±æ€§æ–‡ä»¶ç»™beanæ³¨å…¥å€¼" class="headerlink" title="é€šè¿‡å±æ€§æ–‡ä»¶ç»™beanæ³¨å…¥å€¼"></a>é€šè¿‡å±æ€§æ–‡ä»¶ç»™beanæ³¨å…¥å€¼</h2><p>Â·åœ¨springçš„iocå®¹å™¨,é€šè¿‡å±æ€§æ–‡ä»¶ç»™beanæ³¨å…¥å€¼<br>Â·åº”ç”¨å®ä¾‹<br>Â·åœ¨src/åˆ›å»ºmy.properties</p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">name</span><span class="token punctuation">=</span><span class="token value attr-value">\u9EC4\u888D\u602A</span><span class="token key attr-name">id</span><span class="token punctuation">=</span><span class="token value attr-value">10</span><span class="token key attr-name">skill</span><span class="token punctuation">=</span><span class="token value attr-value">\u72EE\u5B50\u543C</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">&lt;!--1.é€šè¿‡å±æ€§æ–‡ä»¶ç»™beanæ³¨å…¥å€¼2.éœ€è¦å¯¼å…¥:xmlns:context åå­—ç©ºé—´,å¹¶æŒ‡å®šå±æ€§æ–‡ä»¶è·¯å¾„--&gt;&lt;context:property-placeholder location&#x3D;&quot;classpath:my.properties&quot;&#x2F;&gt;&lt;bean id&#x3D;&quot;monster100&quot; class&#x3D;&quot;com.hspedu.spring.beans.Monster&quot;&gt;     &lt;property name&#x3D;&quot;monsterId&quot; value&#x3D;&quot;$&#123;id&#125;&quot;&#x2F;&gt;     &lt;property name&#x3D;&quot;name&quot; value&#x3D;&quot;$&#123;name&#125;&quot;&#x2F;&gt;     &lt;property name&#x3D;&quot;skill&quot; value&#x3D;&quot;$&#123;skill&#125;&quot;&#x2F;&gt;&lt;&#x2F;bean&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åŸºäºXMLçš„beançš„è‡ªåŠ¨è£…é…"><a href="#åŸºäºXMLçš„beançš„è‡ªåŠ¨è£…é…" class="headerlink" title="åŸºäºXMLçš„beançš„è‡ªåŠ¨è£…é…"></a>åŸºäºXMLçš„beançš„è‡ªåŠ¨è£…é…</h2><p>Â·åœ¨springçš„iocå®¹å™¨,å¯ä»¥å®ç°è‡ªåŠ¨è£…é…bean<br>Â·åº”ç”¨å®ä¾‹<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderDao</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¿å­˜ä¸€ä¸ªè®¢å•ã€‚ã€‚ã€‚ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">OrderDao</span> orderDao<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">OrderDao</span> <span class="token function">getOrderDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> orderDao<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOrderDao</span><span class="token punctuation">(</span><span class="token class-name">OrderDao</span> orderDao<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>orderDao <span class="token operator">=</span> orderDao<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderAction</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">OrderService</span> <span class="token function">getOrderService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> orderService<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOrderService</span><span class="token punctuation">(</span><span class="token class-name">OrderService</span> orderService<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>orderService <span class="token operator">=</span> orderService<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    åˆ†æ    1.autowire="byType"è¡¨ç¤ºåœ¨åˆ›å»ºorderServiceæ—¶,é€šè¿‡ç±»å‹çš„æ–¹å¼,ç»™å¯¹è±¡çš„å±æ€§è‡ªåŠ¨å®Œæˆèµ‹å€¼/å¼•ç”¨    2.æ¯”å¦‚OrderServiceå¯¹è±¡æœ‰private OrderDao OrderDao    3.å°±ä¼šåœ¨å®¹å™¨ä¸­å»æ‰¾æ²¡æœ‰OrderDaoç±»å‹çš„å¯¹è±¡    4.å¦‚æœæœ‰,å°±ä¼šè‡ªåŠ¨çš„è£…é…,å¦‚æœæŒ‰ç…§byTypeæ–¹å¼æ¥è£…é…,è¿™ä¸ªå®¹å™¨ä¸­,ä¸èƒ½æœ‰ä¸¤ä¸ªOrderDaoç±»å‹çš„å¯¹è±¡    5.å¦‚æœè®¾ç½®çš„æ—¶autowire="byName",è¡¨ç¤ºé€šè¿‡åå­—å®Œæˆè‡ªåŠ¨è£…é…    6.æ¯”å¦‚ä¸‹é¢çš„autowire="byName" class="com.qgq.spring.service.OrderService" id="orderService"        1ï¼‰å…ˆçœ‹OrderService å±æ€§private OrderDao orderDaoï¼Œ        2ï¼‰åœ¨æ ¹æ®è¿™ä¸ªå±æ€§çš„setXXX()æ–¹æ³•çš„xxxæ¥æ‰¾å¯¹è±¡çš„id        3ï¼‰ public void setOrderDao()å°±ä¼šæ‰¾id=orderDaoå¯¹è±¡æ¥è¿›è¡Œè‡ªåŠ¨è£…é…        4ï¼‰å¦‚æœæ²¡æœ‰å°±è£…é…å¤±è´¥    --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.spring.dao.OrderDao<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>orderDao<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--åŸºäºxmlçš„beançš„è‡ªåŠ¨è£…é…,æ¼”ç¤ºautowire="byType",è¡¨ç¤ºæ ¹æ®ç±»å‹è¿›è¡Œè‡ªåŠ¨ç»„è£…--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">autowire</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>byName<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.spring.service.OrderService<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>orderService<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--é…ç½®OrderActionå¯¹è±¡--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">autowire</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>byName<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.spring.web.OrderAction<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>orderAction<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>Â·è¿™ä¸ªçŸ¥è¯†ç‚¹ä½œä¸ºäº†è§£å³å¯,åé¢æˆ‘ä»¬ä¸»è¦è¿˜æ˜¯åŸºäºæ³¨è§£çš„æ–¹å¼(é‡ç‚¹.)</p><h2 id="spring-elè¡¨è¾¾å¼ã€çŸ¥é“å³å¯ã€‘"><a href="#spring-elè¡¨è¾¾å¼ã€çŸ¥é“å³å¯ã€‘" class="headerlink" title="spring elè¡¨è¾¾å¼ã€çŸ¥é“å³å¯ã€‘"></a>spring elè¡¨è¾¾å¼ã€çŸ¥é“å³å¯ã€‘</h2><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- spring el è¡¨è¾¾å¼ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>spELBean<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.beans.SpELBean<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- sp el ç»™å­—é¢é‡ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#&#123;'éŸ©é¡ºå¹³æ•™è‚²'&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!-- sp el å¼•ç”¨å…¶å®ƒ bean --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#&#123;monster01&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!-- sp el å¼•ç”¨å…¶å®ƒ bean çš„å±æ€§å€¼ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monsterName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#&#123;monster02.name&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!-- sp el è°ƒç”¨æ™®é€šæ–¹æ³• èµ‹å€¼ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>crySound<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#&#123;spELBean.cry('å–µå–µçš„..')&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!-- sp el è°ƒç”¨é™æ€æ–¹æ³• èµ‹å€¼ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#&#123;T(com.hspedu.spring.beans.SpELBean).read(' å¤©é¾™å…«éƒ¨')&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!-- sp el é€šè¿‡è¿ç®—èµ‹å€¼ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>result<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#&#123;89*1.2&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åŸºäºæ³¨è§£é…ç½®bean"><a href="#åŸºäºæ³¨è§£é…ç½®bean" class="headerlink" title="åŸºäºæ³¨è§£é…ç½®bean"></a>åŸºäºæ³¨è§£é…ç½®bean</h2><h3 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>Â·åŸºäºæ³¨è§£çš„æ–¹å¼é…ç½®bean,ä¸»è¦æ˜¯é¡¹ç›®å¼€å‘ä¸­çš„ç»„ä»¶,æ¯”å¦‚Controller,Service,å’ŒDao<br>Â·ç»„ä»¶çš„æ³¨è§£çš„å½¢å¼æœ‰<br>1.@Component è¡¨ç¤ºå½“å‰æ³¨è§£æ ‡è¯†çš„æ˜¯ä¸€ä¸ªç»„ä»¶<br>2.@Controller è¡¨ç¤ºå½“å‰æ³¨è§£æ ‡è¯†çš„æ˜¯ä¸€ä¸ªæ§åˆ¶å™¨,é€šå¸¸ç”¨äºServlet<br>3.@Service è¡¨ç¤ºå½“å‰æ³¨è§£æ ‡è¯†çš„æ˜¯ä¸€ä¸ªå¤„ç†ä¸šåŠ¡é€»è¾‘çš„ç±»,é€šå¸¸ç”¨äºServiceç±»<br>4.@Repositoryæ ‡è¯†å½“å‰æ³¨è§£æ ‡è¯†çš„æ˜¯ä¸€ä¸ªæŒä¹…åŒ–å±‚çš„lei,é€šå¸¸ç”¨äºDaoç±»<br>5.åœ¨ä½¿ç”¨æ—¶è¦é…ç½®è‡ªåŠ¨æ‰«æçš„åŒ…,æ³¨æ„éœ€è¦åŠ å…¥contextåç§°ç©ºé—´<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.component<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br>6.Springçš„IOCå®¹å™¨ä¸èƒ½æ£€æµ‹ä¸€ä¸ªä½¿ç”¨äº†@Controlleræ³¨è§£çš„ç±»åˆ°åº•æ˜¯ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„æ§åˆ¶å™¨ã€‚æ³¨è§£çš„åç§°æ˜¯ç”¨äºç¨‹åºå‘˜è‡ªå·±è¯†åˆ«å½“å‰<br>æ ‡è¯†çš„æ˜¯ä»€ä¹ˆç»„ä»¶,å…¶ä»–çš„@Service,@Repositoryä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ã€‚<br>7.æ’é™¤é‚£äº›ç±»,ä»¥æ³¨è§£ä¸ºä¾‹<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.component<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- æ’é™¤å“ªäº›ç±» , ä»¥ annotaion æ³¨è§£ä¸ºä¾‹ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>exclude-filter</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>annotation<span class="token punctuation">"</span></span> <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.stereotype.Service<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="è§£è¯»"><a href="#è§£è¯»" class="headerlink" title="è§£è¯»"></a>è§£è¯»</h4><p>Â·<context:exclude-filter> æ”¾åœ¨<context:component-scan>å†…ï¼Œè¡¨ç¤ºæ‰«æè¿‡æ»¤æ‰å½“å‰åŒ…çš„æŸäº›ç±»<br>Â·type=â€annotationâ€ æŒ‰ç…§æ³¨è§£ç±»å‹è¿›è¡Œè¿‡æ»¤. 3) expression :å°±æ˜¯æ³¨è§£çš„å…¨ç±»åï¼Œæ¯”å¦‚ org.springframework.stereotype.Service å°±æ˜¯<br>Â·Service æ³¨è§£çš„å…¨ç±»å,å…¶å®ƒæ¯”@Controller @Repository ç­‰ ä¾æ¬¡ç±»æ¨<br>Â·ä¸Šé¢è¡¨ç¤ºè¿‡æ»¤æ‰ com.hspedu.spring.component åŒ…ä¸‹ï¼ŒåŠ å…¥äº†@Service æ³¨è§£çš„ç±»<br>Â·å®Œæˆæµ‹è¯•ï¼Œ ä¿®æ”¹ beans.xml, å¢åŠ  exclude-filter , å‘ç° UserService, ä¸ä¼šæ³¨å…¥åˆ°å®¹å™¨.<br>8.æŒ‡å®šè‡ªåŠ¨æ‰«æé‚£äº›æ³¨è§£ç±»<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.component<span class="token punctuation">"</span></span> <span class="token attr-name">use-default-filters</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>include-filter</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>annotation<span class="token punctuation">"</span></span> <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.stereotype.Service<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>include-filter</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>annotation<span class="token punctuation">"</span></span> <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.stereotype.Controller<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">context:</span>component-scan</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>9.é»˜è®¤æƒ…å†µ:æ ‡è®°æ³¨è§£å,ç±»åé¦–å­—æ¯å°å†™ä½œä¸ºidçš„å€¼,ä¹Ÿå¯ä»¥ä½¿ç”¨æ³¨è§£valueå±æ€§æŒ‡å®šidå€¼,å¹¶ä¸”valueå¯ä»¥çœç•¥</context:component-scan></context:exclude-filter></p><h2 id="ç®€å•çš„springåŸºäºæ³¨è§£çš„å¼€å‘ç¨‹åº"><a href="#ç®€å•çš„springåŸºäºæ³¨è§£çš„å¼€å‘ç¨‹åº" class="headerlink" title="ç®€å•çš„springåŸºäºæ³¨è§£çš„å¼€å‘ç¨‹åº"></a>ç®€å•çš„springåŸºäºæ³¨è§£çš„å¼€å‘ç¨‹åº</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">"com.qgq.spring.component"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QgqSpringConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>qgq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Annotation</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URL</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ConcurrentHashMap</span></span><span class="token punctuation">;</span><span class="token comment">/** * @Author ç§¦å®¶å¤§èƒ– * @Date 2024/3/25 0025 18:42 * @Version 1.0 * æˆ‘äº¦æ— ä»–ï¼ŒæƒŸæ‰‹ç†Ÿå°” */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QgqSpringApplicationContext</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Class</span> configClass<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> ioc<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">getIoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> ioc<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">QgqSpringApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">Class</span> configClass<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>configClass <span class="token operator">=</span> configClass<span class="token punctuation">;</span>        <span class="token class-name">ComponentScan</span> componentScan <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ComponentScan</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configClass<span class="token punctuation">.</span><span class="token function">getDeclaredAnnotation</span><span class="token punctuation">(</span><span class="token class-name">ComponentScan</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> path<span class="token operator">=</span>componentScan<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> <span class="token class-name">QgqSpringApplicationContext</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        path<span class="token operator">=</span>path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ç›®çš„æ˜¯æ‰«æè¯¥è·¯å¾„ä¸‹çš„ç±»</span>        <span class="token class-name">URL</span> resource <span class="token operator">=</span> classLoader<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">File</span><span class="token punctuation">[</span><span class="token punctuation">]</span> files <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">File</span> f <span class="token operator">:</span> files<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">String</span> fileAbsolutePath <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>fileAbsolutePath<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">".class"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token comment">//D:\proj\qgq_spring\MySpring\target\classes\com\qgq\spring\component\MonsterService.class</span>                    <span class="token comment">//å¾—åˆ°ç±»çš„ç±»å</span>                    <span class="token class-name">String</span> className<span class="token operator">=</span>fileAbsolutePath<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>fileAbsolutePath<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>fileAbsolutePath<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">".class"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> classFullPath<span class="token operator">=</span>path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"."</span><span class="token operator">+</span>className<span class="token punctuation">;</span>                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> clazz <span class="token operator">=</span> classLoader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>classFullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>clazz<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">Controller</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ˜¯ä¸€ä¸ª bean = "</span> <span class="token operator">+</span> clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> aClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>classFullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                                <span class="token class-name">Object</span> instance <span class="token operator">=</span> aClass<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                ioc<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸æ˜¯ä¸€ä¸ª bean = "</span> <span class="token operator">+</span> clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> ioc<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è‡ªåŠ¨è£…é…"><a href="#è‡ªåŠ¨è£…é…" class="headerlink" title="è‡ªåŠ¨è£…é…"></a>è‡ªåŠ¨è£…é…</h2><h3 id="åŸºæœ¬è¯´æ˜"><a href="#åŸºæœ¬è¯´æ˜" class="headerlink" title="åŸºæœ¬è¯´æ˜"></a>åŸºæœ¬è¯´æ˜</h3><p>1.åŸºäºæ³¨è§£é…ç½®bean,ä¹Ÿå¯ä»¥å®ç°è‡ªåŠ¨è£…é…,ä½¿ç”¨çš„æ³¨è§£æ˜¯:@AutoWiredæˆ–è€…@Resource<br>2.@AutoWiredçš„è§„åˆ™è¯´æ˜<br>Â·åœ¨iocå®¹å™¨ä¸­æŸ¥æ‰¾å¾…è£…é…çš„ç»„ä»¶çš„ç±»å‹,å¦‚æœæœ‰å”¯ä¸€çš„beanåŒ¹é…,åˆ™ä½¿ç”¨è¯¥beanè£…é…<br>Â·å¦‚å¾…è£…é…çš„ç±»å‹å¯¹åº”çš„beanåœ¨iocå®¹å™¨ä¸­æœ‰å¤šä¸ª,åˆ™ä½¿ç”¨å¾…è£…é…çš„å±æ€§çš„å±æ€§åä½œä¸ºidå€¼å†è¿›è¡ŒæŸ¥æ‰¾,æ‰¾åˆ°å°±è£…é…,æ‰¾ä¸åˆ°å°±æŠ›å¼‚å¸¸<br>Â·@Resource æœ‰ä¸¤ä¸ªå±æ€§æ˜¯æ¯”è¾ƒé‡è¦çš„,åˆ†æ˜¯ name å’Œ type,Spring å°†@Resource æ³¨è§£çš„nameå±æ€§è§£æä¸ºbeançš„åå­—,<br>è€Œtypeå±æ€§åˆ™è§£æä¸ºbeançš„ç±»å‹.æ‰€ä»¥å¦‚æœä½¿ç”¨nameå±æ€§,åˆ™ä½¿ç”¨byNameçš„è‡ªåŠ¨æ³¨å…¥ç­–ç•¥,è€Œä½¿ç”¨typeå±æ€§æ—¶åˆ™ä½¿ç”¨byTypeè‡ªåŠ¨æ³¨<br>Â·å¦‚æœ@Resource æ²¡æœ‰æŒ‡å®š name å’Œ type ,åˆ™å…ˆä½¿ç”¨byNameæ³¨å…¥ç­–ç•¥, å¦‚æœåŒ¹é…ä¸ä¸Š,å†ä½¿ç”¨byTypeç­–ç•¥,å¦‚æœéƒ½ä¸æˆåŠŸï¼Œå°±ä¼šæŠ¥é”™</p><h3 id="Qualifieræ³¨è§£"><a href="#Qualifieræ³¨è§£" class="headerlink" title="Qualifieræ³¨è§£"></a>Qualifieræ³¨è§£</h3><p>Â·Qualifieræ³¨è§£ä¸@Autowiredé…åˆä½¿ç”¨,å¦‚æœå†ä¸€ä¸ªå®¹å™¨ä¸­å¦‚æœå¾…è£…é…çš„ç»„ä»¶çš„beanä¸å”¯ä¸€,å¹¶ä¸”è¦åˆ¶å®šæŸä¸ªbean,<br>å¯ä»¥ä½¿ç”¨Qualifieræ³¨è§£æ³¨è§£<br>Â·å¦‚ä¸‹ä¾‹,è™½ç„¶@AutoWiredé»˜è®¤æƒ…å†µä¸‹ä¼šæŒ‰ç…§ç±»å‹åŒ¹é…,å¦‚æœåŒ¹é…ä¸åˆ°ä¼šæŒ‰ç…§å±æ€§åä¸ºidåŒ¹é…(beanå¾€å®¹å™¨ä¸­æ”¾çš„æ—¶å€™ä¼šæŒ‰ç…§ç±»åé¦–å­—æ¯å°å†™ä½œä¸ºidçš„å€¼)<br>ä½†æ˜¯é‡åˆ°è¿™ç§æƒ…å†µå°±ä¼šæŠ¥é”™NoUniqueBeanDefinitionException,æ‰€ä»¥éœ€è¦ä½¿ç”¨@Qualifieré…åˆä½¿ç”¨<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"fooFormatter"</span><span class="token punctuation">)</span>   <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FooFormatter</span> <span class="token keyword">implements</span> <span class="token class-name">Formatter</span> <span class="token punctuation">&#123;</span>       <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>           <span class="token keyword">return</span> <span class="token string">"foo"</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span>   <span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"barFormatter"</span><span class="token punctuation">)</span>   <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BarFormatter</span> <span class="token keyword">implements</span> <span class="token class-name">Formatter</span> <span class="token punctuation">&#123;</span>       <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>           <span class="token keyword">return</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span>   <span class="token annotation punctuation">@Component</span>   <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FooService</span> <span class="token punctuation">&#123;</span>       <span class="token annotation punctuation">@Autowired</span>       <span class="token keyword">private</span> <span class="token class-name">Formatter</span> formatter<span class="token punctuation">;</span>              <span class="token comment">//todo </span>   <span class="token punctuation">&#125;</span>   <span class="token annotation punctuation">@Component</span>   <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FooService</span> <span class="token punctuation">&#123;</span>       <span class="token annotation punctuation">@Autowired</span>       <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"fooFormatter"</span><span class="token punctuation">)</span>       <span class="token keyword">private</span> <span class="token class-name">Formatter</span> formatter<span class="token punctuation">;</span>              <span class="token comment">//todo </span>   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="æ³›å‹ä¾èµ–æ³¨å…¥"><a href="#æ³›å‹ä¾èµ–æ³¨å…¥" class="headerlink" title="æ³›å‹ä¾èµ–æ³¨å…¥"></a>æ³›å‹ä¾èµ–æ³¨å…¥</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BaseDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Repository</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDao</span> <span class="token keyword">extends</span> <span class="token class-name">BaseDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ­£åœ¨ä¿å­˜ç”¨æˆ·..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Repository</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookDao</span> <span class="token keyword">extends</span> <span class="token class-name">BaseDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ­£åœ¨ä¿å­˜å›¾ä¹¦..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaseService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token class-name">BaseDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> baseDao<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è‡ªåŠ¨æ³¨å…¥çš„dao"</span><span class="token operator">+</span>baseDao<span class="token punctuation">)</span><span class="token punctuation">;</span>        baseDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookService</span> <span class="token keyword">extends</span> <span class="token class-name">BaseService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token keyword">extends</span> <span class="token class-name">BaseService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·æˆ‘çš„ç†è§£,å®ƒä»¬çš„çˆ¶ç±»å­˜åœ¨ä¾èµ–æ³¨å…¥,å­ç±»è‡ªåŠ¨ä¾èµ–æ³¨å…¥</p><h2 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h2><h3 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Vehicle</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token keyword">implements</span> <span class="token class-name">Vehicle</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å°æ±½è½¦åœ¨å…¬è·¯ running.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VehicleProxyProvider</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Vehicle</span> target_vehicle<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">VehicleProxyProvider</span><span class="token punctuation">(</span><span class="token class-name">Vehicle</span> target_vehicle<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>target_vehicle <span class="token operator">=</span> target_vehicle<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Vehicle</span> <span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">ClassLoader</span> loader <span class="token operator">=</span> target_vehicle<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> interfaces <span class="token operator">=</span> target_vehicle<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>interfaces<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¿™ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯ invoke åˆ°æ—¶å¯ä»¥é€šè¿‡åå°„ï¼ŒåŠ¨æ€è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•</span>        <span class="token class-name">InvocationHandler</span> invocationHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"äº¤é€šå·¥å…·å¼€å§‹è¿è¡Œäº†..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target_vehicle<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"äº¤é€šå·¥å…·å¼€å§‹è¿è¡Œäº†..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> result<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token comment">//å°†ä¸Šé¢çš„ loader, interfaces, invocationHandler æ„å»ºä¸€ä¸ª Vehicle</span>        <span class="token comment">//çš„ä»£ç†å¯¹è±¡</span>        <span class="token class-name">Vehicle</span> vehicle <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Vehicle</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>loader<span class="token punctuation">,</span> interfaces<span class="token punctuation">,</span> invocationHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> vehicle<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="AOPçš„åŸºæœ¬ä»‹ç»"><a href="#AOPçš„åŸºæœ¬ä»‹ç»" class="headerlink" title="AOPçš„åŸºæœ¬ä»‹ç»"></a>AOPçš„åŸºæœ¬ä»‹ç»</h2><p>Â·ä»€ä¹ˆæ˜¯AOP<br>1.AOPçš„å…¨ç¨‹(aspect oriented programming) é¢å‘åˆ‡é¢ç¼–ç¨‹<br>2.ä¸€å¼ ç®€æ˜“å›¾è¯´æ˜AOP<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/2889a9ac95a42e25aff1297b2b62fae7.png"></div></div><br>3.ä¸€å¼ è¯¦ç»†å›¾è¯´æ˜AOP<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/462a3e661315ecace1b373f2a35bec7c.png"></div></div></p><h3 id="AOPå®ç°æ–¹å¼"><a href="#AOPå®ç°æ–¹å¼" class="headerlink" title="AOPå®ç°æ–¹å¼"></a>AOPå®ç°æ–¹å¼</h3><p>1.åŸºäºåŠ¨æ€ä»£ç†çš„æ–¹å¼[å†…ç½®aopå®ç°]<br>2.ä½¿ç”¨æ¡†æ¶aspectjæ¥å®ç°</p><h3 id="AOPç¼–ç¨‹å¿«é€Ÿå…¥é—¨"><a href="#AOPç¼–ç¨‹å¿«é€Ÿå…¥é—¨" class="headerlink" title="AOPç¼–ç¨‹å¿«é€Ÿå…¥é—¨"></a>AOPç¼–ç¨‹å¿«é€Ÿå…¥é—¨</h3><p>Â·è¯´æ˜<br>1.éœ€è¦å¼•å…¥æ ¸å¿ƒçš„aspectåŒ…<br>2.å†åˆ‡é¢ç±»ä¸­å£°æ˜é€šçŸ¥æ–¹æ³•<br>3.å‰ç½®é€šçŸ¥:@Before<br>4.è¿”å›é€šçŸ¥:@AfterReturning<br>5.å¼‚å¸¸é€šçŸ¥:@AfterThrowing<br>6.åç½®é€šçŸ¥:@After<br>7.ç¯ç»•é€šçŸ¥@Around<br>Â·ç‰ˆæœ¬ä¸€<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Aspect</span>  <span class="token comment">//è¡¨ç¤ºæ˜¯ä¸€ä¸ªåˆ‡é¢ç±»</span><span class="token annotation punctuation">@Component</span>  <span class="token comment">//ä¼šæ³¨å…¥SmartAnimalAspectåˆ°å®¹å™¨</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SmartAnimalAspect</span> <span class="token punctuation">&#123;</span>     <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(public float com.qgq.spring.AOP.aspectj.SmartDog.*(float, float))"</span><span class="token punctuation">)</span>     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¾—åˆ°çš„æ˜¯æ–¹æ³•ç­¾åcom.qgq.spring.AOP.aspectj.SmartDog.getSum</span>        <span class="token comment">//æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œå‰ç½®é€šçŸ¥</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åˆ‡é¢ç±»-æ–¹æ³•æ‰§è¡Œå‰-æ—¥å¿—-æ–¹æ³•å-"</span> <span class="token operator">+</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-å‚æ•°"</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution( public float com.qgq.spring.AOP.aspectj.SmartDog.getSum(float, float))"</span><span class="token punctuation">,</span>returning <span class="token operator">=</span> <span class="token string">"res"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span><span class="token class-name">Object</span> res<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œè¿”å›é€šçŸ¥</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åˆ‡é¢ç±»-æ—¥å¿—-æ–¹æ³•å-"</span> <span class="token operator">+</span> signature<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-ç»“æœresult="</span><span class="token operator">+</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution( public float com.qgq.spring.AOP.aspectj.SmartDog.getSum(float, float))"</span><span class="token punctuation">,</span>throwing <span class="token operator">=</span> <span class="token string">"thrown"</span><span class="token punctuation">)</span>     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">f3</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span><span class="token class-name">Throwable</span> thrown<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œè¿”å›é€šçŸ¥</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åˆ‡é¢ç±»-æ—¥å¿—-æ–¹æ³•å‡ºç°å¼‚å¸¸-æ–¹æ³•å-"</span> <span class="token operator">+</span> signature<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-å¼‚å¸¸ä¿¡æ¯="</span><span class="token operator">+</span>thrown<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution( public float com.qgq.spring.AOP.aspectj.SmartDog.getSum(float, float))"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">f4</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œè¿”å›é€šçŸ¥</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åˆ‡é¢ç±»æœ€æ€»é€šçŸ¥-æ—¥å¿—-æ–¹æ³•å-"</span> <span class="token operator">+</span> signature<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-ç»“æœresult="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>Â·ä¸Šé¢çš„æ¯ä¸€ä¸ªåˆ‡å…¥çš„æ–¹æ³•éƒ½éœ€è¦å†™åˆ‡å…¥è¡¨è¾¾å¼<br>Â·å®šä¹‰ä¸€ä¸ªåˆ‡å…¥ç‚¹,åœ¨åé¢ä½¿ç”¨çš„æ—¶å€™å¯ä»¥ç›´æ¥ä½¿ç”¨,æé«˜äº†å¤ç”¨è¡Œ<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(public float com.qgq.spring.AOP.aspectj.SmartDog.*(float ,float ))"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myPointCut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@After</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"myPointCut()"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>Â·å¯ä»¥ä½¿ç”¨@Aroundæ³¨è§£å®Œæˆåˆ‡å…¥,ä½†æ˜¯ä¸å¸¸ç”¨<br>Â·å®ƒç›¸å½“äºå°†äº”ä¸ªåˆ‡å…¥æ–¹æ³•é€šè¿‡try-catch-finallyåˆå¹¶åœ¨ä¸€å—<br>Â·æ‰§è¡Œç›®æ ‡æ–¹æ³•çš„æ–¹æ³•ä¸º result=joinPoint.proceed();<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Aspect</span>  <span class="token comment">//è¡¨ç¤ºæ˜¯ä¸€ä¸ªåˆ‡é¢ç±»</span><span class="token annotation punctuation">@Component</span>  <span class="token comment">//ä¼šæ³¨å…¥SmartAnimalAspectåˆ°å®¹å™¨</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SmartAnimalAspect2</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(public float SmartDog.*(float, float) )"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">doAround</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> joinPoint<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">Object</span> result<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> name <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//1.ç›¸å½“äºå‰ç½®é€šçŸ¥å®Œæˆçš„äº‹æƒ…</span>            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> objects <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"AOPç¯ç»•é€šçŸ¥--"</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">"æ–¹æ³•å‚æ•°"</span><span class="token operator">+</span>objects<span class="token punctuation">)</span><span class="token punctuation">;</span>            result<span class="token operator">=</span>joinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//2.ç›¸å½“äºè¿”å›é€šçŸ¥å®Œæˆçš„äº‹æƒ…</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"AOPç¯ç»•é€šçŸ¥--"</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">"æ–¹æ³•å‚æ•°"</span><span class="token operator">+</span>objects<span class="token operator">+</span><span class="token string">"è¿”å›çš„ç»“æœ"</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"AOPç¯ç»•é€šçŸ¥--"</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">"æ–¹æ³•å¼‚å¸¸äº†"</span><span class="token operator">+</span>throwable<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"AOPç¯ç»•é€šçŸ¥--"</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">"æœ€ç»ˆé€šçŸ¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="ç»†èŠ‚è¯´æ˜"><a href="#ç»†èŠ‚è¯´æ˜" class="headerlink" title="ç»†èŠ‚è¯´æ˜"></a>ç»†èŠ‚è¯´æ˜</h3><p>1.å½“springå®¹å™¨å¼€å¯äº†åŸºäºæ³¨è§£çš„AOPçš„åŠŸèƒ½<aop:aspectj-autoproxy>,æˆ‘ä»¬è·å–æ³¨å…¥çš„å¯¹è±¡,éœ€è¦ä»¥æ¥å£çš„ç±»å‹æ¥è·å–,<br>å› ä¸ºä½ æ³¨å…¥çš„å¯¹è±¡.getClass()å·²ç»æ˜¯ä»£ç†ç±»å‹äº†ã€‚<br>Â·ä¾‹å¦‚SmartAnimalable bean = ioc.getBean(SmartAnimalable.class);<br>@Component  //ä½¿ç”¨@Component å½“springå®¹å™¨å¯åŠ¨æ—¶ï¼Œå°†smartDogæ³¨å…¥åˆ°å®¹å™¨<br>public class SmartDog implements SmartAnimalable<br>1.å½“springå®¹å™¨å¼€å¯äº†åŸºäºæ³¨è§£çš„AOPçš„åŠŸèƒ½<aop:aspectj-autoproxy>,æˆ‘ä»¬è·å–æ³¨å…¥çš„å¯¹è±¡,ä¹Ÿå¯ä»¥é€šè¿‡idæ¥è·å–,ä½†æ˜¯ä¹Ÿè¦<br>è½¬æˆæ¥å£ç±»å‹ã€‚</aop:aspectj-autoproxy></aop:aspectj-autoproxy></p><h3 id="åˆ‡å…¥è¡¨è¾¾å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#åˆ‡å…¥è¡¨è¾¾å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="åˆ‡å…¥è¡¨è¾¾å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>åˆ‡å…¥è¡¨è¾¾å¼çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><p>1.åˆ‡å…¥è¡¨è¾¾å¼ä¹Ÿå¯ä»¥æŒ‡å‘ç±»çš„æ–¹æ³•,è¿™æ—¶è¡¨è¾¾å¼ä¼šå¯¹è¯¥ç±»/å¯¹è±¡ç”Ÿæ•ˆ<br>2åˆ‡å…¥è¡¨è¾¾å¼ä¹Ÿå¯ä»¥æŒ‡å‘æ¥å£çš„æ–¹æ³•,è¿™æ—¶åˆ‡å…¥è¡¨è¾¾å¼ä¼šå¯¹æ˜¯æŒ‰äº†æ¥å£çš„ç±»/å¯¹è±¡ç”Ÿæ•ˆ<br>3.åˆ‡å…¥è¡¨è¾¾å¼ä¹Ÿå¯ä»¥å¯¹æ²¡æœ‰å®ç°æ¥å£çš„ç±»,è¿›è¡Œåˆ‡å…¥</p><h3 id="AOP-JoinPoint"><a href="#AOP-JoinPoint" class="headerlink" title="AOP-JoinPoint"></a>AOP-JoinPoint</h3><p>Â·é€šè¿‡JoinPointå¯ä»¥è·å–åˆ°è°ƒç”¨æ–¹æ³•çš„ç­¾å<br>Â·å¸¸ç”¨æ–¹æ³•ä¸€è§ˆ<br><pre class="line-numbers language-java" data-language="java"><code class="language-java">joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–ç›®æ ‡æ–¹æ³•å</span>joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaringType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–ç›®æ ‡æ–¹æ³•æ‰€å±ç±»çš„ç®€å•ç±»å</span>joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaringTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–ç›®æ ‡æ–¹æ³•æ‰€å±ç±»çš„ç±»å</span>joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModifiers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–ç›®æ ‡æ–¹æ³•å£°æ˜ç±»å‹(publicã€privateã€protected)</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–ä¼ å…¥ç›®æ ‡æ–¹æ³•çš„å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„</span>joinPoint<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–è¢«ä»£ç†çš„å¯¹è±¡</span>joinPoint<span class="token punctuation">.</span><span class="token function">getThis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–ä»£ç†å¯¹è±¡è‡ªå·±</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>Â·AOPè¿”å›ç»“æœé€šçŸ¥<br>åœ¨@AfterReturningä¸­æœ‰returningå±æ€§=â€resâ€<br>åœ¨@AfterThrowingä¸­æœ‰throwing=â€throwableâ€</p><h3 id="AOPåˆ‡é¢ä¼˜å…ˆçº§é—®é¢˜"><a href="#AOPåˆ‡é¢ä¼˜å…ˆçº§é—®é¢˜" class="headerlink" title="AOPåˆ‡é¢ä¼˜å…ˆçº§é—®é¢˜"></a>AOPåˆ‡é¢ä¼˜å…ˆçº§é—®é¢˜</h3><p>Â·åˆ‡é¢ä¼˜å…ˆçº§<br>1.å¦‚æœåŒä¸€ä¸ªæ–¹æ³•,æœ‰å¤šä¸ªåˆ‡é¢åœ¨é€šä¸€ä¸ªåˆ‡å…¥ç‚¹åˆ‡å…¥,æ‰§è¡Œçš„å“Ÿè®¸æ¬¸å¹´çºªæ˜¯ç”±@Order(value=n)æ§åˆ¶,nå€¼è¶Šå°,ä¼˜å…ˆçº§å€¼è¶Šé«˜<br>2.ä¸èƒ½ç†è§£æˆä¼˜å…ˆçº§é«˜çš„æ¯ä¸ªæ¶ˆæ¯é€šçŸ¥éƒ½å…ˆæ‰§è¡Œ,è¿™ä¸ªå’Œæ–¹æ³•è°ƒç”¨æœºåˆ¶(å’ŒFilterè¿‡æ»¤å™¨é“¾å¼è°ƒç”¨ç±»ä¼¼)ã€<br>3.å›¾ä¾‹<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/14d14944d82ba02d23de501f9cf98b29.png"></div></div></p><h2 id="AOP-åŸºäºXMLé…ç½®AOP"><a href="#AOP-åŸºäºXMLé…ç½®AOP" class="headerlink" title="AOP-åŸºäºXMLé…ç½®AOP"></a>AOP-åŸºäºXMLé…ç½®AOP</h2><h3 id="åŸºæœ¬è¯´æ˜-å‰é¢æˆ‘ä»¬æ˜¯é€šè¿‡æ³¨è§£æ¥é…ç½®aopçš„-åœ¨springä¸­-æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡xmlçš„æ–¹æ¥é…ç½®AOP"><a href="#åŸºæœ¬è¯´æ˜-å‰é¢æˆ‘ä»¬æ˜¯é€šè¿‡æ³¨è§£æ¥é…ç½®aopçš„-åœ¨springä¸­-æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡xmlçš„æ–¹æ¥é…ç½®AOP" class="headerlink" title="åŸºæœ¬è¯´æ˜:å‰é¢æˆ‘ä»¬æ˜¯é€šè¿‡æ³¨è§£æ¥é…ç½®aopçš„,åœ¨springä¸­,æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡xmlçš„æ–¹æ¥é…ç½®AOP"></a>åŸºæœ¬è¯´æ˜:å‰é¢æˆ‘ä»¬æ˜¯é€šè¿‡æ³¨è§£æ¥é…ç½®aopçš„,åœ¨springä¸­,æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡xmlçš„æ–¹æ¥é…ç½®AOP</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SmartAnimalAspect</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å¸Œæœ›å°†beforeæ–¹æ³•åˆ‡å…¥åˆ°SmartDog-getSumå‰æ‰§è¡Œ-å‰ç½®é€šçŸ¥</span>    <span class="token comment">/**     * è§£è¯»     * 1.@Before è¡¨ç¤ºå‰ç½®é€šçŸ¥ï¼šå³åœ¨æˆ‘ä»¬çš„ç›®æ ‡å¯¹è±¡æ‰§è¡Œçš„æ–¹æ³•å‰æ‰§è¡Œ     * 2.value = "execution(public float com.qgq.spring.AOP.aspectj.SmartDog.getSum(float, float))æŒ‡å®šåˆ‡å…¥åˆ°å“ªä¸ªç±»çš„é‚£ä¸ªæ–¹æ³• å½¢å¼æ˜¯ è®¿é—®ä¿®é¥°ç¬¦ è¿”å›ç±»å‹ å…¨ç±»å.æ–¹æ³•å(å½¢å‚åˆ—è¡¨)     * 3.beforeæ–¹æ³•å¯ä»¥ç†è§£ä¸ºå°±æ˜¯ä¸€ä¸ªåˆ‡å…¥æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åæ˜¯å¯ä»¥ç¨‹åºå‘˜æŒ‡å®š     * 4.JoinPoint joinPointåœ¨åº•å±‚æ‰§è¡Œæ—¶,ç”±Aspectjåˆ‡é¢æ¡†æ¶ï¼Œä¼šç»™è¯¥åˆ‡å…¥æ–¹æ³•ä¼ å…¥joinPointå¯¹è±¡ï¼Œé€šè¿‡è¯¥æ–¹æ³•ï¼Œå¯ä»¥è·å–åˆ°ç›¸å…³ä¿¡æ¯     * @param joinPoint     */</span><span class="token comment">//    @Before(value = "execution(public float com.qgq.spring.AOP.aspectj.SmartDog.*(float, float))")</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¾—åˆ°çš„æ˜¯æ–¹æ³•ç­¾åcom.qgq.spring.AOP.aspectj.SmartDog.getSum</span>        <span class="token comment">//æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œå‰ç½®é€šçŸ¥</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åˆ‡é¢ç±»-æ–¹æ³•æ‰§è¡Œå‰-æ—¥å¿—-æ–¹æ³•å-"</span> <span class="token operator">+</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-å‚æ•°"</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//è¿”å›é€šçŸ¥</span><span class="token comment">//    @AfterReturning(value = "execution( public float com.qgq.spring.AOP.aspectj.SmartDog.getSum(float, float))",returning = "res")</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">AfterReturning</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span><span class="token class-name">Object</span> res<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œè¿”å›é€šçŸ¥</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åˆ‡é¢ç±»-æ—¥å¿—-æ–¹æ³•å-"</span> <span class="token operator">+</span> signature<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-ç»“æœresult="</span><span class="token operator">+</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">//    @AfterThrowing(value = "execution( public float com.qgq.spring.AOP.aspectj.SmartDog.getSum(float, float))",throwing = "thrown")</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">AfterThrowing</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span><span class="token class-name">Throwable</span> thrown<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œè¿”å›é€šçŸ¥</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åˆ‡é¢ç±»-æ—¥å¿—-æ–¹æ³•å‡ºç°å¼‚å¸¸-æ–¹æ³•å-"</span> <span class="token operator">+</span> signature<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-å¼‚å¸¸ä¿¡æ¯="</span><span class="token operator">+</span>thrown<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">//    @After(value = "execution( public float com.qgq.spring.AOP.aspectj.SmartDog.getSum(float, float))")</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">After</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œè¿”å›é€šçŸ¥</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åˆ‡é¢ç±»æœ€æ€»é€šçŸ¥-æ—¥å¿—-æ–¹æ³•å-"</span> <span class="token operator">+</span> signature<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-ç»“æœresult="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- é…ç½®è‡ªåŠ¨æ‰«æçš„åŒ… --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.aop.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!-- å¼€å¯åŸºäºæ³¨è§£çš„ AOP åŠŸèƒ½ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspectj-autoproxy</span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.spring.AOP.xml.SmartAnimalAspect<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>animalAspect<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qgq.spring.AOP.xml.SmartDog<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>pointcut</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myPointCut<span class="token punctuation">"</span></span>                      <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>execution(public float com.qgq.spring.AOP.xml.SmartDog.*(float, float))<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspect</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>animalAspect<span class="token punctuation">"</span></span> <span class="token attr-name">order</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>before</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>before<span class="token punctuation">"</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myPointCut<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>before</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>after-returning</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>AfterReturning<span class="token punctuation">"</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myPointCut<span class="token punctuation">"</span></span>                                 <span class="token attr-name">returning</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>res<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>after-returning</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>after-throwing</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>AfterThrowing<span class="token punctuation">"</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myPointCut<span class="token punctuation">"</span></span> <span class="token attr-name">throwing</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>thrown<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>after-throwing</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>after</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>After<span class="token punctuation">"</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myPointCut<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>after</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>aspect</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è§£è¯»:<br>1.å…ˆé…ç½®è‡ªåŠ¨æ‰«æçš„åŒ…å’Œå¼€å¯åŸºäºæ³¨è§£AOPåŠŸèƒ½<br>2.åœ¨aop:configä¸­å…ˆåŠ å…¥åˆ‡é¢è¡¨è¾¾å¼,ç„¶åé…ç½®è¢«åˆ‡å…¥çš„æ–¹æ³•,ç„¶åé…ç½®è¦åˆ‡å…¥çš„äº”ä¸ªæ–¹æ³•</p><h2 id="JdbcTemplate"><a href="#JdbcTemplate" class="headerlink" title="JdbcTemplate"></a>JdbcTemplate</h2><h3 id="å¦‚æœç¨‹åºå‘˜å°±å¸Œæœ›ä½¿ç”¨springæ¡†æ¶æ¥åšé¡¹ç›®-springæ¡†æ¶å¦‚ä½•å¤„ç†å¯¹æ•°æ®åº“çš„æ“ä½œå‘¢"><a href="#å¦‚æœç¨‹åºå‘˜å°±å¸Œæœ›ä½¿ç”¨springæ¡†æ¶æ¥åšé¡¹ç›®-springæ¡†æ¶å¦‚ä½•å¤„ç†å¯¹æ•°æ®åº“çš„æ“ä½œå‘¢" class="headerlink" title="å¦‚æœç¨‹åºå‘˜å°±å¸Œæœ›ä½¿ç”¨springæ¡†æ¶æ¥åšé¡¹ç›®,springæ¡†æ¶å¦‚ä½•å¤„ç†å¯¹æ•°æ®åº“çš„æ“ä½œå‘¢"></a>å¦‚æœç¨‹åºå‘˜å°±å¸Œæœ›ä½¿ç”¨springæ¡†æ¶æ¥åšé¡¹ç›®,springæ¡†æ¶å¦‚ä½•å¤„ç†å¯¹æ•°æ®åº“çš„æ“ä½œå‘¢</h3><p>Â·springæä¾›äº†äº†ä¸€ä¸ªæ“ä½œæ•°æ®åº“åŠŸèƒ½å¼ºå¤§çš„ç±»JdbcTemplateã€‚æˆ‘ä»¬å¯ä»¥åŒiocå®¹å™¨é…ç½®ä¸€ä¸ªjdbcTemplateå¯¹è±¡,ä½¿ç”¨å®ƒæ¥å®Œæˆå¯¹æ•°æ®<br>åº“è¡¨çš„å„ç§æ“ä½œ</p><h3 id="JdbcTemplate-åŸºæœ¬ä»‹ç»"><a href="#JdbcTemplate-åŸºæœ¬ä»‹ç»" class="headerlink" title="JdbcTemplate-åŸºæœ¬ä»‹ç»"></a>JdbcTemplate-åŸºæœ¬ä»‹ç»</h3><p>Â·é€šè¿‡springå¯ä»¥é…ç½®æ•°æ®æº,ä»è€Œå®Œæˆå¯¹æ•°æ®è¡¨çš„æ“ä½œ<br>Â·JdbcTemplateæ˜¯Springæä¾›çš„è®¿é—®æ•°æ®åº“çš„æŠ€æœ¯,å¯ä»¥å°†JDBCçš„å¸¸ç”¨æ“ä½œå°è£…ä¸ºæ¨¡æ¿æ–¹æ³•</p><h3 id="JdbcTemplateä½¿ç”¨"><a href="#JdbcTemplateä½¿ç”¨" class="headerlink" title="JdbcTemplateä½¿ç”¨"></a>JdbcTemplateä½¿ç”¨</h3><pre class="line-numbers language-propertise" data-language="propertise"><code class="language-propertise">jdbc.userName&#x3D;rootjdbc.password&#x3D;qgqjdbc.driverClass&#x3D;com.mysql.jdbc.Driverjdbc.url&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;spring<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- å¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>classpath:jdbc.properties<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!-- é…ç½®æ•°æ®æº --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mchange.v2.c3p0.ComboPooledDataSource<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.userName&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.password&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driverClass<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.driverClass&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbcUrl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.url&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- é…ç½® JdbcTemplate --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbcTemplate<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.jdbc.core.JdbcTemplate<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- å°†ä¸Šé¢çš„æ•°æ®æºåˆ†é…ç»™ jdbcTemplate --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·ä¸€äº›æ“ä½œå®ä¾‹<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"JdbcTemplate_ioc.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¾—åˆ° JdbcTemplate bean</span><span class="token class-name">JdbcTemplate</span> bean <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">JdbcTemplate</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"INSERT INTO monster VALUES(?, ?, ?)"</span><span class="token punctuation">;</span><span class="token keyword">int</span> affected <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token number">700</span><span class="token punctuation">,</span> <span class="token string">"çº¢å­©å„¿ 2"</span><span class="token punctuation">,</span> <span class="token string">"æªæ³•å‰å®³ 2"</span><span class="token punctuation">)</span><span class="token comment">//æ‰¹é‡æ·»åŠ </span><span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"INSERT INTO monster VALUES(?, ?, ?)"</span><span class="token punctuation">;</span><span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> param_list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>param_list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token string">"ç™½è›‡ç²¾"</span><span class="token punctuation">,</span> <span class="token string">"åƒäºº"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>param_list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">600</span><span class="token punctuation">,</span> <span class="token string">"é’è›‡ç²¾"</span><span class="token punctuation">,</span> <span class="token string">"åƒå°å­©"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>bean<span class="token punctuation">.</span><span class="token function">batchUpdate</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> param_list<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"batch add ok"</span><span class="token comment">//æŸ¥è¯¢å¹¶å°è£…</span><span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"SELECT id as monsterId,name,skill FROM monster WHERE id =?"</span><span class="token class-name">RowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Monster</span><span class="token punctuation">></span></span> rowMapper<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">BeanPropertyRowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Monster</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token class-name">Monster</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Monster</span> monster <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> rowMapper<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä½¿ç”¨Mapä¼ å…¥å…·åå‚æ•°</span><span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"INSERT INTO monster VALUES(:my_id, :name, :skill)"</span><span class="token punctuation">;</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> map_parameter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>map_parameter<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"my_id"</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">;</span>map_parameter<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"èƒèŸ¹ç²¾"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>map_parameter<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"skill"</span><span class="token punctuation">,</span> <span class="token string">"é’³å­æ— æ•Œå¤§æ³•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>namedParameterJdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> map_parameter<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="å£°æ˜å¼äº‹åŠ¡"><a href="#å£°æ˜å¼äº‹åŠ¡" class="headerlink" title="å£°æ˜å¼äº‹åŠ¡"></a>å£°æ˜å¼äº‹åŠ¡</h2><h3 id="äº‹åŠ¡åˆ†ç±»"><a href="#äº‹åŠ¡åˆ†ç±»" class="headerlink" title="äº‹åŠ¡åˆ†ç±»"></a>äº‹åŠ¡åˆ†ç±»</h3><p>1.ç¼–ç¨‹å¼äº‹åŠ¡<br>ä»£ç ç¤ºä¾‹<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">JdbcUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span><span class="token comment">//1. å…ˆè®¾ç½®äº‹åŠ¡ä¸è¦è‡ªåŠ¨æäº¤</span>connection<span class="token punctuation">.</span><span class="token function">setAutoCommint</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2. è¿›è¡Œå„ç§ crud</span><span class="token comment">//å¤šä¸ªè¡¨çš„ä¿®æ”¹ï¼Œæ·»åŠ  ï¼Œåˆ é™¤</span><span class="token comment">//3. æäº¤</span>connection<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//4. å›æ»š</span>conection<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>2.å£°æ˜å¼äº‹åŠ¡<br>Â·ä»¥ç”¨æˆ·è´­ä¹°å•†å“ä¸¾ä¾‹<br>æˆ‘ä»¬éœ€è¦å»å¤„ç†ç”¨æˆ·è´­ä¹°å•†å“çš„ä¸šåŠ¡é€»è¾‘:åˆ†æ: å½“ä¸€ä¸ªç”¨æˆ·è¦å»è´­ä¹°å•†å“åº”è¯¥åŒ…å«ä¸‰ä¸ªæ­¥éª¤<br>1)é€šè¿‡å•†å“ id è·å–ä»·æ ¼.<br>2)è´­ä¹°å•†å“(æŸäººè´­ä¹°å•†å“ï¼Œä¿®æ”¹ç”¨æˆ·çš„ä½™é¢.)<br>3)ä¿®æ”¹åº“å­˜é‡<br>Â·å¦‚æœä½¿ç”¨ä¼ ç»Ÿçš„ç¼–ç¨‹äº‹åŠ¡æ¥å¤„ç†,å°†ä»£ç å†™åœ¨ä¸€èµ·ã€ç¼ºç‚¹:ä»£ç å†—ä½™,æ•ˆç‡ä½,ä¸åˆ©äºå‘å±•,ä¼˜å…ˆç®€å•,å¥½ç†è§£ã€‘<br>Â·ç”¨ Spring çš„å£°æ˜å¼äº‹åŠ¡å¤„ç†ï¼Œ å¯ä»¥å°†ä¸Šé¢ä¸‰ä¸ªå­æ­¥éª¤åˆ†åˆ«å†™æˆä¸€ä¸ªæ–¹æ³•,ç„¶åç»Ÿä¸€ç®¡ç†<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Repository</span>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GoodsDao</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Autowired</span>        <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">Float</span> <span class="token function">queryPriceById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"SELECT price From goods Where goods_id=?"</span><span class="token punctuation">;</span>            <span class="token class-name">Float</span> price <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> price<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateBalance</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> user_id<span class="token punctuation">,</span> <span class="token class-name">Float</span> money<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"UPDATE user_account SET money=money-? Where user_id=?"</span><span class="token punctuation">;</span>            jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> money<span class="token punctuation">,</span> user_id<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateAmount</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> goods_id<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> sql <span class="token operator">=</span> "<span class="token constant">UPDATE</span> goods_amount <span class="token class-name">SET</span> goods_num<span class="token operator">=</span>goods_num<span class="token operator">-</span><span class="token operator">?</span> <span class="token class-name">Where</span>        goods_id<span class="token operator">=</span><span class="token operator">?</span>"<span class="token punctuation">;</span>        jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> amount <span class="token punctuation">,</span> goods_id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- å¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>classpath:jdbc.properties<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!-- é…ç½®æ•°æ®æº --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mchange.v2.c3p0.ComboPooledDataSource<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.userName&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.password&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driverClass<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.driverClass&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbcUrl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.url&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- é…ç½® JdbcTemplate --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbcTemplate<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.jdbc.core.JdbcTemplate<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- å°†ä¸Šé¢çš„æ•°æ®æºåˆ†é…ç»™ jdbcTemplate --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- é…ç½®äº‹åŠ¡ç®¡ç†å™¨ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSourceTransactionManager<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- å¼€å¯åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡åŠŸèƒ½ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>annotation-driven</span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSourceTransactionManager<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!-- åŠ å…¥è‡ªåŠ¨æ‰«æåŒ… dao --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.hspedu.spring.tx.dao<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Transactional</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buyGoodsByTx</span><span class="token punctuation">(</span><span class="token keyword">int</span> user_id<span class="token punctuation">,</span> <span class="token keyword">int</span> goods_id<span class="token punctuation">,</span> <span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//æŸ¥è¯¢åˆ°å•†å“ä»·æ ¼</span>        <span class="token class-name">Float</span> goods_price <span class="token operator">=</span> goodsDao<span class="token punctuation">.</span><span class="token function">queryPriceById</span><span class="token punctuation">(</span>goods_id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è´­ä¹°å•†å“ï¼Œå‡å»ä½™é¢</span>        goodsDao<span class="token punctuation">.</span><span class="token function">updateBalance</span><span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> goods_price <span class="token operator">*</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// //è€éŸ©: æ¨¡æ‹Ÿä¸€ä¸ªå¼‚å¸¸, ä¼šå‘ç”Ÿæ•°æ®åº“æ•°æ®ä¸ä¸€è‡´ç°è±¡</span><span class="token comment">// int i = 10 / 0;</span><span class="token comment">//æ›´æ–°åº“å­˜</span>        goodsDao<span class="token punctuation">.</span><span class="token function">updateAmount</span><span class="token punctuation">(</span>goods_id<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶"><a href="#äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶" class="headerlink" title="äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶"></a>äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Transaction</span><span class="token punctuation">(</span>propagation<span class="token operator">=</span><span class="token class-name">Propagation</span><span class="token punctuation">.</span><span class="token constant">REQUIRES_NEW</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">multiTxTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//2 å·ç”¨æˆ·è´­ä¹° 2 å·å•†å“ï¼Œè´­ä¹°æ•°é‡æ˜¯ 1 ä¸ª. goodService.buyGoodsByTx(2, 2, 1);</span><span class="token comment">//1 å·ç”¨ç”¨æˆ· 1 å·å•†å“ï¼Œè´­ä¹°æ•°é‡æ˜¯ 1 ä¸ª. goodService.buyGoodsByTx02(1, 1, 1);</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>1.å¦‚æœè®¾ç½®ä¸º REQUIRES_NEWbuyGoods2 å¦‚æœé”™è¯¯ï¼Œä¸ä¼šå½±å“åˆ° buyGoods()åä¹‹äº¦ç„¶ï¼Œå³å®ƒä»¬çš„äº‹åŠ¡æ˜¯ç‹¬ç«‹çš„.<br>2.å¦‚æœè®¾ç½®ä¸º REQUIRED buyGoods2 å’Œ buyGoods æ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œåªè¦æœ‰æ–¹æ³•çš„äº‹åŠ¡é”™è¯¯ï¼Œé‚£ä¹ˆä¸¤ä¸ªæ–¹æ³•éƒ½ä¸</p><h2 id="äº‹åŠ¡è¶…æ—¶å›æ»š"><a href="#äº‹åŠ¡è¶…æ—¶å›æ»š" class="headerlink" title="äº‹åŠ¡è¶…æ—¶å›æ»š"></a>äº‹åŠ¡è¶…æ—¶å›æ»š</h2><p>1.å¦‚æœä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œçš„æ—¶é—´è¶…è¿‡æŸä¸ªæ—¶é—´é™åˆ¶ï¼Œå°±è®©è¯¥äº‹åŠ¡å›æ»šã€‚<br>2.å¯ä»¥é€šè¿‡è®¾ç½®äº‹åŠ¡è¶…æ—¶å›é¡¾æ¥å®ç°<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>timeout <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h1 id="springçš„åº•å±‚å®ç°å…³é”®ä»£ç "><a href="#springçš„åº•å±‚å®ç°å…³é”®ä»£ç " class="headerlink" title="springçš„åº•å±‚å®ç°å…³é”®ä»£ç "></a>springçš„åº•å±‚å®ç°å…³é”®ä»£ç </h1><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>qgq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>ioc</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>qgq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>qgq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>qgq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ComponentScan</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>qgq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Scope</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>qgq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>processor<span class="token punctuation">.</span></span><span class="token class-name">BeanPostProcessor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>qgq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>processor<span class="token punctuation">.</span></span><span class="token class-name">InitializingBean</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationTargetException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URL</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Enumeration</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ConcurrentHashMap</span></span><span class="token punctuation">;</span><span class="token comment">/** * @Author ç§¦å®¶å¤§èƒ– * @Date 2023/1/14 5:22 * @Version 1.0 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QgqSpringApplicationContext</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Class</span> configClass<span class="token punctuation">;</span>    <span class="token comment">//å®šä¹‰å±æ€§BeanDefinitionMap->å­˜æ”¾BeanDefinition</span>    <span class="token keyword">private</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">BeanDefinition</span><span class="token punctuation">></span></span> <span class="token class-name">BeanDefinitionMap</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//å®šä¹‰å±æ€§SingletonObjects->å­˜æ”¾å•ä¾‹å¯¹è±¡</span>    <span class="token keyword">private</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token class-name">SingletonObjects</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//å®šä¹‰ä¸€ä¸ªå±æ€§=>å­˜æ”¾åç½®å¤„ç†å™¨</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanPostProcessor</span><span class="token punctuation">></span></span> beanPostProcessorList<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//æ„é€ å™¨</span>    <span class="token keyword">public</span> <span class="token class-name">QgqSpringApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">Class</span> configClass<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">beanDefinitionByScan</span><span class="token punctuation">(</span>configClass<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//éå†BeanDefinitionMapå¯¹è±¡</span>        <span class="token class-name">Enumeration</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> keys <span class="token operator">=</span> <span class="token class-name">BeanDefinitionMap</span><span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>keys<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> beanName <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">BeanDefinition</span> beanDefinition <span class="token operator">=</span> <span class="token class-name">BeanDefinitionMap</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"singleton"</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">.</span><span class="token function">getScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token class-name">SingletonObjects</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span><span class="token function">createBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span>beanDefinition<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"BeanDefinitionMap"</span><span class="token operator">+</span><span class="token class-name">BeanDefinitionMap</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"SingletonObjects"</span><span class="token operator">+</span><span class="token class-name">SingletonObjects</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//è¯¥æ–¹æ³•å®Œæˆå¯¹æŒ‡å®šåŒ…çš„æ‰«æï¼Œå°†beanä¿¡æ¯å°è£…åˆ°beanDefinitionå¯¹è±¡ä¸­ï¼Œè¿”å›æ”¾å…¥åˆ°BeanDefinitionMap</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beanDefinitionByScan</span><span class="token punctuation">(</span><span class="token class-name">Class</span> configClass<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>configClass <span class="token operator">=</span> configClass<span class="token punctuation">;</span><span class="token comment">//        System.out.println("this.configClass="+configClass);</span>        <span class="token comment">//è·å–è¦æ‰«æçš„åŒ…</span>        <span class="token comment">//1.å…ˆå¾—åˆ°QGQSpringConfigé…ç½®çš„@ComponentScan(value = "com.qgq.spring.component")</span>        <span class="token class-name">ComponentScan</span> componentScan <span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">ComponentScan</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>configClass<span class="token punctuation">.</span><span class="token function">getDeclaredAnnotation</span><span class="token punctuation">(</span><span class="token class-name">ComponentScan</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.é€šè¿‡componentScançš„value=>è¦æ‰«æçš„åŒ…</span>        <span class="token class-name">String</span> path <span class="token operator">=</span> componentScan<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¦æ‰«æçš„åŒ…="</span><span class="token operator">+</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å¾—åˆ°è¦æ‰«æçš„åŒ…ä¸‹çš„æ‰€æœ‰èµ„æº(ç±»ï¼Œclass)</span>        <span class="token comment">//1.å¾—åˆ°ç±»çš„åŠ è½½å™¨ï¼ˆæ‰èƒ½å¾—åˆ°outè·¯å¾„ä¸‹çš„ï¼‰ï¼Œappç±»åŠ è½½å™¨</span>        <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> <span class="token class-name">QgqSpringApplicationContext</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"classLoader="</span><span class="token operator">+</span>classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.é€šè¿‡ç±»çš„åŠ è½½å™¨è·å–åˆ°è¦æ‰«æåŒ…çš„èµ„æºurl</span>        path<span class="token operator">=</span>path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä¸€å®šè¦å§.æ›¿æ¢æˆ/</span>        <span class="token class-name">URL</span> resource <span class="token operator">=</span> classLoader<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"resource="</span><span class="token operator">+</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3.å°†è¦åŠ è½½çš„èµ„æº(.class)è·¯å¾„ä¸‹çš„æ–‡ä»¶è¿›è¡Œéå†</span>        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">File</span><span class="token punctuation">[</span><span class="token punctuation">]</span> files <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">File</span> f <span class="token operator">:</span> files<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//                System.out.println("f="+f);</span>                <span class="token comment">//System.out.println("=========================");</span>                <span class="token comment">//System.out.println("f.getAbsolutePath"+f.getAbsolutePath());</span>                <span class="token comment">//D:\proj\qgq_spring\spring\out\production\spring\com\qgq\spring\component\MyComponent.class</span>                <span class="token comment">//è·å–åˆ°com\qgq\spring\component\MyComponent.class</span>                <span class="token class-name">String</span> fileAbsolutePath <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//è¿™é‡Œæˆ‘ä»¬åªå¤„ç†.classæ–‡ä»¶</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>fileAbsolutePath<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">".class"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">String</span> className <span class="token operator">=</span> fileAbsolutePath<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>fileAbsolutePath<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> fileAbsolutePath<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">".class"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//                    System.out.println("className=" + className);</span>                    <span class="token comment">//2.è·å–ç±»çš„å®Œæ•´çš„è·¯å¾„(å…¨ç±»å)</span>                    <span class="token class-name">String</span> classFullname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> className<span class="token punctuation">;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"classFullname="</span><span class="token operator">+</span>classFullname<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//3.åˆ¤æ–­è¯¥ç±»æ˜¯ä¸æ˜¯éœ€è¦æ³¨å…¥å®¹å™¨ï¼Œå°±çœ‹è¯¥ç±»æ˜¯ä¸æ˜¯æœ‰æ³¨è§£@Componentï¼Œ@Service...</span>                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                        <span class="token comment">//è¿™æ—¶æˆ‘ä»¬å°±å¾—åˆ°äº†è¯¥ç±»çš„Classå¯¹è±¡</span>                        <span class="token comment">//Class.forName(classFullname) å¯ä»¥åå°„åŠ è½½ç±»</span>                        <span class="token comment">//classLoader.loadClass(classFullname);å¯ä»¥åå°„ç±»çš„Class</span>                        <span class="token comment">//åŒºåˆ«ä¸Šé¢çš„æ–¹å¼ä¼šè°ƒç”¨è¯¥ç±»çš„é™æ€æ–¹æ³•ï¼Œä¸‹é¢æ–¹æ³•ä¸ä¼š</span>                        <span class="token comment">//4.åˆ¤æ–­è¯¥ç±»æ˜¯å¦æœ‰ä»¥ä¸‹çš„æ³¨è§£</span>                        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> aClass <span class="token operator">=</span> classLoader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>classFullname<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>aClass<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">Component</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                            <span class="token comment">//1.ä¸ºäº†æ–¹ä¾¿ï¼Œè¿™é‡Œå°†åç½®å¤„ç†å™¨æ”¾å…¥åˆ°ä¸€ä¸ªArrayList</span>                            <span class="token comment">//2.å¦‚æœå‘ç°æ˜¯ä¸€ä¸ªåç½®å¤„ç†å™¨ï¼Œæ”¾å…¥åˆ°beanPostProcessorList</span>                            <span class="token comment">//3.åœ¨åŸç”ŸSpringå®¹å™¨ä¸­ï¼Œå¯¹åç½®å¤„ç†å™¨è¿˜æ˜¯èµ°çš„getBeanï¼ŒcreateBeanï¼Œä½†æ˜¯éœ€è¦æˆ‘ä»¬åœ¨singletonObjectsåŠ å…¥ç›¸åº”çš„ä¸šåŠ¡é€»è¾‘</span>                            <span class="token comment">//4.å› ä¸ºè¿™é‡Œæˆ‘ä»¬æ˜¯ä¸ºäº†è®²è§£åç½®å¤„ç†å™¨çš„æœºåˆ¶ï¼Œæ‰€ä»¥å°±ç®€åŒ–äº†</span>                            <span class="token comment">//åˆ¤æ–­å½“å‰çš„è¿™ä¸ªaClassæœ‰æ²¡æœ‰å®ç°BeanPostProcessor</span>                            <span class="token comment">//è¯´æ˜ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨instanceof æ¥åˆ¤æ–­aClassæ˜¯å¦å®ç°äº†BeanPostProcessorï¼ˆinstanceofæ˜¯åˆ¤æ–­è¿è¡Œç±»å‹çš„ï¼‰</span>                            <span class="token comment">//åŸå› æ˜¯aClassä¸æ˜¯ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç±»å¯¹è±¡/aClassï¼Œä½¿ç”¨isAssignableFrom</span>                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">BeanPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>aClass<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                                <span class="token class-name">BeanPostProcessor</span> instance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">BeanPostProcessor</span><span class="token punctuation">)</span>aClass<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token comment">//æ”¾å…¥åˆ°beanPostProcessorList</span>                                beanPostProcessorList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token keyword">continue</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                            <span class="token comment">//å…ˆå¾—åˆ°beanName</span>                            <span class="token class-name">Component</span> declaredAnnotation <span class="token operator">=</span> aClass<span class="token punctuation">.</span><span class="token function">getDeclaredAnnotation</span><span class="token punctuation">(</span><span class="token class-name">Component</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">String</span> beanName <span class="token operator">=</span> declaredAnnotation<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                                beanName<span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">uncapitalize</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                            <span class="token comment">//å°†beanä¿¡æ¯å°è£…åˆ°beanDefinitionå¯¹è±¡ä¸­ï¼Œè¿”å›æ”¾å…¥åˆ°BeanDefinitionMap</span>                            <span class="token class-name">BeanDefinition</span> beanDefinition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            beanDefinition<span class="token punctuation">.</span><span class="token function">setClazz</span><span class="token punctuation">(</span>aClass<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">if</span> <span class="token punctuation">(</span>aClass<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">Scope</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                                <span class="token class-name">String</span> scope <span class="token operator">=</span> aClass<span class="token punctuation">.</span><span class="token function">getDeclaredAnnotation</span><span class="token punctuation">(</span><span class="token class-name">Scope</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                beanDefinition<span class="token punctuation">.</span><span class="token function">setScope</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                                beanDefinition<span class="token punctuation">.</span><span class="token function">setScope</span><span class="token punctuation">(</span><span class="token string">"singleton"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                            <span class="token class-name">BeanDefinitionMap</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span>beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ˜¯ä¸€ä¸ªspring bean="</span><span class="token operator">+</span>aClass<span class="token operator">+</span><span class="token string">"ç±»å"</span><span class="token operator">+</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸æ˜¯ä¸€ä¸ªspring bean="</span><span class="token operator">+</span>aClass<span class="token operator">+</span><span class="token string">"ç±»å"</span><span class="token operator">+</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å®ŒæˆcreateBean(BeanDefinition beanDefinition)æ–¹æ³•</span>    <span class="token comment">//åœ¨åˆ›å»ºå¥½beanå®ä¾‹åï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œåˆå§‹åŒ–[å¿ƒå¾—ï¼šå®¹å™¨ä¸­å¸¸ç”¨çš„ä¸€ä¸ªæ–¹æ³•æ˜¯ï¼Œæ ¹æ®è¯¥ç±»æ˜¯å¦å®ç°äº†æŸä¸ªæ¥å£ï¼Œè€åˆ¤æ–­æ˜¯å¦è¦æ‰§è¡ŒæŸä¸ªä¸šåŠ¡é€»è¾‘ï¼Œè¿™é‡Œå…¶å®å°±æ˜¯æ¥å£ç¼–ç¨‹]</span>    <span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">createBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span><span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> beanDefinition<span class="token punctuation">.</span><span class="token function">getClazz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Object</span> instance <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Field</span><span class="token punctuation">[</span><span class="token punctuation">]</span> declaredFields <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Field</span> declaredField <span class="token operator">:</span> declaredFields<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>declaredField<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">Autowired</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token comment">//å¾—åˆ°å­—æ®µå</span>                    <span class="token class-name">String</span> name <span class="token operator">=</span> declaredField<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//å¾—åˆ°ç»„è£…çš„å¯¹è±¡</span>                    <span class="token class-name">Object</span> bean <span class="token operator">=</span> <span class="token function">getBean</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//ç»„è£…å¯¹è±¡,åå°„</span>                    declaredField<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç§æœ‰ï¼Œçˆ†ç ´ï¼Œå…³é—­å®‰å…¨æ£€æŸ¥æ¥æå‡åå°„é€Ÿåº¦</span>                    declaredField<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span>bean<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=====åˆ›å»ºå¥½å®ä¾‹====="</span><span class="token operator">+</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//æˆ‘ä»¬åœ¨Beançš„åˆå§‹åŒ–æ–¹æ³•å‰ï¼Œè°ƒç”¨åç½®å¤„ç†å™¨çš„beforeæ–¹æ³•</span>            <span class="token comment">//åç½®å¤„ç†å™¨ä¼šå¯¹å®¹å™¨ä¸­çš„æ‰€æœ‰çš„beanç”Ÿæ•ˆ</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BeanPostProcessor</span> beanPostProcessor <span class="token operator">:</span> beanPostProcessorList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>              <span class="token class-name">Object</span>  instance1 <span class="token operator">=</span> beanPostProcessor<span class="token punctuation">.</span><span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span>instance1<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                  instance<span class="token operator">=</span>instance1<span class="token punctuation">;</span>              <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">//è¿™é‡Œåˆ¤æ–­æ˜¯å¦è¦æ‰§è¡ŒBeanåˆå§‹åŒ–æ–¹æ³•</span>            <span class="token comment">//1.åˆ¤æ–­å½“å‰åˆ›å»ºçš„Beanå¯¹è±¡æ˜¯å¦å®ç°äº†InitializingBean</span>            <span class="token comment">//2.instanceof javaåŸºç¡€ä¸­è®²è¿‡ è¡¨åˆ¤æ–­æŸä¸ªå¯¹è±¡çš„è¿è¡Œç±»å‹æ˜¯ä¸æ˜¯æŸä¸ªç±»å‹æˆ–è€…æŸä¸ªç±»å‹çš„å­ç±»å‹</span>            <span class="token comment">//è¿™é‡Œå°±ä½¿ç”¨åˆ°äº†æ¥å£ç¼–ç¨‹</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token keyword">instanceof</span> <span class="token class-name">InitializingBean</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//3.å°†instanceè½¬æˆInitializingBeanç±»å‹</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">InitializingBean</span><span class="token punctuation">)</span>instance<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">//æˆ‘ä»¬åœ¨Beançš„åˆå§‹åŒ–åï¼Œè°ƒç”¨åç½®å¤„ç†å™¨çš„afteræ–¹æ³•</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BeanPostProcessor</span> beanPostProcessor <span class="token operator">:</span> beanPostProcessorList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>               <span class="token class-name">Object</span> instance1<span class="token operator">=</span>beanPostProcessor<span class="token punctuation">.</span><span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>instance1<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    instance<span class="token operator">=</span>instance1<span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> instance<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InstantiationException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvocationTargetException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchMethodException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinitionMap</span><span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">BeanDefinition</span> beanDefinition <span class="token operator">=</span> <span class="token class-name">BeanDefinitionMap</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> scope <span class="token operator">=</span> beanDefinition<span class="token punctuation">.</span><span class="token function">getScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"singleton"</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token class-name">SingletonObjects</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token function">createBean</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token string">"è¯¥beanä¸å­˜åœ¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title&gt;&lt;/a&gt;&lt;div class=&quot;note purple no-icon flat&quot;&gt;&lt;p&gt;Spring(è½»é‡çº§å®¹å™¨æ¡†æ¶)å¤ä¹  &lt;/p&gt;
&lt;/div&gt;&lt;/h1&gt;&lt;h2 id=&quot;Springå­¦ä¹ çš„</summary>
      
    
    
    
    <category term="ä¸»æµæ¡†æ¶" scheme="https://100qin10086.github.io/categories/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6/"/>
    
    
    <category term="æ¡†æ¶" scheme="https://100qin10086.github.io/tags/%E6%A1%86%E6%9E%B6/"/>
    
    <category term="Java" scheme="https://100qin10086.github.io/tags/Java/"/>
    
    <category term="Spring" scheme="https://100qin10086.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>æ‰‹æ’•é›†åˆæºç </title>
    <link href="https://100qin10086.github.io/posts/4183b029.html"/>
    <id>https://100qin10086.github.io/posts/4183b029.html</id>
    <published>2024-03-21T08:33:22.000Z</published>
    <updated>2024-05-06T14:13:59.614Z</updated>
    
    <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a><div class="note purple no-icon flat"><p>é›†åˆæºç åˆ†æ</p></div></h1><h2 id="ArrayListæºç åˆ†æ"><a href="#ArrayListæºç åˆ†æ" class="headerlink" title="ArrayListæºç åˆ†æ"></a>ArrayListæºç åˆ†æ</h2><p>Â·åœ¨ArrayListä¸­æœ‰å…­ä¸ªå±æ€§<br>1.int DEFAULT_CAPACITY = 10;æ•°ç»„çš„é»˜è®¤åˆå§‹å®¹é‡<br>2.Object[] EMPTY_ELEMENTDATA = {};ç©ºå®ä¾‹çš„å…±äº«æ•°ç»„å®ä¾‹ã€‚æˆ‘çš„ç†è§£å°±æ˜¯å½“åˆå§‹åŒ–ArrayListçš„æ—¶,æŒ‡å®šäº†åˆå§‹å®¹é‡,ä½†æ˜¯åˆå§‹<br>å®¹é‡ä¸º0æ—¶,elementDataä¼šç­‰äºè¯¥ç©ºæ•°ç»„<br>3.Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};ç”¨äºé»˜è®¤å¤§å°çš„ç©ºå®ä¾‹çš„å…±äº«ç©ºæ•°ç»„å®ä¾‹ã€‚æˆ‘çš„ç†è§£æ˜¯å½“åˆå§‹åŒ–ArrayListçš„æ—¶ï¼Œ<br>æ²¡æœ‰æŒ‡å®šåˆå§‹å®¹é‡,åœ¨è°ƒç”¨ArrayListçš„æ— å‚æ„é€ å™¨æ—¶,elementDataä¼šç­‰äºè¯¥ç©ºæ•°ç»„<br>4.Object[] elementData;å› ä¸ºArrayListçš„åº•å±‚å°±æ˜¯æ•°ç»„çš„å®ç°,æ‰€ä»¥è¯¥æ•°ç»„ç”¨äºå­˜æ”¾æ•°æ®,æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶,ä»»ä½•å¸¦æœ‰<br>elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATAçš„ç©ºArrayListéƒ½å°†æ‰©å±•åˆ°DEFAULT_CAPACITYå¤§å°ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">8683452581122892189L</span><span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_CAPACITY</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">EMPTY_ELEMENTDATA</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">transient</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elementData<span class="token punctuation">;</span> <span class="token comment">// non-private to simplify nested class access</span><span class="token keyword">private</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·ArrayListçš„ä¸‰ä¸ªæ„é€ å™¨åˆ†æ<br>1.ç¬¬ä¸€ä¸ªæ„é€ å™¨å’Œç¬¬äºŒä¸ªæ„é€ å™¨éƒ½å¾ˆå®¹æ˜“ç†è§£,æ‰€è§å³æ‰€å¾—<br>2.ç¬¬ä¸‰ä¸ªæ„é€ å™¨,åœ¨åˆå§‹åŒ–ArrayListæ˜¯åŒæ—¶ç»™å…¶ä¼ å…¥ä¸€ä¸ªCollectionç±»å‹çš„å¯¹è±¡c<br>3.å°†ä¼ å…¥çš„é›†åˆ c è½¬æ¢ä¸ºæ•°ç»„ï¼Œå¹¶å°†è¯¥æ•°ç»„èµ‹å€¼ç»™ ArrayList çš„æˆå‘˜å˜é‡ elementData<br>4.å…ˆå°†æ•°ç»„çš„é•¿åº¦èµ‹å€¼ç»™ size å˜é‡ï¼Œç„¶åè¿›è¡Œåˆ¤æ–­<br>4.1.å¦‚æœæ•°ç»„é•¿åº¦ä¸ä¸º0,è¿›å…¥ifåˆ†æ”¯<br>4.1.1.å¦‚æœæ•°ç»„é•¿åº¦ä¸ä¸º0,åˆ¤æ–­elementDataçš„ç±»æ˜¯å¦æ˜¯Objectæ•°ç»„,å¦‚æœä¸æ˜¯åˆ™å°†elementDataè½¬ä¸ºObjectæ•°ç»„<br>4.1.2.å¦‚æœæ•°ç»„é•¿åº¦ä¸º0,åˆ™å°†elementDataè®¾ç½®ä¸ºArrayListçš„å†…éƒ¨æ•°æ®ç»“æ„æ˜¯Objectç±»å‹çš„æ•°ç»„</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>initialCapacity<span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> <span class="token constant">EMPTY_ELEMENTDATA</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>         <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal Capacity: "</span><span class="token operator">+</span>                                            initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">public</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> <span class="token constant">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>  <span class="token keyword">public</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token punctuation">></span></span> c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     elementData <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>size <span class="token operator">=</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token comment">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>elementData<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>             elementData <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>         <span class="token comment">// replace with empty array.</span>         <span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> <span class="token constant">EMPTY_ELEMENTDATA</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·ArrayListçš„ä¸¤ä¸ªaddæ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ¤æ–­éœ€ä¸éœ€è¦æ‰©å®¹</span>        <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span>size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Increments modCount!!</span>        elementData<span class="token punctuation">[</span>size<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/**1.é¦–å…ˆåˆ¤æ–­elementDataæ˜¯å¦ç­‰äºArrayListå†…éƒ¨çš„é»˜è®¤ç©ºå®ä¾‹æ•°ç»„2.å¦‚æœç­‰äºè¯´æ˜æ˜¯ç¬¬ä¸€æ¬¡æ‰©å®¹,é»˜è®¤å¤§å°ä¸ºDEFAULT_CAPACITY=103.ç„¶åæ‰§è¡Œç¡®ä¿å®¹å™¨å…·æœ‰è‡³å°‘minCapacityçš„å®¹é‡,è¿™å¯èƒ½ä¼šè§¦å‘å®¹å™¨æ‰©å®¹çš„æ“ä½œ,ä»¥ç¡®ä¿å¯ä»¥å®¹çº³æ‰€éœ€çš„å…ƒç´ æ•°é‡*/</span><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>elementData <span class="token operator">==</span> <span class="token constant">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            minCapacity <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_CAPACITY</span><span class="token punctuation">,</span> minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">ensureExplicitCapacity</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">/**1.modCount,è¿™ä¸ªå€¼ç”¨äºå¯¹å®¹å™¨è¿›è¡Œç»“æ„æ€§ä¿®æ”¹æ—¶,æ¥è¿½è¸ªä¿®æ”¹æ¬¡æ•°2.ç„¶åè¿›è¡Œæ¯”è¾ƒ,å¦‚æœæ‰€éœ€çš„æœ€å°å®¹é‡å¤§äºå½“å‰å®¹å™¨çš„é•¿åº¦,è¿›è¡Œæ‰©å®¹*/</span><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">ensureExplicitCapacity</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        modCount<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token comment">// overflow-conscious code</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>minCapacity <span class="token operator">-</span> elementData<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token function">grow</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">/**1.é¦–å…ˆå¾—åˆ°å®¹å™¨çš„é•¿åº¦,å¹¶ä¸”å°†å…¶æ‰©å®¹1.5å€2.æ£€æŸ¥è®¡ç®—å‡ºæ¥çš„æ–°å®¹é‡æ˜¯å¦å°äºæŒ‡å®šçš„æœ€å°å®¹é‡minCapacity,å¦‚æœæ˜¯,åˆ™å°†æ–°å®¹é‡è®¾ç½®ä¸ºminCapacity3.æ£€æŸ¥æ–°å®¹é‡æ˜¯å¦è¶…å‡ºäº†æ•°ç»„æœ€å¤§å®¹é‡ MAX_ARRAY_SIZE,å¦‚æœè¶…å‡º,è°ƒç”¨hugeCapacity(minCapacity)è·å–ä¸€ä¸ªè¶³å¤Ÿå¤§çš„å®¹é‡4.ä½¿ç”¨Arrays.copyOfæ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„,å°†æ—§æ•°ç»„elementDataä¸­çš„å…ƒç´ å¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­,å¹¶å°†æ–°æ•°ç»„èµ‹å€¼ç»™elementData*/</span><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">grow</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// overflow-conscious code</span>        <span class="token keyword">int</span> oldCapacity <span class="token operator">=</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">;</span>        <span class="token keyword">int</span> newCapacity <span class="token operator">=</span> oldCapacity <span class="token operator">+</span> <span class="token punctuation">(</span>oldCapacity <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">-</span> minCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>            newCapacity <span class="token operator">=</span> minCapacity<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">-</span> <span class="token constant">MAX_ARRAY_SIZE</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>            newCapacity <span class="token operator">=</span> <span class="token function">hugeCapacity</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// minCapacity is usually close to size, so this is a win:</span>        elementData <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h2><p>1.vectoråº•å±‚ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡æ•°ç»„<br>2.vectoræ˜¯çº¿ç¨‹åŒæ­¥çš„,å³çº¿ç¨‹å®‰å…¨,Vectorç±»çš„æ“ä½œæ–¹æ³•å¸¦æœ‰synchronized<br>3.vectoråˆå§‹åŒ–æ—¶,å¦‚æœæ˜¯æ— å‚,é»˜è®¤10,æ»¡å,å°±æŒ‰2å€æ‰©å®¹,å¦‚æœæŒ‡å®šå¤§å°,åˆ™æ¯æ¬¡ç›´æ¥æŒ‰2å€æ‰©å®¹</p><h2 id="Setæ¥å£åŸºæœ¬ä»‹ç»"><a href="#Setæ¥å£åŸºæœ¬ä»‹ç»" class="headerlink" title="Setæ¥å£åŸºæœ¬ä»‹ç»"></a>Setæ¥å£åŸºæœ¬ä»‹ç»</h2><p>1.æ— åº(æ·»åŠ å’Œå–å‡ºçš„é¡ºåºä¸ä¸€è‡´),æ²¡æœ‰ç´¢å¼•<br>2.ä¸å…è®¸é‡å¤å…ƒç´ ,æ‰€ä»¥æœ€å¤šåŒ…å«ä¸€ä¸ªnull<br>3.HashSetçš„åº•å±‚å…¶å®å°±æ˜¯HashMap(æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘)</p><h2 id="HashSetåº•å±‚ä»‹ç»"><a href="#HashSetåº•å±‚ä»‹ç»" class="headerlink" title="HashSetåº•å±‚ä»‹ç»"></a>HashSetåº•å±‚ä»‹ç»</h2><p>1.æ·»åŠ ä¸€ä¸ªå…ƒç´ æ—¶,å…ˆå¾—åˆ°hashå€¼,ä¼šè½¬æˆ-&gt;ç´¢å¼•å€¼<br>2.æ‰¾åˆ°å­˜å‚¨æ•°æ®è¡¨table,çœ‹è¿™ä¸ªç´¢å¼•ä½ç½®æ˜¯å¦å·²ç»å­˜æ”¾çš„æœ‰å…ƒç´ <br>3.å¦‚æœæ²¡æœ‰,ç›´æ¥åŠ å…¥<br>4.å¦‚æœæœ‰,è°ƒç”¨equalsæ¯”è¾ƒ,å¦‚æœç›¸åŒ,å°±æ”¾å¼ƒæ·»åŠ ,å¦‚æœä¸åŒ,åˆ™æ·»åŠ åˆ°æœ€å<br>5.åœ¨java8ä¸­,å¦‚æœä¸€æ¡é“¾è¡¨çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡TREEIFY_THRESHOLD(é»˜è®¤æ˜¯8),å¹¶ä¸”tableçš„å¤§å°&gt;=MIN_TREEIFY_CAPACITY(é»˜è®¤64)<br>å°±ä¼šè¿›è¡Œæ ‘åŒ–(çº¢é»‘æ ‘),å¦åˆ™ä¾ç„¶é‡‡ç”¨æ•°ç»„æ‰©å®¹æœºåˆ¶ã€‚<br>6.HashSetçš„åº•å±‚æ˜¯HashMap,ç¬¬ä¸€æ¬¡æ·»åŠ æ—¶,tableæ•°ç»„æ‰©å®¹åˆ°16,ä¸´ç•Œå€¼æ˜¯16<em>åŠ è½½å› å­(0.75)=12ã€‚<br>7.å¦‚æœtableæ•°ç»„ä½¿ç”¨åˆ°äº†ä¸´ç•Œå€¼12,å°±ä¼šæ‰©å®¹åˆ°16</em>2=32,æ–°çš„ä¸´ç•Œå€¼å°±æ˜¯32*0.75=24,ä¾æ¬¡ç±»æ¨</p><h3 id="HashSetåº•å±‚ç»†èŠ‚"><a href="#HashSetåº•å±‚ç»†èŠ‚" class="headerlink" title="HashSetåº•å±‚ç»†èŠ‚"></a>HashSetåº•å±‚ç»†èŠ‚</h3><p>1.æ±‚hashå€¼: return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);<br>Â·è§£æå½“å‰å€¼çš„hashå€¼å¼‚æˆ–äºå½“å‰å€¼çš„hashCodeå€¼æ— ç¬¦å·å³ç§»16ä½<br>2.å› ä¸ºhashSetçš„åº•å±‚æ˜¯hashMap,æ‰€ä»¥</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">HashSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>3.hashSetç›¸å½“äºåœ¨hashMapä¸­åªæ”¾äº†key,æ‰€ä»¥åœ¨vå¤„æ”¾äº†ä¸€ä¸ªå ä½ç¬¦</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token constant">PRESENT</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> tab<span class="token punctuation">[</span>i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>  tab<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token comment">//åˆ¤æ–­åœ¨tableä¸­ç¬¬iä¸ªä½ç½®æœ‰æ²¡æœ‰å…ƒç´ ,i=n-1,n=table.length</span> <span class="token comment">//å¦‚æœæ²¡æœ‰ç›´æ¥å°±æ”¾åˆ°tableè¡¨çš„ç¬¬iä¸ªä½ç½®</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> tab<span class="token punctuation">[</span>i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>     tab<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span> <span class="token class-name">K</span> k<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>        <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> p<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">//p = tab[i = (n - 1) &amp; hash])æ ¹æ®hashç®—å¾—ç´¢å¼•</span>        <span class="token comment">//å½“å‰ç´¢å¼•ä½ç½®å¯¹åº”çš„é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ å’Œå‡†å¤‡æ·»åŠ çš„keyçš„hashå€¼ä¸€æ ·</span>        <span class="token comment">//hashå€¼ç›¸ç­‰å¹¶ä¸”èŠ‚ç‚¹çš„keyç›¸ç­‰æˆ–è€…key.equals(k),</span>        <span class="token comment">//è¿™ä¸ªifè¯­å¥è¯´æ¥è¯´å»å°±ä¸€å¥è¯,å¦‚æœå‡†å¤‡æ·»åŠ çš„Nodeå’Œå½“å‰ç´¢å¼•ä½ç½®å¯¹åº”é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ Nodeä¸€æ ·,å°±ä¸èƒ½åŠ å…¥</span>        e <span class="token operator">=</span> p<span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>    <span class="token comment">//å†åˆ¤æ–­pæ˜¯ä¸æ˜¯ä¸€é¢—çº¢é»‘æ ‘</span>    <span class="token comment">//å¦‚æœæ˜¯çº¢é»‘æ ‘å°±æŒ‰çº¢é»‘æ ‘çš„æ–¹æ³•æ¥</span>        e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTreeVal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> tab<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å¾ªç¯æ¯”è¾ƒå½“å‰ç´¢å¼•ä½ç½®å¯¹åº”é“¾è¡¨çš„Node,å› ä¸ºå†æ•°ç»„ä¸é“¾è¡¨é‡åˆçš„ä½ç½®ä»¥åŠæ¯”è¾ƒäº†,æˆ‘çš„ç†è§£æ˜¯ä»é“¾è¡¨çš„ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹æ¯”è¾ƒ</span>        <span class="token comment">//è¿™ä¸ªå¾ªç¯æ˜¯æ­»å¾ªç¯,åªæœ‰ä¸¤ä¸ªé€€å‡ºæ¡ä»¶  </span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>binCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//å°†å‡†å¤‡åŠ å…¥çš„Nodeæ”¾å…¥é“¾è¡¨çš„æœ€å</span>                p<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//å¦‚æœé“¾è¡¨çš„é•¿åº¦åˆ°è¾¾8å°±å¯¹å½“å‰é“¾è¡¨è¿›è¡Œæ ‘åŒ–</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">>=</span> <span class="token constant">TREEIFY_THRESHOLD</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// -1 for 1st</span>                    <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// if (tab == null || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY),æ•°ç»„çš„å¤§å°å°äº64,è¿˜ä¸ä¼šæ ‘åŒ–</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>                <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            p <span class="token operator">=</span> e<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title&gt;&lt;/a&gt;&lt;div class=&quot;note purple no-icon flat&quot;&gt;&lt;p&gt;é›†åˆæºç åˆ†æ&lt;/p&gt;
&lt;/div&gt;&lt;/h1&gt;&lt;h2 id=&quot;ArrayListæºç åˆ†æ&quot;&gt;&lt;a hre</summary>
      
    
    
    
    <category term="æ•°æ®ç»“æ„" scheme="https://100qin10086.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
    <category term="java" scheme="https://100qin10086.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>vue2å¤ä¹ </title>
    <link href="https://100qin10086.github.io/posts/94391273.html"/>
    <id>https://100qin10086.github.io/posts/94391273.html</id>
    <published>2024-03-21T00:59:59.000Z</published>
    <updated>2024-05-06T14:13:59.610Z</updated>
    
    <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a><div class="note purple no-icon flat"><p>Vue2å¤ä¹ andé¢„ä¹  </p></div></h1><h2 id="VUEçš„MVVM"><a href="#VUEçš„MVVM" class="headerlink" title="VUEçš„MVVM"></a>VUEçš„MVVM</h2><p>Â·ä¸€å›¾èƒœåƒè¨€<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/7e8025b3fac9caa67c605889f258aa81.png"></div></div></p><h3 id="è§£è¯»MVVMæ€æƒ³"><a href="#è§£è¯»MVVMæ€æƒ³" class="headerlink" title="è§£è¯»MVVMæ€æƒ³"></a>è§£è¯»MVVMæ€æƒ³</h3><p>Â·M:å³Model,æ¨¡å‹,åŒ…æ‹¬æ•°æ®å’Œä¸€äº›åŸºæœ¬æ“ä½œ<br>Â·V:å³View,è§†å›¾,é¡µé¢æ¸²æŸ“ç»“æœ<br>Â·VM:å³View-Model,æ¨¡å‹ä¸è§†å›¾çš„åŒå‘æ“ä½œ(æ— éœ€å¼€å‘äººå‘˜å¹²æ¶‰)<br>Â·åœ¨ MVVMä¹‹å‰ï¼Œå¼€å‘äººå‘˜ä»åç«¯è·å–éœ€è¦çš„æ•°æ®æ¨¡å‹ï¼Œç„¶åè¦é€šè¿‡ DOM æ“ä½œ Modelæ¸²æŸ“åˆ°Viewä¸­ã€‚è€Œåå½“ç”¨æˆ·æ“ä½œè§†å›¾ï¼Œ<br>æˆ‘ä»¬è¿˜éœ€è¦é€šè¿‡ DOMè·å– View ä¸­çš„æ•°æ®,ç„¶ååŒæ­¥åˆ°Model ä¸­ã€‚<br>Â·è€Œ MVVMä¸­çš„VM è¦åšçš„äº‹æƒ…å°±æ˜¯æŠŠDOM æ“ä½œå®Œå…¨å°è£…èµ·æ¥ï¼Œå¼€å‘äººå‘˜ä¸ç”¨å†å…³å¿ƒModelå’ŒViewä¹‹é—´æ˜¯å¦‚ä½•äº’ç›¸ã€‚<br>Â·åªè¦æˆ‘ä»¬ Model å‘ç”Ÿäº†æ”¹å˜ï¼ŒViewä¸Šè‡ªç„¶å°±ä¼šè¡¨ç°å‡ºæ¥<br>Â·å½“ç”¨æˆ·ä¿®æ”¹äº†Viewï¼ŒModel ä¸­çš„æ•°æ®ä¹Ÿä¼šè·Ÿç€æ”¹å˜ã€‚<br>Â·ç»“æœï¼šæŠŠå¼€å‘äººå‘˜ä»ç¹ççš„ DOMæ“ä½œä¸­è§£æ”¾å‡ºæ¥ï¼ŒæŠŠå…³æ³¨ç‚¹æ”¾åœ¨å¦‚ä½•æ“ä½œ Modelä¸Š, å¤§å¤§æé«˜å¼€å‘æ•ˆç‡</p><h3 id="æ•°æ®ç»‘å®šå®ä¾‹"><a href="#æ•°æ®ç»‘å®šå®ä¾‹" class="headerlink" title="æ•°æ®ç»‘å®šå®ä¾‹"></a>æ•°æ®ç»‘å®šå®ä¾‹</h3><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;body&gt;&lt;!--è€å¸ˆè§£è¯»1. div å…ƒç´ ä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒå…ƒç´ ï¼Œæ¯”å¦‚ span,ä½†æ˜¯çº¦å®šéƒ½æ˜¯å°† vue å®ä¾‹æŒ‚è½½åˆ° div2. å› ä¸º div æ›´åŠ é€‚åˆåšå¸ƒå±€3. id ä¸æ˜¯å¿…é¡»ä¸º app , æ˜¯ç¨‹åºå‘˜æŒ‡å®š,ä¸€èˆ¬æˆ‘ä»¬å°±ä½¿ç”¨ app--&gt;&lt;div id&#x3D;&quot;app&quot;&gt;  &lt;!--è€å¸ˆè§£è¯»  1. &#123;&#123;message&#125;&#125; : æ’å€¼è¡¨è¾¾å¼  2. message å°±æ˜¯ä» model çš„ data æ•°æ®æ± æ¥è®¾ç½®  3. å½“æˆ‘ä»¬çš„ä»£ç æ‰§è¡Œæ—¶ï¼Œä¼šåˆ° data&#123;&#125; æ•°æ®æ± ä¸­å»åŒ¹é…æ•°æ®, å¦‚æœåŒ¹é…ä¸Š, å°±è¿›è¡Œæ›¿æ¢  , å¦‚æœæ²¡æœ‰åŒ¹é…ä¸Š, å°±æ˜¯è¾“å‡ºç©º  --&gt;  &lt;h1&gt;æ¬¢è¿ä½ &#123;&#123;message&#125;&#125;-&#123;&#123;name&#125;&#125;&lt;&#x2F;h1&gt;&lt;&#x2F;div&gt;&lt;!--å¼•å…¥ vue.js--&gt;&lt;script src&#x3D;&quot;vue.js&quot;&gt;&lt;&#x2F;script&gt;&lt;script&gt;  &#x2F;&#x2F;åˆ›å»º Vue å¯¹è±¡  &#x2F;**   éŸ©é¡ºå¹³ Java å·¥ç¨‹å¸ˆ   * è€éŸ©è§£è¯»   * 1. åˆ›å»º Vue å¯¹è±¡å®ä¾‹   * 2. æˆ‘ä»¬åœ¨æ§åˆ¶å°è¾“å‡º vm å¯¹è±¡ï¼Œçœ‹çœ‹è¯¥å¯¹è±¡çš„ç»“æ„ï¼(data&#x2F;listeners) *   *&#x2F;  let vm &#x3D; new Vue(&#123;    el: &quot;#app&quot;, &#x2F;&#x2F;åˆ›å»ºçš„ vue å®ä¾‹æŒ‚è½½åˆ° id&#x3D;app çš„ div    data: &#123; &#x2F;&#x2F;data&#123;&#125; è¡¨ç¤ºæ•°æ®æ± (model çš„æœ‰äº†æ•°æ®), æœ‰å¾ˆå¤šæ•°æ® ,ä»¥ k-v å½¢å¼è®¾ç½®(æ ¹æ®ä¸šåŠ¡éœ€è¦æ¥è®¾ç½®)      message: &quot;Hello-Vue!&quot;,      name: &quot;ç§¦ä¸‰é¡º&quot;    &#125;  &#125;)&lt;&#x2F;script&gt;&lt;&#x2F;body&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·æ³¨æ„:ä»£ç é¡ºåºï¼Œè¦æ±‚ div åœ¨å‰ï¼Œscript åœ¨åï¼Œå¦åˆ™æ— æ³•ç»‘å®šæ•°</p><h3 id="æ•°æ®å•å‘æ¸²æŸ“"><a href="#æ•°æ®å•å‘æ¸²æŸ“" class="headerlink" title="æ•°æ®å•å‘æ¸²æŸ“"></a>æ•°æ®å•å‘æ¸²æŸ“</h3><p>Â· v-bind æŒ‡ä»¤å¯ä»¥å®ŒæˆåŸºæœ¬æ•°æ®æ¸²æŸ“/ç»‘å®š<br>Â· v-bind ç®€å†™å½¢å¼å°±æ˜¯ä¸€ä¸ªå†’å·ï¼ˆ:ï¼‰</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;!--è§£è¯»   1.é€‚ç”¨æ’å€¼è¡¨è¾¾å¼å¼•ç”¨dataæ•°æ®æ± æ•°æ®åœ¨æ ‡ç­¾ä½“å†…   2.å¦‚æœæ˜¯åœ¨æ ‡ç­¾&#x2F;å…ƒç´ çš„å±æ€§ä¸Šå»å¼•ç”¨dataæ•°æ®æ± æ•°æ®æ—¶,ä¸èƒ½é€‚ç”¨æ’å€¼è¡¨è¾¾å¼--&gt;&lt;img v-bind:src&#x3D;&quot;img_src&quot; v-bind:width&#x3D;&quot;img_width&quot;&gt;&lt;script&gt;let vm &#x3D; new Vue(&#123;  el: &quot;#app&quot;, &#x2F;&#x2F;åˆ›å»ºçš„ vue å®ä¾‹æŒ‚è½½åˆ° id&#x3D;app çš„ div  data: &#123; &#x2F;&#x2F;data&#123;&#125; è¡¨ç¤ºæ•°æ®æ± (model çš„æœ‰äº†æ•°æ®), æœ‰å¾ˆå¤šæ•°æ® ,ä»¥ k-v å½¢å¼è®¾ç½®(æ ¹æ®ä¸šåŠ¡éœ€è¦æ¥è®¾ç½®)    message: &quot;hello, è€—å­ç²¾&quot;,    img_src: &quot;1.jpg&quot;,    img_width: &quot;200px&quot;  &#125;&#125;)console.log(&quot;vm&#x3D;&gt;&quot;, vm);&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ•°æ®åŒå‘ç»‘å®š"><a href="#æ•°æ®åŒå‘ç»‘å®š" class="headerlink" title="æ•°æ®åŒå‘ç»‘å®š"></a>æ•°æ®åŒå‘ç»‘å®š</h3><p>Â·v-model å¯ä»¥å®ŒæˆåŒå‘æ•°æ®ç»‘å®š</p><h3 id="äº‹ä»¶ç»‘å®šå"><a href="#äº‹ä»¶ç»‘å®šå" class="headerlink" title="äº‹ä»¶ç»‘å®šå"></a>äº‹ä»¶ç»‘å®šå</h3><p>Â·ä½¿ç”¨ v-on è¿›è¡Œäº‹ä»¶å¤„ç†ï¼Œæ¯”å¦‚: v-on:click è¡¨ç¤ºå¤„ç†é¼ æ ‡ç‚¹å‡»äº‹ä»¶<br>Â·v-on æŒ‡ä»¤çš„ç®€å†™å½¢å¼ @ [éœ€è¦æµè§ˆå™¨æ”¯æŒ]</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;body&gt;&lt;!--è§†å›¾--&gt;&lt;div id&#x3D;&quot;app&quot;&gt;  &lt;h1&gt;&#123;&#123;message&#125;&#125;&lt;&#x2F;h1&gt;  &lt;!--è€éŸ©è§£è¯»  1. v-on:click è¡¨ç¤ºæˆ‘ä»¬è¦ç»™ button å…ƒç´ ç»‘å®šä¸€ä¸ª click çš„äº‹ä»¶  2. sayHi() è¡¨ç¤ºç»‘å®šçš„æ–¹æ³•, åœ¨æ–¹æ³•æ±  methods&#123;&#125; å®šä¹‰çš„  3. åº•å±‚ä»ç„¶æ˜¯ dom å¤„ç†  4. å¦‚æœæ–¹æ³•ä¸éœ€è¦ä¼ é€’å‚æ•°ï¼Œå¯ä»¥çœç•¥()  5. v-on:click å¯ä»¥ç®€å†™@, ä½†æ˜¯éœ€è¦æµè§ˆå™¨æ”¯æŒ  --&gt;  &lt;button v-on:click&#x3D;&quot;sayHi()&quot;&gt;ç‚¹å‡»è¾“å‡º&lt;&#x2F;button&gt;  &lt;button v-on:click&#x3D;&quot;sayOk()&quot;&gt;ç‚¹å‡»è¾“å‡º&lt;&#x2F;button&gt;  &lt;button v-on:click&#x3D;&quot;sayHi&quot;&gt;ç‚¹å‡»è¾“å‡º&lt;&#x2F;button&gt;  &lt;button @click&#x3D;&quot;sayOk&quot;&gt;ç‚¹å‡»è¾“å‡º&lt;&#x2F;button&gt;&lt;&#x2F;div&gt;&lt;!--å¼•å…¥æˆ‘ä»¬çš„ vue.js--&gt;&lt;script src&#x3D;&quot;vue.js&quot;&gt;&lt;&#x2F;script&gt;&lt;!--åˆ›å»ºä¸€ä¸ª vue å®ä¾‹,å¹¶æŒ‚è½½åˆ° id&#x3D;app çš„ div--&gt;&lt;script&gt;  &#x2F;&#x2F;è€å¸ˆè¯´æ˜:è¿™é‡Œåˆ›å»ºçš„ Vue å®ä¾‹, ä½ å¯ä»¥ä¸å»æ¥æ”¶, ä¹Ÿå¯ä»¥æ¥æ”¶  &#x2F;&#x2F;æ–¹ä¾¿æˆ‘ä»¬è°ƒè¯•ä¿¡æ¯  let vm &#x3D; new Vue(&#123;    el: &quot;#app&quot;, &#x2F;&#x2F;åˆ›å»ºçš„ vue å®ä¾‹æŒ‚è½½åˆ° id&#x3D;app çš„ div, el å°±æ˜¯ element çš„ç®€å†™    data: &#123; &#x2F;&#x2F;data&#123;&#125; è¡¨ç¤ºæ•°æ®æ± (model ä¸­çš„æ•°æ®), æœ‰å¾ˆå¤šæ•°æ® ,ä»¥ k-v å½¢å¼è®¾ç½®(æ ¹æ®ä¸šåŠ¡éœ€è¦æ¥è®¾ç½®)      message: &quot;Vue äº‹ä»¶å¤„ç†çš„æ¡ˆä¾‹&quot;, name: &quot;éŸ©é¡ºå¹³æ•™è‚²&quot;    &#125;,&#x2F;&#x2F;è€å¸ˆè§£è¯»:&#x2F;&#x2F; 1. æ˜¯ä¸€ä¸ª methods å±æ€§, å¯¹åº”çš„å€¼æ˜¯å¯¹è±¡&#123;&#125;&#x2F;&#x2F; 2. åœ¨&#123;&#125; ä¸­, å¯ä»¥å†™å¾ˆå¤šçš„æ–¹æ³•, ä½ å¯ä»¥è¿™é‡Œç†è§£æ˜¯ä¸€ä¸ªæ–¹æ³•æ± &#x2F;&#x2F; 3. è¿™é‡Œéœ€è¦å°ä¼™ä¼´æœ‰ js çš„åŸºç¡€&#x3D;&gt;java web ç¬¬ 4 ç«     methods: &#123;      sayHi() &#123;        console.log(&quot;hi, é“¶è§’å¤§ç‹~&quot;);      &#125;, sayOk() &#123;        console.log(&quot;ok, é‡‘è§’å¤§ç‹~&quot;);      &#125;    &#125;  &#125;) &lt;&#x2F;script&gt;&lt;&#x2F;body&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ¡ä»¶æ¸²æŸ“-æ§åˆ¶-v-if-v-show"><a href="#æ¡ä»¶æ¸²æŸ“-æ§åˆ¶-v-if-v-show" class="headerlink" title="æ¡ä»¶æ¸²æŸ“/æ§åˆ¶: v-if v-show"></a>æ¡ä»¶æ¸²æŸ“/æ§åˆ¶: v-if v-show</h3><h4 id="v-if-ä»‹ç»"><a href="#v-if-ä»‹ç»" class="headerlink" title="v-if ä»‹ç»"></a>v-if ä»‹ç»</h4><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;body&gt;&lt;div id&#x3D;&quot;app&quot;&gt;  &lt;!--è¿™é‡Œå°ä¼™ä¼´è¿˜å¯ä»¥çœ‹åˆ° checkbox çš„ checked å±æ€§çš„å€¼--&gt;  &lt;input type&#x3D;&quot;checkbox&quot; v-model&#x3D;&quot;sel&quot;&gt;æ˜¯å¦åŒæ„æ¡æ¬¾[v-if å®ç°]  &lt;!-- è€å¸ˆè§£è¯» v-if&#x2F;v-else ä¼šæ ¹æ® è¿”å›çš„å€¼,æ¥å†³å®šæ˜¯å¦åŠ¨æ€åˆ›å»ºå¯¹åº”çš„å­ç»„ä»¶ &lt;h1&gt;  --&gt;  &lt;h1 v-if&#x3D;&quot;sel&quot;&gt;ä½ åŒæ„æ¡æ¬¾&lt;&#x2F;h1&gt;  &lt;h1 v-else&gt;ä½ ä¸åŒæ„æ¡æ¬¾&lt;&#x2F;h1&gt;&lt;&#x2F;div&gt;&lt;script src&#x3D;&quot;vue.js&quot;&gt;&lt;&#x2F;script&gt;&lt;script&gt;  &#x2F;&#x2F;ä¸ºäº†è°ƒè¯•æ–¹ä¾¿, ä½¿ç”¨ vm æ¥æ”¶ Vue å®ä¾‹  let vm &#x3D; new Vue(&#123;    el: &#39;#app&#39;, data: &#123;&#x2F;&#x2F;data æ•°æ®æ±       sel: false    &#125;  &#125;)&lt;&#x2F;script&gt;&lt;&#x2F;body&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="v-show-ä»‹ç»"><a href="#v-show-ä»‹ç»" class="headerlink" title="v-show ä»‹ç»"></a>v-show ä»‹ç»</h4><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;body&gt;&lt;div id&#x3D;&quot;app&quot;&gt;  &lt;!--è¿™é‡Œå°ä¼™ä¼´è¿˜å¯ä»¥çœ‹åˆ° checkbox çš„ checked å±æ€§çš„å€¼--&gt;  &lt;input type&#x3D;&quot;checkbox&quot; v-model&#x3D;&quot;sel&quot;&gt;æ˜¯å¦åŒæ„æ¡æ¬¾[v-show å®ç°]  &lt;h1 v-show&#x3D;&quot;sel&quot;&gt;ä½ åŒæ„æ¡æ¬¾&lt;&#x2F;h1&gt;  &lt;h1 v-show&#x3D;&quot;!sel&quot;&gt;ä½ ä¸åŒæ„æ¡æ¬¾&lt;&#x2F;h1&gt;&lt;&#x2F;div&gt;&lt;script src&#x3D;&quot;vue.js&quot;&gt;&lt;&#x2F;script&gt;&lt;script&gt;  &#x2F;&#x2F;ä¸ºäº†è°ƒè¯•æ–¹ä¾¿, ä½¿ç”¨ vm æ¥æ”¶ Vue å®ä¾‹  let vm &#x3D; new Vue(&#123;    el: &#39;#app&#39;, data: &#123;&#x2F;&#x2F;data æ•°æ®æ±       sel: false    &#125;  &#125;)&lt;&#x2F;script&gt;&lt;&#x2F;body&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="v-if-VS-v-show"><a href="#v-if-VS-v-show" class="headerlink" title="v-if VS v-show"></a>v-if VS v-show</h3><p>1.v-ifä¼šç¡®ä¿åœ¨åˆ‡æ¢è¿‡ç¨‹ä¸­,æ¡ä»¶å—å†…çš„äº‹ä»¶ç›‘å¬å™¨å’Œå­ç»„ä»¶é”€æ¯å’Œé‡å»º<br>2.v-showæœºåˆ¶ç›¸å¯¹ç®€å•,ä¸ç®¡åˆå§‹æ¡ä»¶æ˜¯ä»€ä¹ˆ,å…ƒç´ æ€»ä¼šè¢«æ¸²æŸ“,å¹¶ä¸”åªæ˜¯å¯¹CSSè¿›è¡Œåˆ‡æ¢<br>3.ä½¿ç”¨å»ºè®®ï¼šå¦‚æœè¦é¢‘ç¹åœ°åˆ‡æ¢ï¼Œå»ºè®®ä½¿ç”¨ v-show ï¼›å¦‚æœè¿è¡Œæ—¶æ¡ä»¶å¾ˆå°‘æ”¹å˜ï¼Œä½¿ç”¨ v-if è¾ƒå¥½</p><h3 id="åˆ—è¡¨å¾ªç¯æ¸²æŸ“-v-for"><a href="#åˆ—è¡¨å¾ªç¯æ¸²æŸ“-v-for" class="headerlink" title="åˆ—è¡¨å¾ªç¯æ¸²æŸ“:v-for"></a>åˆ—è¡¨å¾ªç¯æ¸²æŸ“:v-for</h3><p>1.å¯¹æ•°ç»„è¿›è¡Œéå†<br>Â·v-foræŒ‡ä»¤éœ€è¦é€‚ç”¨item in items å½¢å¼çš„ç‰¹æ®Šè¯­æ³•,å…¶ä¸­itemsæ˜¯æºæ•°æ®æ•°ç»„,è€Œitemåˆ™æ˜¯è¢«è¿­ä»£çš„æ•°ç»„å…ƒç´ çš„åˆ«å</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;li v-for&#x3D;&quot;item in items&quot; :key&#x3D;&quot;item.message&quot;&gt;&#123;&#123;item.message&#125;&#125;&lt;&#x2F;li&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>2.ç”¨ v-for æ¥éå†ä¸€ä¸ªå¯¹è±¡çš„ property</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;li v-for&#x3D;&quot;value in object&quot;&gt;&#123;&#123;value&#125;&#125;&lt;&#x2F;li&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç»„ä»¶åŒ–ç¼–ç¨‹"><a href="#ç»„ä»¶åŒ–ç¼–ç¨‹" class="headerlink" title="ç»„ä»¶åŒ–ç¼–ç¨‹"></a>ç»„ä»¶åŒ–ç¼–ç¨‹</h2><h3 id="åŸºæœ¬è¯´æ˜"><a href="#åŸºæœ¬è¯´æ˜" class="headerlink" title="åŸºæœ¬è¯´æ˜"></a>åŸºæœ¬è¯´æ˜</h3><p>1.åœ¨å¤§å‹åº”ç”¨å¼€å‘çš„æ—¶å€™,é¡µé¢å¯ä»¥åˆ’åˆ†æˆå¾ˆå¤šéƒ¨åˆ†,å¾€å¾€ä¸åŒçš„é¡µé¢,ä¹Ÿä¼šæœ‰ç›¸åŒçš„éƒ¨åˆ†ã€‚ä¾‹å¦‚å¯èƒ½ä¼šæœ‰ç›¸åŒçš„å¤´éƒ¨å¯¼èˆª<br>2.ä½†æ˜¯å¦‚æœæ¯ä¸ªé¡µé¢éƒ½ç‹¬è‡ªå¼€å‘,è¿™æ— ç–‘å¢åŠ äº†æˆ‘ä»¬å¼€å‘çš„æˆæœ¬,æ‰€ä»¥æˆ‘ä»¬ä¼šæŠŠé¡µé¢çš„ä¸åŒéƒ¨åˆ†æ‹†åˆ†æˆç‹¬ç«‹çš„ç»„ä»¶,ç„¶ååœ¨ä¸åŒé¡µé¢å°±å¯ä»¥<br>å…±äº«è¿™äº›ç»„ä»¶,é¿å…é‡å¤å¼€å‘ã€‚</p><h3 id="å…¨å±€ç»„ä»¶"><a href="#å…¨å±€ç»„ä»¶" class="headerlink" title="å…¨å±€ç»„ä»¶"></a>å…¨å±€ç»„ä»¶</h3><p>Â·ç›´æ¥Vue.component</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;body&gt;&lt;div id&#x3D;&quot;app&quot;&gt;  &lt;h1&gt;ç»„ä»¶åŒ–ç¼–ç¨‹-å…¨å±€ç»„ä»¶&lt;&#x2F;h1&gt;  &lt;!--ä½¿ç”¨å…¨å±€ç»„ä»¶--&gt;  &lt;counter&gt;&lt;&#x2F;counter&gt;  &lt;br&#x2F;&gt;  &lt;counter&gt;&lt;&#x2F;counter&gt;  &lt;counter&gt;&lt;&#x2F;counter&gt;  &lt;counter&gt;&lt;&#x2F;counter&gt;  &lt;counter&gt;&lt;&#x2F;counter&gt;&lt;&#x2F;div&gt;&lt;div id&#x3D;&quot;app2&quot;&gt;  &lt;h1&gt;ç»„ä»¶åŒ–ç¼–ç¨‹-å…¨å±€ç»„ä»¶-app2&lt;&#x2F;h1&gt;  &lt;!--ä½¿ç”¨å…¨å±€ç»„ä»¶--&gt;  &lt;counter&gt;&lt;&#x2F;counter&gt;  &lt;counter&gt;&lt;&#x2F;counter&gt;&lt;&#x2F;div&gt;&lt;script src&#x3D;&quot;vue.js&quot;&gt;&lt;&#x2F;script&gt;&lt;script&gt;  &#x2F;&#x2F;1ã€å®šä¹‰ä¸€ä¸ªå…¨å±€ç»„ä»¶, åç§°ä¸º counter  &#x2F;&#x2F;2. &#123;&#125; è¡¨ç¤ºå°±æ˜¯æˆ‘ä»¬çš„ç»„ä»¶ç›¸å…³çš„å†…å®¹  &#x2F;&#x2F;3. template æŒ‡å®šè¯¥ç»„ä»¶çš„ç•Œé¢, å› ä¸ºä¼šå¼•ç”¨åˆ°æ•°æ®æ± çš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²  &#x2F;&#x2F;4. è¿™é‡Œè¯´æ˜: è¦æŠŠç»„ä»¶è§†ä¸ºä¸€ä¸ªVueå®ä¾‹ï¼Œä¹Ÿæœ‰è‡ªå·±çš„æ•°æ®æ± å’Œmethods  &#x2F;&#x2F;5. è¿™é‡Œè¯´æ˜: å¯¹äºç»„ä»¶ï¼Œæˆ‘ä»¬çš„æ•°æ®æ± çš„æ•°æ®ï¼Œæ˜¯ä½¿ç”¨å‡½æ•°&#x2F;æ–¹æ³•è¿”å›[ç›®çš„æ˜¯ä¸ºäº†ä¿è¯æ¯ä¸ªç»„ä»¶çš„æ•°æ®æ˜¯ç‹¬ç«‹], ä¸èƒ½ä½¿ç”¨åŸæ¥çš„æ–¹å¼  &#x2F;&#x2F;6. è¿™æ—¶æˆ‘ä»¬è¾¾åˆ°ç›®å‰ï¼Œç•Œé¢é€šè¿‡templateå®ç°å…±äº«,ä¸šåŠ¡å¤„ç†ä¹Ÿå¤ç”¨  &#x2F;&#x2F;7. å…¨å±€ç»„ä»¶æ˜¯å±äºæ‰€æœ‰vueå®ä¾‹ï¼Œå› æ­¤ï¼Œå¯ä»¥åœ¨æ‰€æœ‰çš„vueå®ä¾‹ä½¿ç”¨  Vue.component(&quot;counter&quot;, &#123;    template: &#96;&lt;button v-on:click&#x3D;&quot;click()&quot;&gt;ç‚¹å‡»æ¬¡æ•°&#x3D; &#123;&#123;count&#125;&#125; æ¬¡ã€å…¨å±€ç»„ä»¶åŒ–ã€‘&lt;&#x2F;button&gt;&#96;,    data() &#123;&#x2F;&#x2F;è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå’ŒåŸæ¥çš„æ–¹å¼ä¸ä¸€æ ·!!!!      return &#123;        count: 10      &#125;    &#125;,    methods: &#123;      click() &#123;        this.count++;      &#125;    &#125;  &#125;)  &#x2F;&#x2F;åˆ›å»ºVueå®ä¾‹ï¼Œå¿…é¡»æœ‰  let vm &#x3D; new Vue(&#123;    el: &quot;#app&quot;&#x2F;&#x2F;Vueå®ä¾‹çš„æŒ‚è½½ç‚¹  &#125;)  let vm2 &#x3D; new Vue(&#123;    el: &quot;#app2&quot;&#x2F;&#x2F;Vueå®ä¾‹çš„æŒ‚è½½ç‚¹  &#125;)&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å±€éƒ¨ç»„ä»¶çš„æ–¹å¼"><a href="#å±€éƒ¨ç»„ä»¶çš„æ–¹å¼" class="headerlink" title="å±€éƒ¨ç»„ä»¶çš„æ–¹å¼"></a>å±€éƒ¨ç»„ä»¶çš„æ–¹å¼</h3><p>Â·å®šä¹‰ä¸€ä¸ªç»„ä»¶,ç„¶åå°†å…¶æ”¾å…¥Vueå¯¹è±¡çš„componentså±æ€§ä¸­</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;body&gt;&lt;div id&#x3D;&quot;app&quot;&gt;  &lt;h1&gt;ç»„ä»¶åŒ–ç¼–ç¨‹-å±€éƒ¨ç»„ä»¶&lt;&#x2F;h1&gt;  &lt;!--ä½¿ç”¨å±€éƒ¨ç»„ä»¶ ,è¯¥ç»„ä»¶æ˜¯ä»æŒ‚è½½åˆ°appçš„vueä¸­çš„--&gt;  &lt;my_counter&gt;&lt;&#x2F;my_counter&gt;  &lt;br&#x2F;&gt;  &lt;my_counter&gt;&lt;&#x2F;my_counter&gt;  &lt;br&#x2F;&gt;  &lt;my_counter&gt;&lt;&#x2F;my_counter&gt;  &lt;br&#x2F;&gt;&lt;&#x2F;div&gt;&lt;div id&#x3D;&quot;app2&quot;&gt;  &lt;h1&gt;ç»„ä»¶åŒ–ç¼–ç¨‹-å±€éƒ¨ç»„ä»¶-app2&lt;&#x2F;h1&gt;  &lt;!--ä½¿ç”¨å±€éƒ¨ç»„ä»¶ --&gt;  &lt;hsp_counter&gt;&lt;&#x2F;hsp_counter&gt;  &lt;br&#x2F;&gt;  &lt;hsp_counter&gt;&lt;&#x2F;hsp_counter&gt;  &lt;br&#x2F;&gt;&lt;&#x2F;div&gt;&lt;script src&#x3D;&quot;vue.js&quot;&gt;&lt;&#x2F;script&gt;&lt;script&gt;  &#x2F;&#x2F;å®šä¹‰ä¸€ä¸ªç»„ä»¶, ç»„ä»¶çš„åç§°ä¸º buttonCounter  &#x2F;&#x2F;è€éŸ©æ‰©å±•  &#x2F;&#x2F;1. å¯ä»¥æŠŠå¸¸ç”¨çš„ç»„ä»¶ï¼Œå®šä¹‰åœ¨æŸä¸ªcommons.jsä¸­ export  &#x2F;&#x2F;2. å¦‚æœæŸä¸ªé¡µé¢éœ€è¦ä½¿ç”¨ï¼Œ ç›´æ¥import  const buttonCounter &#x3D; &#123;    template: &#96;&lt;button v-on:click&#x3D;&quot;click()&quot;&gt;ç‚¹å‡»æ¬¡æ•°&#x3D; &#123;&#123;count&#125;&#125; æ¬¡ã€å±€éƒ¨ç»„ä»¶åŒ–ã€‘&lt;&#x2F;button&gt;&#96;,    data() &#123;&#x2F;&#x2F;è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå’ŒåŸæ¥çš„æ–¹å¼ä¸ä¸€æ ·!!!!      return &#123;        count: 10      &#125;    &#125;,    methods: &#123;      click() &#123;        this.count++;      &#125;    &#125;  &#125;  &#x2F;&#x2F;åˆ›å»ºVueå®ä¾‹ï¼Œå¿…é¡»æœ‰  let vm &#x3D; new Vue(&#123;    el: &quot;#app&quot;,&#x2F;&#x2F;Vueå®ä¾‹çš„æŒ‚è½½ç‚¹    components: &#123; &#x2F;&#x2F;å¼•å…¥&#x2F;æ³¨å†ŒæŸä¸ªç»„ä»¶, æ­¤æ—¶my_counterå°±æ˜¯ä¸€ä¸ªç»„ä»¶, æ˜¯ä¸€ä¸ªå±€éƒ¨ç»„ä»¶,ä»–çš„ä½¿ç”¨èŒƒå›´åœ¨å½“å‰vue      &#39;my_counter&#39;: buttonCounter    &#125;  &#125;)  let vm2 &#x3D; new Vue(&#123;    el: &quot;#app2&quot;,&#x2F;&#x2F;Vueå®ä¾‹çš„æŒ‚è½½ç‚¹    components: &#123;&#x2F;&#x2F;å¼•å…¥&#x2F;æ³¨å†Œç»„ä»¶buttonCounter      &#39;hsp_counter&#39;: buttonCounter    &#125;  &#125;)&lt;&#x2F;script&gt;&lt;&#x2F;body&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç”Ÿå‘½å‘¨æœŸå’Œç›‘å¬å‡½æ•°-é’©å­å‡½æ•°"><a href="#ç”Ÿå‘½å‘¨æœŸå’Œç›‘å¬å‡½æ•°-é’©å­å‡½æ•°" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸå’Œç›‘å¬å‡½æ•°(é’©å­å‡½æ•°)"></a>ç”Ÿå‘½å‘¨æœŸå’Œç›‘å¬å‡½æ•°(é’©å­å‡½æ•°)</h2><h3 id="åŸºæœ¬è¯´æ˜-1"><a href="#åŸºæœ¬è¯´æ˜-1" class="headerlink" title="åŸºæœ¬è¯´æ˜"></a>åŸºæœ¬è¯´æ˜</h3><p>1.Vueå®ä¾‹æœ‰ä¸€ä¸ªå®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸ,ä¹Ÿå°±æ˜¯è¯´ä»å¼€å§‹åˆ›å»º,åˆå§‹åŒ–æ•°æ®,ç¼–è¯‘æ¨¡æ¿,æŒ‚è½½DOM,æ¸²æŸ“-æ›´æ–°-æ¸²æŸ“,å¸è½½ç­‰ä¸€ç³»åˆ—è¿‡ç¨‹<br>2.é’©å­å‡½æ•°(ç›‘å¬å‡½æ•°): Vue å®ä¾‹åœ¨å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ä¸­(æ¯”å¦‚è®¾ç½®æ•°æ®ç›‘å¬ã€ç¼–è¯‘æ¨¡æ¿ã€å°†å®ä¾‹æŒ‚è½½åˆ° DOM ã€åœ¨æ•°æ®å˜åŒ–æ—¶æ›´æ–° DOM<br>ç­‰),<br>ä¹Ÿä¼šè¿è¡Œå«åšç”Ÿå‘½å‘¨æœŸé’©å­çš„å‡½æ•°ã€‚<br>3.é’©å­å‡½æ•°çš„ ä½œç”¨å°±æ˜¯åœ¨æŸä¸ªé˜¶æ®µ, ç»™ç¨‹åºå‘˜ä¸€ä¸ªåšæŸäº›å¤„ç†çš„æœºä¼š</p><h3 id="ä¸€å›¾èƒœåƒè¨€"><a href="#ä¸€å›¾èƒœåƒè¨€" class="headerlink" title="ä¸€å›¾èƒœåƒè¨€"></a>ä¸€å›¾èƒœåƒè¨€</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/7caac0ab30865c9307c95a4f81289af6.png"></div></div><p>1.new Vue()<br>new äº†ä¸€ä¸ª Vue çš„å®ä¾‹å¯¹è±¡ï¼Œæ­¤æ—¶å°±ä¼šè¿›å…¥ç»„ä»¶çš„åˆ›å»ºè¿‡ç¨‹<br>2.beforeCreate<br>ç»„ä»¶åˆ›å»ºä¹‹åé‡åˆ°çš„ç¬¬ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œè¿™ä¸ªé˜¶æ®µ data å’Œ methods ä»¥åŠdomç»“æ„éƒ½æœªè¢«åˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯è·å–ä¸åˆ° data çš„å€¼ï¼Œ<br>ä¸èƒ½è°ƒç”¨ methods ä¸­çš„å‡½<br>3.created<br>è¿™ä¸ªé˜¶æ®µç»„ä»¶çš„ data å’Œ methods ä¸­çš„æ–¹æ³•å·²åˆå§‹åŒ–ç»“æŸï¼Œå¯ä»¥è®¿é—®ï¼Œä½†æ˜¯ dom ç»“æ„æœªåˆå§‹åŒ–ï¼Œé¡µé¢æœªæ¸²æŸ“<br>è¯´æ˜ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œç»å¸¸ä¼šå‘èµ· Ajax è¯·æ±‚<br>4.beforeMount<br>å½“æ¨¡æ¿åœ¨å†…å­˜ä¸­ç¼–è¯‘å®Œæˆï¼Œæ­¤æ—¶å†…å­˜ä¸­çš„æ¨¡æ¿ç»“æ„è¿˜æœªæ¸²æŸ“è‡³é¡µé¢ä¸Šï¼Œçœ‹ä¸åˆ°çœŸå®çš„æ•°æ®<br>5.mounted<br>æ­¤æ—¶ï¼Œé¡µé¢æ¸²æŸ“å¥½ï¼Œç”¨æˆ·çœ‹åˆ°çš„æ˜¯çœŸå®çš„é¡µé¢æ•°æ®ï¼Œ ç”Ÿå‘½å‘¨æœŸåˆ›å»ºé˜¶æ®µå®Œæ¯•ï¼Œè¿›å…¥åˆ°äº†è¿è¡Œä¸­çš„é˜¶æ®µ<br>6.beforeUpdate<br>å½“æ‰§è¡Œæ­¤å‡½æ•°ï¼Œæ•°æ®æ± çš„æ•°æ®æ–°çš„ï¼Œä½†æ˜¯é¡µé¢æ˜¯æ—§<br>7.updated<br>é¡µé¢å·²ç»å®Œæˆäº†æ›´æ–°ï¼Œæ­¤æ—¶ï¼Œdata æ•°æ®å’Œé¡µé¢çš„æ•°æ®éƒ½æ˜¯æ–°çš„</p><h2 id="Vue2è„šæ‰‹æ¶æ¨¡å—åŒ–å¼€å‘"><a href="#Vue2è„šæ‰‹æ¶æ¨¡å—åŒ–å¼€å‘" class="headerlink" title="Vue2è„šæ‰‹æ¶æ¨¡å—åŒ–å¼€å‘"></a>Vue2è„šæ‰‹æ¶æ¨¡å—åŒ–å¼€å‘</h2><h3 id="ä¸ºä»€ä¹ˆéœ€è¦-Vue-Cli-è„šæ‰‹æ¶"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-Vue-Cli-è„šæ‰‹æ¶" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ Vue Cli è„šæ‰‹æ¶"></a>ä¸ºä»€ä¹ˆéœ€è¦ Vue Cli è„šæ‰‹æ¶</h3><p>Â·å¼€å‘æ•ˆç‡ä½<br>Â·ä¸å¤Ÿè§„èŒƒ<br>Â·ç»´æŠ¤å’Œå‡çº§, å¯è¯»æ€§æ¯”è¾ƒå·®</p><h3 id="Vueé¡¹ç›®ç»“æœåˆ†æ"><a href="#Vueé¡¹ç›®ç»“æœåˆ†æ" class="headerlink" title="Vueé¡¹ç›®ç»“æœåˆ†æ"></a>Vueé¡¹ç›®ç»“æœåˆ†æ</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/0b8f221e94cb4845d5760dd747e42332.png"></div></div><h2 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h2><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;script&gt;new Vue(&#123;  el: &quot;#app&quot;,  data: &#123;    msg: &quot;å¦–æ€ªä¿¡æ¯åˆ—è¡¨&quot;,    monsterList: [] &#x2F;&#x2F;è¡¨ç¤ºå¦–æ€ªçš„ä¿¡æ¯æ•°ç»„  &#125;,  methods: &#123;&#x2F;&#x2F;è‡ªå®šä¹‰æ–¹æ³•    list() &#123;&#x2F;&#x2F;å‘é€ajaxè¯·æ±‚,è·å–æ•°æ® axios      &#x2F;*          è§£è¯»          1. axios.get() è¡¨ç¤ºå‘å‡ºajaxè¯·æ±‚          2. http:&#x2F;&#x2F;localhost:63342&#x2F;axios&#x2F;data&#x2F;response.data.json è¡¨ç¤ºè¯·æ±‚çš„url             è¦æ ¹æ®å®é™…æƒ…å†µæ¥å¡«å†™          3. axioså‘å‡ºajaxè¯·æ±‚çš„åŸºæœ¬è¯­æ³•             axios.get(url).then(ç®­å¤´å‡½æ•°).then(ç®­å¤´å‡½æ•°)...catch(ç®­å¤´å‡½æ•°)             (1) å¦‚æœgetè¯·æ±‚æˆåŠŸå°±è¿›å…¥åˆ°ç¬¬ä¸€ä¸ªthen()             (2) å¯ä»¥å† ç¬¬ä¸€ä¸ªthen()ä¸­ç»§ç»­å‘å‡ºaxiosçš„ajaxè¯·æ±‚             (3) å¦‚æœæœ‰å¼‚å¸¸, ä¼šè¿›å…¥åˆ° catch(ç®­å¤´å‡½æ•°)          4. liståœ¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°created() ä¸­è°ƒç”¨-è‡ªå·±å»å›é¡¾vueçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°       *&#x2F;      axios.get(&quot;http:&#x2F;&#x2F;localhost:63342&#x2F;axios&#x2F;data&#x2F;response.data.json&quot;)          .then(responseData &#x3D;&gt; &#123;            console.log(&quot;responseData&#x3D; &quot;, responseData)            &#x2F;&#x2F;ä½¿ç”¨JSON.stringify(json) æŠŠjsonå¯¹è±¡è½¬æˆä¸€ä¸ªå­—ç¬¦ä¸²,æ–¹ä¾¿è§‚å¯Ÿ            console.log(&quot;responseData&#x3D; &quot;, JSON.stringify(responseData));            &#x2F;&#x2F; console.log(&quot;responseData.data&#x3D; &quot;, responseData.data)            &#x2F;&#x2F; console.log(&quot;responseData.data.data&#x3D; &quot;, responseData.data.data)            console.log(&quot;responseData.data.data.item&#x3D; &quot;, responseData.data.data.items)            &#x2F;&#x2F;å°†å¦–æ€ªåˆ—è¡¨æ•°ç»„ä¿¡æ¯, ç»‘å®šåˆ° dataæ•°æ®æ± çš„ monsterList            &#x2F;&#x2F;è€å¸ˆå°æŠ€å·§ï¼Œä¸€å®šè¦å­¦ä¼šçœ‹è¿”å›çš„æ•°æ®æ ¼å¼!!!            this.monsterList &#x3D; responseData.data.data.items;            &#x2F;&#x2F;å¯ä»¥å†æ¬¡å‘å‡ºajaxè¯·æ±‚, è€å¸ˆæ•…æ„å‘å‡ºäº†ç¬¬äºŒæ¬¡ajaxè¯·æ±‚ï¼Œ å›é¡¾è€å¸ˆè®²è¿‡çš„promiseå‘å‡ºå¤šæ¬¡è¯·æ±‚            &#x2F;&#x2F; return axios.get(&quot;http:&#x2F;&#x2F;localhost:63342&#x2F;axios&#x2F;data&#x2F;response.data.json&quot;)          &#125;)          &#x2F;&#x2F; .then(responseData &#x3D;&gt; &#123;          &#x2F;&#x2F;     console.log(&quot;ç¬¬äºŒæ¬¡axioså‘å‡º ajaxè¯·æ±‚responseData&#x3D; &quot;, responseData)          &#x2F;&#x2F; &#125;)          .catch(err &#x3D;&gt; &#123;            console.log(&quot;å¼‚å¸¸&#x3D;&quot;, err)          &#125;)    &#125;  &#125;,  created() &#123;    this.list();  &#125;&#125;)&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title&gt;&lt;/a&gt;&lt;div class=&quot;note purple no-icon flat&quot;&gt;&lt;p&gt;Vue2å¤ä¹ andé¢„ä¹  &lt;/p&gt;
&lt;/div&gt;&lt;/h1&gt;&lt;h2 id=&quot;VUEçš„MVVM&quot;&gt;&lt;a hr</summary>
      
    
    
    
    <category term="Vueæ¡†æ¶" scheme="https://100qin10086.github.io/categories/Vue%E6%A1%86%E6%9E%B6/"/>
    
    
    <category term="VUE" scheme="https://100qin10086.github.io/tags/VUE/"/>
    
  </entry>
  
  <entry>
    <title>javaWebå¤ä¹ 6</title>
    <link href="https://100qin10086.github.io/posts/b1a728b5.html"/>
    <id>https://100qin10086.github.io/posts/b1a728b5.html</id>
    <published>2024-03-19T03:25:47.000Z</published>
    <updated>2024-05-06T14:13:59.610Z</updated>
    
    <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a><div class="note purple no-icon flat"><p>javaWebå¤ä¹  </p></div></h1><h2 id="æ•°æ®äº¤æ¢å’Œå¼‚æ­¥è¯·æ±‚-JSON-amp-Ajax"><a href="#æ•°æ®äº¤æ¢å’Œå¼‚æ­¥è¯·æ±‚-JSON-amp-Ajax" class="headerlink" title="æ•°æ®äº¤æ¢å’Œå¼‚æ­¥è¯·æ±‚ -JSON &amp; Ajax"></a>æ•°æ®äº¤æ¢å’Œå¼‚æ­¥è¯·æ±‚ -JSON &amp; Ajax</h2><h3 id="JSONä»‹ç»"><a href="#JSONä»‹ç»" class="headerlink" title="JSONä»‹ç»"></a>JSONä»‹ç»</h3><p>1.JSONæŒ‡åœ°æ˜¯JavaScriptå¯¹è±¡è¡¨ç¤ºæ³•<br>2.JSONæ˜¯è½»é‡çº§åœ°æ–‡æœ¬æ•°æ®äº¤æ¢æ ¼å¼<br>3.JSONç‹¬ç«‹äºè¯­è¨€<br>4.JSONå…·æœ‰è‡ªæˆ‘æè¿°æ€§</p><h3 id="JSONå¿«é€Ÿå…¥é—¨"><a href="#JSONå¿«é€Ÿå…¥é—¨" class="headerlink" title="JSONå¿«é€Ÿå…¥é—¨"></a>JSONå¿«é€Ÿå…¥é—¨</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> myJson <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string-property property">"key1"</span><span class="token operator">:</span> <span class="token string">"éŸ©é¡ºå¹³æ•™è‚²"</span><span class="token punctuation">,</span> <span class="token comment">// å­—ç¬¦ä¸²</span>    <span class="token string-property property">"key2"</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token comment">// Number "key3":[1,"hello", 2.3], // æ•°ç»„</span>    <span class="token string-property property">"key4"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string-property property">"age"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"jack"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">//json å¯¹è±¡</span>    <span class="token string-property property">"key5"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">//json æ•°ç»„</span>        <span class="token punctuation">&#123;</span><span class="token string-property property">"k1"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string-property property">"k2"</span><span class="token operator">:</span> <span class="token string">"milan"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span><span class="token string-property property">"k3"</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string-property property">"k4"</span><span class="token operator">:</span> <span class="token string">"smith"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>1.æ˜ å°„åœ°é›†åˆ(å¯¹è±¡)ç”¨å¤§æ‹¬å·{}è¡¨ç¤ºã€‚<br>2.å¹¶åˆ—åœ°æ•°æ®åœ°é›†åˆ(æ•°ç»„)ç”¨æ–¹æ‹¬å·[]è¡¨ç¤º</p><h3 id="JSONå¯¹è±¡å’Œå­—ç¬¦ä¸²å¯¹è±¡è½¬æ¢"><a href="#JSONå¯¹è±¡å’Œå­—ç¬¦ä¸²å¯¹è±¡è½¬æ¢" class="headerlink" title="JSONå¯¹è±¡å’Œå­—ç¬¦ä¸²å¯¹è±¡è½¬æ¢"></a>JSONå¯¹è±¡å’Œå­—ç¬¦ä¸²å¯¹è±¡è½¬æ¢</h3><p>1.JSON.stringify(json)åŠŸèƒ½:å°†ä¸€ä¸ªjsonå¯¹è±¡è½¬æ¢æˆä¸ºjsonå­—ç¬¦ä¸²<br>2.JSON.parse(jsonString)åŠŸèƒ½:å°†ä¸€ä¸ªjsonå­—ç¬¦ä¸²è½¬æ¢ä¸ºjsonå¯¹è±¡</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">        <span class="token keyword">var</span> jsonObj <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"ç§¦å›½å¼º"</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>jsonObj<span class="token punctuation">)</span>        <span class="token keyword">var</span> jsonStr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>jsonObj<span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">)</span>        <span class="token keyword">var</span> jsonObj2 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>jsonObj2<span class="token punctuation">)</span><span class="token punctuation">;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>// Object &#123; name: "ç§¦å›½å¼º", age: 10 &#125;//&#123;"name":"ç§¦å›½å¼º","age":10&#125;// Object &#123; name: "ç§¦å›½å¼º", age: 10 &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="JSONåœ¨Javaä¸­çš„ä½¿ç”¨"><a href="#JSONåœ¨Javaä¸­çš„ä½¿ç”¨" class="headerlink" title="JSONåœ¨Javaä¸­çš„ä½¿ç”¨"></a>JSONåœ¨Javaä¸­çš„ä½¿ç”¨</h3><h4 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h4><p>1.java ä¸­ä½¿ç”¨ jsonï¼Œéœ€è¦å¼•å…¥åˆ°ç¬¬ 3 æ–¹çš„åŒ… gson.jarã€‚<br>2.Gson æ˜¯ Google æä¾›çš„ç”¨æ¥åœ¨ Java å¯¹è±¡å’Œ JSON æ•°æ®ä¹‹é—´è¿›è¡Œæ˜ å°„çš„ Java ç±»åº“ã€‚<br>3.å¯ä»¥å¯¹ JSON å­—ç¬¦ä¸² å’Œ Java å¯¹è±¡ç›¸äº’è½¬æ¢</p><h4 id="JSONåœ¨Javaä¸­åº”ç”¨åœºæ™¯"><a href="#JSONåœ¨Javaä¸­åº”ç”¨åœºæ™¯" class="headerlink" title="JSONåœ¨Javaä¸­åº”ç”¨åœºæ™¯"></a>JSONåœ¨Javaä¸­åº”ç”¨åœºæ™¯</h4><p>1.JavaBeanå¯¹è±¡å’Œjsonå­—ç¬¦ä¸²åœ°è½¬æ¢<br>2.Listå¯¹è±¡å’Œjsonå­—ç¬¦ä¸²åœ°è½¬æ¢<br>3.mapå¯¹è±¡å’Œjsonå­—ç¬¦ä¸²åœ°è½¬æ¢</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Gson</span> gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Book</span> book <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"è¥¿æ¸¸è®°"</span><span class="token punctuation">)</span><span class="token class-name">String</span> bookStr <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bookStr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Book</span> book2 <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>bookStr<span class="token punctuation">,</span> <span class="token class-name">Book</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>book2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//List é›†åˆå’Œ json çš„è½¬æ¢</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">></span></span> bookList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>bookList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"å¤©é¾™å…«éƒ¨"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>bookList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token string">"ç¥é›•ä¾ ä¾£"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å°† list è½¬æˆ json å­—ç¬¦ä¸²</span><span class="token class-name">String</span> bookListStr <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>bookList<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å°† json å­—ç¬¦ä¸²è½¬æˆ List é›†åˆæ–¹å¼ 2- ä½¿ç”¨ åŒ¿åå†…éƒ¨ç±»</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">></span></span> bookList3 <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>bookListStr<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TypeToken</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">></span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3. map é›†åˆå’Œ json çš„è½¬æ¢</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\n====3. map é›†åˆå’Œ json çš„è½¬æ¢====="</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Book</span><span class="token punctuation">></span></span> bookMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>bookMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"sn1"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">"å°„é›•è‹±é›„ä¼ "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>bookMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"sn2"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">"ç¢§è¡€å‰‘"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æŠŠ map è½¬æ¢æˆä¸º json</span><span class="token class-name">String</span> bookMapStr <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>bookMap<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Book</span><span class="token punctuation">></span></span> bookMap2 <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>bookMapStr<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TypeToken</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HashMap</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Book</span><span class="token punctuation">></span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h2><h3 id="AjaxåŸºæœ¬ä»‹ç»"><a href="#AjaxåŸºæœ¬ä»‹ç»" class="headerlink" title="AjaxåŸºæœ¬ä»‹ç»"></a>AjaxåŸºæœ¬ä»‹ç»</h3><p>1.Ajaxæ˜¯ä¸€ç§æµè§ˆå™¨å¼‚æ­¥å‘èµ·è¯·æ±‚(æŒ‡å®šå‘é‚£äº›æ•°æ®),å±€éƒ¨æ›´æ–°é¡µé¢åœ°æŠ€æœ¯</p><h3 id="åŸç†ç¤ºæ„å›¾"><a href="#åŸç†ç¤ºæ„å›¾" class="headerlink" title="åŸç†ç¤ºæ„å›¾"></a>åŸç†ç¤ºæ„å›¾</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1710844435346.jpg"></div></div><h3 id="javascriptåŸç”ŸAjaxè¯·æ±‚"><a href="#javascriptåŸç”ŸAjaxè¯·æ±‚" class="headerlink" title="javascriptåŸç”ŸAjaxè¯·æ±‚"></a>javascriptåŸç”ŸAjaxè¯·æ±‚</h3><p>1.åˆ›å»ºXMLHttpRequestå¯¹è±¡ã€ajaxå¼•æ“å¯¹è±¡ã€‘<br>2.é€šè¿‡XMLHttpRequestå¯¹è±¡å‘é€æŒ‡å®šæ•°æ®(å¼‚æ­¥)<br>3.XMLHttpRequestæŒ‡å®šå½“æ•°æ®è¿”å›æ—¶,ç”±é‚£ä¸ªå‡½æ•°æ¥å¤„ç†<br>4.å¾—åˆ°è¿”å›æ•°æ®å,å¯ä»¥è¿›è¡Œdomæ“ä½œ,å®Œæˆå±€éƒ¨åˆ·æ–°/é¡µé¢/æ•°æ®<br>5.åŸç”ŸAjaxä»£ç æ¼”ç¤º<br>Â·å…³é”®åœ°å‡ æ­¥<br>Â·åˆ›å»ºXMLHttpRequest<br>Â·xmlHttpRequest.open(â€œmethodâ€,â€urlâ€,â€true/falseâ€)<br>Â·xmlHttpRequest.onreadystatechange=function(){},å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶,ä¼šè°ƒç”¨è¯¥æ–¹æ³•<br>Â·xmlHttpRequest.send()çœŸæ­£çš„å‘é€ajaxè¯·æ±‚[httpè¯·æ±‚]<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">        window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//é¡µé¢åŠ è½½åæ‰§è¡Œfunction</span>            <span class="token keyword">var</span> checkButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"checkButton"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//ç»™checkButtonç»‘å®šonclick</span>            checkButton<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">//1. åˆ›å»ºXMLHttpRequestå¯¹è±¡(!!!) [ajaxå¼•æ“å¯¹è±¡]</span>                <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//   è·å–ç”¨æˆ·å¡«å†™çš„ç”¨æˆ·å</span>                <span class="token keyword">var</span> uname <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"uname"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>                <span class="token comment">//2. å‡†å¤‡å‘é€æŒ‡å®šæ•°æ® open, send</span>                <span class="token comment">//è€éŸ©è§£è¯»</span>                <span class="token comment">//(1)"GET" è¯·æ±‚æ–¹å¼å¯ä»¥ GET/POST</span>                <span class="token comment">//(2)"/ajax/checkUserServlet?username=" + uname å°±æ˜¯ url</span>                <span class="token comment">//(3)true , è¡¨ç¤ºå¼‚æ­¥å‘é€</span>                xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"/ajax/checkUserServlet?uname="</span> <span class="token operator">+</span> uname<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//è€å¸ˆè¯´æ˜ï¼Œåœ¨sendå‡½æ•°è°ƒç”¨å‰ï¼Œç»™XMLHttpRequest ç»‘å®šä¸€ä¸ªäº‹ä»¶onreadystatechange</span>                <span class="token comment">//è¯¥äº‹ä»¶è¡¨ç¤ºï¼Œå¯ä»¥å»æŒ‡å®šä¸€ä¸ªå‡½æ•°ï¼Œå½“æ•°æ®å˜åŒ–ï¼Œä¼šè§¦å‘onreadystatechange</span>                <span class="token comment">// æ¯å½“ xhrå¯¹è±¡readyState æ”¹å˜æ—¶ï¼Œå°±ä¼šè§¦å‘ onreadystatechange äº‹ä»¶</span>                xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">//å¦‚æœè¯·æ±‚å·²å®Œæˆï¼Œä¸”å“åº”å·²å°±ç»ª, å¹¶ä¸”çŠ¶æ€ç æ˜¯200</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token comment">//æŠŠè¿”å›çš„jonæ•°æ®,æ˜¾ç¤ºåœ¨div</span>                        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"div1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>                        <span class="token comment">//console.log("xhr=", xhr)</span>                        <span class="token keyword">var</span> responseText <span class="token operator">=</span> xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>                        <span class="token comment">//console.log("è¿”å›çš„ä¿¡æ¯=" + responseText);</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>responseText <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"myres"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">"ç”¨æˆ·åä¸å¯ç”¨"</span>                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                            document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"myres"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">"ç”¨æˆ·åå¯ç”¨"</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>                <span class="token comment">//3. çœŸæ­£çš„å‘é€ajaxè¯·æ±‚[httpè¯·æ±‚]</span>                <span class="token comment">// å†è¯´æ˜å¦‚æœä½ POST è¯·æ±‚ï¼Œå†send("å‘é€çš„æ•°æ®")</span>                xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="åŸç”ŸAjaxè¯·æ±‚é—®é¢˜åˆ†æ"><a href="#åŸç”ŸAjaxè¯·æ±‚é—®é¢˜åˆ†æ" class="headerlink" title="åŸç”ŸAjaxè¯·æ±‚é—®é¢˜åˆ†æ"></a>åŸç”ŸAjaxè¯·æ±‚é—®é¢˜åˆ†æ</h3><p>1.ç¼–å†™åŸç”Ÿçš„Ajaxè¦å†™å¾ˆå¤šçš„ä»£ç ,è¿˜è¦è€ƒè™‘æµè§ˆå™¨å…¼å®¹é—®é¢˜,ä½¿ç”¨å¾ˆä¸æ–¹ä¾¿<br>2.åœ¨å®é™…å·¥ä½œä¸­,ä¸€èˆ¬ä½¿ç”¨JavaScriptçš„åº“å‘é€Ajaxè¯·æ±‚,ä»è€Œè§£å†³è¿™ä¸ªé—®é¢˜</p><h3 id="JQueryçš„Ajaxè¯·æ±‚-ä»£ç æ¼”ç¤º"><a href="#JQueryçš„Ajaxè¯·æ±‚-ä»£ç æ¼”ç¤º" class="headerlink" title="JQueryçš„Ajaxè¯·æ±‚-ä»£ç æ¼”ç¤º"></a>JQueryçš„Ajaxè¯·æ±‚-ä»£ç æ¼”ç¤º</h3><p>Â·è§£è¯»<br>1.æŒ‡å®šå‚æ•°æ—¶,éœ€è¦åœ¨{}<br>2.ç»™å‚æ•°æ—¶,å‰é¢éœ€è¦æŒ‡å®šå‚æ•°å<br>3.dataType: â€œjsonâ€ è¦æ±‚æœåŠ¡å™¨è¿”å›çš„æ•°æ®æ ¼å¼æ˜¯json/text<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#btn1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"/xxxxx"</span><span class="token punctuation">,</span>            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>            <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span>            <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#uname"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"å¤±è´¥"</span><span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span>status<span class="token punctuation">,</span>xhr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"data="</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"status="</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"xhr="</span><span class="token punctuation">,</span> xhr<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#div1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//å¯¹è¿”å›çš„ç»“æœè¿›è¡Œå¤„ç†</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">""</span> <span class="token operator">==</span> data<span class="token punctuation">.</span>username<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#myres"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token string">"è¯¥ç”¨æˆ·åå¯ç”¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#myres"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token string">"è¯¥ç”¨æˆ·åä¸å¯ç”¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="çº¿ç¨‹æ•°æ®å…±äº«å’Œå®‰å…¨-ThreadLocal"><a href="#çº¿ç¨‹æ•°æ®å…±äº«å’Œå®‰å…¨-ThreadLocal" class="headerlink" title="çº¿ç¨‹æ•°æ®å…±äº«å’Œå®‰å…¨-ThreadLocal"></a>çº¿ç¨‹æ•°æ®å…±äº«å’Œå®‰å…¨-ThreadLocal</h2><h3 id="ä»€ä¹ˆæ˜¯ThreadLocal"><a href="#ä»€ä¹ˆæ˜¯ThreadLocal" class="headerlink" title="ä»€ä¹ˆæ˜¯ThreadLocal"></a>ä»€ä¹ˆæ˜¯ThreadLocal</h3><p>1.ThreadLocalçš„ä½œç”¨,å¯ä»¥å®ç°åœ¨åŒä¸€ä¸ªçº¿ç¨‹æ•°æ®å…±äº«,ä»è€Œè§£å†³å¤šçº¿ç¨‹æ•°æ®å®‰å…¨é—®é¢˜ã€‚<br>2.ThreadLocalå¯ä»¥ç»™å½“å‰çº¿ç¨‹å…³è”ä¸€ä¸ªæ•°æ®(æ™®é€šå˜é‡,å¯¹è±¡,æ•°ç»„)setæ–¹æ³•<br>3.ThreadLocalå¯ä»¥åƒMapä¸€æ ·å­˜å–æ•°æ®,keyæ˜¯å½“å‰çº¿ç¨‹,getæ–¹æ³•<br>4.æ¯ä¸€ä¸ªThreadLocalå¯¹è±¡,åªèƒ½ä¸ºå½“å‰çº¿ç¨‹å…³è”ä¸€ä¸ªæ•°æ®,å¦‚æœè¦ä¸ºå½“å‰çº¿ç¨‹å…³è”å¤šä¸ªæ•°æ®,å°±éœ€è¦ä½¿ç”¨å¤šä¸ªThreadLocalå¯¹è±¡å®ä¾‹ã€‚<br>5.æ¯ä¸ªThreadLocalå¯¹è±¡å®ä¾‹å®šä¹‰çš„æ—¶å€™,ä¸€èˆ¬ä¸ºstaticç±»å‹<br>6.ThreadLocalä¸­ä¿å­˜æ•°æ®,åœ¨çº¿ç¨‹é”€æ¯å,ä¼šè‡ªåŠ¨é‡Šæ”¾ã€‚</p><h3 id="æºç è§£è¯»"><a href="#æºç è§£è¯»" class="headerlink" title="æºç è§£è¯»"></a>æºç è§£è¯»</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//setæ–¹æ³•çš„æºç </span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1.è·å–å½“å‰çº¿ç¨‹,å…³è”åˆ°å½“å‰çº¿ç¨‹</span>        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.é€šè¿‡çº¿ç¨‹å¯¹è±¡,è·å–åˆ°ThreadLocalMap</span>        <span class="token comment">//ThreadLocalMap ç±»å‹ThreadLocal.ThreadLocalMap</span>        <span class="token class-name">ThreadLocalMap</span> map <span class="token operator">=</span> <span class="token function">getMap</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>        <span class="token comment">//3.å¦‚æœmapä¸ä¸ºnull,å°†æ•°æ®(dogï¼Œpig..)æ”¾å…¥map-key:threadLocal value:å­˜æ”¾çš„æ•°æ®</span>        <span class="token comment">//  ä»è¿™ä¸ªæºç æˆ‘ä»¬çœ‹å‡ºä¸€ä¸ªthreadlocalåªèƒ½å…³è”ä¸€ä¸ªæ•°æ®</span>        <span class="token comment">//4.å¦‚æœmapä¸ºnull,å°±åˆ›å»ºä¸€ä¸ªå’Œå½“å‰çº¿ç¨‹å…³è”çš„ThreadLocalMap,å¹¶ä¸”è¯¥æ•°æ®æ”¾å…¥</span>            map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">else</span>            <span class="token function">createMap</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">//getæ–¹æ³•çš„æºç </span><span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//1.è·å–å½“å‰çº¿ç¨‹,å…³è”åˆ°å½“å‰çº¿ç¨‹</span>        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//é€šè¿‡çº¿ç¨‹è·å–åˆ°å¯¹åº”çš„ThreadLocalMap</span>        <span class="token class-name">ThreadLocalMap</span> map <span class="token operator">=</span> <span class="token function">getMap</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//3.å¦‚æœmapä¸ä¸ºç©º,å°±æ ¹æ®å½“å‰çš„ThreadLocalå¯¹è±¡,å¾—åˆ°å¯¹åº”çš„Entry</span>            <span class="token class-name">ThreadLocalMap<span class="token punctuation">.</span>Entry</span> e <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//4.å¦‚æœeä¸ä¸ºç©º</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>                <span class="token comment">//è¿”å›å½“å‰ThreadLocalå¯¹åº”çš„value</span>                <span class="token class-name">T</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span>e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>                <span class="token keyword">return</span> result<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token function">setInitialValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ–‡ä»¶çš„ä¸Šä¼ ä¸‹è½½"><a href="#æ–‡ä»¶çš„ä¸Šä¼ ä¸‹è½½" class="headerlink" title="æ–‡ä»¶çš„ä¸Šä¼ ä¸‹è½½"></a>æ–‡ä»¶çš„ä¸Šä¼ ä¸‹è½½</h2><h3 id="æ–‡ä»¶ä¸Šä¼ æ³¨æ„"><a href="#æ–‡ä»¶ä¸Šä¼ æ³¨æ„" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ³¨æ„"></a>æ–‡ä»¶ä¸Šä¼ æ³¨æ„</h3><p>1.æ–‡ä»¶ä¸Šä¼ è¿˜æ˜¯æŒ‰ç…§è¡¨å•æäº¤<br>2.actionè¿˜æ˜¯ä¸å˜<br>3.methodæŒ‡å®šä¸ºpost<br>4.enctype:enctypeç¼–ç ç±»å‹é»˜è®¤æ˜¯application/x-www-urlencodedå³urlç¼–ç ,è¿™ç§ç¼–ç ä¸é€‚ç”¨äºŒè¿›åˆ¶æ–‡ä»¶æ•°æ®çš„æäº¤,ä¸€èˆ¬é€‚ç”¨æ–‡æœ¬<br>5.å¦‚æœè¦æäº¤äºŒè¿›åˆ¶æ–‡ä»¶enctypeè¦æŒ‡å®šmultipart/form-data<br>Â·åç«¯ä»£ç éƒ¨åˆ†<br>1.é¦–å…ˆç”¨ServletFileUpload.isMultipartContenté€šè¿‡ä¼ å…¥çš„requeståˆ¤æ–­ä¼ å…¥çš„æ˜¯ä¸æ˜¯æ–‡ä»¶è¡¨å•<br>2.ç„¶ååˆ›å»ºDiskFileItemFactoryå¯¹è±¡,ç”¨äºæ„å»ºä¸€ä¸ªè§£æä¸Šä¼ æ•°æ®çš„å·¥å…·å¯¹è±¡<br>3.ServletFileUpload servletFileUpload = new ServletFileUpload(diskFileItemFactory);<br>4.é€šè¿‡servletFileUpload.parseRequest(request)å¾—åˆ°ä¼ å…¥çš„å¯¹è±¡<br>5.æ‰¾ç›®å½•,ä¿®æ”¹æ–‡ä»¶åæœ€åä¿å­˜<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileUploadServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//System.out.println("FileUploadServlet è¢«è°ƒç”¨...");</span>        <span class="token comment">//1. åˆ¤æ–­æ˜¯ä¸æ˜¯æ–‡ä»¶è¡¨å•(enctype="multipart/form-data")</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ServletFileUpload</span><span class="token punctuation">.</span><span class="token function">isMultipartContent</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//System.out.println("OK");</span>            <span class="token comment">//2. åˆ›å»º DiskFileItemFactory å¯¹è±¡, ç”¨äºæ„å»ºä¸€ä¸ªè§£æä¸Šä¼ æ•°æ®çš„å·¥å…·å¯¹è±¡</span>            <span class="token class-name">DiskFileItemFactory</span> diskFileItemFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DiskFileItemFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//3. åˆ›å»ºä¸€ä¸ªè§£æä¸Šä¼ æ•°æ®çš„å·¥å…·å¯¹è±¡</span>            <span class="token comment">/**             *     è¡¨å•æäº¤çš„æ•°æ®å°±æ˜¯ input å…ƒç´              *     &lt;input type="file" name="pic" id="" value="2xxx.jpg" onchange="prev(this)"/>             *     å®¶å±…å: &lt;input type="text" name="name">&lt;br/>             *     &lt;input type="submit" value="ä¸Šä¼ "/>             */</span>            <span class="token class-name">ServletFileUpload</span> servletFileUpload <span class="token operator">=</span>                    <span class="token keyword">new</span> <span class="token class-name">ServletFileUpload</span><span class="token punctuation">(</span>diskFileItemFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//è§£å†³æ¥æ”¶åˆ°æ–‡ä»¶åæ˜¯ä¸­æ–‡ä¹±ç é—®é¢˜</span>            servletFileUpload<span class="token punctuation">.</span><span class="token function">setHeaderEncoding</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//4. å…³é”®çš„åœ°æ–¹, servletFileUpload å¯¹è±¡å¯ä»¥æŠŠè¡¨å•æäº¤çš„æ•°æ®text / æ–‡ä»¶</span>            <span class="token comment">//   å°†å…¶å°è£…åˆ° FileItem æ–‡ä»¶é¡¹ä¸­</span>            <span class="token comment">//   ç¼–ç¨‹å¿ƒå¾—ä½“ä¼š: å¦‚æœæˆ‘ä»¬ä¸çŸ¥é“ä¸€ä¸ªå¯¹è±¡æ˜¯ä»€ä¹ˆç»“æ„[1.è¾“å‡º 2.debug 3. åº•å±‚è‡ªåŠ¨çœ‹åˆ°]</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileItem</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> servletFileUpload<span class="token punctuation">.</span><span class="token function">parseRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">/*                list==>                [name=3.jpg, StoreLocation=D:\hspedu_javaweb\apache-tomcat-8.0.50-windows-x64\apache-tomcat-8.0.50\temp\xupload__7e34374f_17fce4168b1__7f4b_00000000.tmp, size=106398bytes, isFormField=false, FieldName=pic,                name=null, StoreLocation=D:\hspedu_javaweb\apache-tomcat-8.0.50-windows-x64\apache-tomcat-8.0.50\temp\xupload__7e34374f_17fce4168b1__7f4b_00000001.tmp, size=6bytes, isFormField=true, FieldName=name]                 */</span>                <span class="token comment">//System.out.println("list==>" + list);</span>                <span class="token comment">//éå†ï¼Œå¹¶åˆ†åˆ«å¤„ç†=> è‡ªç„¶æ€è·¯</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">FileItem</span> fileItem <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">//System.out.println("fileItem=" + fileItem);</span>                    <span class="token comment">//åˆ¤æ–­æ˜¯ä¸æ˜¯ä¸€ä¸ªæ–‡ä»¶=> ä½ æ˜¯OOPç¨‹åºå‘˜</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>fileItem<span class="token punctuation">.</span><span class="token function">isFormField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//å¦‚æœæ˜¯trueå°±æ˜¯æ–‡æœ¬ input text</span>                        <span class="token class-name">String</span> name <span class="token operator">=</span> fileItem<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å®¶å…·å="</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token comment">//æ˜¯ä¸€ä¸ªæ–‡ä»¶</span>                        <span class="token comment">//ç”¨ä¸€ä¸ªæ–¹æ³•</span>                        <span class="token comment">//è·å–ä¸Šä¼ çš„æ–‡ä»¶çš„åå­—</span>                        <span class="token class-name">String</span> name <span class="token operator">=</span> fileItem<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸Šä¼ çš„æ–‡ä»¶å="</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">//æŠŠè¿™ä¸ªä¸Šä¼ åˆ° æœåŠ¡å™¨çš„ tempä¸‹çš„æ–‡ä»¶ä¿å­˜åˆ°ä½ æŒ‡å®šçš„ç›®å½•</span>                        <span class="token comment">//1.æŒ‡å®šä¸€ä¸ªç›®å½• , å°±æ˜¯æˆ‘ä»¬ç½‘ç«™å·¥ä½œç›®å½•ä¸‹</span>                        <span class="token class-name">String</span> filePath <span class="token operator">=</span> <span class="token string">"/upload/"</span><span class="token punctuation">;</span>                        <span class="token comment">//2. è·å–åˆ°å®Œæ•´ç›®å½• [io/servletåŸºç¡€]</span>                        <span class="token comment">//  è¿™ä¸ªç›®å½•æ˜¯å’Œä½ çš„webé¡¹ç›®è¿è¡Œç¯å¢ƒç»‘å®šçš„. æ˜¯åŠ¨æ€.</span>                        <span class="token comment">//fileRealPath=D:\hspedu_javaweb\fileupdown\out\artifacts\fileupdown_war_exploded\xupload\</span>                        <span class="token class-name">String</span> fileRealPath <span class="token operator">=</span>                                request<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"fileRealPath="</span> <span class="token operator">+</span> fileRealPath<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">//3. åˆ›å»ºè¿™ä¸ªä¸Šä¼ çš„ç›®å½•=> åˆ›å»ºç›®å½•?=> JavaåŸºç¡€</span>                        <span class="token comment">//   æˆ‘ä»¬ä¹Ÿä¸€ä¸ªå·¥å…·ç±»ï¼Œå¯ä»¥è¿”å› /2024/11/11 å­—ç¬¦ä¸²</span>                        <span class="token class-name">File</span> fileRealPathDirectory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>fileRealPath <span class="token operator">+</span> <span class="token class-name">WebUtils</span><span class="token punctuation">.</span><span class="token function">getYearMonthDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fileRealPathDirectory<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//ä¸å­˜åœ¨ï¼Œå°±åˆ›å»º</span>                            fileRealPathDirectory<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»º</span>                        <span class="token punctuation">&#125;</span>                        <span class="token comment">//4. å°†æ–‡ä»¶æ‹·è´åˆ°fileRealPathDirectoryç›®å½•</span>                        <span class="token comment">//   æ„å»ºä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ ï¼šç›®å½•+æ–‡ä»¶å</span>                        <span class="token comment">//   å¯¹ä¸Šä¼ çš„æ–‡ä»¶åè¿›è¡Œå¤„ç†, å‰é¢å¢åŠ ä¸€ä¸ªå‰ç¼€ï¼Œä¿è¯æ˜¯å”¯ä¸€å³å¯, ä¸é”™</span>                        name <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"_"</span> <span class="token operator">+</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"_"</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>                        <span class="token class-name">String</span> fileFullPath <span class="token operator">=</span> fileRealPathDirectory <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span>name<span class="token punctuation">;</span>                        fileItem<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>fileFullPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">//5. æç¤ºä¿¡æ¯</span>                        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"ä¸Šä¼ æˆåŠŸ~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸æ˜¯æ–‡ä»¶è¡¨å•..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token function">doPost</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="æ–‡ä»¶ä¸‹è½½ä»£ç "><a href="#æ–‡ä»¶ä¸‹è½½ä»£ç " class="headerlink" title="æ–‡ä»¶ä¸‹è½½ä»£ç "></a>æ–‡ä»¶ä¸‹è½½ä»£ç </h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileDownloadServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"FileDownloadServlet è¢«è°ƒç”¨..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//1. å…ˆå‡†å¤‡è¦ä¸‹è½½çš„æ–‡ä»¶[å‡å®šè¿™äº›æ–‡ä»¶æ˜¯å…¬å…±çš„èµ„æº]</span>        <span class="token comment">//   é‡è¦: ä¿è¯å½“æˆ‘ä»¬çš„tomcatå¯åŠ¨åï¼Œåœ¨å·¥ä½œç›®å½•outä¸‹æœ‰downloadæ–‡ä»¶å¤¹, å¹¶ä¸”æœ‰å¯ä¾›ä¸‹è½½çš„æ–‡ä»¶!!</span>        <span class="token comment">//   è€å¸ˆå†æ¬¡è¯´æ˜ï¼Œå¦‚æœä½ æ²¡æœ‰çœ‹åˆ°ä½ åˆ›å»ºçš„downloadåœ¨å·¥ä½œç›®å½•outä¸‹ rebuild project -> restart, å°±OK</span>        <span class="token comment">//2. è·å–åˆ°è¦ä¸‹è½½çš„æ–‡ä»¶çš„åå­—</span>        request<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> downLoadFileName <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//System.out.println("downLoadFileName= " + downLoadFileName);</span>        <span class="token comment">//3. ç»™httpå“åº”ï¼Œè®¾ç½®å“åº”å¤´ Content-Type , å°±æ˜¯æ–‡ä»¶çš„MIME</span>        <span class="token comment">//   é€šè¿‡servletContext æ¥è·å–</span>        <span class="token class-name">ServletContext</span> servletContext <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> downLoadPath <span class="token operator">=</span> <span class="token string">"/download/"</span><span class="token punctuation">;</span> <span class="token comment">//ä¸‹è½½ç›®å½•ä» webå·¥ç¨‹æ ¹ç›®å½•è®¡ç®— /download/1.jpg</span>        <span class="token class-name">String</span> downLoadFileFullPath <span class="token operator">=</span> downLoadPath <span class="token operator">+</span> downLoadFileName<span class="token punctuation">;</span>        <span class="token class-name">String</span> mimeType <span class="token operator">=</span> servletContext<span class="token punctuation">.</span><span class="token function">getMimeType</span><span class="token punctuation">(</span>downLoadFileFullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"mimeType= "</span> <span class="token operator">+</span> mimeType<span class="token punctuation">)</span><span class="token punctuation">;</span>        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span>mimeType<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//4. ç»™httpå“åº”ï¼Œè®¾ç½®å“åº”å¤´ Content-Disposition</span>        <span class="token comment">//   è¿™é‡Œè€ƒè™‘çš„ç»†èŠ‚æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚ä¸åŒçš„æµè§ˆå™¨å†™æ³•ä¸ä¸€æ ·ï¼Œè€ƒè™‘ç¼–ç </span>        <span class="token comment">//   ff æ˜¯ æ–‡ä»¶åä¸­æ–‡éœ€è¦ base64, è€Œ ie/chrome æ˜¯ URLç¼–ç </span>        <span class="token comment">//   è¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦åŒå­¦ä»¬è®°ä½ï¼Œåªéœ€çŸ¥é“åŸç†</span>        <span class="token comment">//(1)å¦‚æœæ˜¯Firefox åˆ™ä¸­æ–‡ç¼–ç éœ€è¦ base64</span>        <span class="token comment">//(2)Content-Disposition æ˜¯æŒ‡å®šä¸‹è½½çš„æ•°æ®çš„å±•ç¤ºå½¢å¼ , å¦‚æœattachment åˆ™ä½¿ç”¨æ–‡ä»¶ä¸‹è½½æ–¹å¼</span>        <span class="token comment">//(3)å¦‚æœæ˜¯å…¶ä»–(ä¸»æµie/chrome) ä¸­æ–‡ç¼–ç ä½¿ç”¨URLç¼–ç </span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"User-Agent"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"Firefox"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// ç«ç‹ Base64ç¼–ç </span>            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span> <span class="token string">"attachment; filename==?UTF-8?B?"</span> <span class="token operator">+</span>                    <span class="token keyword">new</span> <span class="token class-name">BASE64Encoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>downLoadFileName<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"?="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// å…¶ä»–(ä¸»æµie/chrome)ä½¿ç”¨URLç¼–ç æ“ä½œ</span>            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span> <span class="token string">"attachment; filename="</span> <span class="token operator">+</span>                    <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>downLoadFileName<span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//5. è¯»å–ä¸‹è½½çš„æ–‡ä»¶æ•°æ®ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯/æµè§ˆå™¨</span>        <span class="token comment">//(1) åˆ›å»ºä¸€ä¸ªå’Œè¦ä¸‹è½½çš„æ–‡ä»¶ï¼Œå…³è”çš„è¾“å…¥æµ</span>        <span class="token class-name">InputStream</span> resourceAsStream <span class="token operator">=</span>                servletContext<span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>downLoadFileFullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//(2) å¾—åˆ°è¿”å›æ•°æ®çš„è¾“å‡ºæµ [å› ä¸ºè¿”å›æ–‡ä»¶å¤§å¤šæ•°æ˜¯äºŒè¿›åˆ¶(å­—èŠ‚), IO javaåŸºç¡€]</span>        <span class="token class-name">ServletOutputStream</span> outputStream <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//(3) ä½¿ç”¨å·¥å…·ç±»ï¼Œå°†è¾“å…¥æµå…³è”çš„æ–‡ä»¶ï¼Œå¯¹æ‹·åˆ°è¾“å‡ºæµï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯/æµè§ˆå™¨</span>        <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>resourceAsStream<span class="token punctuation">,</span> outputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token function">doPost</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title&gt;&lt;/a&gt;&lt;div class=&quot;note purple no-icon flat&quot;&gt;&lt;p&gt;javaWebå¤ä¹  &lt;/p&gt;
&lt;/div&gt;&lt;/h1&gt;&lt;h2 id=&quot;æ•°æ®äº¤æ¢å’Œå¼‚æ­¥è¯·æ±‚-JSON-am</summary>
      
    
    
    
    <category term="javaWeb" scheme="https://100qin10086.github.io/categories/javaWeb/"/>
    
    
    <category term="javaWeb" scheme="https://100qin10086.github.io/tags/javaWeb/"/>
    
  </entry>
  
  <entry>
    <title>javaWebå¤ä¹ 5</title>
    <link href="https://100qin10086.github.io/posts/28ae790f.html"/>
    <id>https://100qin10086.github.io/posts/28ae790f.html</id>
    <published>2024-03-18T08:03:17.000Z</published>
    <updated>2024-05-06T14:13:59.610Z</updated>
    
    <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a><div class="note purple no-icon flat"><p>javaWebå¤ä¹  </p></div></h1><h2 id="JavaWebä¸‰å¤§ç»„ä»¶ä¹‹ç›‘å¬å™¨-Listener"><a href="#JavaWebä¸‰å¤§ç»„ä»¶ä¹‹ç›‘å¬å™¨-Listener" class="headerlink" title="JavaWebä¸‰å¤§ç»„ä»¶ä¹‹ç›‘å¬å™¨ Listener"></a>JavaWebä¸‰å¤§ç»„ä»¶ä¹‹ç›‘å¬å™¨ Listener</h2><h3 id="Listenerç›‘å¬å™¨ä»‹ç»"><a href="#Listenerç›‘å¬å™¨ä»‹ç»" class="headerlink" title="Listenerç›‘å¬å™¨ä»‹ç»"></a>Listenerç›‘å¬å™¨ä»‹ç»</h3><p>Â·ç›‘å¬å™¨çš„ä½œç”¨æ˜¯,ç›‘å¬æŸç§å˜åŒ–(ä¸€èˆ¬å°±æ˜¯å¯¹è±¡åˆ›å»º/é”€æ¯,å±æ€§å˜åŒ–),è§¦å‘å¯¹åº”æ–¹æ³•å®Œæˆç›¸åº”çš„ä»»åŠ¡<br>Â·JavaWebä¸­çš„ç›‘å¬å™¨(å…±å…«ä¸ª),ç›®å‰æœ€å¸¸ç”¨çš„æ˜¯ServletContextListenerã€‚</p><h3 id="JavaWebç›‘å¬å™¨"><a href="#JavaWebç›‘å¬å™¨" class="headerlink" title="JavaWebç›‘å¬å™¨"></a>JavaWebç›‘å¬å™¨</h3><p>Â·ServletContextListenerç›‘å¬å™¨<br>1.ä½œç”¨:ç›‘å¬ServletContextåˆ›å»ºå’Œé”€æ¯(å½“æˆ‘ä»¬Webåº”ç”¨å¯åŠ¨æ—¶,å°±ä¼šåˆ›å»ºServletContext),å³ç”Ÿå‘½å‘¨æœŸç›‘å¬<br>2.ç›¸å…³æ–¹æ³•:<br>void contextInitialized(ServletContextEvent sce) åˆ›å»ºServletContextæ—¶è§¦å‘<br>void contextDestroyed(ServletContextEvent sce) é”€æ¯ServletContextæ—¶è§¦å‘<br>3.å®ä¾‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServletContextListener</span> <span class="token keyword">implements</span> <span class="token class-name">ServletContextListener</span> <span class="token punctuation">&#123;</span>      <span class="token annotation punctuation">@Override</span>      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextInitialized</span><span class="token punctuation">(</span><span class="token class-name">ServletContextEvent</span> servletContextEvent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ServletContext åˆ›å»ºï¼Œå®Œæˆ WEB é¡¹ç›®åˆå§‹åŒ–çš„å·¥ä½œ.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>     <span class="token annotation punctuation">@Override</span>     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextDestroyed</span><span class="token punctuation">(</span><span class="token class-name">ServletContextEvent</span> servletContextEvent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ServletContext é”€æ¯, å®Œæˆèµ„æºå›æ”¶å·¥ä½œ.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>é…ç½®web<span class="token punctuation">.</span>xml<span class="token generics"><span class="token punctuation">&lt;</span>linstener<span class="token punctuation">></span></span>      <span class="token operator">&lt;</span>linstener<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">></span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>qgq<span class="token punctuation">.</span>linstener<span class="token punctuation">.</span></span>MyServletContextListener</span><span class="token operator">&lt;</span><span class="token operator">/</span>linstener<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>linstener<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·ServletContextAttributeListenerç›‘å¬å™¨<br>1.ä½œç”¨:ç›‘å¬ServletContextå±æ€§å˜åŒ–<br>2.ç›¸å…³æ–¹æ³•<br>void attributeAdded(ServletContextAttributeEvent event) æ·»åŠ å±æ€§æ—¶è°ƒç”¨<br>void attributeReplaced(ServletContextAttributeEvent event) æ›¿æ¢å±æ€§æ—¶è°ƒç”¨<br>void attributeRemoved(ServletContextAttributeEvent event) ç§»é™¤å±æ€§æ—¶è°ƒç”¨<br>3.å®ä¾‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServletContextAttributeListener</span> <span class="token keyword">implements</span> <span class="token class-name">ServletContextAttributeListener</span> <span class="token punctuation">&#123;</span>     <span class="token annotation punctuation">@Override</span>     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">attributeAdded</span><span class="token punctuation">(</span><span class="token class-name">ServletContextAttributeEvent</span> servletContextAttributeEvent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ·»åŠ äº† servletContext å±æ€§å= "</span> <span class="token operator">+</span> servletContextAttributeEvent<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" å± æ€§ å€¼ ="</span> <span class="token operator">+</span>servletContextAttributeEvent<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token annotation punctuation">@Override</span>     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">attributeRemoved</span><span class="token punctuation">(</span><span class="token class-name">ServletContextAttributeEvent</span> servletContextAttributeEvent<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åˆ é™¤äº† servletContextå±æ€§"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token annotation punctuation">@Override</span>     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">attributeReplaced</span><span class="token punctuation">(</span><span class="token class-name">ServletContextAttributeEvent</span> servletContextAttributeEvent<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ›¿æ¢äº† servletContext å±æ€§ "</span><span class="token punctuation">)</span>     <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>     <span class="token function">doGet</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>     <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>     <span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">,</span><span class="token string">"k1_value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â·HttpSessionListener ç›‘å¬å™¨<br>1.ä½œç”¨ï¼šç›‘å¬ Session åˆ›å»ºæˆ–é”€æ¯ï¼Œå³ç”Ÿå‘½å‘¨æœŸç›‘å¬<br>2.ç›¸å…³æ–¹æ³•<br>void sessionCreated(HttpSessionEvent se)åˆ›å»ºsessionæ—¶è°ƒç”¨<br>void sessionDestroyed(HttpSessionEvent se) é”€æ¯sessionæ—¶è°ƒç”¨<br>3.ä½¿ç”¨æ–¹æ³•å’Œå‰é¢ä¸€æ ·,å¯ä»¥ç”¨äºç›‘æ§ç”¨æˆ·ä¸Šçº¿,ç¦»çº¿<br>Â·HttpSessionAttributeListener<br>1.ä½œç”¨:ç›‘å¬Requeståˆ›å»ºæˆ–é”€æ¯,å³Requestç”Ÿå‘½å‘¨æœŸç›‘å¬<br>2.ç›¸å…³æ–¹æ³•<br>Â·void requestInitialized(ServletRequestEvent sre) åˆ›å»º request æ—¶<br>Â·void requestDestroyed(ServletRequestEvent sre) é”€æ¯ request æ—¶<br>3.å¯ä»¥ç”¨æ¥ç›‘æ§,æŸä¸ªIPè®¿é—®æˆ‘ä»¬ç½‘ç«™çš„é¢‘ç‡,æ—¥å¿—è®°å½•,è®¿é—®èµ„æºçš„æƒ…å†µ<br>Â·ServletRequestAttributeListener ç›‘å¬å™¨<br>1.ä½œç”¨:ç›‘å¬Requestå±æ€§å˜åŒ–<br>2.ç›¸å…³æ–¹æ³•<br>Â·void attributeAdded(ServletRequestAttributeEvent srae) æ·»åŠ å±æ€§æ—¶<br>Â·void attributeReplaced(ServletRequestAttributeEvent srae) æ›¿æ¢å±æ€§æ—¶<br>Â·void attributeRemoved(ServletRequestAttributeEvent srae)ç§»é™¤å±æ€§æ—¶</p><h2 id="JavaWebä¸‰å¤§ç»„ä»¶ä¹‹è¿‡æ»¤å™¨Filter"><a href="#JavaWebä¸‰å¤§ç»„ä»¶ä¹‹è¿‡æ»¤å™¨Filter" class="headerlink" title="JavaWebä¸‰å¤§ç»„ä»¶ä¹‹è¿‡æ»¤å™¨Filter"></a>JavaWebä¸‰å¤§ç»„ä»¶ä¹‹è¿‡æ»¤å™¨Filter</h2><h3 id="è¿‡æ»¤å™¨ä»‹ç»"><a href="#è¿‡æ»¤å™¨ä»‹ç»" class="headerlink" title="è¿‡æ»¤å™¨ä»‹ç»"></a>è¿‡æ»¤å™¨ä»‹ç»</h3><p>1.Filterè¿‡æ»¤å™¨å®ƒçš„ä½œç”¨æ˜¯:æ‹¦æˆªè¯·æ±‚,è¿‡æ»¤å“åº”<br>2.åº”ç”¨åœºæ™¯<br>Â·æƒé™æ£€æŸ¥<br>Â·æ—¥è®°æ“ä½œ<br>Â·äº‹åŠ¡ç®¡ç†</p><h3 id="Filterè¿‡æ»¤å™¨åŸºæœ¬åŸç†"><a href="#Filterè¿‡æ»¤å™¨åŸºæœ¬åŸç†" class="headerlink" title="Filterè¿‡æ»¤å™¨åŸºæœ¬åŸç†"></a>Filterè¿‡æ»¤å™¨åŸºæœ¬åŸç†</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/e80e1db130b5e0343c540b585b9ee0d2.png"></div></div><h3 id="Filterè¿‡æ»¤å™¨åŸºæœ¬å®ä¾‹"><a href="#Filterè¿‡æ»¤å™¨åŸºæœ¬å®ä¾‹" class="headerlink" title="Filterè¿‡æ»¤å™¨åŸºæœ¬å®ä¾‹"></a>Filterè¿‡æ»¤å™¨åŸºæœ¬å®ä¾‹</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ManageFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filte</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"====ManageFilter init()è¢«è°ƒç”¨..===="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=====ManageFilter doFilter()è¢«è°ƒç”¨===="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">HttpServletRequest</span> httpServletRequest <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> servletRequest<span class="token punctuation">;</span>    <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> httpServletRequest<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//è·å– session å¯¹è±¡çš„ user å±æ€§</span>    <span class="token class-name">Object</span> user <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         servletRequest<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"/login.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">return</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>          <span class="token comment">// é€šè¿‡äº†, ç»§ç»­</span>         filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨web.xmlé…ç½®è¿‡æ»¤å™¨</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filters</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>ManageFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">></span></span>com.qgq.servlet.ManageFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>ManageFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- è€éŸ©è§£è¯»(é‡è¦)        1. url-pattern é…ç½®æ‹¦æˆªè·¯å¾„ /manage/*        2. ç¬¬ 1 ä¸ª / è¢«æœåŠ¡å™¨è§£æä¸ºï¼šhttp://ip:port/å·¥ç¨‹è·¯å¾„/        3. /manage/* è¡¨ç¤ºï¼šhttp://ip:port/å·¥ç¨‹è·¯å¾„/manage/* æ‰€æœ‰èµ„æºè¯·æ±‚éƒ½ç»è¿‡è¯¥è¿‡        æ»¤å™¨        --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/manage/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filters</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Filterè¿‡æ»¤å™¨url-pattern"><a href="#Filterè¿‡æ»¤å™¨url-pattern" class="headerlink" title="Filterè¿‡æ»¤å™¨url-pattern"></a>Filterè¿‡æ»¤å™¨url-pattern</h3><p>1.url-pattern:Filterçš„æ‹¦æˆªè·¯å¾„,å³æµè§ˆå™¨åœ¨è¯·æ±‚ç”Ÿå‘½ä½ç½®çš„èµ„æºæ—¶,è¿‡æ»¤å™¨ä¼šè¿›è¡Œæ‹¦æˆªè¿‡æ»¤<br>2.ç²¾ç¡®åŒ¹é… <url-pattern>/a.jsp&lt;/url-pattern&gt; å¯¹åº”çš„ è¯·æ±‚åœ°å€ <a href="http://ip[åŸŸå]:port/å·¥ç¨‹è·¯å¾„/a.jspä¼šæ‹¦æˆª">http://ip[åŸŸå]:port/å·¥ç¨‹è·¯å¾„/a.jspä¼šæ‹¦æˆª</a><br>3.ç›®å½•åŒ¹é…ç›®å½•åŒ¹é… <url-pattern>/manage/*&lt;/url-pattern&gt;å¯¹åº”çš„ è¯·æ±‚åœ°å€ <a href="http://ip[åŸŸå]:port/å·¥ç¨‹è·¯å¾„/manage/xx,å³">http://ip[åŸŸå]:port/å·¥ç¨‹è·¯å¾„/manage/xx,å³</a><br>webå·¥ç¨‹manageç›®å½•ä¸‹æ‰€æœ‰èµ„æºä¼šæ‹¦æˆªã€‚<br>4.Filter è¿‡æ»¤å™¨å®ƒåªå…³å¿ƒè¯·æ±‚çš„åœ°å€æ˜¯å¦åŒ¹é…ï¼Œä¸å…³å¿ƒè¯·æ±‚çš„èµ„æºæ˜¯å¦å­˜åœ¨</url-pattern></url-pattern></p><h3 id="Filterè¿‡æ»¤å™¨ç”Ÿå‘½å‘¨æœŸ"><a href="#Filterè¿‡æ»¤å™¨ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Filterè¿‡æ»¤å™¨ç”Ÿå‘½å‘¨æœŸ"></a>Filterè¿‡æ»¤å™¨ç”Ÿå‘½å‘¨æœŸ</h3><p>1.å½“webå·¥ç¨‹å¯åŠ¨æ—¶,ä¼šæ‰§è¡Œæ„é€ å™¨å’Œinitæ–¹æ³•<br>2.å¦‚æœåŒ¹é…åˆ°Filterçš„url-pattern<br>3.doFilter()æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨<br>4.åœæ­¢webå·¥ç¨‹æ—¶,é”€æ¯Filterå®ä¾‹,ä¼šè°ƒç”¨destory()</p><h3 id="FilterConfigè¯´æ˜"><a href="#FilterConfigè¯´æ˜" class="headerlink" title="FilterConfigè¯´æ˜"></a>FilterConfigè¯´æ˜</h3><p>1.FilterConfigæ˜¯Filterè¿‡æ»¤å™¨çš„é…ç½®ç±»<br>2.Tomcatæ¯æ¬¡åˆ›å»ºFilterçš„æ—¶å€™,ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªFilterConfigå¯¹è±¡,è¿™é‡ŒåŒ…å«äº†Filteré…ç½®æ–‡ä»¶çš„é…ç½®ä¿¡æ¯<br>3.FilterConfigå¯¹è±¡ä½œç”¨æ˜¯è·å–filterè¿‡æ»¤å™¨çš„é…ç½®å†…å®¹<br>4.å®ä¾‹</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filters</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>FilterConfig_<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">></span></span>com.hspedu.servlet.FilterConfig_<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!-- å°æ€ ip æ®µ --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>ip<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>128.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>port<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>8888<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>FilterConfig_<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/abc/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filters</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FilterConfig_</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿‡æ»¤å™¨å= "</span> <span class="token operator">+</span> filterConfig<span class="token punctuation">.</span><span class="token function">getFilterName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿‡æ»¤å™¨ ip= "</span> <span class="token operator">+</span> filterConfig<span class="token punctuation">.</span><span class="token function">getInitParameter</span><span class="token punctuation">(</span><span class="token string">"ip"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¾—åˆ° servletContext= "</span> <span class="token operator">+</span> filterConfig<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="FilterChain"><a href="#FilterChain" class="headerlink" title="FilterChain"></a>FilterChain</h3><p>1.ä¸€å¥è¯:FilterChain:åœ¨å¤„ç†æŸäº›å¤æ‚ä¸šåŠ¡æ—¶,ä¸€ä¸ªè¿‡æ»¤å™¨ä¸å¤Ÿ,å¯ä»¥è®¾è®¡å¤šä¸ªè¿‡æ»¤å™¨å…±åŒå®Œæˆè¿‡æ»¤ä»»åŠ¡,å½¢æˆè¿‡æ»¤é“¾</p><h4 id="FilterChainæ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#FilterChainæ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="FilterChainæ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>FilterChainæ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><p>1.å¤šä¸ªfilterå’Œç›®æ ‡èµ„æºåœ¨ä¸€æ¬¡httpè¯·æ±‚,åœ¨åŒä¸€ä¸ªçº¿ç¨‹<br>2.å½“ä¸€ä¸ªè¯·æ±‚urlå’Œfilterçš„url-patternåŒ¹é…æ—¶,æ‰ä¼šè¢«æ‰§è¡Œ,å¦‚æœæœ‰å¤šä¸ªåŒ¹é…ä¸Š,å°±ä¼šé¡ºåºæ‰§è¡Œ,å½¢æˆä¸€ä¸ªfilterè°ƒç”¨é“¾(<br>åº•å±‚å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ•°æ®ç»“æ„æå®š)<br>3.å¤šä¸ªfilterå…±åŒæ‰§è¡Œæ—¶,å› ä¸ºæ˜¯ä¸€æ¬¡httpè¯·æ±‚,ä½¿ç”¨åŒä¸€ä¸ªrequestå¯¹è±¡<br>4.å¤šä¸ªfilteræ‰§è¡Œé¡ºåº,å’Œweb.xmlé…ç½®é¡ºåºä¿å­˜ä¸€è‡´<br>5.chain.doFilter(req,resp)æ–¹æ³•,å°†æ‰§è¡Œä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨çš„doFilteræ–¹æ³•,å¦‚æœåé¢æ²¡æœ‰è¿‡æ»¤å™¨,åˆ™æ‰§è¡Œç›®æ ‡èµ„æº</p><h2 id="JavaScriptå¼€å‘åˆ©å™¨ä¹‹Jquery"><a href="#JavaScriptå¼€å‘åˆ©å™¨ä¹‹Jquery" class="headerlink" title="JavaScriptå¼€å‘åˆ©å™¨ä¹‹Jquery"></a>JavaScriptå¼€å‘åˆ©å™¨ä¹‹Jquery</h2><h3 id="JqueryåŸºæœ¬ä»‹ç»"><a href="#JqueryåŸºæœ¬ä»‹ç»" class="headerlink" title="JqueryåŸºæœ¬ä»‹ç»"></a>JqueryåŸºæœ¬ä»‹ç»</h3><p>1.jQueryæ˜¯ä¸€ä¸ªå¿«é€Ÿçš„,ç®€æ´çš„javaScriptåº“,ä½¿ç”¨æˆ·èƒ½æ›´æ–¹ä¾¿å¤„ç†HTML,CSS,dom<br>2.æä¾›æ–¹æ³•,events,é€‰æ‹©å™¨,å¹¶ä¸”æ–¹ä¾¿åœ°ä¸ºç½‘ç«™æä¾›AJAXäº¤äº’</p><h3 id="JQueryåŸºæœ¬å¼€å‘æ­¥éª¤"><a href="#JQueryåŸºæœ¬å¼€å‘æ­¥éª¤" class="headerlink" title="JQueryåŸºæœ¬å¼€å‘æ­¥éª¤"></a>JQueryåŸºæœ¬å¼€å‘æ­¥éª¤</h3><p>Â·ä½¿ç”¨scriptå¼•å…¥jQueryåº“æ–‡ä»¶å³å¯ä½¿ç”¨<br>Â·<script type="text/javascript" src="./script/jquery-3.6.0.min.js"></script></p><h3 id="jQueryå¯¹è±¡å’ŒDOMå¯¹è±¡"><a href="#jQueryå¯¹è±¡å’ŒDOMå¯¹è±¡" class="headerlink" title="jQueryå¯¹è±¡å’ŒDOMå¯¹è±¡"></a>jQueryå¯¹è±¡å’ŒDOMå¯¹è±¡</h3><p>1.jQueryå¯¹è±¡å°±æ˜¯å¯¹DOMå¯¹è±¡è¿›è¡ŒåŒ…è£…åäº§ç”Ÿåœ°å¯¹è±¡<br>Â·æ¯”å¦‚:$(â€œ#testâ€).html() æ„æ€æ˜¯æŒ‡:è·å–IDä¸ºteståœ°å…ƒç´ å†…åœ°htmlä»£ç ,å…¶ä¸­html()æ˜¯jQueryé‡Œåœ°æ–¹æ³•<br>Â·è¿™æ®µä»£ç ç­‰åŒäºç”¨DOMå®ç°ä»£ç :document.getElementById(â€œidâ€).innerHTML;<br>2.çº¦å®šï¼šå¦‚æœè·å–çš„æ˜¯ jQuery å¯¹è±¡, é‚£ä¹ˆè¦åœ¨å˜é‡å‰é¢åŠ ä¸Š $ , æ¯”å¦‚:<br>Â·var $variable :jQuery å¯¹è±¡<br>Â·var variable : DOMå¯¹è±¡</p><h3 id="jQueryå’ŒDOMç›¸äº’è½¬æ¢"><a href="#jQueryå’ŒDOMç›¸äº’è½¬æ¢" class="headerlink" title="jQueryå’ŒDOMç›¸äº’è½¬æ¢"></a>jQueryå’ŒDOMç›¸äº’è½¬æ¢</h3><p>1.å°†DOMå¯¹è±¡ç”¨$()åŒ…è£¹åå°±æˆä¸ºäº†jQuery<br>2.å¯¹äºjQueryå¯¹è±¡ä½¿ç”¨get(index)æ¥å¾—åˆ°å“åº”åœ°DOMå¯¹è±¡,å› ä¸ºjQueryå¯¹è±¡æ˜¯ä¸€ä¸ªæ•°ç»„å¯¹è±¡</p><h3 id="jQueryé€‰æ‹©å™¨"><a href="#jQueryé€‰æ‹©å™¨" class="headerlink" title="jQueryé€‰æ‹©å™¨"></a>jQueryé€‰æ‹©å™¨</h3><p>1.jQueryé€‰æ‹©å™¨æ˜¯æ ¸å¿ƒ,åœ¨jQueryä¸­,å¯¹äº‹ä»¶å¤„ç†,éå†DMOå’ŒAjaxæ“ä½œéƒ½ä¾èµ–äºé€‰æ‹©å™¨</p><h4 id="åŸºæœ¬é€‰æ‹©å™¨"><a href="#åŸºæœ¬é€‰æ‹©å™¨" class="headerlink" title="åŸºæœ¬é€‰æ‹©å™¨"></a>åŸºæœ¬é€‰æ‹©å™¨</h4><p>1.#id ç”¨æ³•: $(â€œ#myDivâ€);è¿”å›å€¼å•ä¸ªå…ƒç´ çš„ç»„æˆçš„é›†åˆ,è¿™ä¸ªå°±æ˜¯ç›´æ¥é€‰æ‹© html ä¸­çš„ id=â€myDivâ€<br>2.Element ç”¨æ³•:$(â€œdivâ€)è¿”å›å€¼é›†åˆå…ƒç´ ,æ‰€ä»¥ element å…¶å®å°±æ˜¯ html å·²ç»å®šä¹‰åœ°æ ‡ç­¾å…ƒç´ <br>3.class ç”¨æ³•: $(â€œ.myClassâ€)è¿”å›å€¼é›†åˆå…ƒç´ ,è¿™ä¸ªæ ‡ç­¾æ˜¯ç›´æ¥é€‰æ‹© html ä»£ç ä¸­ class=â€myClassâ€çš„å…ƒç´ æˆ–å…ƒç´ ç»„</p><h4 id="å±‚æ¬¡é€‰æ‹©å™¨"><a href="#å±‚æ¬¡é€‰æ‹©å™¨" class="headerlink" title="å±‚æ¬¡é€‰æ‹©å™¨"></a>å±‚æ¬¡é€‰æ‹©å™¨</h4><p>1.ç”¨æ³•:$(â€form inputâ€);è¿”å›å€¼é›†åˆå…ƒç´ ,åœ¨ç»™å®šçš„ç¥–å…ˆå…ƒç´ ä¸‹åŒ¹é…æ‰€æœ‰åä»£å…ƒç´ <br>2.ç”¨æ³•:$(â€form &gt; inputâ€);è¿”å›å€¼é›†åˆå…ƒç´ ,åœ¨ç»™å®šçš„çˆ¶å…ƒç´ ä¸‹åŒ¹é…æ‰€æœ‰å­å…ƒç´ <br>3.ç”¨æ³•: $(â€label + inputâ€);è¿”å›å€¼é›†åˆå…ƒç´  è¯´æ˜: åŒ¹é…æ‰€æœ‰ç´§æ¥åœ¨ prev å…ƒç´ åçš„ next å…ƒç´ </p><h4 id="ç”±äºjQueryåœ°é€‰æ‹©å™¨å¤ªå¤šäº†-å°±ä¸ä¸€ä¸€å†™äº†-åªéœ€è¦èƒ½è®¤è¯†å°±è¡Œ"><a href="#ç”±äºjQueryåœ°é€‰æ‹©å™¨å¤ªå¤šäº†-å°±ä¸ä¸€ä¸€å†™äº†-åªéœ€è¦èƒ½è®¤è¯†å°±è¡Œ" class="headerlink" title="ç”±äºjQueryåœ°é€‰æ‹©å™¨å¤ªå¤šäº†,å°±ä¸ä¸€ä¸€å†™äº†,åªéœ€è¦èƒ½è®¤è¯†å°±è¡Œ"></a>ç”±äºjQueryåœ°é€‰æ‹©å™¨å¤ªå¤šäº†,å°±ä¸ä¸€ä¸€å†™äº†,åªéœ€è¦èƒ½è®¤è¯†å°±è¡Œ</h4><h3 id="jQueryåœ°DOMæ“ä½œ"><a href="#jQueryåœ°DOMæ“ä½œ" class="headerlink" title="jQueryåœ°DOMæ“ä½œ"></a>jQueryåœ°DOMæ“ä½œ</h3><h4 id="æŸ¥æ‰¾èŠ‚ç‚¹-ä¿®æ”¹å±æ€§"><a href="#æŸ¥æ‰¾èŠ‚ç‚¹-ä¿®æ”¹å±æ€§" class="headerlink" title="æŸ¥æ‰¾èŠ‚ç‚¹,ä¿®æ”¹å±æ€§"></a>æŸ¥æ‰¾èŠ‚ç‚¹,ä¿®æ”¹å±æ€§</h4><p>1.æŸ¥æ‰¾å±æ€§èŠ‚ç‚¹: æŸ¥æ‰¾åˆ°æ‰€éœ€è¦çš„å…ƒç´ ä¹‹å, å¯ä»¥è°ƒç”¨ jQuery å¯¹è±¡çš„ attr() æ–¹æ³•æ¥è·å–å®ƒçš„å„ç§å±æ€§å€¼<br><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//ç»™ button ç»‘å®šä¸€ä¸ª click äº‹ä»¶</span>    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">,</span> <span class="token string">"../image/1.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span> <span class="token string">"200"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="åˆ›å»ºèŠ‚ç‚¹"><a href="#åˆ›å»ºèŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºèŠ‚ç‚¹"></a>åˆ›å»ºèŠ‚ç‚¹</h4><p>1.åˆ›å»ºèŠ‚ç‚¹:ä½¿ç”¨jQueryçš„å·¥å‚å‡½æ•°$():$(htmlæ ‡ç­¾);ä¼šæ ¹æ®ä¼ å…¥çš„ htmlæ ‡è®°å­—ç¬¦ä¸²åˆ›å»ºä¸€ä¸ªjQueryå¯¹è±¡,å¹¶è¿”å›ã€‚<br>2.åŠ¨æ€åˆ›å»ºçš„æ–°å…ƒç´ èŠ‚ç‚¹ä¸ä¼šè¢«è‡ªåŠ¨æ·»åŠ åˆ°æ–‡æ¡£ä¸­, è€Œæ˜¯éœ€è¦ä½¿ç”¨å…¶ä»–æ–¹æ³•å°†å…¶æ’å…¥åˆ°æ–‡æ¡£ä¸­<br>3.å½“åˆ›å»ºå•ä¸ªå…ƒç´ æ—¶, éœ€æ³¨æ„é—­åˆæ ‡ç­¾å’Œä½¿ç”¨æ ‡å‡†çš„ XHTML æ ¼å¼. ä¾‹å¦‚åˆ›å»ºä¸€ä¸ª</p><p>å…ƒç´ , å¯ä»¥ä½¿ç”¨ $("</p><p>") æˆ– $("</p><p></p>â€œ), ä½†ä¸èƒ½ä½¿ç”¨ $(â€œ<p>â€œ) æˆ– $(â€œ&lt;/P&gt;â€)ã€‚<br><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//*****æ·»åŠ é‡åº† li åˆ° ä¸Šæµ·ä¸‹</span>    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#b1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//jquery æ–¹æ³•</span><span class="token comment">//æœ‰ä¸¤ç§æ–¹æ³• ï¼š ä¸€æ­¥åˆ°ä½********</span><span class="token comment">// $myli = $("&lt;li id='cq' name='chongqing'>é‡åº†&lt;/li>");</span><span class="token comment">// //å…ˆä½¿ç”¨å†…éƒ¨æ’å…¥</span><span class="token comment">// //$('#id').append($myli) :è¡¨ç¤º åœ¨ $('#id')å¯¹è±¡å†…éƒ¨åé¢æ·»åŠ ä¸€ä¸ª $myli å¯¹è±¡</span><span class="token comment">// $('#sh').append($myli);</span>        $myli <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"&lt;li>&lt;/li>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        $myli<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">"é‡åº†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;li>é‡åº†&lt;/li></span>        $myli<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"cq"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&lt;li id='cq'>é‡åº†&lt;/li></span>        $myli<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"chongqing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æŠŠ$myli æ·»åŠ åˆ°ä¸Šæµ·</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#sh'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>$myli<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¡¨ç¤º åœ¨ $('#sh')å¯¹è±¡å†…éƒ¨åé¢æ·»åŠ ä¸€ä¸ª $myli å¯¹è±¡</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#b2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//jqury æ–¹æ³•</span>        $myli <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"&lt;li id='cd' name='chengdu'>æˆéƒ½&lt;/li>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#city'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span>$myli<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//$myli.prependTo($('#city'));</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#b4'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//ä½¿ç”¨å¤–éƒ¨æ’å…¥</span><span class="token comment">//ä¸€æ­¥åˆ°ä½</span><span class="token comment">//$("#bj").after("&lt;li id='cd' name='chengdu '>æˆéƒ½&lt;/li>");</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"&lt;li id='cd' name='chengdu '>æˆéƒ½&lt;/li>"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insertAfter</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#bj'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#b5'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//ä½¿ç”¨å¤–éƒ¨æ’å…¥, ä¸€æ­¥åˆ°ä½</span><span class="token comment">//$("#jl") å¯¹è±¡å‰é¢æ·»åŠ  "&lt;li id='cd' name='chengdu '>æˆéƒ½&lt;/li>";</span>        <span class="token keyword">var</span> $cd <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"&lt;li id='cd' name='chengdu'>æˆéƒ½&lt;/li>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//$("#jl").before($cd);</span>        $cd<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#jl'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="åˆ é™¤èŠ‚ç‚¹"><a href="#åˆ é™¤èŠ‚ç‚¹" class="headerlink" title="åˆ é™¤èŠ‚ç‚¹"></a>åˆ é™¤èŠ‚ç‚¹</h4><p>1.remove(): ä» DOM ä¸­åˆ é™¤æ‰€æœ‰åŒ¹é…çš„å…ƒç´ , ä¼ å…¥çš„å‚æ•°ç”¨äºæ ¹æ®jQueryè¡¨è¾¾å¼æ¥ç­›é€‰å…ƒç´ ,å½“æŸä¸ªèŠ‚ç‚¹ç”¨ remove() æ–¹æ³•åˆ é™¤å,<br>è¯¥èŠ‚ç‚¹æ‰€åŒ…å«çš„æ‰€æœ‰åä»£èŠ‚ç‚¹å°†è¢«åŒæ—¶åˆ é™¤ï¼Œè¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡å‘å·²è¢«åˆ é™¤çš„èŠ‚ç‚¹çš„å¼•ç”¨ã€‚<br>2.empty(): æ¸…ç©ºèŠ‚ç‚¹ â€“ æ¸…ç©ºå…ƒç´ ä¸­çš„æ‰€æœ‰åä»£èŠ‚ç‚¹(ä¸åŒ…å«å±æ€§èŠ‚ç‚¹)ã€‚</p><h4 id="å±æ€§æ“ä½œ"><a href="#å±æ€§æ“ä½œ" class="headerlink" title="å±æ€§æ“ä½œ"></a>å±æ€§æ“ä½œ</h4><p>1.attr(): è·å–å±æ€§å’Œè®¾ç½®å±æ€§<br>2.attr()ä¼ é€’ä¸€ä¸ªå‚æ•°æ—¶, å³ä¸ºæŸå…ƒç´ çš„è·å–æŒ‡å®šå±æ€§<br>3.attr()ä¼ é€’ä¸¤ä¸ªå‚æ•°æ—¶, å³ä¸ºæŸå…ƒç´ è®¾ç½®æŒ‡å®šå±æ€§çš„å€¼<br>4.jQuery ä¸­æœ‰å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°å®ç°è·å–å’Œè®¾ç½®.å¦‚:attr(),html(),text(),val(),height(),width(),css()ç­‰<br>5.removeAttr(): åˆ é™¤æŒ‡å®šå…ƒç´ çš„æŒ‡å®šå±æ€§<br>6.è®¾ç½®æˆ–è¿”å›æ‰€é€‰å…ƒç´ çš„å†…å®¹ï¼ˆåŒ…æ‹¬ HTML æ ‡è®°ï¼‰: html()<br>7.è¯»å–å’Œè®¾ç½®æŸä¸ªå…ƒç´ ä¸­çš„æ–‡æœ¬å†…å®¹: text(). è¯¥æ–¹æ³•æ—¢å¯ä»¥ç”¨äº HTML ä¹Ÿå¯ä»¥ç”¨äº XMLæ–‡æ¡£.<br>8.è¯»å–å’Œè®¾ç½®æŸä¸ªå…ƒç´ ä¸­çš„å€¼:val()è¯¥æ–¹æ³•ç±»ä¼¼JavaScriptä¸­çš„valueå±æ€§.å¯¹äºæ–‡æœ¬æ¡†,ä¸‹æ‹‰åˆ—è¡¨æ¡†,å•é€‰æ¡†è¯¥æ–¹æ³•å¯è¿”å›å…ƒç´ çš„å€¼</p><h4 id="å¸¸ç”¨éå†èŠ‚ç‚¹æ–¹æ³•"><a href="#å¸¸ç”¨éå†èŠ‚ç‚¹æ–¹æ³•" class="headerlink" title="å¸¸ç”¨éå†èŠ‚ç‚¹æ–¹æ³•"></a>å¸¸ç”¨éå†èŠ‚ç‚¹æ–¹æ³•</h4><p>1ã€å–å¾—åŒ¹é…å…ƒç´ çš„æ‰€æœ‰å­å…ƒç´ ç»„æˆçš„é›†åˆ: children()è¯¥æ–¹æ³•åªè€ƒè™‘å­å…ƒç´ è€Œä¸è€ƒè™‘ä»»ä½•åä»£å…ƒç´ ;<br>2ã€å–å¾—åŒ¹é…å…ƒç´ åé¢çš„åŒè¾ˆå…ƒç´ çš„é›†åˆ:next()/nextAll();<br>3ã€å–å¾—åŒ¹é…å…ƒç´ å‰é¢çš„åŒè¾ˆå…ƒç´ çš„é›†åˆ:prev()/prevAll();<br>4ã€å–å¾—åŒ¹é…å…ƒç´ å‰åæ‰€æœ‰çš„åŒè¾ˆå…ƒç´ : siblings();<br>5ã€è·å–æŒ‡å®šçš„ç¬¬å‡ ä¸ªå…ƒç´ : nextAll().eq(index);</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title&gt;&lt;/a&gt;&lt;div class=&quot;note purple no-icon flat&quot;&gt;&lt;p&gt;javaWebå¤ä¹  &lt;/p&gt;
&lt;/div&gt;&lt;/h1&gt;&lt;h2 id=&quot;JavaWebä¸‰å¤§ç»„ä»¶ä¹‹ç›‘å¬å™¨-L</summary>
      
    
    
    
    <category term="javaWeb" scheme="https://100qin10086.github.io/categories/javaWeb/"/>
    
    
    <category term="javaWeb" scheme="https://100qin10086.github.io/tags/javaWeb/"/>
    
  </entry>
  
  <entry>
    <title>javaWebå¤ä¹ 4</title>
    <link href="https://100qin10086.github.io/posts/5fa94999.html"/>
    <id>https://100qin10086.github.io/posts/5fa94999.html</id>
    <published>2024-03-14T08:12:17.000Z</published>
    <updated>2024-05-06T14:13:59.610Z</updated>
    
    <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a><div class="note purple no-icon flat"><p>javaWebå¤ä¹  </p></div></h1><h2 id="WEBå·¥ç¨‹è·¯å¾„"><a href="#WEBå·¥ç¨‹è·¯å¾„" class="headerlink" title="WEBå·¥ç¨‹è·¯å¾„"></a>WEBå·¥ç¨‹è·¯å¾„</h2><h3 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://localhost:10000/hspedu_servlet/ok<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    u: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>æ³¨å†Œç”¨æˆ·<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>1.æ ¹æ®ä¸Šé¢çš„ä»£ç ,æ€ä¹ˆè§£å†³è®¿é—®èµ„æºçš„é—®é¢˜</p><h4 id="è§£å†³æ–¹æ¡ˆ-ç›¸å¯¹è·¯å¾„"><a href="#è§£å†³æ–¹æ¡ˆ-ç›¸å¯¹è·¯å¾„" class="headerlink" title="è§£å†³æ–¹æ¡ˆ:ç›¸å¯¹è·¯å¾„"></a>è§£å†³æ–¹æ¡ˆ:ç›¸å¯¹è·¯å¾„</h4><p>1.è¯´æ˜:ä½¿ç”¨ç›¸å¯¹è·¯å¾„æ¥è§£å†³,ä¸€ä¸ªéå¸¸é‡è¦çš„è§„åˆ™:é¡µé¢æ‰€æœ‰çš„ç›¸å¯¹è·¯å¾„,åœ¨é»˜è®¤æƒ…å†µä¸‹,éƒ½ä¼šå‚è€ƒå½“å‰æµè§ˆå™¨åœ°å€æ çš„è·¯å¾„<a href="http://ip">http://ip</a>:<br>port/å·¥ç¨‹å/+èµ„æº<br>æ¥è¿›è¡Œè·³è½¬,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è¿™æ ·å†™</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ok<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    u: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>æ³¨å†Œç”¨æˆ·<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="è§£å†³æ–¹æ¡ˆ-baseæ ‡ç­¾"><a href="#è§£å†³æ–¹æ¡ˆ-baseæ ‡ç­¾" class="headerlink" title="è§£å†³æ–¹æ¡ˆ:baseæ ‡ç­¾"></a>è§£å†³æ–¹æ¡ˆ:baseæ ‡ç­¾</h4><h5 id="baseåŸºæœ¬ä»‹ç»"><a href="#baseåŸºæœ¬ä»‹ç»" class="headerlink" title="baseåŸºæœ¬ä»‹ç»"></a>baseåŸºæœ¬ä»‹ç»</h5><p>1.base æ ‡ç­¾æ˜¯ HTML è¯­è¨€ä¸­çš„åŸºå‡†ç½‘å€æ ‡è®°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå•æ ‡ç­¾ï¼Œä½äºç½‘é¡µå¤´éƒ¨æ–‡ä»¶çš„ headæ ‡ç­¾å†…<br>2.ä¸€ä¸ªé¡µé¢æœ€å¤šåªèƒ½ä½¿ç”¨ä¸€ä¸ª base å…ƒç´ ï¼Œç”¨æ¥æä¾›ä¸€ä¸ªæŒ‡å®šçš„é»˜è®¤ç›®æ ‡ï¼Œæ˜¯ä¸€ç§è¡¨è¾¾è·¯å¾„å’Œè¿æ¥ç½‘å€çš„æ ‡è®°<br>3.å¸¸è§çš„urlè·¯å¾„å½¢å¼åˆ†åˆ«æœ‰ç›¸å¯¹è·¯å¾„ä¸ç»å¯¹è·¯å¾„,å¦‚æœbaseæ ‡ç­¾æŒ‡å®šäº†ç›®æ ‡,æµè§ˆå™¨å°†é€šè¿‡è¿™ä¸ªç›®æ ‡æ¥è§£æå½“å‰æ–‡æ¡£ä¸­çš„æ‰€æœ‰ç›¸å¯¹è·¯å¾„<br>åŒ…æ‹¬çš„æ ‡ç­¾æœ‰(a,img,link,form)</p><h4 id="WEBå·¥ç¨‹è·¯å¾„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#WEBå·¥ç¨‹è·¯å¾„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="WEBå·¥ç¨‹è·¯å¾„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>WEBå·¥ç¨‹è·¯å¾„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><p>1.åœ¨å®é™…å¼€å‘ä¸­,è·¯å¾„éƒ½ä½¿ç”¨ç»å¯¹è·¯å¾„,è€Œä¸æ˜¯ç›¸å¯¹è·¯å¾„<br>2.åœ¨webä¸­/æ–œæ å¦‚æœè¢«æµè§ˆå™¨è§£æ,å¾—åˆ°çš„åœ°å€æ˜¯:<a href="http://ip[åŸŸå]:port/">http://ip[åŸŸå]:port/</a><br>3.åœ¨webä¸­/æ–œæ å¦‚æœè¢«æœåŠ¡å™¨è§£æ,å¾—åˆ°çš„åœ°å€æ˜¯:<a href="http://ip[åŸŸå]:port/å·¥ç¨‹è·¯å¾„/">http://ip[åŸŸå]:port/å·¥ç¨‹è·¯å¾„/</a><br>4.åœ¨javaWebä¸­è·¯å¾„æœ€åå¸¦/å’Œä¸å¸¦/å«ä¹‰ä¸åŒ,ä¸€å®šè¦å°å¿ƒ<br>5.ç‰¹åˆ«è¯´æ˜ï¼šé‡å®šå‘ response.sendRediect(â€œ/â€œ); è¿™æ¡è¯­å¥è™½ç„¶æ˜¯åœ¨æœåŠ¡å™¨æ‰§è¡Œçš„ï¼Œä½†æ˜¯,æœåŠ¡å™¨æ˜¯æŠŠæ–œæ /å‘é€ç»™æµè§ˆå™¨è§£æã€‚</p><h2 id="WEBå¼€å‘ä¼šè¯æŠ€æœ¯-Cookie-amp-Session"><a href="#WEBå¼€å‘ä¼šè¯æŠ€æœ¯-Cookie-amp-Session" class="headerlink" title="WEBå¼€å‘ä¼šè¯æŠ€æœ¯-Cookie&amp;Session"></a>WEBå¼€å‘ä¼šè¯æŠ€æœ¯-Cookie&amp;Session</h2><h3 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>Â·ä»€ä¹ˆæ˜¯ä¼šè¯<br>ä¼šè¯å¯ç®€å•ç†è§£ä¸º:ç”¨æˆ·å¼€ä¸€ä¸ªæµè§ˆå™¨,ç‚¹å‡»å¤šä¸ªè¶…é“¾æ¥,è®¿é—®æœåŠ¡å™¨å¤šä¸ªwebèµ„æº,ç„¶åå…³é—­æµè§ˆå™¨,æ•´ä¸ªè¿‡ç¨‹ç§°ä¹‹ä¸ºä¸€ä¸ªä¼šè¯<br>Â·ä¼šè¯è¿‡ç¨‹ä¸­è¦è§£å†³çš„ä¸€äº›é—®é¢˜<br>æ¯ä¸ªç”¨æˆ·åœ¨ä½¿ç”¨æµè§ˆå™¨ä¸æœåŠ¡å™¨è¿›è¡Œä¼šè¯çš„è¿‡ç¨‹ä¸­,ä¸å¯é¿å…å„è‡ªä¼šäº§ç”Ÿä¸€äº›æ•°æ®,æœåŠ¡å™¨è¦æƒ³åŠæ³•ä¸ºæ¯ä¸ªç”¨æˆ·ä¿å­˜è¿™äº›æ•°æ®</p><h3 id="ä¼šè¯çš„ä¸¤ç§æŠ€æœ¯"><a href="#ä¼šè¯çš„ä¸¤ç§æŠ€æœ¯" class="headerlink" title="ä¼šè¯çš„ä¸¤ç§æŠ€æœ¯"></a>ä¼šè¯çš„ä¸¤ç§æŠ€æœ¯</h3><p>Â·Session<br>Â·Cookie</p><h3 id="CookieæŠ€æœ¯"><a href="#CookieæŠ€æœ¯" class="headerlink" title="CookieæŠ€æœ¯"></a>CookieæŠ€æœ¯</h3><p>Â·Cookieæ˜¯å®¢æˆ·ç«¯æŠ€æœ¯,æœåŠ¡å™¨æŠŠæ¯ä¸ªç”¨æˆ·çš„æ•°æ®ä»¥cookieçš„å½¢å¼å†™ç»™ç”¨æˆ·å„è‡ªçš„æµè§ˆå™¨,å½“ç”¨æˆ·ä½¿ç”¨æµè§ˆå™¨å†å»è®¿é—®æœåŠ¡å™¨ä¸­çš„web<br>èµ„æºæ—¶,å°±ä¼šå¸¦ç€å„è‡ªçš„æ•°æ®å»,è¿™æ ·,webèµ„æºå¤„ç†çš„å°±æ˜¯ç”¨æˆ·å„è‡ªçš„æ•°æ®äº†ã€‚<br>Â·Cookieæ˜¯æœåŠ¡å™¨åœ¨å®¢æˆ·ç«¯ä¿å­˜ç”¨æˆ·çš„ä¿¡æ¯,æ¯”å¦‚ç™»å½•å,æµè§ˆå†å²ç­‰<br>Â·Cookieä¿¡æ¯æ•°æ®é‡å¹¶ä¸å¤§,æœåŠ¡å™¨ç«¯åœ¨éœ€è¦çš„æ—¶å€™å¯ä»¥ä»å®¢æˆ·ç«¯/æµè§ˆå™¨è¯»å–(httpåè®®)<br>Â·Cookieæ•°æ®æ˜¯ä¿å­˜åœ¨æµè§ˆå™¨çš„</p><h4 id="ç¤ºæ„å›¾"><a href="#ç¤ºæ„å›¾" class="headerlink" title="ç¤ºæ„å›¾"></a>ç¤ºæ„å›¾</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/278faeb04750246bd5d32f1d1ba4a4ec.png"></div></div><h4 id="cookie-ç”Ÿå‘½å‘¨æœŸ"><a href="#cookie-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="cookie ç”Ÿå‘½å‘¨æœŸ"></a>cookie ç”Ÿå‘½å‘¨æœŸ</h4><p>1.Cookieçš„ç”Ÿå‘½å‘¨æœŸæŒ‡çš„æ˜¯å¦‚ä½•ç®¡ç†Cookieä»€ä¹ˆæ—¶å€™è¢«é”€æ¯(åˆ é™¤)<br>2.setMaxAge()<br>Â·æ­£æ•°,è¡¨ç¤ºåœ¨æŒ‡å®šçš„ç§’æ•°åè¿‡æœŸ<br>Â·è´Ÿæ•°,è¡¨ç¤ºæµè§ˆå™¨å…³é—­,Cookieå°±ä¼šè¢«åˆ é™¤<br>Â·0,è¡¨ç¤ºé©¬ä¸Šåˆ é™¤Cookie</p><h4 id="cookieæœ‰æ•ˆè·¯å¾„Pathçš„è®¾ç½®"><a href="#cookieæœ‰æ•ˆè·¯å¾„Pathçš„è®¾ç½®" class="headerlink" title="cookieæœ‰æ•ˆè·¯å¾„Pathçš„è®¾ç½®"></a>cookieæœ‰æ•ˆè·¯å¾„Pathçš„è®¾ç½®</h4><p>1.Cookieçš„pathå±æ€§å¯ä»¥æœ‰æ•ˆçš„è¿‡æ»¤é‚£äº›Cookieå¯ä»¥å‘é€ç»™æœåŠ¡å™¨,é‚£äº›ä¸å‘ã€‚pathå±æ€§æ˜¯é€šè¿‡è¯·æ±‚çš„åœ°å€æ¥è¿›è¡Œæœ‰æ•ˆçš„è¿‡æ»¤<br>2.è§„åˆ™å¦‚ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">cookie1<span class="token punctuation">.</span>setPath<span class="token operator">=</span><span class="token operator">/</span>å·¥ç¨‹è·¯å¾„cookie1<span class="token punctuation">.</span>setPath<span class="token operator">=</span><span class="token operator">/</span>å·¥ç¨‹è·¯å¾„<span class="token operator">/</span>aaaè¯·æ±‚çš„åœ°å€<span class="token operator">:</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>ip<span class="token operator">:</span>ç«¯å£<span class="token operator">/</span>å·¥ç¨‹è·¯å¾„<span class="token operator">/</span>èµ„æºcookie1ä¼šå‘ç»™æœåŠ¡å™¨cookie2ä¸ä¼šå‘ç»™æœåŠ¡å™¨<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Cookieç»å…¸æ¡ˆä¾‹-è‡ªåŠ¨å¡«å†™ç™»å½•è´¦å·"><a href="#Cookieç»å…¸æ¡ˆä¾‹-è‡ªåŠ¨å¡«å†™ç™»å½•è´¦å·" class="headerlink" title="Cookieç»å…¸æ¡ˆä¾‹-è‡ªåŠ¨å¡«å†™ç™»å½•è´¦å·"></a>Cookieç»å…¸æ¡ˆä¾‹-è‡ªåŠ¨å¡«å†™ç™»å½•è´¦å·</h4><p>Â·è¦æ±‚:éœ€æ±‚: å®Œæˆè‡ªåŠ¨å¡«å†™ç™»å½•è´¦æˆ·åº”ç”¨æ¡ˆä¾‹ , å¦‚æœç”¨æˆ·ç™»å½•æˆåŠŸï¼Œåˆ™ä¸‹æ¬¡ç™»å½•è‡ªåŠ¨å¡«å†™ç™»å½•</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>ç™»å½•é¡µé¢<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>ç”¨æˆ·ç™»å½•ç•Œé¢<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/loginServlet<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    u:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;cookie.get(<span class="token punctuation">"</span></span> <span class="token attr-name">username").value&#125;"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>    p:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pwd<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;cookie.get(<span class="token punctuation">"</span></span> <span class="token attr-name">pwd").value&#125;"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç™»å½•<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * @Author ç§¦å®¶å¤§èƒ– * @Date 2024/3/14 0014 17:33 * @Version 1.0 * æˆ‘äº¦æ— ä»–ï¼ŒæƒŸæ‰‹ç†Ÿå°” */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> username <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> pwd <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"pwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token string">"123"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>pwd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            writer<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"&lt;h1>login-ok&lt;/h1>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Cookie</span> cookieusername <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Cookie</span> cookiepwd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">"pwd"</span><span class="token punctuation">,</span> pwd<span class="token punctuation">)</span><span class="token punctuation">;</span>            cookieusername<span class="token punctuation">.</span><span class="token function">setMaxAge</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token operator">*</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            cookiepwd<span class="token punctuation">.</span><span class="token function">setMaxAge</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token operator">*</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            resp<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookieusername<span class="token punctuation">)</span><span class="token punctuation">;</span>            resp<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookiepwd<span class="token punctuation">)</span><span class="token punctuation">;</span>            resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/login.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="SessionæŠ€æœ¯"><a href="#SessionæŠ€æœ¯" class="headerlink" title="SessionæŠ€æœ¯"></a>SessionæŠ€æœ¯</h3><p>Â·Sessionæ˜¯æœåŠ¡å™¨ç«¯æŠ€æœ¯,æœåŠ¡å™¨åœ¨è¿è¡Œæ—¶ä¸ºæ¯ä¸€ä¸ªç”¨æˆ·çš„æµè§ˆå™¨åˆ›å»ºä¸€ä¸ªå…¶ç‹¬äº«çš„sessionå¯¹è±¡/é›†åˆ<br>Â·ç”±äºsessionä¸ºå„ä¸ªç”¨æˆ·æµè§ˆå™¨ç‹¬äº«,æ‰€ä»¥ç”¨æˆ·åœ¨è®¿é—®æœåŠ¡å™¨çš„ä¸åŒé¡µé¢æ—¶,å¯ä»¥ä»å„è‡ªçš„sessionä¸­è¯»å–/æ·»åŠ å…ƒç´ ,ä»è€Œå®Œæˆ<br>ç›¸åº”ä»»åŠ¡</p><h4 id="sessionåŸºæœ¬åŸç†ç¤ºæ„å›¾"><a href="#sessionåŸºæœ¬åŸç†ç¤ºæ„å›¾" class="headerlink" title="sessionåŸºæœ¬åŸç†ç¤ºæ„å›¾"></a>sessionåŸºæœ¬åŸç†ç¤ºæ„å›¾</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/0ca682a0a28e381d6613c8076ce68f0d.png"></div></div><p>1.å½“ç”¨æˆ·æ‰“å¼€æµè§ˆå™¨,è®¿é—®æŸä¸ªç½‘ç«™,æ“ä½œsession,æœåŠ¡å™¨å°±ä¼šåœ¨å†…å­˜(åœ¨æœåŠ¡ç«¯)ä¸ºè¯¥æµè§ˆå™¨åˆ†é…ä¸€ä¸ªsessionå¯¹è±¡,è¯¥session<br>å¯¹è±¡è¢«è¿™ä¸ªæµè§ˆå™¨ç‹¬å ã€‚<br>2.è¿™ä¸ªsessionå¯¹è±¡ä¹Ÿå¯çœ‹åšæ˜¯ä¸€ä¸ªå®¹å™¨/é›†åˆ,sessionå¯¹è±¡é»˜è®¤å­˜åœ¨æ—¶é—´ä¸º30min,è¿™æ˜¯åœ¨tomcat/conf/web.xml,ä¹Ÿå¯ä»¥ä¿®æ”¹</p><h4 id="sessionå¸¸ç”¨æ–¹æ³•"><a href="#sessionå¸¸ç”¨æ–¹æ³•" class="headerlink" title="sessionå¸¸ç”¨æ–¹æ³•"></a>sessionå¸¸ç”¨æ–¹æ³•</h4><p>1.åˆ›å»ºå’Œè·å– Sessionï¼ŒAPIä¸€æ ·<br>HttpSession hs=request.getSession();<br>ç¬¬1æ¬¡è°ƒç”¨æ˜¯åˆ›å»ºSessionä¼šè¯,ä¹‹åè°ƒç”¨æ˜¯è·å–åˆ›å»ºå¥½çš„Sessionå¯¹è±¡<br>2.å‘sessionæ·»åŠ å±æ€§<br>hs.setAttribute(String name,Object val);<br>3.ä»sessionå¾—åˆ°æŸä¸ªå±æ€§<br>Object obj=hs.getAttribute(String name);<br>4.ä» session åˆ é™¤è°ƒæŸä¸ªå±æ€§<br>hs.removeAttribute(String name);<br>5.æ¯ä¸ªSessionéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€è¡¨ç¤ºIdå€¼,é€šè¿‡getId()å¾—åˆ°Sessionçš„ä¼šè¯idå€¼</p><h4 id="åŸç†åˆ†æå›¾"><a href="#åŸç†åˆ†æå›¾" class="headerlink" title="åŸç†åˆ†æå›¾"></a>åŸç†åˆ†æå›¾</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/4271c34589640519fe7021cf5b6b49b7.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/af6b421258bf48a92e108926341bcc17.png"></div></div><h4 id="sessionç”Ÿå‘½å‘¨æœŸ"><a href="#sessionç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="sessionç”Ÿå‘½å‘¨æœŸ"></a>sessionç”Ÿå‘½å‘¨æœŸ</h4><p>1.public void setMaxInactiveInterval(int interval)è®¾ç½®Sessionçš„è¶…æ—¶æ—¶é—´(ä»¥ç§’ä¸ºå•ä½),è¶…è¿‡æŒ‡å®šçš„æ—¶é•¿,Session<br>å°±ä¼šè¢«é”€æ¯ã€‚<br>Â·å€¼ä¸ºæ­£æ•°çš„æ—¶å€™,è®¾å®šSessionçš„è¶…æ—¶æ—¶é•¿<br>Â·è´Ÿæ•°è¡¨ç¤ºæ°¸ä¸è¶…æ—¶<br>2.public void invalidate() è®©å½“å‰Sessionä¼šè¯ç«‹å³æ— æ•ˆ<br>3.æ²¡æœ‰æ²¡æœ‰è°ƒç”¨setMaxInactiveInterval()æ¥æŒ‡å®šSessionçš„ç”Ÿå‘½æ—¶é•¿,Tomcatä¼šä»¥Sessioné»˜è®¤æ—¶é•¿ä¸ºå‡†,Sessioné»˜è®¤çš„è¶…æ—¶ä¸º30åˆ†<br>4.Sessionçš„ç”Ÿå‘½å‘¨æœŸæŒ‡çš„æ˜¯:å®¢æˆ·ç«¯/æµè§ˆå™¨ä¸¤æ¬¡è¯·æ±‚çš„æœ€å¤§é—´éš”æ—¶é•¿,è€Œä¸æ˜¯ç´¯ç§¯æ—¶é•¿ã€‚å³å½“å®¢æˆ·ç«¯è®¿é—®äº†è‡ªå·±çš„session,session<br>çš„ç”Ÿå‘½å‘¨æœŸå°†ä»0å¼€å§‹é‡æ–°è®¡ç®—(è§£è¯»:æŒ‡çš„æ˜¯åŒä¸€ä¸ªä¼šè¯ä¸¤æ¬¡è¯·æ±‚ä¹‹é—´çš„é—´éš”æ—¶é—´)</p><h4 id="Sessionç»å…¸æ¡ˆä¾‹-é˜²æ­¢éæ³•è¿›å…¥ç®¡ç†é¡µé¢"><a href="#Sessionç»å…¸æ¡ˆä¾‹-é˜²æ­¢éæ³•è¿›å…¥ç®¡ç†é¡µé¢" class="headerlink" title="Sessionç»å…¸æ¡ˆä¾‹-é˜²æ­¢éæ³•è¿›å…¥ç®¡ç†é¡µé¢"></a>Sessionç»å…¸æ¡ˆä¾‹-é˜²æ­¢éæ³•è¿›å…¥ç®¡ç†é¡µé¢</h4><p>Â·éœ€æ±‚è¯´æ˜: å®Œæˆé˜²æ­¢ç”¨æˆ·ç™»å½•ç®¡ç†é¡µé¢åº”ç”¨æ¡ˆä¾‹<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>ç™»å½•é¡µé¢<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>ç”¨æˆ·ç™»å½•ç•Œé¢<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/loginCheckServlet<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    u:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;cookie.get(<span class="token punctuation">"</span></span><span class="token attr-name">username").value&#125;"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>    p:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pwd<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;cookie.get(<span class="token punctuation">"</span></span><span class="token attr-name">pwd").value&#125;"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç™»å½•<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * @Author ç§¦å®¶å¤§èƒ– * @Date 2024/3/14 0014 18:41 * @Version 1.0 * æˆ‘äº¦æ— ä»–ï¼ŒæƒŸæ‰‹ç†Ÿå°” */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginCheckServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> username <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> pwd <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"pwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token string">"123"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>pwd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>            session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"pwd"</span><span class="token punctuation">,</span>pwd<span class="token punctuation">)</span><span class="token punctuation">;</span>            req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"/manageServlet"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * @Author ç§¦å®¶å¤§èƒ– * @Date 2024/3/14 0014 18:43 * @Version 1.0 * æˆ‘äº¦æ— ä»–ï¼ŒæƒŸæ‰‹ç†Ÿå°” */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ManageServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>username<span class="token operator">==</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"ç®¡ç†å‘˜ç™»å½•æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"ç¦æ­¢ç›´æ¥è®¿é—®ç®¡ç†å‘˜ç•Œé¢"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token function">doPost</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="æœåŠ¡å™¨æ¸²æŸ“æŠ€æœ¯-JSP"><a href="#æœåŠ¡å™¨æ¸²æŸ“æŠ€æœ¯-JSP" class="headerlink" title="æœåŠ¡å™¨æ¸²æŸ“æŠ€æœ¯-JSP"></a>æœåŠ¡å™¨æ¸²æŸ“æŠ€æœ¯-JSP</h2><p>1.ç›®å‰ä¸»æµçš„æŠ€æœ¯æ˜¯å‰åç«¯åˆ†ç¦»(æ¯”å¦‚:Spring Boot+Vue/React)<br>2.JSPæŠ€æœ¯çš„ä½¿ç”¨åœ¨é€æ¸å‡å°‘,ä½†ä½¿ç”¨å°‘å’Œæ²¡æœ‰ä½¿ç”¨æ˜¯ä¸¤ä¸ªæ„æ€,ä¸€äº›è€é¡¹ç›®å’Œä¸­å°å…¬å¸è¿˜åœ¨ä½¿ç”¨</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦jsp"><a href="#ä¸ºä»€ä¹ˆéœ€è¦jsp" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦jsp"></a>ä¸ºä»€ä¹ˆéœ€è¦jsp</h3><p>Â·ç¨‹åºåœ¨å¼€å‘è¿‡ç¨‹ä¸­,å‘ç°servletåšç•Œé¢éå¸¸ä¸æ–¹ä¾¿,ServletåŠ¨æ€è¾“å…¥HTMLå¾ˆéº»çƒ¦<br>Â·ä¸ºä»€ä¹ˆä¸ä½¿ç”¨HTMLåšç•Œé¢,åº”ä¸ºHTMLæœ‰éƒ¨åˆ†æ•°æ®éœ€è¦åŠ¨æ€å¾—åˆ°</p><h3 id="JSPå…¬å¼"><a href="#JSPå…¬å¼" class="headerlink" title="JSPå…¬å¼"></a>JSPå…¬å¼</h3><p>jsp=html+java ç‰‡æ®µ+æ ‡ç­¾+javascript+css</p><h3 id="JSPåŸºæœ¬ä»‹ç»"><a href="#JSPåŸºæœ¬ä»‹ç»" class="headerlink" title="JSPåŸºæœ¬ä»‹ç»"></a>JSPåŸºæœ¬ä»‹ç»</h3><p>1.JSPå…¨ç§°æ˜¯Java Servlet Page Javaçš„æœåŠ¡å™¨ç•Œé¢<br>2.JSP è¿™é—¨æŠ€æœ¯çš„æœ€å¤§çš„ç‰¹ç‚¹åœ¨äºï¼Œå†™ JSP å°±åƒåœ¨å†™ HTML<br>3.ç›¸æ¯” html è€Œè¨€ï¼Œhtml åªèƒ½ä¸ºç”¨æˆ·æä¾›é™æ€æ•°æ®ï¼Œè€Œ JSP æŠ€æœ¯å…è®¸åœ¨é¡µé¢ä¸­åµŒå¥— java ä»£ç ,ä¸ºç”¨æˆ·æä¾›åŠ¨æ€æ•°æ®<br>4.ç›¸æ¯” Servlet è€Œè¨€ï¼ŒServlet å¾ˆéš¾å¯¹æ•°æ®è¿›è¡Œæ’ç‰ˆï¼Œè€Œ jsp é™¤äº†å¯ä»¥ç”¨ java ä»£ç äº§ç”ŸåŠ¨æ€æ•°æ®çš„åŒæ—¶ï¼Œä¹Ÿå¾ˆå®¹æ˜“å¯¹æ•°æ®è¿›è¡Œæ’ç‰ˆã€‚<br>5.jsp æŠ€æœ¯åŸºäº Servlet, ä½ å¯ä»¥ç†è§£æˆ JSP å°±æ˜¯å¯¹ Servlet çš„åŒ…è£…</p><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>Â·jspé¡µé¢ä¸èƒ½åƒHTMLé¡µé¢,ç›´æ¥ç”¨æµè§ˆå™¨è¿è¡Œ,åªèƒ½é€šè¿‡æµè§ˆå™¨è®¿é—®Tomcatæ¥è®¿é—®jspé¡µé¢</p><h3 id="JSPè¿è¡ŒåŸç†"><a href="#JSPè¿è¡ŒåŸç†" class="headerlink" title="JSPè¿è¡ŒåŸç†"></a>JSPè¿è¡ŒåŸç†</h3><p>1.jspé¡µé¢æœ¬è´¨æ˜¯ä¸€ä¸ªServletç¨‹åº,å…¶æ€§èƒ½æ˜¯å’ŒJavaå…³è”çš„ã€‚<br>2.ç¬¬ä¸€æ¬¡è®¿é—®jspé¡µé¢çš„æ—¶å€™,TomcatæœåŠ¡å™¨ä¼šæŠŠjspé¡µé¢è§£ææˆä¸ºä¸€ä¸ªjavaæºæ–‡ä»¶ã€‚å¹¶ä¸”å¯¹å®ƒè¿›è¡Œç¼–è¯‘æˆä¸º.classå­—èŠ‚ç ç¨‹åº</p><h3 id="JSPçš„ä¸‰ç§å¸¸ç”¨è„šæœ¬-å£°æ˜è„šæœ¬-è¡¨è¾¾å¼è„šæœ¬-ä»£ç è„šæœ¬"><a href="#JSPçš„ä¸‰ç§å¸¸ç”¨è„šæœ¬-å£°æ˜è„šæœ¬-è¡¨è¾¾å¼è„šæœ¬-ä»£ç è„šæœ¬" class="headerlink" title="JSPçš„ä¸‰ç§å¸¸ç”¨è„šæœ¬ å£°æ˜è„šæœ¬,è¡¨è¾¾å¼è„šæœ¬,ä»£ç è„šæœ¬"></a>JSPçš„ä¸‰ç§å¸¸ç”¨è„šæœ¬ å£°æ˜è„šæœ¬,è¡¨è¾¾å¼è„šæœ¬,ä»£ç è„šæœ¬</h3><h4 id="å£°æ˜è„šæœ¬"><a href="#å£°æ˜è„šæœ¬" class="headerlink" title="å£°æ˜è„šæœ¬"></a>å£°æ˜è„šæœ¬</h4><p>Â·å£°æ˜è„šæœ¬çš„æ ¼å¼æ˜¯:&lt;%!å£°æ˜Javaä»£ç %&gt;<br>Â·ä½œç”¨:å®šä¹‰jspçš„éœ€è¦å±æ€§,æ–¹æ³•,é™æ€ä»£ç å—å’Œå†…éƒ¨ç±»ç­‰<br>Â·ä¾‹<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;%!private Integer id;private String name = "è€éŸ©åŒå­¦";private String job;private static String company;private Double sal;//é™æ€ä»£ç å—static &#123;company = "å­—èŠ‚è·³åŠ¨";&#125;//å£°æ˜æ–¹æ³•public String getName() &#123;return name;&#125;%><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="è¡¨è¾¾å¼è„šæœ¬"><a href="#è¡¨è¾¾å¼è„šæœ¬" class="headerlink" title="è¡¨è¾¾å¼è„šæœ¬"></a>è¡¨è¾¾å¼è„šæœ¬</h4><p>Â·åŸºæœ¬è¯­æ³•&lt;%=è¡¨è¾¾å¼%&gt;<br>Â·è¡¨è¾¾å¼è„šæœ¬çš„ä½œç”¨æ˜¯:åœ¨jspé¡µé¢ä¸Šè¾“å‡ºæ•°æ®<br>Â·è¡¨è¾¾å¼è„šæœ¬ä¸­çš„è¡¨è¾¾å¼ä¸èƒ½ä»¥åˆ†å·ç»“æŸ<br>Â·ä¾‹<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;%!String name = "éŸ©é¡ºå¹³æ•™è‚²";%><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>ä¸ªäººä¿¡æ¯<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>ç”¨æˆ·å=&lt;%=name%><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>å·¥ä½œæ˜¯:&lt;%="Javaå·¥ç¨‹å¸ˆ"%><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>å¾—åˆ°å‚æ•°:&lt;%=request.getParameter("sex")%><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="ä»£ç è„šæœ¬"><a href="#ä»£ç è„šæœ¬" class="headerlink" title="ä»£ç è„šæœ¬"></a>ä»£ç è„šæœ¬</h4><p>Â·åŸºæœ¬è¯­æ³•:&lt;%javaä»£ç %&gt;<br>Â·ä»£ç è„šæœ¬çš„ä½œç”¨æ˜¯:å¯ä»¥åœ¨jspé¡µé¢ä¸­,ç¼–å†™æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½(ä½¿ç”¨Java)<br>Â·å¯ä»¥ç”±å¤šä¸ªä»£ç è„šæœ¬å—ç»„åˆå®Œæˆä¸€ä¸ªå®Œæ•´çš„Javaè¯­å¥<br>Â·ä»£ç è„šæœ¬è¿˜å¯ä»¥å’Œè¡¨è¾¾å¼è„šæœ¬ä¸€èµ·ç»„åˆä½¿ç”¨,åœ¨jspé¡µé¢ä¸Šè¾“å‡ºæ•°æ®<br>Â·ä¾‹<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>è®¡ç®—ç»“æœ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>&lt;%ArrayList<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Monster</span><span class="token punctuation">></span></span> list = new ArrayList&lt;>();list.add(new Monster(1, "ç‰›é­”ç‹", "èŠ­è•‰æ‰‡"));list.add(new Monster(2, "èœ˜è››ç²¾", "åå£æ°´"));%><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">bgcolor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#f0f8ff<span class="token punctuation">"</span></span> <span class="token attr-name">border</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1px<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500px<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>skill<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span> &lt;%    for(int i=0;i<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list.size();i++)&#123;</span>       <span class="token attr-name">Monster</span> <span class="token attr-name">monster</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>list.get(i);</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>&lt;%=monster.getId()%><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>&lt;%=monster.getName()%><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>&lt;%=monster.getSkill()%><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span> &lt;%    &#125; %>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="JSPå†…ç½®å¯¹è±¡"><a href="#JSPå†…ç½®å¯¹è±¡" class="headerlink" title="JSPå†…ç½®å¯¹è±¡"></a>JSPå†…ç½®å¯¹è±¡</h3><h4 id="åŸºæœ¬ä»‹ç»-1"><a href="#åŸºæœ¬ä»‹ç»-1" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h4><p>1.JSPå†…ç½®å¯¹è±¡,æ˜¯æŒ‡Tomcatåœ¨ç¿»è¯‘jspé¡µé¢æˆä¸ºServletå,å†…éƒ¨æä¾›çš„ä¹å¤§å¯¹è±¡,å«å†…ç½®å¯¹è±¡<br>2.å†…ç½®å¯¹è±¡,å¯ä»¥ç›´æ¥ä½¿ç”¨,ä¸éœ€è¦æ‰‹åŠ¨å®šä¹‰</p><h4 id="ä¹å¤§å†…ç½®å¯¹è±¡"><a href="#ä¹å¤§å†…ç½®å¯¹è±¡" class="headerlink" title="ä¹å¤§å†…ç½®å¯¹è±¡"></a>ä¹å¤§å†…ç½®å¯¹è±¡</h4><p>1.outé¦™ç§‘çŸ­è¾“å‡ºæ•°æ®,out.println(â€œâ€);<br>2.requestå®¢æˆ·ç«¯çš„httpè¯·æ±‚<br>3.responseå“åº”å¯¹è±¡<br>4.sessionä¼šè¯å¯¹è±¡<br>5.applicationå¯¹åº”ServletContext<br>6.pageContext jspé¡µé¢çš„ä¸Šä¸‹æ–‡,æ˜¯ä¸€ä¸ªåŸŸå¯¹è±¡,å¯ä»¥setAttribute(),ä½œç”¨èŒƒå›´åªæ˜¯æœ¬é¡µé¢<br>7.exceptionå¼‚å¸¸å¯¹è±¡<br>8.page ä»£è¡¨jspè¿™ä¸ªå®ä¾‹æœ¬èº«<br>9.config å¯¹åº”ServletConfig<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;%//jsp ä¸­å¯ä»¥ä½¿ç”¨çš„å†…ç½®å¯¹è±¡:ä¸ç”¨åˆ›å»º,ç›´æ¥ä½¿ç”¨out.println("out å¯¹è±¡..");String age = request.getParameter("age");//response.sendRedirect("http://www.baidu.com");session.setAttribute("name", "jack");//application ç­‰ä»· servlet çš„ servletContextapplication.setAttribute("company", "åŒ—äº¬éŸ©é¡ºå¹³æ•™è‚²");//æœ¬é¡µé¢æœ‰æ•ˆpageContext.setAttribute("num1", 900);//pageout.println("page= " + page);//ä½¿ç”¨ configString pwd = config.getInitParameter("pwd");%><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="JSPå››å¤§åŸŸå¯¹è±¡ã€ä½œç”¨å­˜å–æ•°æ®ã€‘"><a href="#JSPå››å¤§åŸŸå¯¹è±¡ã€ä½œç”¨å­˜å–æ•°æ®ã€‘" class="headerlink" title="JSPå››å¤§åŸŸå¯¹è±¡ã€ä½œç”¨å­˜å–æ•°æ®ã€‘"></a>JSPå››å¤§åŸŸå¯¹è±¡ã€ä½œç”¨å­˜å–æ•°æ®ã€‘</h3><p>1.pageContext(åŸŸå¯¹è±¡,å­˜æ”¾çš„æ•°æ®åªèƒ½åœ¨å½“å‰çš„é¡µé¢ä½¿ç”¨);<br>2.request(åŸŸå¯¹è±¡,å­˜æ”¾çš„æ•°æ®åœ¨ä¸€æ¬¡requestè¯·æ±‚æœ‰æ•ˆ);<br>Â·åœ¨ä¸€æ¬¡httpè¯·æ±‚æœ‰æ•ˆ,å¦‚æœrequestå¯¹è±¡æ²¡æœ‰å˜åŒ–,åˆ™å¯ä»¥ä¸€ç›´å–ã€‚<br>3.session(åŸŸå¯¹è±¡,å­˜æ”¾çš„æ•°æ®åœ¨ä¸€æ¬¡ä¼šè¯æœ‰æ•ˆ);<br>Â·åœ¨å¤šæ¬¡httpè¯·æ±‚æœ‰æ•ˆ,åªè¦ä¼šè¯æ²¡æœ‰å˜,åˆ™å¯ä»¥ä¸€ç›´å–ã€‚<br>4.application(åŸŸå¯¹è±¡,å­˜æ”¾çš„æ•°æ®åœ¨æ•´ä¸ªwebåº”ç”¨è¿è¡ŒæœŸé—´æœ‰æ•ˆ,èŒƒå›´æ›´å¤§);</p><h4 id="JSPå››å¤§ä¸å¯¹è±¡æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#JSPå››å¤§ä¸å¯¹è±¡æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="JSPå››å¤§ä¸å¯¹è±¡æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>JSPå››å¤§ä¸å¯¹è±¡æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><p>1.åŸŸå¯¹è±¡æ˜¯å¯ä»¥åƒMapä¸€æ ·å­˜å–æ•°æ®çš„å¯¹è±¡,å››ä¸ªåŸŸå¯¹è±¡åŠŸèƒ½ä¸€æ ·ã€‚ä¸åŒçš„æ˜¯å®ƒä»¬å¯¹æ•°æ®çš„å­˜å‚¨èŒƒå›´<br>2.ä»å­˜å‚¨èŒƒå›´(ä½œç”¨åŸŸèŒƒå›´çœ‹)pageContext&lt;request&lt;session&lt;application</p><h4 id="JSPè¯·æ±‚è½¬å‘æ ‡ç­¾"><a href="#JSPè¯·æ±‚è½¬å‘æ ‡ç­¾" class="headerlink" title="JSPè¯·æ±‚è½¬å‘æ ‡ç­¾"></a>JSPè¯·æ±‚è½¬å‘æ ‡ç­¾</h4><p><jsp:forward page="/bb.jsp">&lt;/jsp:forward&gt;</jsp:forward></p><h3 id="ELè¡¨è¾¾å¼"><a href="#ELè¡¨è¾¾å¼" class="headerlink" title="ELè¡¨è¾¾å¼"></a>ELè¡¨è¾¾å¼</h3><h4 id="ELè¡¨è¾¾å¼ä»‹ç»"><a href="#ELè¡¨è¾¾å¼ä»‹ç»" class="headerlink" title="ELè¡¨è¾¾å¼ä»‹ç»"></a>ELè¡¨è¾¾å¼ä»‹ç»</h4><p>1.ELè¡¨è¾¾å¼ä¸»è¦æ˜¯ä»£æ›¿jspé¡µé¢çš„è¡¨è¾¾å¼è„šæœ¬&lt;%=request.getAttribute(â€œxxâ€â€)%&gt;<br>2.ELè¡¨è¾¾å¼è¾“å‡ºæ•°æ®çš„æ—¶å€™,æ¯”jspçš„è¡¨è¾¾å¼è„šæœ¬ç®€æ´<br>3.ELè¡¨è¾¾å¼åŸºæœ¬è¯­æ³•:${key1}ã€‚<br>4.ELè¡¨è¾¾å¼å¸¸ç”¨è¾“å‡ºBeançš„æ™®é€šå±æ€§,æ•°ç»„å±æ€§,Listé›†åˆå’Œmapé›†åˆå±æ€§<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;%Book book=new Book();book.setName("æ˜†è™«æ€»åŠ¨å‘˜");book.setWriter(new String[]&#123;"jack", "tom", "terry"&#125;);pageContext.setAttribute("book", book);ArrayList<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>String</span><span class="token punctuation">></span></span> readers = new ArrayList&lt;>();    readers.add("æ±¤å§†");    readers.add("ç›ä¸½");    readers.add("ç±³å…°");    book.setReader(readers);    HashMap    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>String</span> <span class="token attr-name">,</span> <span class="token attr-name">Object</span><span class="token punctuation">></span></span> topics = new HashMap&lt;>();        topics.put("key1", "è¿™æ˜¯æˆ‘çœ‹è¿‡çš„æœ€å¥½çš„åŠ¨ç”»ç‰‡");        topics.put("key2", "æ˜†è™«æ€»åŠ¨å‘˜ 2ï¼Œéå¸¸æœŸå¾…..");        topics.put("3", "æ˜†è™«æ€»åŠ¨å‘˜ 3ï¼Œéå¸¸æœŸå¾…..");        book.setTopics(topics);        %>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>ELè¾“å‡ºæ•°æ®<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>        bookä¿¡æ¯:$&#123;book&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>        <span class="token comment">&lt;!--$&#123;book.name&#125;è°ƒç”¨çš„å°±æ˜¯getName()--></span>        book.name:$&#123;book.name&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>        book.writerçš„ç¬¬ä¸€ä¸ªå…ƒç´ :$&#123;book.writer[0]&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>        book.reader é›†åˆï¼š$&#123;book.reader&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>        book.reader é›†åˆç¬¬ä¸‰ä¸ªå…ƒç´ ï¼š$&#123;book.reader[2]&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>        book çš„ Map é›†åˆ: $&#123;book.topics&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>        book çš„ Map é›†åˆ key1 çš„å€¼: $&#123;book.topics.key1&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>        &lt;%-- map ç‰¹æ®Šå­—ç¬¦ key å¯ä»¥ç”¨[]æ–¹å¼æ¥è¯»å–,æ¯”å¦‚å°± book.topics['1'] --%>        book çš„ Map é›†åˆ key2 çš„å€¼: $&#123;book.topics['key2']&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>        book çš„ Map é›†åˆ key=3 çš„å€¼: $&#123;book.topics['3']&#125;&lt;br<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="ELçš„11ä¸ªéšå«å¯¹è±¡"><a href="#ELçš„11ä¸ªéšå«å¯¹è±¡" class="headerlink" title="ELçš„11ä¸ªéšå«å¯¹è±¡"></a>ELçš„11ä¸ªéšå«å¯¹è±¡</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/0a71a49efb765608f0da0ffe0e4c7b09.png"></div></div><h4 id="ELè¡¨è¾¾å¼åŸŸå¯¹è±¡çš„æ³¨æ„äº‹é¡¹"><a href="#ELè¡¨è¾¾å¼åŸŸå¯¹è±¡çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="ELè¡¨è¾¾å¼åŸŸå¯¹è±¡çš„æ³¨æ„äº‹é¡¹"></a>ELè¡¨è¾¾å¼åŸŸå¯¹è±¡çš„æ³¨æ„äº‹é¡¹</h4><p>ä½œç”¨åŸŸä¼˜å…ˆçº§ï¼špageScope &gt; requestScope &gt; sessionScope &gt; applicationScope<br>å¦‚æœæ²¡æœ‰ç»™å®šå–å€¼ä½œç”¨åŸŸ,åˆ™é»˜è®¤ä»pageScopeæ¥æ—¶æŸ¥æ‰¾,æ‰¾åˆ°åˆ™è¿”å›,æ²¡æœ‰æ‰¾åˆ°åˆ™æŒ‰ç…§ä¸Šè¿°é¡ºåºç»§ç»­æŸ¥æ‰¾,ç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢</p><h3 id="JSTLæ ‡ç­¾åº“"><a href="#JSTLæ ‡ç­¾åº“" class="headerlink" title="JSTLæ ‡ç­¾åº“"></a>JSTLæ ‡ç­¾åº“</h3><h4 id="JSTLæ ‡ç­¾åº“çš„ä»‹ç»"><a href="#JSTLæ ‡ç­¾åº“çš„ä»‹ç»" class="headerlink" title="JSTLæ ‡ç­¾åº“çš„ä»‹ç»"></a>JSTLæ ‡ç­¾åº“çš„ä»‹ç»</h4><p>1.ELè¡¨è¾¾å¼æ˜¯ä¸ºäº†æ›¿æ¢jspä¸­çš„è¡¨è¾¾å¼è„šæœ¬,JSTLæ˜¯ä¸ºäº†æ›¿æ¢ä»£ç è„šæœ¬,è¿™æ ·jspé¡µé¢å˜å¾—æ›´åŠ ç®€æ´<br>2.ä½¿ç”¨JSTL,éœ€è¦å¯¼å…¥ç›¸å…³çš„jaråŒ…</p><h4 id="coreæ ¸å¿ƒåº“"><a href="#coreæ ¸å¿ƒåº“" class="headerlink" title="coreæ ¸å¿ƒåº“"></a>coreæ ¸å¿ƒåº“</h4><p>1.&lt; c:set/ &gt;ä»‹ç»</p><p><c:set scope="request" var="username" value="ç§¦ä¸‰é¡º"><br>&lt; c:set/ &gt;setæ ‡ç­¾å¯ä»¥å¾€åŸŸä¸­ä¿å­˜æ•°æ®<br>Â·ç­‰ä»·äºåŸŸå¯¹è±¡.setAttribute(key,value)<br>Â·scope å±æ€§è®¾ç½®ä¿å­˜åˆ°é‚£ä¸ªåŸŸ:page,request,session,application<br>Â·var å±æ€§è®¾ç½®keyæ˜¯ä»€ä¹ˆ<br>Â·value å±æ€§è®¾ç½®å€¼<br>2.&lt; c:if/ &gt;ä»‹ç»</c:set></p><p><c:if test="${ 10 > 2 }">hello&lt;/c:if&gt;<br>Â·ifæ ‡ç­¾ç”¨æ¥åšifåˆ¤æ–­<br>Â·testå±æ€§è¡¨ç¤ºåˆ¤æ–­çš„æ¡ä»¶(ç”¨ELè¡¨è¾¾å¼è¾“å‡º)<br>3.&lt; c:choose  &lt; :when &gt; &lt; c:otherwise &gt;æ ‡ç­¾<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">c:</span>choose</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">c:</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123; requestScope.money > 20000 &#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        æœ‰é’±äºº    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">c:</span>when</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">c:</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123; requestScope.money > 15000 &#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        æ¯”è¾ƒæœ‰é’±    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">c:</span>when</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">c:</span>otherwise</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">c:</span>choose</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">c:</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123; requestScope.money > 10000 &#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                æ²¡å•¥é’±            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">c:</span>when</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">c:</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> $&#123;requestScope.money> 5000&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                åªå¤Ÿæ¸©é¥±äº†            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">c:</span>when</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">c:</span>otherwise</span><span class="token punctuation">></span></span>åƒäº†é¥­ï¼Œæ²¡é’±ç§Ÿæˆ¿äº†<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">c:</span>otherwise</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">c:</span>choose</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">c:</span>otherwise</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">c:</span>choose</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>4.&lt; c:forEach/&gt;æ ‡ç­¾<br>c:forEach æ ‡ç­¾ç”¨æ¥éå†è¾“å‡º,ä¸»è¦æœ‰å››ç§å½¢å¼<br>Â·æ™®é€šéå†è¾“å‡ºiåˆ°j<br>Â·éå†æ•°ç»„<br>Â·éå†Map<br>Â·éå†List<br><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--è¿™é‡Œçš„itemsä½¿ç”¨ELè¡¨è¾¾å¼,ç›´æ¥ä»åç«¯å–--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">c:</span>forEach</span> <span class="token attr-name">items</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;monsters&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">var</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">c:</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;monster.id >= 200&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>$&#123;monster.id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>$&#123;monster.name&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>$&#123;monster.skill&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">c:</span>if</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">c:</span>forEach</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></c:if></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title&gt;&lt;/a&gt;&lt;div class=&quot;note purple no-icon flat&quot;&gt;&lt;p&gt;javaWebå¤ä¹  &lt;/p&gt;
&lt;/div&gt;&lt;/h1&gt;&lt;h2 id=&quot;WEBå·¥ç¨‹è·¯å¾„&quot;&gt;&lt;a href=</summary>
      
    
    
    
    <category term="javaWeb" scheme="https://100qin10086.github.io/categories/javaWeb/"/>
    
    
    <category term="javaWeb" scheme="https://100qin10086.github.io/tags/javaWeb/"/>
    
  </entry>
  
  <entry>
    <title>javaWebå¤ä¹ 3</title>
    <link href="https://100qin10086.github.io/posts/c1cddc3a.html"/>
    <id>https://100qin10086.github.io/posts/c1cddc3a.html</id>
    <published>2024-03-13T08:09:58.000Z</published>
    <updated>2024-05-06T14:13:59.610Z</updated>
    
    <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a><div class="note purple no-icon flat"><p>javaWebå¤ä¹  </p></div></h1><h2 id="æ‰‹åŠ¨å®ç°Tomcatåº•å±‚æœºåˆ¶-è‡ªå·±è®¾è®¡Servlet"><a href="#æ‰‹åŠ¨å®ç°Tomcatåº•å±‚æœºåˆ¶-è‡ªå·±è®¾è®¡Servlet" class="headerlink" title="æ‰‹åŠ¨å®ç°Tomcatåº•å±‚æœºåˆ¶+è‡ªå·±è®¾è®¡Servlet"></a>æ‰‹åŠ¨å®ç°Tomcatåº•å±‚æœºåˆ¶+è‡ªå·±è®¾è®¡Servlet</h2><h3 id="å®ç°é˜¶æ®µ1-ç¼–å†™è‡ªå·±çš„Tomcat-èƒ½ç»™æµè§ˆå™¨è¿”å›Hi-Hello"><a href="#å®ç°é˜¶æ®µ1-ç¼–å†™è‡ªå·±çš„Tomcat-èƒ½ç»™æµè§ˆå™¨è¿”å›Hi-Hello" class="headerlink" title="å®ç°é˜¶æ®µ1-ç¼–å†™è‡ªå·±çš„Tomcat,èƒ½ç»™æµè§ˆå™¨è¿”å›Hi,Hello"></a>å®ç°é˜¶æ®µ1-ç¼–å†™è‡ªå·±çš„Tomcat,èƒ½ç»™æµè§ˆå™¨è¿”å›Hi,Hello</h3><h4 id="åˆ†æç¤ºæ„å›¾"><a href="#åˆ†æç¤ºæ„å›¾" class="headerlink" title="åˆ†æç¤ºæ„å›¾"></a>åˆ†æç¤ºæ„å›¾</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/e59687a970dedfb08a6805b1d50ef400.png"></div></div><h4 id="åŸºäºsocketå¼€å‘æœåŠ¡ç«¯æµç¨‹"><a href="#åŸºäºsocketå¼€å‘æœåŠ¡ç«¯æµç¨‹" class="headerlink" title="åŸºäºsocketå¼€å‘æœåŠ¡ç«¯æµç¨‹"></a>åŸºäºsocketå¼€å‘æœåŠ¡ç«¯æµç¨‹</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/6b150300e8ed7cbac3edbf01f930a760.png"></div></div><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QgqTomcatV1</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åœ¨9999ç«¯å£ç›‘å¬</span>        <span class="token class-name">ServerSocket</span> serverSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å¦‚æœserverSocketæ²¡æœ‰å…³é—­,å°±ç­‰å¾…è¿æ¥ï¼Œä¸åœçš„ç­‰å¾…</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>serverSocket<span class="token punctuation">.</span><span class="token function">isClosed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=====æˆ‘çš„ web æœåŠ¡åœ¨ 9999 ç«¯å£ç›‘å¬====="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//2. ç­‰å¾…æµè§ˆå™¨/å®¢æˆ·ç«¯è¿æ¥, å¾—åˆ° socket</span>            <span class="token class-name">Socket</span> socket <span class="token operator">=</span> serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//3ã€‚é€šè¿‡socketå¾—åˆ°è¾“å‡ºæµ</span>            <span class="token class-name">OutputStream</span> outputStream <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            outputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"this a web server"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        serverSocket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h4><p>Â·æ²¡æœ‰ç¤ºæ„BIOçº¿ç¨‹æ¨¡å‹,æ²¡æœ‰å®ç°å¤šçº¿ç¨‹,æ€§èƒ½å·®</p><h3 id="ä½¿ç”¨BIOçº¿ç¨‹æ¨¡å‹-æ”¯æŒå¤šçº¿ç¨‹"><a href="#ä½¿ç”¨BIOçº¿ç¨‹æ¨¡å‹-æ”¯æŒå¤šçº¿ç¨‹" class="headerlink" title="ä½¿ç”¨BIOçº¿ç¨‹æ¨¡å‹,æ”¯æŒå¤šçº¿ç¨‹"></a>ä½¿ç”¨BIOçº¿ç¨‹æ¨¡å‹,æ”¯æŒå¤šçº¿ç¨‹</h3><h4 id="BIOçº¿ç¨‹æ¨¡å‹ä»‹ç»"><a href="#BIOçº¿ç¨‹æ¨¡å‹ä»‹ç»" class="headerlink" title="BIOçº¿ç¨‹æ¨¡å‹ä»‹ç»"></a>BIOçº¿ç¨‹æ¨¡å‹ä»‹ç»</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/9c33b5a73c230d62b4dbc97d588c1ff6.png"></div></div><h4 id="åˆ†æç¤ºæ„å›¾-1"><a href="#åˆ†æç¤ºæ„å›¾-1" class="headerlink" title="åˆ†æç¤ºæ„å›¾"></a>åˆ†æç¤ºæ„å›¾</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/605d126e8cc3cd2fb07c1aa9aa5d30e3.png"></div></div><h4 id="ä»£ç å®ç°è§æœ€å"><a href="#ä»£ç å®ç°è§æœ€å" class="headerlink" title="ä»£ç å®ç°è§æœ€å"></a>ä»£ç å®ç°è§æœ€å</h4><h4 id="é—®é¢˜åˆ†æ-MyTomcatåªæ˜¯ç®€å•çš„è¿”å›ç»“æœ-æ²¡æœ‰å’ŒServlet-web-xmlå…³è”"><a href="#é—®é¢˜åˆ†æ-MyTomcatåªæ˜¯ç®€å•çš„è¿”å›ç»“æœ-æ²¡æœ‰å’ŒServlet-web-xmlå…³è”" class="headerlink" title="é—®é¢˜åˆ†æ:MyTomcatåªæ˜¯ç®€å•çš„è¿”å›ç»“æœ,æ²¡æœ‰å’ŒServlet,web.xmlå…³è”"></a>é—®é¢˜åˆ†æ:MyTomcatåªæ˜¯ç®€å•çš„è¿”å›ç»“æœ,æ²¡æœ‰å’ŒServlet,web.xmlå…³è”</h4><h3 id="å®ç°ä»»åŠ¡é˜¶æ®µ-3-å¤„ç†-Servlet"><a href="#å®ç°ä»»åŠ¡é˜¶æ®µ-3-å¤„ç†-Servlet" class="headerlink" title="å®ç°ä»»åŠ¡é˜¶æ®µ 3- å¤„ç† Servlet"></a>å®ç°ä»»åŠ¡é˜¶æ®µ 3- å¤„ç† Servlet</h3><h4 id="åˆ†æç¤ºæ„å›¾-2"><a href="#åˆ†æç¤ºæ„å›¾-2" class="headerlink" title="åˆ†æç¤ºæ„å›¾"></a>åˆ†æç¤ºæ„å›¾</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/395789cd99475692c7aca0da8dd9303f.png"></div></div><h4 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><div class="tabs" id><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#-1">QgqRequestHandler</button></li><li class="tab"><button type="button" data-href="#-2">QgqRequest</button></li><li class="tab"><button type="button" data-href="#-3">QgqResponse</button></li><li class="tab"><button type="button" data-href="#-4">QgqCalServlet</button></li><li class="tab"><button type="button" data-href="#-5">QgqHttpServlet</button></li><li class="tab"><button type="button" data-href="#-6">QgqServlet</button></li><li class="tab"><button type="button" data-href="#-7">QgqTomcatV3</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="-1"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * @Author ç§¦å®¶å¤§èƒ– * @Date 2024/3/13 0013 16:16 * @Version 1.0 * æˆ‘äº¦æ— ä»–ï¼ŒæƒŸæ‰‹ç†Ÿå°” */</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span></span><span class="token class-name">QgqTomcatV3</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">QgqRequest</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">QgqResponse</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">QgqCalServlet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">QgqHttpServlet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">OutputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">Socket</span></span><span class="token punctuation">;</span><span class="token comment">/** * è§£è¯» * 1.QgqRequestHandlerå¯¹è±¡æ˜¯ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ * 2.å¤„ç†ä¸€ä¸ªhttpè¯·æ±‚çš„ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QgqRequestHandler</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">&#123;</span>    <span class="token comment">//å®šä¹‰Socket</span>    <span class="token keyword">private</span> <span class="token class-name">Socket</span> socket<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">QgqRequestHandler</span><span class="token punctuation">(</span><span class="token class-name">Socket</span> socket<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>socket <span class="token operator">=</span> socket<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//è¿™é‡Œæˆ‘ä»¬å¯ä»¥å¯¹å®¢æˆ·ç«¯/æµè§ˆå™¨è¿›è¡ŒIOç¼–ç¨‹/äº¤äº’</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//InputStream inputStream = socket.getInputStream();</span>            <span class="token comment">//æŠŠinputStream->BufferedReader->æ–¹ä¾¿è¿›è¡ŒæŒ‰è¡Œè¯»å–</span>            <span class="token comment">//BufferedReader bufferedReader =</span>            <span class="token comment">//        new BufferedReader(new InputStreamReader(inputStream,"utf-8"));</span>            <span class="token comment">//System.out.println("=====qgqtomcatv2æ¥æ”¶çš„æ•°æ®å¦‚ä¸‹=====");</span>            <span class="token comment">//String mes=null;</span>            <span class="token comment">//while((mes=bufferedReader.readLine())!=null)&#123;</span>            <span class="token comment">//    //å¦‚æœé•¿åº¦ä¸º0</span>            <span class="token comment">//    if (mes.length()==0)&#123;</span>            <span class="token comment">//        break;//é€€å‡º</span>            <span class="token comment">//    &#125;</span>            <span class="token comment">//    System.out.println(mes);</span>            <span class="token comment">//&#125;</span>            <span class="token class-name">QgqRequest</span> qgqRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QgqRequest</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//String num1 = qgqRequest.getParameter("num1");</span>            <span class="token comment">//String num2 = qgqRequest.getParameter("num2");</span>            <span class="token comment">//System.out.println("num1"+num1);</span>            <span class="token comment">//System.out.println("num2"+num2);</span>            <span class="token comment">////è¿”å›æ•°æ®ç»™æµè§ˆå™¨->å°è£…æˆhttpå“åº”</span>            <span class="token class-name">QgqResponse</span> qgqResponse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QgqResponse</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//String resp=QgqResponse.respHeader+"&lt;h1>hi qgq æ‰‹å†™tomcat&lt;/h1>";</span>            <span class="token comment">//outputStream.write(resp.getBytes());</span>            <span class="token comment">//outputStream.flush();</span>            <span class="token comment">//outputStream.close();</span>            <span class="token comment">//QgqCalServlet qgqCalServlet = new QgqCalServlet();</span>            <span class="token comment">//qgqCalServlet.doGet(qgqRequest,qgqResponse);</span>            <span class="token class-name">String</span> uri <span class="token operator">=</span> qgqRequest<span class="token punctuation">.</span><span class="token function">getUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> servletName <span class="token operator">=</span> <span class="token class-name">QgqTomcatV3</span><span class="token punctuation">.</span>servletUrlMapping<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">QgqHttpServlet</span> qgqHttpServlet <span class="token operator">=</span> <span class="token class-name">QgqTomcatV3</span><span class="token punctuation">.</span>servletMapping<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>servletName<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>qgqHttpServlet<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                qgqHttpServlet<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span>qgqRequest<span class="token punctuation">,</span> qgqResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token class-name">String</span> resp<span class="token operator">=</span><span class="token class-name">QgqResponse</span><span class="token punctuation">.</span>respHeader<span class="token operator">+</span><span class="token string">"&lt;h1>404&lt;/h1>"</span><span class="token punctuation">;</span>                <span class="token class-name">OutputStream</span> outputStream <span class="token operator">=</span> qgqResponse<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                outputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                outputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">////æ„å»ºhttpå“åº”å¤´</span>            <span class="token comment">//String respHeader="HTTP/1.1 200 OK \r\n"+</span>            <span class="token comment">//        "Content-Type: text/html;charset=utf-8\r\n\r\n";</span>            <span class="token comment">//String resp=respHeader+"&lt;h1>hi qgq æ‰‹å†™tomcat&lt;/h1>";</span>            <span class="token comment">//System.out.println("=====qgqtomcatv2è¿”å›çš„æ•°æ®å¦‚ä¸‹=====");</span>            <span class="token comment">//System.out.println(resp);</span>            <span class="token comment">//outputStream.write(resp.getBytes());</span>            <span class="token comment">//outputStream.flush();</span>            <span class="token comment">//outputStream.close();</span>            <span class="token comment">//inputStream.close();</span>            <span class="token comment">//socket.close();</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>socket<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="-2"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedReader</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStreamReader</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span><span class="token comment">/** * @Author ç§¦å®¶å¤§èƒ– * @Date 2024/3/13 0013 17:20 * @Version 1.0 * æˆ‘äº¦æ— ä»–ï¼ŒæƒŸæ‰‹ç†Ÿå°” * 1.QgqRequest ä½œç”¨æ˜¯å°è£…httpè¯·æ±‚çš„æ•°æ® * 2.æ¯”å¦‚method get/post  uri å‚æ•°åˆ—è¡¨ * 3.QgqRequestä½œç”¨å°±ç­‰ä»·åŸç”Ÿçš„servletä¸­çš„HttpServletRequest */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QgqRequest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> method<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> uri<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">></span></span> parametersMapping<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">InputStream</span> inputStream<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token comment">//æ„é€ å™¨</span>    <span class="token keyword">public</span> <span class="token class-name">QgqRequest</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>inputStream<span class="token operator">=</span>inputStream<span class="token punctuation">;</span>       <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">BufferedReader</span> bufferedReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//è¯»å–ç¬¬ä¸€è¡Œ</span>            <span class="token class-name">String</span> requestLine <span class="token operator">=</span> bufferedReader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> requestLine<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//åˆ†å‰²å¾—åˆ°method</span>            method<span class="token operator">=</span>split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment">//è§£æå¾—åˆ°/qgqCalServlet</span>            <span class="token comment">//1.å…ˆçœ‹çœ‹uriæœ‰æœ¨æœ‰å‚æ•°åˆ—è¡¨</span>            <span class="token keyword">int</span> index <span class="token operator">=</span> split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>index<span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//è¯´æ˜æ²¡æœ‰å‚æ•°åˆ—è¡¨</span>                uri<span class="token operator">=</span>split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                uri<span class="token operator">=</span>split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//è·å–å‚æ•°åˆ—è¡¨->parametersMapping</span>                <span class="token class-name">String</span> parameters <span class="token operator">=</span> split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterPairs <span class="token operator">=</span> parameters<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"&amp;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">!=</span>parameterPairs<span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token string">""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>parameterPairs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> parameterPair <span class="token operator">:</span> parameterPairs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split2 <span class="token operator">=</span> parameterPair<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>split2<span class="token punctuation">.</span>length<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            parametersMapping<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>split2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> split2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//requestå¯¹è±¡æœ‰ä¸€ä¸ªç‰¹åˆ«é‡è¦çš„æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>parametersMapping<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>           <span class="token keyword">return</span> parametersMapping<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> method<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMethod</span><span class="token punctuation">(</span><span class="token class-name">String</span> method<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>method <span class="token operator">=</span> method<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> uri<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUri</span><span class="token punctuation">(</span><span class="token class-name">String</span> uri<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>uri <span class="token operator">=</span> uri<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="-3"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * @Author ç§¦å®¶å¤§èƒ– * @Date 2024/3/13 0013 17:23 * @Version 1.0 * æˆ‘äº¦æ— ä»–ï¼ŒæƒŸæ‰‹ç†Ÿå°” */</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">OutputStream</span></span><span class="token punctuation">;</span><span class="token comment">/** * 1.QgqResponseå¯¹è±¡å¯ä»¥å°è£…OutputStream(æ˜¯socketå…³è”) * 2.å³å¯ä»¥é€šè¿‡QgqResponseå¯¹è±¡è¿”å›Httpå“åº”ç»™æµè§ˆå™¨/å®¢æˆ·ç«¯ * 3.QgqResponseå¯¹è±¡çš„ä½œç”¨ç­‰ä»·äºåŸç”Ÿçš„servletçš„HttpServletResponse */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QgqResponse</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">OutputStream</span> outputStream<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token comment">//å†™ä¸€ä¸ªhttpçš„å“åº”å¤´</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> respHeader<span class="token operator">=</span><span class="token string">"HTTP/1.1 200 OK \r\n"</span><span class="token operator">+</span>            <span class="token string">"Content-Type: text/html;charset=utf-8\r\n\r\n"</span><span class="token punctuation">;</span>    <span class="token comment">//åœ¨åˆ›å»ºQgqResponseå¯¹è±¡æ—¶,ä¼ å…¥çš„OutputStreamæ˜¯å’ŒSocketå…³è”çš„</span>    <span class="token keyword">public</span> <span class="token class-name">QgqResponse</span><span class="token punctuation">(</span><span class="token class-name">OutputStream</span> outputStream<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>outputStream<span class="token operator">=</span>outputStream<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å½“æˆ‘ä»¬éœ€è¦ç»™æµè§ˆå™¨è¿”å›æ•°æ®æ—¶,å¯ä»¥é€šè¿‡QgqResponseçš„è¾“å‡ºæµæ¥å®Œæˆ</span>    <span class="token keyword">public</span> <span class="token class-name">OutputStream</span> <span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> outputStream<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="-4"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">QgqRequest</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">QgqResponse</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">WebUtils</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">OutputStream</span></span><span class="token punctuation">;</span><span class="token comment">/** * @Author ç§¦å®¶å¤§èƒ– * @Date 2024/3/13 0013 17:16 * @Version 1.0 * æˆ‘äº¦æ— ä»–ï¼ŒæƒŸæ‰‹ç†Ÿå°” */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QgqCalServlet</span> <span class="token keyword">extends</span> <span class="token class-name">QgqHttpServlet</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">QgqRequest</span> qgqRequest<span class="token punctuation">,</span> <span class="token class-name">QgqResponse</span> qgqResponse<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> num1 <span class="token operator">=</span> qgqRequest<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"num1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> num2 <span class="token operator">=</span> qgqRequest<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"num2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> num11 <span class="token operator">=</span> <span class="token class-name">WebUtils</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> num22 <span class="token operator">=</span> <span class="token class-name">WebUtils</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>num2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> sum<span class="token operator">=</span>num11<span class="token operator">+</span>num22<span class="token punctuation">;</span>        <span class="token comment">//è¿”å›è®¡ç®—ç»“æœç»™æµè§ˆå™¨</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">OutputStream</span> outputStream <span class="token operator">=</span> qgqResponse<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> respMes<span class="token operator">=</span><span class="token class-name">QgqResponse</span><span class="token punctuation">.</span>respHeader<span class="token operator">+</span><span class="token string">"&lt;h1>"</span><span class="token operator">+</span>num11<span class="token operator">+</span><span class="token string">"+"</span><span class="token operator">+</span>num22<span class="token operator">+</span><span class="token string">"="</span><span class="token operator">+</span>sum<span class="token operator">+</span><span class="token string">"&lt;/h1>"</span><span class="token punctuation">;</span>            outputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>respMes<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            outputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">QgqRequest</span> qgqRequest<span class="token punctuation">,</span> <span class="token class-name">QgqResponse</span> qgqResponse<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span>qgqRequest<span class="token punctuation">,</span>qgqResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="-5"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">QgqRequest</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">QgqResponse</span></span><span class="token punctuation">;</span><span class="token comment">/** * @Author ç§¦å®¶å¤§èƒ– * @Date 2024/3/13 0013 17:16 * @Version 1.0 * æˆ‘äº¦æ— ä»–ï¼ŒæƒŸæ‰‹ç†Ÿå°” */</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">QgqHttpServlet</span> <span class="token keyword">implements</span> <span class="token class-name">QgqServlet</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">QgqRequest</span> qgqRequest<span class="token punctuation">,</span> <span class="token class-name">QgqResponse</span> qgqResponse<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>qgqRequest<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åˆ°get"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span>qgqRequest<span class="token punctuation">,</span>qgqResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doPost</span><span class="token punctuation">(</span>qgqRequest<span class="token punctuation">,</span>qgqResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//è¿™é‡Œä½¿ç”¨äº†æŠ½è±¡æ¨¡æ¿è®¾è®¡æ¨¡å¼</span>    <span class="token comment">//è®©QgqHttpServletå­ç±»QgqCalServletå»å®ç°</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">QgqRequest</span> qgqRequest<span class="token punctuation">,</span> <span class="token class-name">QgqResponse</span> qgqResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">QgqRequest</span> qgqRequest<span class="token punctuation">,</span> <span class="token class-name">QgqResponse</span> qgqResponse<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="-6"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">QgqRequest</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">QgqResponse</span></span><span class="token punctuation">;</span><span class="token comment">/** * @Author ç§¦å®¶å¤§èƒ– * @Date 2024/3/13 0013 17:15 * @Version 1.0 * æˆ‘äº¦æ— ä»–ï¼ŒæƒŸæ‰‹ç†Ÿå°” * å…ˆæ­å»ºç»“æ„,åé¢å†å†™å†…å®¹ */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">QgqServlet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">QgqRequest</span> qgqRequest<span class="token punctuation">,</span> <span class="token class-name">QgqResponse</span> qgqResponse<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="-7"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>handler<span class="token punctuation">.</span></span><span class="token class-name">QgqRequestHandler</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">QgqHttpServlet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">Document</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">DocumentException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">Element</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">SAXReader</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">ServerSocket</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">Socket</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ConcurrentHashMap</span></span><span class="token punctuation">;</span><span class="token comment">/** * @Author ç§¦å®¶å¤§èƒ– * @Date 2024/3/13 0013 19:05 * @Version 1.0 * æˆ‘äº¦æ— ä»–ï¼ŒæƒŸæ‰‹ç†Ÿå°” * å®ç°xml+åå°„æ¥åˆå§‹åŒ–å®¹å™¨ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QgqTomcatV3</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">QgqHttpServlet</span><span class="token punctuation">></span></span> servletMapping<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">></span></span> servletUrlMapping<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">QgqTomcatV3</span> qgqTomcatV3<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">QgqTomcatV3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        qgqTomcatV3<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        qgqTomcatV3<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">ServerSocket</span> serverSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=====hsptomcatv3åœ¨8080ç›‘å¬======"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>serverSocket<span class="token punctuation">.</span><span class="token function">isClosed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Socket</span> socket <span class="token operator">=</span> serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">QgqRequestHandler</span> hspRequestHandler <span class="token operator">=</span>                        <span class="token keyword">new</span> <span class="token class-name">QgqRequestHandler</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>hspRequestHandler<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//ç›´æ¥å¯¹ä¸¤ä¸ªå®¹å™¨è¿›è¡Œåˆå§‹åŒ–</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//è¯»å–web.xml=>dom4j=></span>        <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token class-name">QgqTomcatV3</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">SAXReader</span> saxReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SAXReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Document</span> document <span class="token operator">=</span> saxReader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>path <span class="token operator">+</span> <span class="token string">"web.xml"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Element</span> rootElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getRootElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Element</span><span class="token punctuation">></span></span> elements <span class="token operator">=</span> rootElement<span class="token punctuation">.</span><span class="token function">elements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Element</span> element <span class="token operator">:</span> elements<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"servlet"</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token comment">//è¿™æ˜¯ä¸€ä¸ªservleté…ç½®</span>                    <span class="token class-name">Element</span> element1 <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token string">"servlet-name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">Element</span> element2 <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token string">"servlet-class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    servletMapping<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>element1<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">QgqHttpServlet</span><span class="token punctuation">)</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>element2<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"servlet-mapping"</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token class-name">Element</span> element1 <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token string">"servlet-name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">Element</span> element2 <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token string">"url-pattern"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    servletUrlMapping<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>element2<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>element1<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>servletMapping<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>servletUrlMapping<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="é˜¶æ®µä¸‰æ‰€éµå¾ªçš„è®¾è®¡æ¨¡å¼"><a href="#é˜¶æ®µä¸‰æ‰€éµå¾ªçš„è®¾è®¡æ¨¡å¼" class="headerlink" title="é˜¶æ®µä¸‰æ‰€éµå¾ªçš„è®¾è®¡æ¨¡å¼"></a>é˜¶æ®µä¸‰æ‰€éµå¾ªçš„è®¾è®¡æ¨¡å¼</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/2db9c44c9b11cc1a1e3b28924fc05171.png"></div></div><h4 id="è¿™ä¸‰ä¸ªé˜¶æ®µçš„å„ä¸ªåŒºåˆ«"><a href="#è¿™ä¸‰ä¸ªé˜¶æ®µçš„å„ä¸ªåŒºåˆ«" class="headerlink" title="è¿™ä¸‰ä¸ªé˜¶æ®µçš„å„ä¸ªåŒºåˆ«"></a>è¿™ä¸‰ä¸ªé˜¶æ®µçš„å„ä¸ªåŒºåˆ«</h4><p>1.ç¬¬ä¸€é˜¶æ®µåœ¨Tomcatå°±è¿›è¡Œäº†IOæ“ä½œ<br>2.ç¬¬äºŒé˜¶æ®µ,Tomcaté˜¶æ®µèµ·åˆ°äº†åˆ†å‘çš„ä½œç”¨å…·ä½“çš„IOæ“ä½œåœ¨QgqRequestHandler,åŒæ—¶åŠ å…¥äº†å¤šçº¿ç¨‹æ“ä½œ,å°±æ˜¯æ¯ä¸€ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ª<br>QgqRequestHandlerè¿›è¡Œç›¸åº”çš„æ“ä½œ<br>3.ç¬¬ä¸‰é˜¶æ®µ,åœ¨ç¬¬äºŒé˜¶æ®µçš„åŸºç¡€ä¸ŠåŠ ä¸Šäº†å¯¹Servletå’Œweb.xmlçš„å…³è”,ä¸»è¦ç”¨åˆ°çš„æ“ä½œæ˜¯åå°„å’Œdom4j<br>Â·é€šè¿‡æ‰‹åŠ¨å®ç°tomcatå¯ä»¥æ›´åŠ äº†è§£Tomcatçš„åº•å±‚å·¥ä½œæœºåˆ¶</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title&gt;&lt;/a&gt;&lt;div class=&quot;note purple no-icon flat&quot;&gt;&lt;p&gt;javaWebå¤ä¹  &lt;/p&gt;
&lt;/div&gt;&lt;/h1&gt;&lt;h2 id=&quot;æ‰‹åŠ¨å®ç°Tomcatåº•å±‚æœºåˆ¶-è‡ªå·±</summary>
      
    
    
    
    <category term="javaWeb" scheme="https://100qin10086.github.io/categories/javaWeb/"/>
    
    
    <category term="javaWeb" scheme="https://100qin10086.github.io/tags/javaWeb/"/>
    
  </entry>
  
  <entry>
    <title>javaWebå¤ä¹ 2</title>
    <link href="https://100qin10086.github.io/posts/b6caecac.html"/>
    <id>https://100qin10086.github.io/posts/b6caecac.html</id>
    <published>2024-03-08T00:56:42.000Z</published>
    <updated>2024-05-06T14:13:59.610Z</updated>
    
    <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a><div class="note purple no-icon flat"><p>javaWebå¤ä¹  </p></div></h1><h2 id="Httpåè®®"><a href="#Httpåè®®" class="headerlink" title="Httpåè®®"></a>Httpåè®®</h2><h3 id="ServletConfig-åŸºæœ¬ä»‹ç»"><a href="#ServletConfig-åŸºæœ¬ä»‹ç»" class="headerlink" title="ServletConfig åŸºæœ¬ä»‹ç»"></a>ServletConfig åŸºæœ¬ä»‹ç»</h3><p>1.ServletConfig ç±»æ˜¯ä¸º Servlet ç¨‹åºçš„é…ç½®ä¿¡æ¯çš„ç±»<br>2.Servlet ç¨‹åºå’Œ ServletConfig å¯¹è±¡éƒ½æ˜¯ç”± Tomcat è´Ÿè´£åˆ›å»º<br>3.Servlet ç¨‹åºé»˜è®¤æ˜¯ç¬¬ 1 æ¬¡è®¿é—®çš„æ—¶å€™åˆ›å»ºï¼ŒServletConfig åœ¨ Servlet ç¨‹åºåˆ›å»ºæ—¶ï¼Œå°±åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ ServletConfig å¯¹è±¡</p><h4 id="ServletConfig-ç±»èƒ½å¹²ä»€ä¹ˆ"><a href="#ServletConfig-ç±»èƒ½å¹²ä»€ä¹ˆ" class="headerlink" title="ServletConfig ç±»èƒ½å¹²ä»€ä¹ˆ"></a>ServletConfig ç±»èƒ½å¹²ä»€ä¹ˆ</h4><p>1.è·å– Servlet ç¨‹åºçš„ servlet-name çš„å€¼<br>2.è·å–åˆå§‹åŒ–å‚æ•° init-param<br>3.è·å– ServletContext å¯¹è±¡</p><h3 id="ServletContextåŸºæœ¬ä»‹ç»"><a href="#ServletContextåŸºæœ¬ä»‹ç»" class="headerlink" title="ServletContextåŸºæœ¬ä»‹ç»"></a>ServletContextåŸºæœ¬ä»‹ç»</h3><p>1.ServletContext æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒè¡¨ç¤º Servlet ä¸Šä¸‹æ–‡å¯¹è±¡<br>2.ä¸€ä¸ª web å·¥ç¨‹ï¼Œåªæœ‰ä¸€ä¸ª ServletContext å¯¹è±¡å®ä¾‹<br>3.ServletContext å¯¹è±¡ æ˜¯åœ¨ web å·¥ç¨‹å¯åŠ¨çš„æ—¶å€™åˆ›å»ºï¼Œåœ¨ web å·¥ç¨‹åœæ­¢çš„æ—¶é”€æ¯<br>4.ServletContext å¯¹è±¡å¯ä»¥é€šè¿‡ ServletConfig.getServletContext æ–¹æ³•è·å¾—å¯¹ ServletContext<br>å¯¹è±¡çš„å¼•ç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ this.getServletContext()æ¥è·å¾—å…¶å¯¹è±¡çš„å¼•ç”¨ã€‚<br>5.ç”±äºä¸€ä¸ª WEB åº”ç”¨ä¸­çš„æ‰€æœ‰ Servlet å…±äº«åŒä¸€ä¸ª ServletContext å¯¹è±¡ï¼Œå› æ­¤ Servlet å¯¹è±¡ä¹‹é—´å¯ä»¥é€šè¿‡ ServletContext å¯¹è±¡æ¥å®ç°å¤šä¸ª<br>Servlet é—´é€šè®¯ã€‚ServletContext å¯¹è±¡é€šå¸¸ä¹Ÿè¢« ç§°ä¹‹ä¸ºåŸŸå¯¹è±¡<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/4a15998091fd8149cfb3ef28e1dcb72c.png"></div></div></p><h4 id="ServletContextå¯ä»¥å¹²ä»€ä¹ˆ"><a href="#ServletContextå¯ä»¥å¹²ä»€ä¹ˆ" class="headerlink" title="ServletContextå¯ä»¥å¹²ä»€ä¹ˆ"></a>ServletContextå¯ä»¥å¹²ä»€ä¹ˆ</h4><p>1.è·å– web.xml ä¸­é…ç½®çš„ä¸Šä¸‹æ–‡å‚æ•° context-param ã€ä¿¡æ¯å’Œæ•´ä¸ª web åº”ç”¨ç›¸å…³ï¼Œè€Œä¸æ˜¯å±äºæŸä¸ª Servletã€‘<br>2.åƒMapä¸€æ ·å­˜å–æ•°æ®,å¤šä¸ªServletå…±äº«æ•°æ®</p><h3 id="HttpServletRequestä»‹ç»"><a href="#HttpServletRequestä»‹ç»" class="headerlink" title="HttpServletRequestä»‹ç»"></a>HttpServletRequestä»‹ç»</h3><p>1.HttpServletRequestä»£è¡¨å®¢æˆ·ç«¯çš„è¯·æ±‚<br>2.å½“å®¢æˆ·ç«¯/æµè§ˆå™¨é€šè¿‡Httpåè®®è®¿é—®æœåŠ¡å™¨æ—¶,HTTPè¯·æ±‚å¤´ä¸­çš„æ‰€æœ‰ä¿¡æ¯éƒ½å°è£…åœ¨è¿™ä¸ªå¯¹è±¡ä¸­<br>3.é€šè¿‡è¿™ä¸ªå¯¹è±¡æ–¹æ³•,å¯ä»¥è·å¾—å®¢æˆ·ç«¯è¿™å†™ä¿¡æ¯</p><h4 id="HttpServletRequestå¸¸ç”¨æ–¹æ³•"><a href="#HttpServletRequestå¸¸ç”¨æ–¹æ³•" class="headerlink" title="HttpServletRequestå¸¸ç”¨æ–¹æ³•"></a>HttpServletRequestå¸¸ç”¨æ–¹æ³•</h4><p>1.getRequestURI() è·å–è¯·æ±‚çš„èµ„æºè·¯å¾„ <a href="http://localhost:8080/servlet/loginServlet">http://localhost:8080/servlet/loginServlet</a><br>2.getRequestURL() è· å– è¯· æ±‚ çš„ ç»Ÿ ä¸€ èµ„ æº å®š ä½ ç¬¦ ï¼ˆ ç» å¯¹ è·¯ å¾„ ï¼‰<a href="http://localhost:8080/servlet/loginServlet">http://localhost:8080/servlet/loginServlet</a><br>3.getRemoteHost() è·å–å®¢æˆ·ç«¯çš„ ä¸»æœº, getRemoteAddr()<br>4.getHeader() è·å–è¯·æ±‚å¤´<br>5.getParameter() è·å–è¯·æ±‚çš„å‚æ•°<br>6.getParameterValues() è·å–è¯·æ±‚çš„å‚æ•°ï¼ˆå¤šä¸ªå€¼çš„æ—¶å€™ä½¿ç”¨ï¼‰ , æ¯”å¦‚ checkbox, è¿”å›çš„æ•°ç»„<br>7.getMethod() è·å–è¯·æ±‚çš„æ–¹å¼ GET æˆ– POST<br>8.setAttribute(key, value); è®¾ç½®åŸŸæ•°æ®<br>9.getAttribute(key); è·å–åŸŸæ•°æ®<br>10.getRequestDispatcher() è·å–è¯·æ±‚è½¬å‘å¯¹è±¡, è¯·æ±‚è½¬å‘çš„æ ¸å¿ƒå¯¹è±¡</p><h4 id="HttpServletRequestæ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#HttpServletRequestæ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="HttpServletRequestæ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>HttpServletRequestæ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><p>1.è·å–doPostå‚æ•°ä¸­æ–‡ä¹±ç è§£å†³æ–¹æ¡ˆ,æ³¨æ„setCharacterEncoding(â€œutf-8â€)è¦å†™åœ¨request.getParameter()å‰</p><h4 id="è¯·æ±‚è½¬å‘è¯´æ˜"><a href="#è¯·æ±‚è½¬å‘è¯´æ˜" class="headerlink" title="è¯·æ±‚è½¬å‘è¯´æ˜"></a>è¯·æ±‚è½¬å‘è¯´æ˜</h4><p>1.å®ç°è¯·æ±‚è½¬å‘:è¯·æ±‚è½¬å‘æŒ‡ä¸€ä¸ªwebèµ„æºæ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚å,é€šçŸ¥æœåŠ¡å™¨å»è°ƒç”¨å¦å¤–ä¸€ä¸ªwebèµ„æºè¿›è¡Œå¤„ç†<br>2.HttpServletRequestå¯¹è±¡æä¾›äº†ä¸€ä¸ªgetRequestDispatcheræ–¹æ³•,è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªRequestDispatcherå¯¹è±¡,è°ƒç”¨è¿™ä¸ªå¯¹è±¡<br>çš„forwardæ–¹æ³•å¯ä»¥å®ç°è¯·æ±‚è½¬å‘<br>3.requestå¯¹è±¡åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªåŸŸå¯¹è±¡,å¼€å‘äººå‘˜é€šè¿‡requestå¯¹è±¡åœ¨å®ç°è½¬å‘æ—¶,æŠŠæ•°æ®é€šè¿‡requestå¯¹è±¡å¸¦ç»™å…¶ä»–webèµ„æºå¤„ç†<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/161470ac25bfab5c6e801dbb5859f8bb.png"></div></div></p><h4 id="è¯·æ±‚è½¬å‘æ³¨æ„äº‹é¡¹"><a href="#è¯·æ±‚è½¬å‘æ³¨æ„äº‹é¡¹" class="headerlink" title="è¯·æ±‚è½¬å‘æ³¨æ„äº‹é¡¹"></a>è¯·æ±‚è½¬å‘æ³¨æ„äº‹é¡¹</h4><p>1.æµè§ˆå™¨åœ°å€ä¸ä¼šå˜åŒ–(åœ°å€ä¼šä¿ç•™åœ¨ç¬¬1ä¸ªservletçš„url)<br>2.åœ¨åŒä¸€æ¬¡HTTPè¯·æ±‚ä¸­,è¿›è¡Œå¤šæ¬¡è½¬å‘,ä»ç„¶æ˜¯ä¸€æ¬¡HTTPè¯·æ±‚<br>3.åœ¨åŒä¸€æ¬¡ HTTP è¯·æ±‚ä¸­ï¼Œè¿›è¡Œå¤šæ¬¡è½¬å‘ï¼Œå¤šä¸ª Servlet å¯ä»¥å…±äº« request åŸŸ/å¯¹è±¡çš„æ•°æ®(å› ä¸ºå§‹ç»ˆæ˜¯åŒä¸€ä¸ª request å¯¹è±¡)</p><h3 id="HttpServletResponse-ä»‹ç»"><a href="#HttpServletResponse-ä»‹ç»" class="headerlink" title="HttpServletResponse ä»‹ç»"></a>HttpServletResponse ä»‹ç»</h3><p>1.æ¯æ¬¡ HTTP è¯·æ±‚ï¼ŒTomcat ä¼šåˆ›å»ºä¸€ä¸ª HttpServletResponse å¯¹è±¡ä¼ é€’ç»™ Servlet ç¨‹åºå»ä½¿ç”¨ã€‚<br>2.HttpServletRequest è¡¨ç¤ºè¯·æ±‚è¿‡æ¥çš„ä¿¡æ¯ï¼ŒHttpServletResponse è¡¨ç¤ºæ‰€æœ‰å“åº”çš„ä¿¡æ¯,å¦‚æœéœ€è¦è®¾ç½®è¿”å›ç»™å®¢æˆ·ç«¯çš„ä¿¡æ¯ï¼Œé€šè¿‡<br>HttpServletResponse å¯¹è±¡æ¥è¿›è¡Œè®¾ç½®å³</p><h4 id="å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®æ–¹æ³•"><a href="#å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®æ–¹æ³•" class="headerlink" title="å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®æ–¹æ³•"></a>å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®æ–¹æ³•</h4><p>1.å­—èŠ‚æµ getOutputStream;å¸¸ç”¨äºä¸‹è½½(å¤„ç†äºŒè¿›åˆ¶æ•°æ®)<br>2.å­—ç¬¦æµ getWriter();å¸¸ç”¨äºå›ä¼ å­—ç¬¦ä¸²<br>3.ä¸¤ä¸ªæµåŒæ—¶åªèƒ½ä½¿ç”¨ä¸€ä¸ª,ä½¿ç”¨äº†å­—èŠ‚æµ,å°±ä¸èƒ½å†ä½¿ç”¨å­—ç¬¦æµ,åä¹‹äº¦ç„¶</p><h4 id="è¯·æ±‚é‡å®šå‘è¯´æ˜"><a href="#è¯·æ±‚é‡å®šå‘è¯´æ˜" class="headerlink" title="è¯·æ±‚é‡å®šå‘è¯´æ˜"></a>è¯·æ±‚é‡å®šå‘è¯´æ˜</h4><p>1.è¯·æ±‚é‡å®šå‘æŒ‡:ä¸€ä¸ªwebèµ„æºæ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚å,é€šçŸ¥å®¢æˆ·ç«¯å»è®¿é—®å¦å¤–ä¸€ä¸ªwebèµ„æº,è¿™ç§°ä¹‹ä¸ºè¯·æ±‚é‡å®šå‘<br>2.è¯·æ±‚é‡å®šå‘ç¤ºæ„åŸç†å›¾<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/ad69bb182c3008385da87050dc5d1bdf.png"></div></div></p><h4 id="è¯·æ±‚é‡å®šå‘æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#è¯·æ±‚é‡å®šå‘æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="è¯·æ±‚é‡å®šå‘æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>è¯·æ±‚é‡å®šå‘æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><p>1.æµè§ˆå™¨åœ°å€ä¼šå‘ç”Ÿå˜åŒ–,æœ¬è´¨æ˜¯ä¸¤æ¬¡httpè¯·æ±‚<br>2.ä¸èƒ½å…±äº«requeståŸŸä¸­çš„æ•°æ®,æœ¬è´¨æ˜¯ä¸¤æ¬¡httpè¯·æ±‚,ä¼šç”Ÿæˆä¸¤ä¸ªHttpServletRequestå¯¹è±¡<br>3.ä¸èƒ½é‡å®šå‘åˆ°/WEB-INFä¸‹çš„èµ„æº<br>4.å¯ä»¥é‡å®šå‘åˆ° Web å·¥ç¨‹ä»¥å¤–çš„èµ„æºï¼Œ æ¯”å¦‚ åˆ° www.baidu.com<br>5.response.sendRedirect(getServletContext().getContext()+â€/pathâ€)</p><h3 id="ä»€ä¹ˆæ˜¯HTTPåè®®"><a href="#ä»€ä¹ˆæ˜¯HTTPåè®®" class="headerlink" title="ä»€ä¹ˆæ˜¯HTTPåè®®"></a>ä»€ä¹ˆæ˜¯HTTPåè®®</h3><p>1.è¶…æ–‡æœ¬ä¼ è¾“åè®®æ˜¯äº’è”ç½‘ä¸Šåº”ç”¨å¹¿æ³›çš„ä¸€ç§ç½‘ç»œåè®®,æ˜¯å·¥ä½œåœ¨tcp/ipåè®®åŸºç¡€ä¸Šçš„,æ‰€æœ‰çš„wwwæ–‡ä»¶éƒ½éµå®ˆè¿™ä¸ªæ ‡å‡†<br>2.http1.0çŸ­é“¾æ¥ http1.1é•¿è¿æ¥</p><h4 id="httpè¯·æ±‚çš„UMLæ—¶åºå›¾"><a href="#httpè¯·æ±‚çš„UMLæ—¶åºå›¾" class="headerlink" title="httpè¯·æ±‚çš„UMLæ—¶åºå›¾"></a>httpè¯·æ±‚çš„UMLæ—¶åºå›¾</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/33d09a30f5f5e6143dff3bfa11c08565.png"></div></div><h4 id="HTTPè¯·æ±‚åŒ…åˆ†æ-GET"><a href="#HTTPè¯·æ±‚åŒ…åˆ†æ-GET" class="headerlink" title="HTTPè¯·æ±‚åŒ…åˆ†æ(GET)"></a>HTTPè¯·æ±‚åŒ…åˆ†æ(GET)</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/b83a6d39c6269be961073959b0ca019e.png"></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/ed7a79956e59275a3956ded879704efa.png"></div></div><h4 id="HTTPè¯·æ±‚åŒ…åˆ†æ-POST"><a href="#HTTPè¯·æ±‚åŒ…åˆ†æ-POST" class="headerlink" title="HTTPè¯·æ±‚åŒ…åˆ†æ(POST)"></a>HTTPè¯·æ±‚åŒ…åˆ†æ(POST)</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/050fbf25507f36ad06a993df4cd3a20e.png"></div></div><h4 id="GETè¯·æ±‚å’ŒPOSTè¯·æ±‚åˆ†åˆ«æœ‰é‚£äº›"><a href="#GETè¯·æ±‚å’ŒPOSTè¯·æ±‚åˆ†åˆ«æœ‰é‚£äº›" class="headerlink" title="GETè¯·æ±‚å’ŒPOSTè¯·æ±‚åˆ†åˆ«æœ‰é‚£äº›"></a>GETè¯·æ±‚å’ŒPOSTè¯·æ±‚åˆ†åˆ«æœ‰é‚£äº›</h4><p>1.GETè¯·æ±‚æœ‰å“ªäº›<br>Â·formæ ‡ç­¾method=getã€æŒ‡å®šã€‘<br>Â·aæ ‡ç­¾<br>Â·linkæ ‡ç­¾å¼•å…¥cssã€ä»¥getæ–¹å¼æ¥è·å–èµ„æºã€‘<br>Â·Scriptæ ‡ç­¾å¼•å…¥jsæ–‡ä»¶ã€ä»¥getæ–¹å¼æ¥è·å–èµ„æºã€‘<br>Â·imgæ ‡ç­¾å¼•å…¥å›¾ç‰‡ã€ä»¥getè¯·æ±‚æ¥è·å–å›¾ç‰‡ã€‘<br>2.POSTè¯·æ±‚æœ‰å“ªäº›<br>1.formæ ‡ç­¾method=post</p><h3 id="å‡ ä¸ªé‡è¦çš„çŠ¶æ€ç "><a href="#å‡ ä¸ªé‡è¦çš„çŠ¶æ€ç " class="headerlink" title="å‡ ä¸ªé‡è¦çš„çŠ¶æ€ç "></a>å‡ ä¸ªé‡è¦çš„çŠ¶æ€ç </h3><p>1.302:é‡å®šå‘,å½“å“åº”ç ä¸º302æ—¶,è¡¨ç¤ºæœåŠ¡å™¨è¦æ±‚æµè§ˆå™¨é‡æ–°å†å‘ä¸€ä¸ªè¯·æ±‚,æœåŠ¡å™¨ä¼šå‘é€ä¸€ä¸ªå“åº”å¤´Location,å®ƒæŒ‡å®šäº†æ–°è¯·æ±‚çš„URLåœ°å€<br>2.304:å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡è¯·æ±‚index.htmlæ—¶,æœåŠ¡å™¨ä¼šæ·»åŠ ä¸€ä¸ªåä¸ºLast-Modifiedå“åº”å¤´,è¿™ä¸ªå¤´è¯´æ˜äº†index.htmlçš„æœ€åä¿®æ”¹<br>æ—¶é—´,æµè§ˆå™¨ä¼šæŠŠindex.htmlå†…å®¹,ä»¥åŠæœ€å¥½å“åº”æ—¶é—´ç¼“å­˜ä¸‹æ¥,å½“ç”¨æˆ·ç¬¬äºŒæ¬¡è¯·æ±‚index.htmlæ—¶,å†è¯·æ±‚åœ¨åŒ…å«ä¸€ä¸ªIf-Modified<br>-Sinceè¯·æ±‚å¤´,å®ƒçš„å€¼å°±æ˜¯ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶æœåŠ¡å™¨é€šè¿‡Last-Modifiedå“åº”å¤´å‘é€ç»™æµè§ˆå™¨çš„å€¼,å³index.htmlæœ€åä¿®æ”¹æ—¶é—´<br>å¦‚æœIf-Modified-Sinceçš„å€¼å’Œindex.htmlæœ€åä¿®æ”¹æ—¶é—´ä¸€è‡´,æµè§ˆå™¨ä¼šå‘é€å“åº”ç 304,è¡¨ç¤ºindex.htmlä¸æµè§ˆå™¨ä¸Šæ¬¡ç¼“å­˜çš„ç›¸åŒ,<br>æ— éœ€å†æ¬¡å‘é€(èŠ‚çœä¼ è¾“æˆæœ¬),æµè§ˆå™¨å¯ä»¥æ˜¾ç¤ºè‡ªå·±çš„ç¼“å­˜é¡µé¢,å¦‚æœæ¯”å¯¹ä¸åŒ,è¯´æ˜index.htmlä»¥åŠåšäº†ä¿®æ”¹,æœåŠ¡å™¨å°±ä¼šå“åº”200</p><h2 id="å¤šçº¿ç¨‹åŸºç¡€çš„å¤ä¹ "><a href="#å¤šçº¿ç¨‹åŸºç¡€çš„å¤ä¹ " class="headerlink" title="å¤šçº¿ç¨‹åŸºç¡€çš„å¤ä¹ "></a>å¤šçº¿ç¨‹åŸºç¡€çš„å¤ä¹ </h2><h3 id="åˆ›å»ºçº¿ç¨‹çš„ä¸¤ç§æ–¹å¼"><a href="#åˆ›å»ºçº¿ç¨‹çš„ä¸¤ç§æ–¹å¼" class="headerlink" title="åˆ›å»ºçº¿ç¨‹çš„ä¸¤ç§æ–¹å¼"></a>åˆ›å»ºçº¿ç¨‹çš„ä¸¤ç§æ–¹å¼</h3><p>1.ç»§æ‰¿Threadç±»,é‡å†™runæ–¹æ³•<br>2.å®ç°Runnableæ¥å£,é‡å†™runæ–¹æ³•</p><h4 id="ç»§æ‰¿Threadç±»å®ä¾‹"><a href="#ç»§æ‰¿Threadç±»å®ä¾‹" class="headerlink" title="ç»§æ‰¿Threadç±»å®ä¾‹"></a>ç»§æ‰¿Threadç±»å®ä¾‹</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> no1 <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Cat</span> cat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        cat<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//start()æ–¹æ³•è°ƒç”¨äº†start0()æ–¹æ³•å,è¯¥çº¿ç¨‹ä¸ä¸€å®šä¼šé©¬ä¸Šæ‰§è¡Œ,åªæ˜¯å°†çº¿ç¨‹æ”¹å˜äº†å¯è¿è¡ŒçŠ¶æ€,å…·ä½“ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ</span>        <span class="token comment">//å–å†³äºCPUï¼Œç”±CPUç»Ÿä¸€è°ƒåº¦</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ"</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åå­— main</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸»çº¿ç¨‹ i="</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è®©ä¸»çº¿ç¨‹ä¼‘çœ </span>            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> times<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å–µå–µ, æˆ‘æ˜¯å°çŒ«å’ª"</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">++</span>times<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" çº¿ç¨‹å="</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>times<span class="token operator">==</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é€šè¿‡å®ç°æ¥å£-Runnable-æ¥å¼€å‘çº¿ç¨‹"><a href="#é€šè¿‡å®ç°æ¥å£-Runnable-æ¥å¼€å‘çº¿ç¨‹" class="headerlink" title="é€šè¿‡å®ç°æ¥å£ Runnable æ¥å¼€å‘çº¿ç¨‹"></a>é€šè¿‡å®ç°æ¥å£ Runnable æ¥å¼€å‘çº¿ç¨‹</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> no2 <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Dog</span> dog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span><span class="token punctuation">;</span>        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span> <span class="token comment">//é€šè¿‡å®ç° Runnable æ¥å£ï¼Œå¼€å‘çº¿ç¨‹</span>    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//æ™®é€šæ–¹æ³•</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å°ç‹—æ±ªæ±ªå«..hi"</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">++</span>count<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//ä¼‘çœ  1 ç§’</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ç»§æ‰¿Thread-vs-å®ç°Runnableçš„åŒºåˆ«"><a href="#ç»§æ‰¿Thread-vs-å®ç°Runnableçš„åŒºåˆ«" class="headerlink" title="ç»§æ‰¿Thread vs å®ç°Runnableçš„åŒºåˆ«"></a>ç»§æ‰¿Thread vs å®ç°Runnableçš„åŒºåˆ«</h4><p>Â·è¯´æ˜:<br>1.javaæ˜¯å•ç»§æ‰¿çš„,åœ¨æŸäº›æƒ…å†µä¸‹ä¸€ä¸ªç±»å¯èƒ½å·²ç»ç»§æ‰¿äº†æŸä¸ªçˆ¶ç±»,è¿™æ—¶åœ¨ç”¨ç»§æ‰¿Threadç±»æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹æ˜¾ç„¶å·²ç»ä¸å¯èƒ½äº†<br>2.ä»Javaçš„è®¾è®¡æ¥çœ‹,é€šè¿‡ç»§æ‰¿Threadæˆ–è€…å®ç°Runnableæ¥å£æ¥åˆ›å»ºçº¿ç¨‹æœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«</p><h4 id="çº¿ç¨‹å¸¸ç”¨çš„æ–¹æ³•"><a href="#çº¿ç¨‹å¸¸ç”¨çš„æ–¹æ³•" class="headerlink" title="çº¿ç¨‹å¸¸ç”¨çš„æ–¹æ³•"></a>çº¿ç¨‹å¸¸ç”¨çš„æ–¹æ³•</h4><p>Â·setName  :è®¾ç½®çº¿ç¨‹åç§°<br>Â·getName  :è¿”å›è¯¥çº¿ç¨‹çš„åç§°<br>Â·start    :ä½¿çº¿ç¨‹å¼€å§‹æ‰§è¡Œ;Javaè™šæ‹Ÿæœºåº•å±‚è°ƒç”¨è¯¥çº¿ç¨‹çš„start0æ–¹æ³•<br>Â·run      :è°ƒç”¨çº¿ç¨‹å¯¹è±¡runæ–¹æ³•<br>Â·setPriority :æ›´æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§<br>Â·getPriority :è·å–çº¿ç¨‹çš„ä¼˜å…ˆçº§<br>Â·sleep    :åœ¨æŒ‡å®šçš„æ¯«ç§’æ•°å†…è®©å½“å‰çœŸåœ¨æ‰§è¡Œçš„çº¿ç¨‹ä¼‘çœ <br>Â·interrupt   :ä¸­æ–­çº¿ç¨‹<br>Â·yield    :çº¿ç¨‹çš„ç¤¼è®©,è®©å‡ºcpu,è®©å…¶ä»–çº¿ç¨‹æ‰§è¡Œ,ä½†ç¤¼è®©çš„æ—¶é—´ä¸ç¡®å®š,æ‰€ä»¥ä¹Ÿä¸ä¸€å®šæˆåŠŸ<br>Â·join     :çº¿ç¨‹çš„æ’é˜Ÿã€‚æ’é˜Ÿçš„çº¿ç¨‹ä¸€æ—¦æ’é˜ŸæˆåŠŸ,åˆ™è‚¯å®šå…ˆæ‰§è¡Œå®Œæ’å…¥çš„çº¿ç¨‹æ‰€æœ‰çš„ä»»åŠ¡</p><h4 id="ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹"><a href="#ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹"></a>ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹</h4><p>1.ç”¨æˆ·çº¿ç¨‹:ä¹Ÿå«å·¥ä½œçº¿ç¨‹,å½“çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆ–é€šçŸ¥æ–¹å¼ç»“æŸ<br>2.å®ˆæŠ¤çº¿ç¨‹:ä¸€èˆ¬æ˜¯ä¸ºå·¥ä½œçº¿ç¨‹æœåŠ¡çš„,å½“æ‰€æœ‰çš„ç”¨æˆ·çº¿ç¨‹ç»“æŸ,å®ˆæŠ¤çº¿ç¨‹è‡ªåŠ¨ç»“æŸ<br>3.å¸¸è§çš„å®ˆæŠ¤çº¿ç¨‹:åƒåœ¾å›æ”¶æœºåˆ¶</p><h4 id="å®ˆæŠ¤çº¿ç¨‹å®ä¾‹"><a href="#å®ˆæŠ¤çº¿ç¨‹å®ä¾‹" class="headerlink" title="å®ˆæŠ¤çº¿ç¨‹å®ä¾‹"></a>å®ˆæŠ¤çº¿ç¨‹å®ä¾‹</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> no3 <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">MyDaemonThread</span> dt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyDaemonThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dt<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dt<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å·¥ä½œå¹¸è‹¦ã€‚ã€‚ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">MyDaemonThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"XXOOing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"></a>çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</h4><p>Â·NEW å°šæœªå¯åŠ¨çš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€<br>Â·RUNNABLE åœ¨Javaè™šæ‹Ÿæœºä¸­æ‰§è¡Œçš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€<br>Â·BLOCKED  è¢«é˜»å¡ç­‰å¾…ç›‘è§†å™¨é”å®šçš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€<br>Â·WAITING  æ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç‰¹å®šåŠ¨ä½œçš„çº¿ç¨‹å¤„äºæ­¤çº¿ç¨‹<br>Â·TIMED_WAITING<br>Â·TERMINATED  å·²é€€å‡ºçš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€</p><h4 id="Synchronized-çº¿ç¨‹åŒæ­¥æœºåˆ¶"><a href="#Synchronized-çº¿ç¨‹åŒæ­¥æœºåˆ¶" class="headerlink" title="Synchronized çº¿ç¨‹åŒæ­¥æœºåˆ¶"></a>Synchronized çº¿ç¨‹åŒæ­¥æœºåˆ¶</h4><p>1.åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹,ä¸€äº›æ•æ„Ÿæ•°æ®ä¸å…è®¸è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®,æ­¤æ—¶å°±éœ€è¦ç¤ºæ„åŒæ­¥è®¿é—®æŠ€æœ¯,ä¿è¯æ•°æ®åœ¨ä»»ä½•åŒä¸€æ—¶åˆ»,æœ€å¤šç”±ä¸€ä¸ªçº¿ç¨‹<br>è®¿é—®,ä»¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§</p><h4 id="åŒæ­¥å…·ä½“æ–¹æ³•"><a href="#åŒæ­¥å…·ä½“æ–¹æ³•" class="headerlink" title="åŒæ­¥å…·ä½“æ–¹æ³•"></a>åŒæ­¥å…·ä½“æ–¹æ³•</h4><p>1.åŒæ­¥ä»£ç å—<br>synchronized(å¯¹è±¡){//éœ€è¦è¢«åŒæ­¥ä»£ç }å¾—åˆ°å¯¹è±¡çš„é”,æ‰èƒ½æ“ä½œåŒæ­¥ä»£ç <br>2.synchronizedè¿˜å¯ä»¥æ”¾åœ¨æ–¹æ³•å£°æ˜ä¸­,è¡¨ç¤ºæ•´ä¸ªæ–¹æ³•-ä¸ºåŒæ­¥æ–¹æ³•<br>public synchronized void m(String name){//éœ€è¦è¢«åŒæ­¥çš„ä»£ç }</p><h4 id="ä½¿ç”¨äº’æ–¥é”æ¥è§£å†³å”®ç¥¨é—®é¢˜"><a href="#ä½¿ç”¨äº’æ–¥é”æ¥è§£å†³å”®ç¥¨é—®é¢˜" class="headerlink" title="ä½¿ç”¨äº’æ–¥é”æ¥è§£å†³å”®ç¥¨é—®é¢˜"></a>ä½¿ç”¨äº’æ–¥é”æ¥è§£å†³å”®ç¥¨é—®é¢˜</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> no4 <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SellTicket03</span> sellTicket03 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SellTicket03</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>sellTicket03<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç¬¬ 1 ä¸ªçº¿ç¨‹-çª—å£</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>sellTicket03<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç¬¬ 2 ä¸ªçº¿ç¨‹-çª—å£</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>sellTicket03<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç¬¬ 3 ä¸ªçº¿ç¨‹-çª—</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">SellTicket03</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> ticketNum <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span><span class="token comment">//è®©å¤šä¸ªçº¿ç¨‹å…±äº« ticketNum</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> loop <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//æ§åˆ¶ run æ–¹æ³•å˜é‡</span>    <span class="token class-name">Object</span> object <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token comment">/*synchronized*/</span> <span class="token keyword">void</span> <span class="token function">sell</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//åœ¨åŒä¸€æ—¶åˆ»,åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œsellæ–¹æ³•</span>        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>ticketNum <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å”®ç¥¨ç»“æŸ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                loop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">//ä¼‘çœ  50 æ¯«ç§’, æ¨¡æ‹Ÿ</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"çª—å£ "</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" å”®å‡ºä¸€å¼ ç¥¨"</span> <span class="token operator">+</span> <span class="token string">" å‰©ä½™ç¥¨æ•°="</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">--</span>ticketNum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1 - 0 - -1 - -</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>loop<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">sell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title&gt;&lt;/a&gt;&lt;div class=&quot;note purple no-icon flat&quot;&gt;&lt;p&gt;javaWebå¤ä¹  &lt;/p&gt;
&lt;/div&gt;&lt;/h1&gt;&lt;h2 id=&quot;Httpåè®®&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    <category term="javaWeb" scheme="https://100qin10086.github.io/categories/javaWeb/"/>
    
    
    <category term="javaWeb" scheme="https://100qin10086.github.io/tags/javaWeb/"/>
    
  </entry>
  
  <entry>
    <title>javaWebå¤ä¹ </title>
    <link href="https://100qin10086.github.io/posts/a3abe12b.html"/>
    <id>https://100qin10086.github.io/posts/a3abe12b.html</id>
    <published>2024-03-07T01:37:25.000Z</published>
    <updated>2024-05-06T14:13:59.610Z</updated>
    
    <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a><div class="note purple no-icon flat"><p>javaWebå¤ä¹  </p></div></h1><h2 id="DOMå¤ä¹ "><a href="#DOMå¤ä¹ " class="headerlink" title="DOMå¤ä¹ "></a>DOMå¤ä¹ </h2><h3 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>1.DOM å…¨ç§°æ˜¯ Document Object Model æ–‡æ¡£å¯¹è±¡æ¨¡å‹<br>2.å°±æ˜¯æŠŠæ–‡æ¡£ä¸­çš„æ ‡ç­¾ï¼Œå±æ€§ï¼Œæ–‡æœ¬ï¼Œè½¬æ¢æˆä¸ºå¯¹è±¡æ¥ç®¡ç†<br>3.å½“ç½‘é¡µè¢«åŠ è½½æ—¶,æµè§ˆå™¨ä¼šåˆ›å»ºé¡µé¢çš„æ–‡æ¡£å¯¹è±¡æ¨¡å‹(Document Object Model)</p><h4 id="doucmentè¯´æ˜"><a href="#doucmentè¯´æ˜" class="headerlink" title="doucmentè¯´æ˜"></a>doucmentè¯´æ˜</h4><p>1.document å®ƒç®¡ç†äº†æ‰€æœ‰çš„HTMLæ–‡æ¡£å†…å®¹<br>2.document å®ƒæ˜¯ä¸€ç§æ ‘ç»“æ„çš„æ–‡æ¡£<br>3.æœ‰å±‚çº§å…³ç³»,åœ¨domä¸­æŠŠæ‰€æœ‰çš„æ ‡ç­¾éƒ½å¯¹è±¡åŒ–(å¾—åˆ°è¿™ä¸ªhtmlæ ‡ç­¾çš„&lt;â€”&gt;å¯¹è±¡â€”&gt;æ“ä½œ)<br>4.é€šè¿‡ document å¯ä»¥è®¿é—®æ‰€æœ‰çš„æ ‡ç­¾å¯¹è±¡</p><h5 id="å®ä¾‹ä¸€"><a href="#å®ä¾‹ä¸€" class="headerlink" title="å®ä¾‹ä¸€"></a>å®ä¾‹ä¸€</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//1. è·å– myHeader çš„ dom å¯¹è±¡</span>    <span class="token keyword">var</span> elementsByName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByName</span><span class="token punctuation">(</span><span class="token string">"myHeader"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> input1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"input1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//2. ç»™ myHeader ç»‘å®š onclick çš„äº‹ä»¶</span>    elementsByName<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"åŠ¨æ€ç»‘å®š å†…å®¹æ˜¯= "</span> <span class="token operator">+</span> myHeader<span class="token punctuation">.</span>innerText<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="å®ä¾‹äºŒ"><a href="#å®ä¾‹äºŒ" class="headerlink" title="å®ä¾‹äºŒ"></a>å®ä¾‹äºŒ</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>    <span class="token keyword">function</span> <span class="token function">addImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> img<span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    img<span class="token punctuation">.</span>src<span class="token operator">=</span><span class="token string">'1.png'</span><span class="token punctuation">;</span>    img<span class="token punctuation">.</span>hight<span class="token operator">=</span><span class="token string">'100'</span><span class="token punctuation">;</span>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="HTML-DOMèŠ‚ç‚¹"><a href="#HTML-DOMèŠ‚ç‚¹" class="headerlink" title="HTML DOMèŠ‚ç‚¹"></a>HTML DOMèŠ‚ç‚¹</h3><h4 id="èŠ‚ç‚¹å¸¸ç”¨æ–¹æ³•"><a href="#èŠ‚ç‚¹å¸¸ç”¨æ–¹æ³•" class="headerlink" title="èŠ‚ç‚¹å¸¸ç”¨æ–¹æ³•"></a>èŠ‚ç‚¹å¸¸ç”¨æ–¹æ³•</h4><p>1.é€šè¿‡å…·ä½“çš„å…ƒç´ èŠ‚ç‚¹è°ƒç”¨ getElementsByTagName() æ–¹æ³•ï¼Œè·å–å½“å‰èŠ‚ç‚¹çš„æŒ‡å®šæ ‡ç­¾åå­©å­èŠ‚ç‚¹<br>2.appendChild(oChildNode)æ–¹æ³•,å¯ä»¥æ·»åŠ ä¸€ä¸ªå­ç»“ç‚¹<br>3.èŠ‚ç‚¹å¸¸ç”¨å±æ€§<br>(1)childNodes å±æ€§ï¼Œè·å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹<br>(2)firstChild å±æ€§ï¼Œè·å–å½“å‰èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹<br>(3)lastChild å±æ€§ï¼Œè·å–å½“å‰èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹<br>(4)parentNode å±æ€§ï¼Œè·å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹<br>(5)nextSibling å±æ€§ï¼Œè·å–å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ (åä¸€ä¸ª)<br>(6)previousSibling å±æ€§ï¼Œè·å–å½“å‰èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ (å‰ä¸€ä¸ª)<br>(7)className ç”¨äºè·å–æˆ–è®¾ç½®æ ‡ç­¾çš„ class å±æ€§å€¼<br>(8)innerHTML å±æ€§ï¼Œè¡¨ç¤ºè·å–/è®¾ç½®èµ·å§‹æ ‡ç­¾å’Œç»“æŸæ ‡ç­¾ä¸­çš„å†…å®¹<br>(9)innerText å±æ€§ï¼Œè¡¨ç¤ºè·å–/è®¾ç½®èµ·å§‹æ ‡ç­¾å’Œç»“æŸæ ‡ç­¾ä¸­çš„æ–‡æœ¬</p><h2 id="XMLå¤ä¹ "><a href="#XMLå¤ä¹ " class="headerlink" title="XMLå¤ä¹ "></a>XMLå¤ä¹ </h2><h3 id="ä¸ºä»€ä¹ˆéœ€è¦XML"><a href="#ä¸ºä»€ä¹ˆéœ€è¦XML" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦XML"></a>ä¸ºä»€ä¹ˆéœ€è¦XML</h3><p>1.éœ€æ±‚ä¸€:ä¸¤ä¸ªç¨‹åºé—´è¿›è¡Œæ•°æ®é€šä¿¡<br>2.éœ€æ±‚äºŒ:ç»™ä¸€å°æœåŠ¡å™¨ï¼Œåšä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå½“æœåŠ¡å™¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œå»è¯»å–å®ƒåº”å½“ç›‘å¬çš„ç«¯å£å·ã€è¿˜æœ‰è¿æ¥æ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç <br>3.springä¸­çš„iocé…ç½®æ–‡ä»¶,beans.xml mybatis XXXMapper.xml tomcat server.xml web.xml maven pom.xml<br>4.èƒ½å­˜å‚¨å¤æ‚çš„æ•°æ®å…³ç³»<br>5.xml æ–‡ä»¶åšå°å‹æ•°æ®åº“ï¼Œä¹Ÿæ˜¯ä¸é”™çš„é€‰æ‹©ï¼Œæˆ‘ä»¬ç¨‹åºä¸­å¯èƒ½ç”¨åˆ°çš„æ•°æ®ï¼Œå¦‚æœæ”¾åœ¨æ•°æ®åº“ ä¸­è¯»å–ä¸åˆé€‚(å› ä¸ºä½ è¦å¢åŠ ç»´æŠ¤æ•°æ®åº“å·¥ä½œ)<br>ï¼Œå¯ä»¥è€ƒè™‘ç›´æ¥ç”¨xmlæ¥åšå°å‹æ•°æ®åº“ ï¼Œè€Œä¸”ç›´æ¥è¯»å–æ–‡ä»¶æ˜¾ç„¶è¦æ¯”è¯»å–æ•°æ®åº“å¿«</p><h3 id="DOM4jæŠ€æœ¯"><a href="#DOM4jæŠ€æœ¯" class="headerlink" title="DOM4jæŠ€æœ¯"></a>DOM4jæŠ€æœ¯</h3><p>1.Dom4j æ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„ Java XML APIï¼Œå…·æœ‰æ€§èƒ½ä¼˜å¼‚ã€åŠŸèƒ½å¼ºå¤§å’Œææ˜“ä½¿ç”¨çš„ç‰¹ç‚¹ã€‚ç°åœ¨å¾ˆå¤šè½¯ä»¶é‡‡ç”¨çš„ Dom4j<br>2.ä½¿ç”¨Dom4jå¼€å‘,éœ€è¦ä¸‹è½½dom4jç›¸åº”çš„jaræ–‡ä»¶</p><h4 id="DOM4jåº”ç”¨å®ä¾‹"><a href="#DOM4jåº”ç”¨å®ä¾‹" class="headerlink" title="DOM4jåº”ç”¨å®ä¾‹"></a>DOM4jåº”ç”¨å®ä¾‹</h4><p>1.é‡ç‚¹æ˜¯æŸ¥è¯¢(éå†å’ŒæŒ‡å®šæŸ¥è¯¢)<br>2.xmlå¢åˆ æ”¹ä½¿ç”¨å°‘</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">?</span><span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>students<span class="token punctuation">></span></span>    <span class="token operator">&lt;</span>student id<span class="token operator">=</span><span class="token string">"01"</span><span class="token operator">></span>     <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">></span></span>å°é¾™å¥³<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">></span>     <span class="token generics"><span class="token punctuation">&lt;</span>gender<span class="token punctuation">></span></span>å¥³<span class="token operator">&lt;</span><span class="token operator">/</span>gender<span class="token operator">></span>     <span class="token generics"><span class="token punctuation">&lt;</span>age<span class="token punctuation">></span></span><span class="token number">16</span><span class="token operator">&lt;</span><span class="token operator">/</span>age<span class="token operator">></span>     <span class="token generics"><span class="token punctuation">&lt;</span>resume<span class="token punctuation">></span></span>å¤å¢“æ´¾æŒé—¨äºº<span class="token operator">&lt;</span><span class="token operator">/</span>resume<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>student<span class="token operator">></span>    <span class="token operator">&lt;</span>student id<span class="token operator">=</span><span class="token string">"02"</span><span class="token operator">></span>     <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">></span></span>æ¬§é˜³é”‹<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">></span>     <span class="token generics"><span class="token punctuation">&lt;</span>gender<span class="token punctuation">></span></span>ç”·<span class="token operator">&lt;</span><span class="token operator">/</span>gender<span class="token operator">></span>     <span class="token generics"><span class="token punctuation">&lt;</span>age<span class="token punctuation">></span></span><span class="token number">18</span><span class="token operator">&lt;</span><span class="token operator">/</span>age<span class="token operator">></span>     <span class="token generics"><span class="token punctuation">&lt;</span>resume<span class="token punctuation">></span></span>ç™½é©¼å±±<span class="token punctuation">,</span>è›¤èŸ†ç¥åŠŸ<span class="token operator">&lt;</span><span class="token operator">/</span>resume<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>student<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>students<span class="token operator">></span><span class="token comment">//javaä»£ç </span>    <span class="token comment">//å¾—åˆ°ä¸€ä¸ªè§£æå™¨</span>    <span class="token class-name">SAXReader</span> reader<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">SAXReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//å¾—åˆ°xmlæ–‡ä»¶</span>    <span class="token class-name">Document</span> document<span class="token operator">=</span>reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"src/student.xml"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//å¾—åˆ°æ ¹èŠ‚ç‚¹</span>    <span class="token class-name">Element</span> rootElement<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getRootElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//å¾—åˆ°æ ¹èŠ‚ç‚¹ä¸‹çš„å­ç»“ç‚¹</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Element</span><span class="token punctuation">></span></span> students<span class="token operator">=</span>rootElement<span class="token punctuation">.</span><span class="token function">elements</span><span class="token punctuation">(</span><span class="token string">"student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>student<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Element</span> student <span class="token operator">:</span> students<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token class-name">Element</span> name<span class="token operator">=</span>student<span class="token punctuation">.</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token class-name">Element</span> age <span class="token operator">=</span> student<span class="token punctuation">.</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token class-name">Element</span> resume <span class="token operator">=</span> student<span class="token punctuation">.</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token string">"resume"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token class-name">Element</span> gender <span class="token operator">=</span> student<span class="token punctuation">.</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å­¦ç”Ÿä¿¡æ¯= "</span> <span class="token operator">+</span> name<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> age<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> resume<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> gender<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//åˆ›å»ºä¸€ä¸ªå­¦ç”ŸèŠ‚ç‚¹</span>    <span class="token class-name">Element</span> newStu <span class="token operator">=</span> <span class="token class-name">DocumentHelper</span><span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    newsStu<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span><span class="token string">"03"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Element</span> newStu_name <span class="token operator">=</span> <span class="token class-name">DocumentHelper</span><span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    newStu_name<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"å®‹æ±Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//åˆ›å»º age å…ƒç´ </span>    <span class="token class-name">Element</span> newStu_age <span class="token operator">=</span> <span class="token class-name">DocumentHelper</span><span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    newStu_age<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"23"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//åˆ›å»º resume å…ƒç´ </span>    <span class="token class-name">Element</span> newStu_intro <span class="token operator">=</span> <span class="token class-name">DocumentHelper</span><span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"resume"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    newStu_intro<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"æ¢å±±è€å¤§"</span><span class="token punctuation">)</span>    <span class="token comment">//æŠŠä¸‰ä¸ªå­å…ƒç´ ï¼ˆèŠ‚ç‚¹ï¼‰åŠ åˆ° newStu ä¸‹</span>    newStu<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newStu_name<span class="token punctuation">)</span><span class="token punctuation">;</span>    newStu<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newStu_age<span class="token punctuation">)</span><span class="token punctuation">;</span>    newStu<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newStu_intro<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//å†æŠŠ newStu èŠ‚ç‚¹åŠ åˆ°æ ¹å…ƒç´ </span>    document<span class="token punctuation">.</span><span class="token function">getRootElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newStu<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//ç›´æ¥è¾“å‡ºä¼šå‡ºç°ä¸­æ–‡ä¹±ç :</span>    <span class="token class-name">OutputFormat</span> output <span class="token operator">=</span> <span class="token class-name">OutputFormat</span><span class="token punctuation">.</span><span class="token function">createPrettyPrint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    output<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¾“å‡ºçš„ç¼–ç  utf-8</span>    <span class="token comment">////æŠŠæˆ‘ä»¬çš„ xml æ–‡ä»¶æ›´</span>    <span class="token class-name">XMLWriter</span> writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLWriter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"src/students.xml"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">;</span>    writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">;</span>    writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h2><h3 id="WEBå¼€å‘ä»‹ç»"><a href="#WEBå¼€å‘ä»‹ç»" class="headerlink" title="WEBå¼€å‘ä»‹ç»"></a>WEBå¼€å‘ä»‹ç»</h3><p>1.WEBæœåŠ¡å™¨(ä¸»æœº)ä¸Šä¾›å¤–ç•Œè®¿é—®çš„Webèµ„æºåˆ†ä¸º<br>-é™æ€webèµ„æº(å¦‚ html é¡µé¢ï¼‰:æŒ‡ web é¡µé¢ä¸­ä¾›äººä»¬æµè§ˆçš„æ•°æ®å§‹ç»ˆ<br>-åŠ¨æ€ web èµ„æºï¼Œæ¯”å¦‚ Servlet(java)ã€PHP ç­‰</p><h3 id="JavaWebå¼€å‘æŠ€æœ¯æ ˆå›¾-ä¸€å›¾èƒœåƒè¨€"><a href="#JavaWebå¼€å‘æŠ€æœ¯æ ˆå›¾-ä¸€å›¾èƒœåƒè¨€" class="headerlink" title="JavaWebå¼€å‘æŠ€æœ¯æ ˆå›¾-ä¸€å›¾èƒœåƒè¨€"></a>JavaWebå¼€å‘æŠ€æœ¯æ ˆå›¾-ä¸€å›¾èƒœåƒè¨€</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/b0d67072679b22144311328097e3f2e7.png"></div></div><h3 id="æ‰‹å†™ç®€å•WebæœåŠ¡ç¨‹åº"><a href="#æ‰‹å†™ç®€å•WebæœåŠ¡ç¨‹åº" class="headerlink" title="æ‰‹å†™ç®€å•WebæœåŠ¡ç¨‹åº"></a>æ‰‹å†™ç®€å•WebæœåŠ¡ç¨‹åº</h3><pre class="line-numbers language-j" data-language="j"><code class="language-j">public class MyTomcat <span class="token verb keyword">&#123;</span>    public static void main<span class="token punctuation">(</span>String<span class="token verb keyword">[</span><span class="token verb keyword">]</span> args<span class="token punctuation">)</span> throws IOException <span class="token verb keyword">&#123;</span>        <span class="token adverb builtin">/</span><span class="token adverb builtin">/</span>åœ¨<span class="token number">9999</span>ç«¯å£ç›‘å¬        ServerSocket serverSocket <span class="token verb keyword">=</span> new ServerSocket<span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token verb keyword">;</span>        <span class="token adverb builtin">/</span><span class="token adverb builtin">/</span>å¦‚æœserverSocketæ²¡æœ‰å…³é—­<span class="token verb keyword">,</span>å°±ç­‰å¾…è¿æ¥ï¼Œä¸åœçš„ç­‰å¾…        while<span class="token punctuation">(</span><span class="token verb keyword">!</span>serverSocke<span class="token adverb builtin">t.</span>isClosed<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token verb keyword">&#123;</span>            System<span class="token conjunction variable">.</span>ou<span class="token adverb builtin">t.</span>println<span class="token punctuation">(</span><span class="token conjunction variable">"</span><span class="token verb keyword">=</span><span class="token verb keyword">=</span><span class="token verb keyword">=</span><span class="token verb keyword">=</span><span class="token verb keyword">=</span>æˆ‘çš„ web æœåŠ¡åœ¨ <span class="token number">9999</span> ç«¯å£ç›‘å¬<span class="token verb keyword">=</span><span class="token verb keyword">=</span><span class="token verb keyword">=</span><span class="token verb keyword">=</span><span class="token verb keyword">=</span><span class="token conjunction variable">"</span><span class="token punctuation">)</span><span class="token verb keyword">;</span>            <span class="token adverb builtin">/</span><span class="token adverb builtin">/</span><span class="token number">2</span><span class="token conjunction variable">.</span> ç­‰å¾…æµè§ˆå™¨<span class="token adverb builtin">/</span>å®¢æˆ·ç«¯è¿æ¥<span class="token verb keyword">,</span> å¾—åˆ° socket            Socket socket <span class="token verb keyword">=</span> serverSocke<span class="token adverb builtin">t.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token verb keyword">;</span>            <span class="token adverb builtin">/</span><span class="token adverb builtin">/</span><span class="token number">3</span>ã€‚é€šè¿‡socketå¾—åˆ°è¾“å‡ºæµ            OutputStream outputStream <span class="token verb keyword">=</span> socke<span class="token adverb builtin">t.</span>getOutputStream<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token verb keyword">;</span>            outputStream<span class="token conjunction variable">.</span>write<span class="token punctuation">(</span><span class="token conjunction variable">"</span>this a web server<span class="token verb keyword">".</span>getBytes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token verb keyword">;</span>            outputStream<span class="token conjunction variable">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token verb keyword">;</span>            socke<span class="token adverb builtin">t.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token verb keyword">;</span>        <span class="token adverb builtin">&#125;</span>        serverSocke<span class="token adverb builtin">t.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token verb keyword">;</span>    <span class="token adverb builtin">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æµè§ˆå™¨è®¿é—®WebæœåŠ¡è¿‡ç¨‹è¯¦è§£"><a href="#æµè§ˆå™¨è®¿é—®WebæœåŠ¡è¿‡ç¨‹è¯¦è§£" class="headerlink" title="æµè§ˆå™¨è®¿é—®WebæœåŠ¡è¿‡ç¨‹è¯¦è§£"></a>æµè§ˆå™¨è®¿é—®WebæœåŠ¡è¿‡ç¨‹è¯¦è§£</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1eb5d734e83449e1252c243dea82ca0d.png"></div></div><p>1.æµè§ˆå™¨å…ˆæ ¹æ®è¯·æ±‚è§£æå‡ºä¸»æœºå<br>2.å…ˆåˆ°æœ¬æœºçš„Hostæ–‡ä»¶å»æŸ¥è¯¢ä¸»æœºåå¯¹åº”çš„IP<br>3.å¦‚æœåœ¨Hostæ–‡ä»¶æ²¡æœ‰æ‰¾åˆ°åŸŸåçš„IPï¼Œå°±åˆ°å¤–ç½‘çš„DNSæŸ¥æ‰¾,å¦‚æœåœ¨DNSä¹Ÿæ‰¾ä¸åˆ°,å°±ä¼šæŠ¥404<br>4.å¦‚æœæ‰¾åˆ°ä¼šæ ¹æ®æ‰¾åˆ°çš„IPï¼Œå‘tomcatå‘å‡ºhttpè¯·æ±‚<br>5.æœåŠ¡å™¨è§£æå‡ºwebåº”ç”¨,ç„¶åè§£æå‡ºèµ„æº<br>6.ç„¶åå°†ç»“æ„ä»¥httpå“åº”çš„æ–¹å¼è¿”å›<br>7.æœ€åæµè§ˆå™¨è§£æè¿”å›çš„ç»“æ„,å¹¶æ˜¾ç¤º</p><h2 id="åŠ¨æ€WEBå¼€å‘æ ¸å¿ƒ-Servlet"><a href="#åŠ¨æ€WEBå¼€å‘æ ¸å¿ƒ-Servlet" class="headerlink" title="åŠ¨æ€WEBå¼€å‘æ ¸å¿ƒ-Servlet"></a>åŠ¨æ€WEBå¼€å‘æ ¸å¿ƒ-Servlet</h2><h3 id="ä»€ä¹ˆæ˜¯Servlet"><a href="#ä»€ä¹ˆæ˜¯Servlet" class="headerlink" title="ä»€ä¹ˆæ˜¯Servlet"></a>ä»€ä¹ˆæ˜¯Servlet</h3><p>Â·Servlet åœ¨å¼€å‘åŠ¨æ€ WEB å·¥ç¨‹ä¸­ï¼Œå¾—åˆ°å¹¿æ³›çš„åº”ç”¨ï¼ŒæŒæ¡å¥½ Servlet éå¸¸é‡è¦äº†, Servlet(åŸºçŸ³)æ˜¯ SpringMVC çš„åŸºç¡€</p><h4 id="åŸç”Ÿçš„servlet"><a href="#åŸç”Ÿçš„servlet" class="headerlink" title="åŸç”Ÿçš„servlet"></a>åŸç”Ÿçš„servlet</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloServlet</span> <span class="token keyword">implements</span> <span class="token class-name">Servlet</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//è¯¥æ–¹æ³•åªä¼šè°ƒç”¨ä¸€æ¬¡,å°±æ˜¯æ”¹Servletè¢«å®ä¾‹åŒ–æ—¶</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">ServletConfig</span> servletConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">ServletConfig</span> <span class="token function">getServletConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æ”¹æ–¹æ³•ä¸“é—¨ç”¨æ¥å¤„ç†è¯·æ±‚å’Œå“åº”çš„</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getServletInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æµè§ˆå™¨è°ƒç”¨Servletæµç¨‹åˆ†æ"><a href="#æµè§ˆå™¨è°ƒç”¨Servletæµç¨‹åˆ†æ" class="headerlink" title="æµè§ˆå™¨è°ƒç”¨Servletæµç¨‹åˆ†æ"></a>æµè§ˆå™¨è°ƒç”¨Servletæµç¨‹åˆ†æ</h3><p>Â·ä¸€å›¾èƒœåƒè¨€<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/33ff985f882a260c71a3c3a707f715d8.png"></div></div><br>Â·è¯¦ç»†åˆ†æ<br>1.å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¯·æ±‚,tomcatä¼šå¤„ç†è¯·æ±‚å¾—åˆ°è¦è®¿é—®çš„Servletçš„url,ç„¶åå»web.xmlçš„<servlet-mapping>ä¸­æŸ¥æ‰¾æ”¹æ”¹urlå¯¹åº”çš„&lt;<br>servlet-name&gt;<br>2.ç„¶åå»web.xmlçš„<servlet>ä¸‹æŸ¥æ‰¾æ”¹<servlet-name>å¯¹åº”çš„<servlet-class>,å¾—åˆ°è¦è®¿é—®çš„Servletçš„å…¨è·¯å¾„<br>3.åœ¨Tomcatä¸­ç»´æŠ¤äº†ä¸€ä¸ªå¤§çš„HashMap<id,Servlet>,æŸ¥çœ‹æ”¹Hashmap,çœ‹çœ‹æœ‰æœ¨æœ‰è¿™ä¸ªServletå®ä¾‹<br>4.å¦‚æœæ²¡æœ‰æŸ¥åˆ°æ”¹servlet-nameå¯¹åº”çš„id,å³æ²¡æœ‰è¿™ä¸ªServletå®ä¾‹<br>5.ä½¿ç”¨åå°„æŠ€æœ¯å°†å‰é¢çš„å¾—åˆ°çš„Servletçš„å…¨è·¯å¾„å°†servletå®ä¾‹åŒ–,å¹¶æ”¾å…¥åˆ°Tomcatç»´æŠ¤çš„HashMap<id,Servlet><br>6.å¦‚æœæ˜¯ç¬¬äºŒæ¬¡(ä»¥å)è¯·æ±‚,å°±å°‘äº†åå°„å¾—åˆ°Servletå®ä¾‹çš„é‚£ä¸€æ­¥,ç›´æ¥ä»HashMapä¸­æŸ¥æ‰¾<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/5846614c5c20db92c57a04b10d428906.png"></div></div></id,Servlet></id,Servlet></servlet-class></servlet-name></servlet></servlet-mapping></p><h3 id="Servletç”Ÿå‘½å‘¨æœŸ"><a href="#Servletç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Servletç”Ÿå‘½å‘¨æœŸ"></a>Servletç”Ÿå‘½å‘¨æœŸ</h3><p>Â·ä¸»è¦æœ‰ä¸‰ä¸ªæ–¹æ³•<br>1.init()åˆå§‹åŒ–é˜¶æ®µã€è¯¥æ–¹æ³•åªåœ¨Servletå®ä¾‹åŒ–æ—¶è°ƒç”¨ã€‘<br>2.service()å¤„ç†æµè§ˆå™¨è¯·æ±‚é˜¶æ®µ<br>3.destroy()ç»ˆæ­¢é˜¶æ®µ<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/46174e96cc44e35bd7c59bb28c5e8573.png"></div></div></p><h4 id="åˆå§‹åŒ–é˜¶æ®µ"><a href="#åˆå§‹åŒ–é˜¶æ®µ" class="headerlink" title="åˆå§‹åŒ–é˜¶æ®µ"></a>åˆå§‹åŒ–é˜¶æ®µ</h4><p>Â·Servlet å®¹å™¨(æ¯”å¦‚: Tomcat)åŠ è½½ Servletï¼ŒåŠ è½½å®Œæˆåï¼ŒServlet å®¹å™¨ä¼šåˆ›å»ºä¸€ä¸ª Servlet å®ä¾‹å¹¶è°ƒç”¨ init()æ–¹æ³•ï¼Œinit()æ–¹æ³•åªä¼šè°ƒç”¨ä¸€æ¬¡ã€‚<br>1.Servletå®¹å™¨(Tomcat)å¯åŠ¨æ—¶è‡ªåŠ¨è£…è½½æŸäº›servlet,å®ç°è¿™ä¸ªéœ€è¦åœ¨web.xmlæ–‡ä»¶ä¸­æ·»åŠ <load-on-startup>1&lt;/load-on-startup&gt;<br>2.Servlet é‡æ–°è£…è½½æ—¶(æ¯”å¦‚ tomcat è¿›è¡Œ redeployã€redeploy ä¼šé”€æ¯æ‰€æœ‰çš„ Servlet å®ä¾‹ã€‘)ï¼Œæµè§ˆå™¨å†å‘ Servlet å‘é€è¯·æ±‚çš„ç¬¬ 1 æ¬¡</load-on-startup></p><h4 id="å¤„ç†æµè§ˆå™¨è¯·æ±‚é˜¶æ®µ-serviceæ–¹æ³•"><a href="#å¤„ç†æµè§ˆå™¨è¯·æ±‚é˜¶æ®µ-serviceæ–¹æ³•" class="headerlink" title="å¤„ç†æµè§ˆå™¨è¯·æ±‚é˜¶æ®µ(serviceæ–¹æ³•)"></a>å¤„ç†æµè§ˆå™¨è¯·æ±‚é˜¶æ®µ(serviceæ–¹æ³•)</h4><p>1.æ¯æ”¶åˆ°ä¸€ä¸ªhttpè¯·æ±‚,æœåŠ¡å™¨å°±ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„çº¿ç¨‹å»å¤„ç†<br>2.åˆ›å»ºä¸€ä¸ªç”¨äºå°è£…HTTPè¯·æ±‚æ¶ˆæ¯çš„ServletRequestå¯¹è±¡å’Œä¸€ä¸ªä»£è¡¨HTTPå“åº”æ¶ˆæ¯çš„ServletResponseå¯¹è±¡<br>3.ç„¶åè°ƒç”¨Servletçš„service()æ–¹æ³•å¹¶å°†è¯·æ±‚å’Œå“åº”å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’è¿›å»</p><h4 id="ç»ˆæ­¢é˜¶æ®µ-destroy-æ–¹æ³•-ä½“ç°-Servlet-å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#ç»ˆæ­¢é˜¶æ®µ-destroy-æ–¹æ³•-ä½“ç°-Servlet-å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç»ˆæ­¢é˜¶æ®µ destroy æ–¹æ³•(ä½“ç° Servlet å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸ)"></a>ç»ˆæ­¢é˜¶æ®µ destroy æ–¹æ³•(ä½“ç° Servlet å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸ)</h4><p>1.å½“web åº”ç”¨è¢«ç»ˆæ­¢ï¼Œæˆ–è€…Servlet å®¹å™¨ç»ˆæ­¢è¿è¡Œï¼Œæˆ–è€…Servlet ç±»é‡æ–°è£…è½½æ—¶ï¼Œä¼šè°ƒç”¨ destroy()æ–¹æ³•, æ¯”å¦‚é‡å¯ tomcat ,æˆ–è€…<br>redeploy web åº”ç”¨</p><h3 id="Servlet-æ³¨è§£æ–¹å¼"><a href="#Servlet-æ³¨è§£æ–¹å¼" class="headerlink" title="Servlet - æ³¨è§£æ–¹å¼"></a>Servlet - æ³¨è§£æ–¹å¼</h3><p>1.Servletæ”¯æŒæ³¨è§£çš„é…ç½®,ä¸€ä¸ªServletæ”¯æŒé…ç½®å¤šä¸ªurlPattern<br>ä¾‹å¦‚:@WebServlet(urlPatterns = {â€œ/ok1â€, â€œ/ok2â€})<br>2.åŒæ—¶åŸºäºæ³¨è§£é…ç½®ä¹Ÿæ”¯æŒç›®å½•åŒ¹é…ã€@WebServlet(â€œ/ok/<em>â€œ)ã€‘,æ‰©å±•ååŒ¹é…ã€@WebServlet(â€œ</em>.actionâ€),ä»»æ„åŒ¹é…ã€@WebServlet(â€œ/â€œ)<br>@WebServlet(â€œ/*â€)ã€‘</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title&gt;&lt;/a&gt;&lt;div class=&quot;note purple no-icon flat&quot;&gt;&lt;p&gt;javaWebå¤ä¹  &lt;/p&gt;
&lt;/div&gt;&lt;/h1&gt;&lt;h2 id=&quot;DOMå¤ä¹ &quot;&gt;&lt;a href=&quot;#</summary>
      
    
    
    
    <category term="javaWeb" scheme="https://100qin10086.github.io/categories/javaWeb/"/>
    
    
    <category term="javaWeb" scheme="https://100qin10086.github.io/tags/javaWeb/"/>
    
  </entry>
  
  <entry>
    <title>ä¼Šæ–¯å­©å‰²ç¤¼ç•™å¿µ</title>
    <link href="https://100qin10086.github.io/posts/195db198.html"/>
    <id>https://100qin10086.github.io/posts/195db198.html</id>
    <published>2024-02-11T14:04:19.000Z</published>
    <updated>2024-05-06T14:13:59.610Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="be16eaba982ef74b675d6700d786fccd6c13a255021884a836d66b72f6d67bf9">179ff0acd31da41b1bfdfb571c96c200c4d0ed50516a891c6898e98afd6dc139687ab0600a4450905adedde2a271a12b12f95ab7eaef9673e6ad3bb8872235f63b162e5e4559fcbd70222eec9002ae038566abab3625ae2a2fbeb153014a3234c54901b0ac13fad3cb1fbd59238c22cba51133ce4b7b74bb8ee93608b07a294e5810b945bdc7380a77feb05f2f41b608513cb93f043c1659aed28b73a5753e0721da7464934e4f3a13f78e559b6c0fa8cf8ca3720477f41c8313cca603403656fbddb953cb589a3e13f36da9131fb913448c2a951782b4a3b7c70f104dcb754be9cb5a4f8d836bcab6985d2ea0a8152e3f6af86f4734c5bc7538ed23a5ab0ccac2a214e27b8df84dbc50e7dfda53b36802a5f784ca5d06128e0030fcfa54d773f010c7366e1e4587742425b9e70d4089823a9e442de805646eebc6b0fd371a8a6c4a91fc767dede752e1fefbf7c9abb6c00d68681e9bae7ee0a69ec7e18a76694cafde665183ed84cc61c3dee026f6480b18f4a90af20849b17a1f204221effabb2eebe5057613a20c62f47a2517542d2526f53733af7b92833c97e7d56b09bbf2c966a762bf8028a91e7c5f22d35fd215315254c5f84c9c4f955bb641920ea17ca11a78cb6eefd8c0d8f764a2ffb736a1393747cd668e5be9d2f17eba8e02903793b2042b345053e1624a8f795fc53fb30e1c9c9e2802a6dda6a7be91ed963ee802df4c74fad435126f889e0362c1d003fd3ae747380f0fb4fe6f9b7063ba3833f141fe8a0d7f9b48bfe62c3d5405402eb0ba35bb9fed5e7ff1558c4e14f083b14131110f8aca2ef9f24bc22d3438096bcfc3f65805296a03fb94bff9ee4010ae2e13898989b6d3852a75c6d3cc41c7</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Here&#39;s something encrypted, password is required to continue reading.</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>æ³›å‹ç¨‹åºè®¾è®¡</title>
    <link href="https://100qin10086.github.io/posts/98735cb0.html"/>
    <id>https://100qin10086.github.io/posts/98735cb0.html</id>
    <published>2023-09-07T07:07:59.000Z</published>
    <updated>2024-05-06T14:13:59.614Z</updated>
    
    <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a><div class="note purple no-icon flat"><p>æ³›å‹ç¨‹åºè®¾è®¡</p></div></h1><p>~~ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ³›å‹ç¨‹åºè®¾è®¡<br>  Â·æ³›å‹ç¨‹åºè®¾è®¡æ„å‘³ç€ç¼–å†™çš„ä»£ç å¯ä»¥å¯¹å¤šç§ä¸åŒç±»å‹çš„å¯¹è±¡é‡ç”¨<br>~~ç±»å‹å‚æ•°<br>  Â·ArrayList list=new ArrayList<String>(),è¿™ä½¿å¾—ä»£ç å…·æœ‰æ›´å¥½çš„å¯è¯»æ€§,äººé—¨ä¸€çœ‹å°±çŸ¥é“è¿™ä¸ªæ•°ç»„åˆ—è¡¨ä¸­åŒ…å«çš„æ˜¯String<br>  Â·ç¼–è¯‘å™¨ä¹Ÿå¯ä»¥å……åˆ†åˆ©ç”¨è¿™ä¸ªç±»å‹çš„ä¿¡æ¯,è°ƒç”¨getçš„æ—¶å€™,ä¸éœ€è¦è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢,ç¼–è¯‘å™¨çŸ¥é“è¿”å›å€¼ç±»å‹ä¸ºString<br>  Â·ç¼–è¯‘å™¨è¿˜çŸ¥é“ArrayList<String>addæ–¹æ³•æœ‰ä¸€ä¸ªç±»å‹ä¸ºStringåœ°å‚æ•°,è¿™æ¯”æœ‰ä¸€ä¸ªObjectç±»å‹åœ°å‚æ•°è¦å®‰å…¨åœ°å¤š,ç°åœ¨,ç¼–è¯‘å™¨å¯ä»¥æ£€æŸ¥,é˜²æ­¢ä½ æ’å…¥é”™è¯¯ç±»å‹åœ°å¯¹è±¡<br>  Â·å‡ºç°ç¼–è¯‘é”™è¯¯æ¯”è¿è¡Œæ—¶å‡ºç°ç±»åœ°å¼ºåˆ¶ç±»å‹è½¬æ¢å¼‚å¸¸å¥½çš„å¤š<br>~~å®šä¹‰ç®€å•æ³›å‹ç±»<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">T</span> first<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">T</span> second<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Pair</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        first<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>        second<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Pair</span><span class="token punctuation">(</span><span class="token class-name">T</span> first<span class="token punctuation">,</span> <span class="token class-name">T</span> second<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>first <span class="token operator">=</span> first<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>second <span class="token operator">=</span> second<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> first<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFirst</span><span class="token punctuation">(</span><span class="token class-name">T</span> first<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>first <span class="token operator">=</span> first<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">getSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> second<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSecond</span><span class="token punctuation">(</span><span class="token class-name">T</span> second<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>second <span class="token operator">=</span> second<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>~~æ³›å‹çš„å¥½å¤„<br>  Â·ç¼–è¯‘æ—¶,æ£€æŸ¥æ·»åŠ å…ƒç´ åœ°ç±»å‹,æé«˜äº†å®‰å…¨æ€§<br>  Â·å‡å°‘äº†ç±»å‹è½¬åŒ–åœ°æ¬¡æ•°,æé«˜äº†æ•ˆç‡<br>~~æ³›å‹æ–¹æ³•<br>  Â·ç±»å‹å˜é‡æ”¾åœ¨ä¿®é¥°ç¬¦ä¹‹å,å¹¶åœ¨è¿”å›ç±»å‹ä¹‹å‰<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">T</span> <span class="token function">getMiddle</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> a<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> a<span class="token punctuation">[</span>a<span class="token punctuation">.</span>length<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">//è°ƒç”¨</span><span class="token class-name">String</span> middle <span class="token operator">=</span> <span class="token class-name">Pair</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token function">getMiddle</span><span class="token punctuation">(</span><span class="token string">"j"</span><span class="token punctuation">,</span> <span class="token string">"q"</span><span class="token punctuation">,</span> <span class="token string">"k"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>  Â·åœ¨è¿™ç§æƒ…å†µä¸‹,æ–¹æ³•è°ƒç”¨ä¸­å¯ä»¥çœç•¥<String> ç±»å‹å‚æ•°ï¼Œå› ä¸ºå¯ä»¥ä»ç±»å‹å‚æ•°å“ªé‡Œè¿›è¡Œæ¨æ–­<br>  Â·ä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•åœ°é—®é¢˜åˆ†æ<br>  Â·1.ä¸èƒ½å¯¹åŠ å…¥åˆ°é›†åˆArrayListä¸­çš„æ•°æ®è¿›è¡Œçº¦æŸ<br>  Â·2.éå†åœ°æ—¶å€™,éœ€è¦è¿›è¡Œç±»å‹è½¬æ¢,å¦‚æœé›†åˆä¸­åœ°æ•°æ®é‡è¾ƒå¤§,å¯¹æ•ˆç‡æœ‰å½±å“<br>~~æ³›å‹åœ°ä»‹ç»<br>  Â·æ³›(å¹¿æ³›)å‹(ç±»å‹)=<br>  Â·æ³›å‹åˆç§°å‚æ•°åŒ–ç±»å‹<br>  Â·åœ¨ç±»å£°æ˜æˆ–å®ä¾‹åŒ–æ—¶åªè¦åˆ¶å®šå¥½éœ€è¦åœ°å…·ä½“åœ°ç±»å‹å³å¯<br>  Â·æ³›å‹åœ°ä½œç”¨æ˜¯:å¯ä»¥åœ¨ç±»å£°æ˜æ—¶é€šè¿‡ä¸€ä¸ªæ ‡è¯†è¡¨ç¤ºç±»ä¸­æŸä¸ªå±æ€§åœ°ç±»å‹<br>  Â·åœ¨ç»™æ³›å‹æŒ‡å®šå…·ä½“ç±»å‹å,å¯ä»¥ä¼ å…¥è¯¥ç±»å‹æˆ–è€…è¯¥ç±»å‹åœ°å­ç±»å‹<br>  Â·ç»™æ³›å‹æŒ‡å‘æ•°æ®ç±»å‹æ˜¯,è¦æ±‚æ˜¯å¼•ç”¨ç±»å‹,ä¸èƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹<br>~~è‡ªå®šä¹‰æ³›å‹æ¥å£<br>  Â·åŸºæœ¬è¯­æ³• interface æ¥å£å<T,R...>{}<br>~~æ³›å‹åœ°ç»§æ‰¿å’Œé€šé…ç¬¦<br>  Â·æ³›å‹ä¸å…·å¤‡ç»§æ‰¿æ€§<br>  Â·&lt;? extends A&gt;:æ”¯æŒAç±»ä»¥åŠAç±»åœ°å­ç±»,è§„å®šäº†æ³›å‹åœ°ä¸Šé™<br>  Â·&lt;? super A&gt;:æ”¯æŒAç±»ä»¥åŠAç±»åœ°çˆ¶ç±»,ä¸é™äºç›´æ¥çˆ¶ç±»,è§„å®šäº†æ³›å‹åœ°ä¸‹é™</T,R...></String></String></String></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title&gt;&lt;/a&gt;&lt;div class=&quot;note purple no-icon flat&quot;&gt;&lt;p&gt;æ³›å‹ç¨‹åºè®¾è®¡&lt;/p&gt;
&lt;/div&gt;&lt;/h1&gt;&lt;p&gt;~~ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ³›å‹ç¨‹åºè®¾è®¡&lt;br&gt;  Â·æ³›å‹ç¨‹åºè®¾</summary>
      
    
    
    
    <category term="javaåŸºç¡€" scheme="https://100qin10086.github.io/categories/java%E5%9F%BA%E7%A1%80/"/>
    
    
    <category term="java" scheme="https://100qin10086.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>æ¥å£-lambdaè¡¨è¾¾å¼-å†…éƒ¨ç±»</title>
    <link href="https://100qin10086.github.io/posts/280ce217.html"/>
    <id>https://100qin10086.github.io/posts/280ce217.html</id>
    <published>2023-09-04T11:49:41.000Z</published>
    <updated>2024-05-06T14:13:59.614Z</updated>
    
    <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a><div class="note purple no-icon flat"><p>æ¥å£-lambdaè¡¨è¾¾å¼-å†…éƒ¨ç±»</p></div></h1><h2 id="-1"><a href="#-1" class="headerlink" title></a><p class="p green">æ¥å£</p></h2><p>~~æ¥å£<br>  Â·æ¥å£çš„æ¦‚å¿µ:åœ¨Javaç¨‹åºè®¾è®¡ä¸­,æ¥å£ä¸æ˜¯ç±»,è€Œæ˜¯å¯¹å¸Œæœ›ç¬¦åˆè¿™ä¸ªæ¥å£çš„ç±»çš„ä¸€ç»„éœ€æ±‚<br>  Â·æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½è‡ªåŠ¨æ˜¯publicæ–¹æ³•ã€‚å› æ­¤ï¼Œåœ¨æ¥å£ä¸­å£°æ˜æ–¹æ³•æ—¶,ä¸å¿…æä¾›å…³é”®å­—public<br>  Â·ä¸ºäº†è®©ç±»å®ç°ä¸€ä¸ªæ¥å£,é€šå¸¸éœ€è¦å®Œæˆä¸‹é¢ä¸¤ä¸ªæ­¥éª¤<br>  Â·(1)å°†ç±»å£°æ˜ä¸ºå®ç°ç»™å®šçš„æ¥å£<br>  Â·(2)å¯¹æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•æä¾›å®šä¹‰<br>  Â·æˆ‘ä»¬è¦ç±»æŒ‰ç…§æŸä¸€ä¸ªå­—æ®µè¿›è¡Œæ’åº,å¿…é¡»è®©å®ƒå®ç°compareToæ–¹æ³•<br>  Â·æ¥å£çš„å±æ€§<br>  Â·æ¥å£ä¸æ˜¯ç±»,å…·ä½“æ¥è¯´,ä¸èƒ½ä½¿ç”¨newè¿ç®—ç¬¦å®ä¾‹åŒ–ä¸€ä¸ªæ¥å£,ä¸è¿‡,å°½ç®¡ä¸èƒ½æ„é€ æ¥å£çš„å¯¹è±¡,å´èƒ½å£°æ˜æ¥å£çš„å˜é‡<br>  Â·æ¥å£å˜é‡å¿…é¡»å¼•ç”¨å®ç°äº†è¿™ä¸ªæ¥å£çš„ç±»å¯¹è±¡<br>  Â·å¦‚åŒä½¿ç”¨instanceofæ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å±äºæŸä¸ªç‰¹å®šçš„ç±»ä¸€æ ·,ä¹Ÿå¯ä»¥ä½¿ç”¨instanceofæ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å®ç°äº†æŸä¸ªç‰¹å®šçš„æ¥å£<br>  Â·ä¸æ¥å£ä¸­çš„æ–¹æ³•éƒ½è‡ªåŠ¨è¢«è®¾ç½®ä¸ºpublicä¸€æ ·,æ¥å£ä¸­çš„å­—æ®µæ€»æ˜¯public static final;<br>  Â·å°½ç®¡æ¯ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªè¶…ç±»,ä½†å´å¯ä»¥å®ç°å¤šä¸ªæ¥å£ç”¨é€—å·éš”å¼€,è¿™å°±ä¸ºå®šä¹‰ç±»çš„è¡Œä¸ºæä¾›äº†æå¤§çš„çµæ´»æ€§</p><h2 id="-2"><a href="#-2" class="headerlink" title></a><p class="p green">lambdaè¡¨è¾¾å¼</p></h2><p>~~æ¥å£ä¸æŠ½è±¡ç±»<br>  Â·æ‰€è°“çš„æŠ½è±¡æ–¹æ³•å°±æ˜¯æ²¡æœ‰å®ç°çš„æ–¹æ³•<br>  Â·æ‰€è°“æ²¡æœ‰å®ç°å°±æ˜¯æŒ‡,æ²¡æœ‰æ–¹æ³•ä½“<br>  Â·å½“ä¸€ä¸ªç±»ä¸­å­˜åœ¨æŠ½è±¡æ–¹æ³•æ—¶,éœ€è¦å°†è¯¥ç±»å£°æ˜ä¸ºabstractç±»<br>  Â·ä¸€èˆ¬æ¥è¯´,æŠ½è±¡ç±»ä¼šè¢«ç»§æ‰¿,ç”±å…¶å­ç±»æ¥å®ç°æŠ½è±¡æ–¹æ³•<br>  Â·å½“çˆ¶ç±»çš„ä¸€äº›æ–¹æ³•ä¸èƒ½ç¡®å®šæ—¶,å¯ä»¥ç”¨abstractå…³é”®å­—æ¥ä¿®é¥°è¯¥æ–¹æ³•,è¿™ä¸ªæ–¹æ³•å°±æ˜¯æŠ½è±¡æ–¹æ³•,ç”¨abstractæ¥ä¿®é¥°è¯¥ç±»å°±æ˜¯æŠ½è±¡ç±»<br>  Â·æŠ½è±¡ç±»çš„ä»·å€¼æ›´å¤šåœ¨äºè®¾è®¡,æ˜¯è®¾è®¡å¥½è®¾è®¡å¥½å,è®©å­ç±»ç»§æ‰¿å¹¶å®ç°æŠ½è±¡ç±»<br>  Â·æŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–<br>  Â·æŠ½è±¡ç±»ä¸ä¸€å®šè¦åŒ…å«abstractæ–¹æ³•,ä¹Ÿå°±æ˜¯è¯´,æŠ½è±¡ç±»å¯ä»¥æ²¡æœ‰abstractæ–¹æ³•<br>  Â·ä¸€æ—¦ç±»åŒ…å«äº†abstractæ–¹æ³•,åˆ™è¿™ä¸ªç±»å¿…é¡»å£°æ˜ä¸ºabstract<br>  Â·abstractåªèƒ½ä¿®é¥°ç±»å’Œæ–¹æ³•,ä¸èƒ½ä¿®é¥°å±æ€§å’Œå…¶ä»–çš„<br>  Â·æŠ½è±¡æ–¹æ³•ä¸èƒ½ä½¿ç”¨private,finalå’Œstaticæ¥ä¿®é¥°,å› ä¸ºè¿™äº›å…³é”®å­—éƒ½æ˜¯å’Œé‡å†™ç›¸è¿èƒŒçš„<br>  Â·å¦‚æœä¸€ä¸ªç±»ç»§æ‰¿äº†æŠ½è±¡ç±»,åˆ™å®ƒå¿…é¡»å®ç°æŠ½è±¡ç±»çš„æ‰€æœ‰æŠ½è±¡ç±»<br>~~Comparatoræ¥å£<br>  Â·å®ç°Comparatoræ¥å£,å°±å¯ä»¥é‡å†™compareç±»,å¯ä»¥è‡ªå®šä¹‰æ¯”è¾ƒçš„æ–¹å¼,å¦‚æŒ‰å­—æ¯,æŒ‰ç…§ä»å¤§åˆ°å°,ä»å°åˆ°å¤§</p><h2 id="-3"><a href="#-3" class="headerlink" title></a><p class="p green">å†…éƒ¨ç±»</p></h2><p>~~åŒ¿åå†…éƒ¨ç±»<br><pre class="line-numbers language-none"><code class="language-none">public interface Comparator&lt;T&gt; &#123;int compare(T o1, T o2);&#125;Collections.sort(words,new Comparator&lt;String&gt;()&#123;    public int compare(String s1,String s2)&#123;       return Integer.compare(s1.lemgth(),s2.length());    &#125;&#125;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>  Â·é€šä¿—çš„è®²,å°±æ˜¯æ²¡æœ‰ç±»å,ç›´æ¥é€šè¿‡newå…³é”®å­—åˆ›å»ºè¿™ä¸ªç±»çš„å®ä¾‹<br>  Â·lambdaè¡¨è¾¾å¼<br><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">Collection.sort(words,(s1,s2)-&gt;Integer.compare(s1.length(),s2.length()));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br>  Â·å†æ¥ä¸ªç®€å•çš„ä¾‹å­<br><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">&#x2F;&#x2F;é¦–å…ˆå®šä¹‰ä¸€ä¸ªstudyæ¥å£public interface Learn&#123;void study();&#125;&#x2F;&#x2F;å¯ä»¥ä¸ºè¯¥æ¥å£å®šä¹‰ä¸€ä¸ªå®ç°ç±» StudyDemopublic class StudyDemo implements Learn&#123;@Override    public void study() &#123;    System.out.println(&quot;å¥½å¥½å­¦ä¹ ï¼Œå¤©å¤©å‘ä¸Š&quot;);        &#125;    &#125;&#x2F;&#x2F;ç„¶ååˆ›å»ºè¯¥å®ç°ç±»çš„å¯¹è±¡è°ƒç”¨studyæ–¹æ³•ï¼šLearn s &#x3D; new StudyDemo ();        s.study();&#x2F;&#x2F;è¿è¡Œç»“æœ--&gt;å¥½å¥½å­¦ä¹ ï¼Œå¤©å¤©å‘ä¸Š&#x2F;&#x2F;å¦‚æœStudyDemo ç±»åªæ˜¯ä¸ºäº†å®ç° Learnæ¥å£è€Œå­˜åœ¨çš„ï¼Œä¸”ä»…è¢«ä½¿ç”¨äº†ä¸€æ¬¡ï¼Œæ‰€ä»¥ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»æ¥ç®€åŒ–è¿™ä¸€æ“ä½œï¼špublic static void main(String[] args)&#123;   Learn s&#x3D;new Learn()&#123;   public void study() &#123;            System.out.println(&quot;å¥½å¥½å­¦ä¹ ï¼Œå¤©å¤©å‘ä¸Š&quot;);                &#125;   &#125;;   s.study();&#125;&#x2F;&#x2F;æ˜¾ç„¶ï¼Œä½¿ç”¨åŒ¿åå†…éƒ¨ç±»è¿˜ä¸å¤Ÿç®€æ´ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨lambdaè¡¨è¾¾å¼æ¥ä¼˜åŒ–ï¼š&#x2F;&#x2F;å› ä¸ºlearnæ¥å£ä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•,ç¼–è¯‘å™¨ä½¿ç”¨ç§°ä¸ºç±»å‹æ¨æ–­çš„è¿‡ç¨‹ä»ä¸Šä¸‹æ–‡æ¨å¯¼å‡ºè¿™äº›ç±»å‹å’Œæ–¹æ³•,æˆ‘ä»¬å¯ä»¥çœåŒºstudyçš„æ–¹æ³•åå’Œnew Learn,å¹¶åŠ ä¸Šç®­å¤´Learn s&#x3D;()-&gt;&#123;   System.out.println(&quot;å¥½å¥½å­¦ä¹ ï¼Œå¤©å¤©å‘ä¸Š&quot;); &#125;s.study();&#x2F;&#x2F;è¿˜å¯ä»¥ç®€åŒ–Learn s&#x3D;()-&gt;System.out.println(&quot;å¥½å¥½å­¦ä¹ ï¼Œå¤©å¤©å‘ä¸Š&quot;);&#96;&#96;&#96;    Â·ä¸Šé¢çš„ä¾‹å­æ–¹æ³•å³æ²¡æœ‰å‚æ•°,ä¹Ÿæ²¡æœ‰è¿”å›å€¼&#96;&#96;&#96;Javainterface Learn1&#123;    void study(int a,int b);&#125;&#x2F;&#x2F;å†çœ‹çœ‹å®ƒçš„åŒ¿åå†…éƒ¨ç±»å’Œlambdaè¡¨è¾¾å¼å†™æ³•Learn1 learn;       &#x2F;&#x2F;åŒ¿åå†…éƒ¨ç±»å†™æ³•    learn &#x3D; new Learn1() &#123;        @Override        public void study(int a,int b) &#123;            System.out.println(&quot;å¥½å¥½å­¦ä¹ x&quot;(a+b));        &#125;    &#125;;learn&#x3D;(a,b)-&gt;&#123;System.out.println(&quot;å¥½å¥½å­¦ä¹ x&quot;(a+b));&#125;learn.study(3,4);&#x2F;&#x2F;å¦‚æœæ–¹æ³•ä¸­åªæœ‰ä¸€ä¸ªå‚æ•°,è¿˜å¯ä»¥çœç•¥å°æ‹¬å· learn &#x3D; e-&gt; System.out.println(&quot;å¥½å¥½å­¦ä¹ &quot;+e);    &#96;&#96;&#96;     Â·å†æ¥çœ‹çœ‹æœ‰è¿”å›å€¼çš„æƒ…å†µ&#96;&#96;&#96;Javapublic interface Comparator&lt;T&gt; &#123;int compare(T o1, T o2);&#125;å…ˆå®šä¹‰ä¸€ä¸ªå­¦ç”Ÿç±»ï¼špublic class Student &#123;    private String name;    private int age;    public Student(String name,int age)&#123;    this.name &#x3D; name;    this.age &#x3D; age;    &#125;    public int getAge(    return this.age;&#125;æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹æ•°ç»„ä¸­çš„Studentå¯¹è±¡ï¼Œä½¿ç”¨Arraysçš„sortæ–¹æ³•é€šè¿‡å¹´é¾„è¿›è¡Œå‡åºpublic static void main(String[] args) &#123;Student[] array &#x3D; &#123;         new Student(&quot;å¼ ä¸‰&quot;, 18),             new Student(&quot;æå››&quot;, 20),             new Student(&quot;ç‹äº”&quot;, 19) &#125;;    &#x2F;&#x2F;åŒ¿åå†…éƒ¨ç±»å†™æ³•    Compartor&lt;Student&gt; compare&#x3D;new Compartor&lt;Student&gt;()&#123;            @Override            public int compare(Student s1, Student s2) &#123;                return s1.getAge() â€ s2.getAge();            &#125;    &#125;;    &#x2F;&#x2F;Lambdaè¡¨è¾¾å¼å†™æ³•    Comparator&lt;Student &gt; compare&#x3D;(Studeng s1,Student s1)-&gt;&#123;return s1.getAge() â€ s2.getAge();&#125;    &#96;&#96;&#96;   ~~å†…éƒ¨ç±»  Â·å†…éƒ¨ç±»æ˜¯å®šä¹‰åœ¨å¦ä¸€ä¸ªç±»ä¸­çš„ç±»,ä½¿ç”¨å†…éƒ¨ç±»çš„ä¸¤ä¸ªåŸå›   Â·å†…éƒ¨ç±»å¯ä»¥å †åŒä¸€ä¸ªåŒ…ä¸­çš„å…¶ä»–ç±»éšè—  Â·å†…éƒ¨ç±»æ–¹æ³•å¯ä»¥è®¿é—®å®šä¹‰è¿™ä¸ªç±»çš„ä½œç”¨åŸŸä¸­çš„æ•°æ®,åŒ…æ‹¬åŸæœ¬ç§æœ‰çš„æ•°æ®  Â·å¦‚æœå®šä¹‰åœ¨å±€éƒ¨ä½ç½®(æ–¹æ³•ä¸­&#x2F;ä»£ç å—)(1)å±€éƒ¨å†…éƒ¨ç±»(2)åŒ¿åå†…éƒ¨ç±»  Â·å®šä¹‰åœ¨æˆå‘˜ä½ç½®(1)æˆå‘˜å†…éƒ¨ç±»(2)é™æ€å†…éƒ¨ç±»&#96;&#96;&#96;java&#x2F;&#x2F;è¯­æ³•æ¼”ç¤ºclass Outer&#123; &#x2F;&#x2F;å¤–éƒ¨ç±»    class inner&#123; &#x2F;&#x2F;å†…éƒ¨ç±»      &#125;&#125;class Other&#123; &#x2F;&#x2F;å¤–éƒ¨å…¶ä»–ç±»&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>  Â·å±€éƒ¨å†…éƒ¨ç±»(æœ‰ç±»å)<br>  Â·åŒ¿åå†…éƒ¨ç±»(æ²¡æœ‰ç±»å,é‡ç‚¹ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼)<br>~~å±€éƒ¨å†…éƒ¨ç±»çš„ä½¿ç”¨<br>  Â·å®šä¹‰åœ¨å†…éƒ¨ç±»çš„å±€éƒ¨ä½ç½®,æ¯”å¦‚æ–¹æ³•ä¸­,å¹¶ä¸”æœ‰ç±»å<br>  Â·å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜,åŒ…å«ç§æœ‰çš„<br>  Â·ä¸èƒ½æ·»åŠ è®¿é—®ä¿®é¥°ç¬¦,å› ä¸ºå®ƒçš„åœ°ä½å°±æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡,å±€éƒ¨å˜é‡æ˜¯ä¸èƒ½ä½¿ç”¨ä¿®é¥°ç¬¦çš„,ä½†å¯ä»¥ä½¿ç”¨finalä¿®é¥°,å› ä¸ºå±€éƒ¨å˜é‡ä¹Ÿå¯ä»¥ä½¿ç”¨final<br>  Â·ä½œç”¨åŸŸ:ä»…ä»…åœ¨å®šä¹‰å®ƒçš„æ–¹æ³•æˆ–ä»£ç å—ä¸­<br>  Â·å±€éƒ¨å†…éƒ¨ç±»â€”-è®¿é—®â€”-&gt;å¤–éƒ¨ç±»çš„æˆå‘˜ã€è®¿é—®æ–¹å¼:ç›´æ¥è®¿é—®ã€‘<br>  Â·å¤–éƒ¨ç±»â€”-è®¿é—®â€”-&gt;å±€éƒ¨å†…éƒ¨ç±»çš„æˆå‘˜ã€è®¿é—®æ–¹å¼:åˆ›å»ºå¯¹è±¡,åœ¨è®¿é—®ã€‘<br>  Â·å¤–éƒ¨å…¶ä»–ç±»â€”-ä¸èƒ½è®¿é—®å‘¢â€”-&gt;å±€éƒ¨å†…éƒ¨ç±»<br>  Â·å¦‚æœå¤–éƒ¨ç±»å’Œå±€éƒ¨å†…éƒ¨ç±»çš„æˆå‘˜é‡åæ—¶,é»˜è®¤éµå¾ªå°±è¿‘åŸåˆ™,å¦‚æœæƒ³è®¿é—®å¤–éƒ¨ç±»çš„æˆå‘˜,åˆ™å¯ä»¥ä½¿ç”¨(å¤–éƒ¨ç±»å.this.æˆå‘˜)å»è®¿é—®<br>~~åŒ¿åå†…éƒ¨ç±»çš„ä½¿ç”¨(é‡è¦ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼)<br>  Â·(1)æœ¬è´¨æ˜¯ç±»(2)å†…éƒ¨ç±»(3)è¯¥ç±»æ²¡æœ‰åå­—(4)åŒæ—¶è¿˜æ˜¯ä¸€ä¸ªå¯¹è±¡<br>  Â·è¯´æ˜:åŒ¿åå†…éƒ¨ç±»æ˜¯å®šä¹‰åœ¨å¤–éƒ¨ç±»çš„å±€éƒ¨ä½ç½®,æ¯”å¦‚æ–¹æ³•ä¸­,å¹¶ä¸”æ²¡æœ‰ç±»å<br>  Â·åŸºæœ¬è¯­æ³•<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">new</span> ç±»æˆ–æ¥å£<span class="token punctuation">(</span>å‚æ•°åˆ—è¡¨<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    ç±»ä½“<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><br>  Â·åŒ¿åå†…éƒ¨ç±»ä½¿ç”¨ä¸€æ¬¡,å°±ä¸èƒ½å†ä½¿ç”¨<br>  Â·åŒ¿åå†…éƒ¨ç±»çš„æœ€ä½³æ—¶é—´,ç›´æ¥å½“åšå®å‚ä¼ é€’<br><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> no5 <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">f1</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿™æ˜¯ä¸€å‰¯åç”»XXXX"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token class-name">IL</span> il<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        il<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">interface</span> <span class="token class-name">IL</span><span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>~~æˆå‘˜å†…éƒ¨ç±»çš„ä½¿ç”¨<br>  Â·æˆå‘˜å†…éƒ¨ç±»æ˜¯å®šä¹‰å†å¤–éƒ¨ç±»çš„æˆå‘˜ä½ç½®,å¹¶ä¸”æ²¡æœ‰staticä¿®é¥°<br>  Â·å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜,åŒ…å«ç§æœ‰çš„<br>  Â·å¯ä»¥æ·»åŠ ä»»æ„è®¿é—®ä¿®é¥°ç¬¦<br>~~é™æ€å†…éƒ¨ç±»<br>  Â·æœ‰staticä¿®é¥°<br>  Â·å› ä¸ºæ˜¯é™æ€å†…éƒ¨ç±»,æ˜¯å¯ä»¥é€šè¿‡ç±»åç›´æ¥è®¿é—®</p><h2 id="-4"><a href="#-4" class="headerlink" title></a><p class="p green">å¼‚å¸¸</p></h2><p>~~å¼‚å¸¸åˆ†ç±»<br>  Â·å†Javaä¸­,å¼‚å¸¸å¯¹è±¡éƒ½æ˜¯æ´¾ç”ŸäºThrowableç±»çš„ä¸€ä¸ªç±»å®ä¾‹<br>  Â·éœ€è¦æ³¨æ„çš„æ˜¯,æ‰€æœ‰çš„å¼‚å¸¸éƒ½æ˜¯ç”±Throwableç»§æ‰¿è€Œæ¥,ä½†æ˜¯ä¸‹ä¸€å±‚ç«‹å³åˆ†è§£ä¸ºä¸¤ä¸ªåˆ†æ”¯:Errorå’ŒException<br>  Â·Errorç±»å±‚æ¬¡ç»“æ„æè¿°äº†Javaè¿è¡Œæ˜¯ç³»ç»Ÿçš„å†…éƒ¨é”™è¯¯å’Œèµ„æºè€—å°½é”™è¯¯<br>  Â·è¦é‡ç‚¹å…³æ³¨Exceptionå±‚æ¬¡ç»“æ„,è¿™ä¸ªå±‚æ¬¡ç»“æ„åˆåˆ†è§£ä¸ºä¸¤ä¸ªåˆ†æ”¯,ä¸€ä¸ªåˆ†æ”¯æ´¾ç”ŸäºRuntimeException,å¦ä¸€ä¸ªåˆ†æ”¯åŒ…å«å…¶ä»–å¼‚å¸¸<br>  Â·ä¸€èˆ¬è§„åˆ™æ˜¯:ç”±ç¼–ç¨‹é”™è¯¯å¯¼è‡´çš„å¼‚å¸¸å±äºRuntimeException;å¦‚æœç¨‹åºæœ¬èº«æ²¡æœ‰é—®é¢˜,ä½†ç”±äºåƒI/0é”™è¯¯è¿™ç±»é—®é¢˜å¯¼è‡´çš„å¼‚å¸¸å±äºå…¶ä»–å¼‚å¸¸<br>  Â·æ´¾ç”ŸäºRuntimeExceptionçš„å¼‚å¸¸åŒ…æ‹¬ä¸€ä¸‹é—®é¢˜<br>  Â·é”™è¯¯çš„å¼ºåˆ¶ç±»å‹è½¬æ¢<br>  Â·æ•°ç»„è®¿é—®è¶Šç•Œ<br>  Â·è®¿é—®nullæŒ‡é’ˆ<br>  Â·ä¸æ˜¯æ´¾ç”ŸäºRuntimeExceptionçš„å¼‚å¸¸åŒ…æ‹¬<br>  Â·è¯•å›¾è¶…è¶Šæ–‡ä»¶æœ«å°¾ç»§ç»­è¯»å–æ•°æ®<br>  Â·è§†å›¾æ‰“å¼€ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶<br>~~å£°æ˜æ£€æŸ¥ç±»å‹<br>  Â·å¦‚æœé‡åˆ°äº†æ— æ³•å¤„ç†çš„æƒ…å†µ,Javaæ–¹æ³•å¯ä»¥æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸<br>  Â·è¦åœ¨æ–¹æ³•çš„é¦–éƒ¨æŒ‡å‡ºè¿™ä¸ªæ–¹æ³•å¯èƒ½æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸,æ‰€ä»¥è¦ä¿®æ”¹æ–¹æ³•é¦–éƒ¨,ä»¥åæ˜ è¿™ä¸ªæ–¹æ³•å¯èƒ½æŠ›å‡ºçš„æ£€æŸ¥å‹å¼‚å¸¸<br>~~æ•è·å¼‚å¸¸<br>  Â·å¦‚æœå‘ç”Ÿäº†æŸä¸ªå¼‚å¸¸,åœ¨æ²¡æœ‰å†ä»»ä½•åœ°æ–¹æ•è·è¿™ä¸ªå¼‚å¸¸,ç¨‹åºå°±ä¼šç»ˆæ­¢,å¹¶åœ¨æ§åˆ¶å°ä¸Šæ‰“å°ä¸€ä¸ªä¿¡æ¯<br>  Â·è¦æƒ³æ•è·ä¸€ä¸ªå¼‚å¸¸,éœ€è¦è®¾ç½®try/catchè¯­å¥å—<br>  Â·å¦‚æœtryè¯­å¥å—ä¸­çš„ä»»ä½•ä»£ç è·‘å‡ºæ¥catchå­å¥æŒ‡å®šçš„ä¸€ä¸ªå¼‚å¸¸ç±»,é‚£ä¹ˆ<br>  Â·ç¨‹åºå°†è·³è¿‡tryè¯­å¥å—çš„å…¶ä½™ä»£ç <br>  Â·ç¨‹åºå°†æ‰§è¡Œcatchè‡ªå±…ä¸­çš„å¤„ç†å™¨ä»£ç <br>  Â·å¦‚æœtryè¯­å¥å—ä¸­çš„ä»£ç æ²¡æœ‰æŠ›å‡ºä»»ä½•å¼‚å¸¸,é‚£ä¹ˆç¨‹åºå°†è·³è¿‡catchå­å¥<br>  Â·åœ¨ä¸€ä¸ªtryè¯­å¥å—ä¸­å¯ä»¥æ•è·å¤šä¸ªå¼‚å¸¸,å¹¶ä¸”å¯¹ä¸åŒç±»å‹çš„å¼‚å¸¸åšå‡ºä¸åŒçš„å¤„ç†,è¦ä¸ºæ¯ä¸ªå¼‚å¸¸ç±»å‹ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„catchå­å¥<br>~~finallyå­å¥<br>  Â·ä»£ç æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸æ—¶ï¼Œå°±ä¼šåœæ­¢å¤„ç†è¿™ä¸ªæ–¹æ³•ä¸­å‰©ä½™çš„ä»£ç ,å¹¶é€€å‡ºè¿™ä¸ªæ–¹æ³•ã€‚å› æ­¤éœ€è¦æ¸…ç†èµ„æºåˆ†é…<br>  Â·ä¸ç®¡æ˜¯å¦å¼‚å¸¸è¢«æ•è·,finallyå­å¥ä¸­çš„ä»£ç éƒ½ä¼šè¢«æ‰§è¡Œ<br>~~æ–­è¨€<br>  Â·å¯åŠ¨æ–­è¨€è¦åœ¨é…ç½®å‚æ•°ä¸­åŠ å…¥-ea -Dfile.encoding=UTF-8<br>  Â·è¯­æ³•:åœ¨assertå…³é”®å­—åæ”¾ä¸€ä¸ªå¸ƒå°”å€¼(ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼,è¿™ä¸ªè¡¨è¾¾å¼ä¹Ÿä¼šå˜æˆä¸€ä¸ªå¸ƒå°”å€¼),å½“è¿™ä¸ªå¸ƒå°”å€¼ä¸ºtrueæ—¶,å°±ä¼šé€šè¿‡æ•´ä¸ªæ–­è¨€,å½“è¿™ä¸ªå¸ƒå°”å€¼ä¸ºfalseæ—¶,è¿™ä¸ªæ–­è¨€å°±ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯,è¿™ä¼šè®©è¿™ä¸ªç¨‹åºåœæ­¢<br>~~æ—¥å¿—<br>  Â·åŸºæœ¬æ—¥å¿—:è¦ç”Ÿæˆç®€å•çš„æ—¥å¿—è®°å½•,å¯ä»¥ä½¿ç”¨å…¨å±€æ—¥å¿—è®°å½•å™¨global loggerå¹¶è°ƒç”¨å…¶infoæ–¹æ³•<br>  Â·åŸºæœ¬è¯­æ³•,Logger.getGlobal().info(â€œè¿™é‡Œå†™å…¥æ—¥å¿—ä¿¡æ¯â€)ã€‚æœ€ååœ¨æ§åˆ¶å°å°±ä¼šä½¿ç”¨çº¢è‰²çš„å­—ä½“è¾“å‡ºæ—¶é—´,åŒ…åä»¥åŠæ—¥å¿—ä¿¡æ¯<br>  Â·å…³é—­æ—¥å¿—:åœ¨é€‚å½“çš„åœ°æ–¹(å¦‚mainçš„æœ€å‰é¢)è°ƒç”¨Logger.getGlobal.setLevel(Level.off),å°†ä¼šå–æ¶ˆæ‰€æœ‰çš„æ—¥å¿—<br>  Â·é«˜çº§æ—¥å¿—:</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title&gt;&lt;/a&gt;&lt;div class=&quot;note purple no-icon flat&quot;&gt;&lt;p&gt;æ¥å£-lambdaè¡¨è¾¾å¼-å†…éƒ¨ç±»&lt;/p&gt;
&lt;/div&gt;&lt;/h1&gt;&lt;h2 id=&quot;-1&quot;&gt;&lt;a href</summary>
      
    
    
    
    <category term="javaåŸºç¡€" scheme="https://100qin10086.github.io/categories/java%E5%9F%BA%E7%A1%80/"/>
    
    
    <category term="java" scheme="https://100qin10086.github.io/tags/java/"/>
    
  </entry>
  
</feed>
