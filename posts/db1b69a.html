<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>SpringCloud &amp; SpringCloudAlibaba | 秦家大胖's Blog</title><meta name="author" content="秦三顺"><meta name="copyright" content="秦三顺"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="SpringCloud &amp; SpringCloudAlibaba复习  Spring Cloud 基本介绍系统架构的演变过程单机架构 动静分离架构:静态缓存+文件存储 分布式架构:业务拆分+负载均衡 Spring Cloud 全面说明(重要)1.SpringCloud 来源于 Spring, 是更高层次的、 架构视角的综合性大型项目， 目标旨在构建一套标准化的微服务解决方案，让架构师在使用"><meta property="og:type" content="article"><meta property="og:title" content="SpringCloud &amp; SpringCloudAlibaba"><meta property="og:url" content="https://100qin10086.github.io/posts/db1b69a.html"><meta property="og:site_name" content="秦家大胖&#39;s Blog"><meta property="og:description" content="SpringCloud &amp; SpringCloudAlibaba复习  Spring Cloud 基本介绍系统架构的演变过程单机架构 动静分离架构:静态缓存+文件存储 分布式架构:业务拆分+负载均衡 Spring Cloud 全面说明(重要)1.SpringCloud 来源于 Spring, 是更高层次的、 架构视角的综合性大型项目， 目标旨在构建一套标准化的微服务解决方案，让架构师在使用"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://100qin10086.github.io/img/bj/no34.jpg"><meta property="article:published_time" content="2024-04-18T01:08:22.000Z"><meta property="article:modified_time" content="2025-01-11T14:24:34.491Z"><meta property="article:author" content="秦三顺"><meta property="article:tag" content="框架"><meta property="article:tag" content="Java"><meta property="article:tag" content="分布式微服务"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://100qin10086.github.io/img/bj/no34.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://100qin10086.github.io/posts/db1b69a.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#3b70fc"><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/128.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"><link rel="mask-icon" href="/img/siteicon/128.png" color="#5bbad5"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"SpringCloud & SpringCloudAlibaba",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2025-01-11 22:24:34"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/progress_bar.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/css/runtime/runtime.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload='this.media="all"'><script src="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload='this.media="screen"'><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="秦家大胖's Blog" type="application/atom+xml"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/tx.jfif" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">42</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>Home</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/index.html"><i class="fa-fw fas fa-home"></i> <span>追番</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i> <span>留言板</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/bj/no34.jpg)"><nav id="nav"><span id="blog-info"><a href="/" title="秦家大胖's Blog"><span class="site-name">秦家大胖's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>Home</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/index.html"><i class="fa-fw fas fa-home"></i> <span>追番</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i> <span>留言板</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SpringCloud &amp; SpringCloudAlibaba</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-04-18T01:08:22.000Z" title="发表于 2024-04-18 09:08:22">2024-04-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-01-11T14:24:34.491Z" title="更新于 2025-01-11 22:24:34">2025-01-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E5%BE%AE%E6%9C%8D%E5%8A%A1/">分布式微服务</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="SpringCloud &amp; SpringCloudAlibaba"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1><a href="#" class="headerlink"></a><div class="note purple no-icon flat"><p>SpringCloud &amp; SpringCloudAlibaba复习</p></div></h1><h2 id="Spring-Cloud-基本介绍"><a href="#Spring-Cloud-基本介绍" class="headerlink" title="Spring Cloud 基本介绍"></a>Spring Cloud 基本介绍</h2><h3 id="系统架构的演变过程"><a href="#系统架构的演变过程" class="headerlink" title="系统架构的演变过程"></a>系统架构的演变过程</h3><h4 id="单机架构"><a href="#单机架构" class="headerlink" title="单机架构"></a>单机架构</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/41e80c2982515987ae7e9a1f14e348fa.png"></div></div><h4 id="动静分离架构-静态缓存-文件存储"><a href="#动静分离架构-静态缓存-文件存储" class="headerlink" title="动静分离架构:静态缓存+文件存储"></a>动静分离架构:静态缓存+文件存储</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/658053dabbd32532257568bc1806eff2.png"></div></div><h4 id="分布式架构-业务拆分-负载均衡"><a href="#分布式架构-业务拆分-负载均衡" class="headerlink" title="分布式架构:业务拆分+负载均衡"></a>分布式架构:业务拆分+负载均衡</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1141d9c79050fa061b9a9f3e81a8e637.png"></div></div><h3 id="Spring-Cloud-全面说明-重要"><a href="#Spring-Cloud-全面说明-重要" class="headerlink" title="Spring Cloud 全面说明(重要)"></a>Spring Cloud 全面说明(重要)</h3><p>1.SpringCloud 来源于 Spring, 是更高层次的、 架构视角的综合性大型项目， 目标旨在构建一套标准化的微服务解决方案，<br>让架构师在使用微服务理念构建系统的时， 面对各环节的问题都可以找到相应的组件来处理。<br>2.Spring Cloud 是 Spring 社区为微服务架构提供的一个 “全家桶” 套餐。套餐中各个组件之间的配合，<br>可以减少在组件的选型和整合上花费的精力，可以快速构建起基础的微服务架构系统，是微服务架构的最佳落地方案<br>3.Spirng Cloud 天然支持 Spring Boot(有版本对应要求)，使用门槛较低<br>4.解决与分布式系统相关的复杂性 – 网络问题，延迟开销，带宽问题，安全问题<br>5.处理服务发现的能力 – 服务发现允许集群中的进程和服务找到彼此并进行通信<br>6.解决冗余问题 – 冗余问题经常发生在分布式系统中<br>7.解决负载平衡 – 改进跨多个计算资源（例如计算机集群，网络链接，中央处理单元）的 工作负载分布</p><h3 id="Spring-Cloud组件选型"><a href="#Spring-Cloud组件选型" class="headerlink" title="Spring Cloud组件选型"></a>Spring Cloud组件选型</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/303fc8102165a400bdd6f5745b714150.png"></div></div><h2 id="Spring-Cloud-Alibaba-基本介绍"><a href="#Spring-Cloud-Alibaba-基本介绍" class="headerlink" title="Spring Cloud Alibaba 基本介绍"></a>Spring Cloud Alibaba 基本介绍</h2><h3 id="分布式微服务技术选型"><a href="#分布式微服务技术选型" class="headerlink" title="分布式微服务技术选型"></a>分布式微服务技术选型</h3><p>·Spring Cloud 原生组件的几大痛点<br>1.Spring Cloud 部分组件停止维护和更新, 给开发带来不便<br>2.Spring Cloud 部分环境搭建复杂，没有完善的可视化界面，我们需要大量的二次开发和定制<br>3.Spring Cloud 配置复杂，难以上手<br>·Spring Cloud Alibaba 的优势<br>1.阿里使用过的组件经历了考验[高并发,高性能,高可用]，性能强悍，设计合理，现在开源出来供大家使用.<br>1.搭配完善的可视化界面, 给开发运维带来极大的便利搭建简单，学习曲线低</p><h2 id="RestTemplate"><a href="#RestTemplate" class="headerlink" title="RestTemplate"></a>RestTemplate</h2><h3 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>·RestTemplate 是 Spring 提供的用于访问 Rest 服务的模板类<br>·RestTemplate 提供了多种便捷访问远程 Http 服务的方法<br>·可以这样理解, 通过 RestTemplate, 我们可以发出 http 请求(支持<br>Restful 风格), 去调用 Controller 提供的 API 接口, 就像我们使用浏览器发出 http 请求,<br>调用该 API 接口一样.</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">MEMBER_SERVICE_PROVIDER_URL</span><span class="token operator">=</span><span class="token string">"http://MEMBER-SERVICE-PROVIDER"</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>
 <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/member/consumer/get/&#123;id&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">></span></span> <span class="token function">getMemberById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
         <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token constant">MEMBER_SERVICE_PROVIDER_URL</span>
                 <span class="token operator">+</span><span class="token string">"/member/get/"</span><span class="token operator">+</span>id<span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Eureka服务注册与发现"><a href="#Eureka服务注册与发现" class="headerlink" title="Eureka服务注册与发现"></a>Eureka服务注册与发现</h2><h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><p>·在企业级项目中，服务消费访问请求会存在高并发<br>·如果只有一个会员中心-提供服务，可用性差<br>·所以，会员中心提供服务往往是一个集群，也就是说会有多个会员中心-提供服务微服务模块<br>·那么这个时候，就存在一个问题就是服务消费方，怎么去发现可以使用的服务<br>·当服务消费方，发现了可以使用的服务后(<br>可能是多个，又存在一个问题就是到底调用A服务，还是B服务的问题，这就引出了服务注册和负载均衡)<br>·Eureka就可以解决上述问题<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/f769cb302d576c58e7a0159ce0510c22.png"></div></div><p></p><h3 id="解读上图"><a href="#解读上图" class="headerlink" title="解读上图"></a>解读上图</h3><p>·会员中心-提供服务的，在项目中，会做成集群，提供高可用<br>·Eureka Server 有必要的话，也可以做成集群<br>·Eureka 包含两个组件∶Eureka Server 和 Eureka Client<br>·Eureka Server 提供注册服务, 各个微服务节点通过配置启动后，会在 Eureka Server 中进<br>行注册，这样 EurekaServer 中的服务注册表中将会存储所有可用服务节点的信息，服务节<br>点的信息可以在界面中直观看到。<br>·EurekaClient 通过注册中心进行访问, 是一个 Java 客户端，用于简化 Eureka Server 的交<br>互，客户端同时也具备一个内置的、使用轮询(round-robin) 负载算法的负载均衡器。在应<br>用启动后，将会向 Eureka Server 发送心跳(默认周期为 30 秒)。如果 Eureka Server 在多个<br>心跳周期内没有接收到某个节点的心跳，EurekaServer 将会从服务注册表中把这个服务节<br>点移除(默认 90 秒)【默认使用轮询算法,并且会判断client是否存活,将其是否剔除】<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/93f2d62365027655ba4ac300cdf7d67c.png"></div></div><p></p><h3 id="创建单机Eureka"><a href="#创建单机Eureka" class="headerlink" title="创建单机Eureka"></a>创建单机Eureka</h3><p>·引入pom.xml文件</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">></span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.qgq.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>e-eommerce-center<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>e-commerce-eureka-server-9001<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!-- 引入eureka-server 场景启动器starter: 使用版本仲裁 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!-- 引入web-starter 老师说明我们使用版本仲裁(从父项目继承了版本)
                 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!-- 说明:starter-actuator 是springboot程序的监控系统, 可以实现系统的健康检测
                可以通过http://localhost:9001/actuator 看到相关的连接,和信息
                 --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!-- lombok --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!-- 引入test-starter --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!-- 引入e_commerce_center-common-api --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.qgq.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>e_commerce_center-common-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>·application.yml配置</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9001</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> eureka9001.com  <span class="token comment">#</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 不向注册中心注册自己</span>
    <span class="token comment">#表示自己就是注册中心,作用就是维护组测服务实例,不去检索服务</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#设置与eureka Server交互的模块,查询服务和注册服务都需要依赖这个地址</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka9002.com<span class="token punctuation">:</span>9002/eureka/
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>·配置启动类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@EnableEurekaServer</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EurekaApplication9001</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">EurekaApplication9001</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="将member-service-provider-10000作为EurekaClient注册到e-commerce-eureka-server-9001成为服务提供"><a href="#将member-service-provider-10000作为EurekaClient注册到e-commerce-eureka-server-9001成为服务提供" class="headerlink" title="将member-service-provider-10000作为EurekaClient注册到e-commerce-eureka-server-9001成为服务提供"></a>将member-service-provider-10000作为EurekaClient注册到e-commerce-eureka-server-9001成为服务提供</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/b307a3f312df73d50be3b50ed58d5844.png"></div></div><p>·引入pom.xml文件<br>·application.yml配置</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10000</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> member<span class="token punctuation">-</span>service<span class="token punctuation">-</span>provider
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/e_commerce_center_db_review<span class="token punctuation">?</span>useSSL=true<span class="token important">&amp;userUnicode=true&amp;characterEncoding=UTF-</span><span class="token number">8</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">1234</span>
<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>
  <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> com.qgq.springcloud.entity
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#表示从Eureka-Server抓取注册信息,如果是一个单节点,是可以不配置的</span>
    <span class="token comment">#但如果是一个集群,则必须配置true ,才能配置Ribbon使用负载均衡</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#将自己注册到EurekaServer</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka9001.com<span class="token punctuation">:</span>9001/eureka/<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka9002.com<span class="token punctuation">:</span>9002/eureka/
      <span class="token comment">#表示将自己注册到那个eurekaServer</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">instance-id</span><span class="token punctuation">:</span> $<span class="token punctuation">&#123;</span>spring.cloud.client.ip<span class="token punctuation">-</span>address<span class="token punctuation">&#125;</span><span class="token punctuation">:</span>$<span class="token punctuation">&#123;</span>spring.application.name<span class="token punctuation">&#125;</span><span class="token punctuation">:</span>$<span class="token punctuation">&#123;</span>server.port<span class="token punctuation">&#125;</span>
    <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>·修改启动类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableEurekaClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberApplication10000</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MemberApplication10000</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="配-置-member-service-consumer-80作为EurekaClient可以拉取-获取e-commerce-eureka-server-9001-提供的服务信"><a href="#配-置-member-service-consumer-80作为EurekaClient可以拉取-获取e-commerce-eureka-server-9001-提供的服务信" class="headerlink" title="配 置 member-service-consumer-80作为EurekaClient可以拉取/获取e-commerce-eureka-server-9001 提供的服务信"></a>配 置 member-service-consumer-80作为EurekaClient可以拉取/获取e-commerce-eureka-server-9001 提供的服务信</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/7e8048288b8c2a7948deff213366df53.png"></div></div><h4 id="Service-Consumer-、Service-Provider-、EurekaServer-的维护机制"><a href="#Service-Consumer-、Service-Provider-、EurekaServer-的维护机制" class="headerlink" title="Service Consumer 、Service Provider 、EurekaServer 的维护机制"></a>Service Consumer 、Service Provider 、EurekaServer 的维护机制</h4><div class="img-wrap"><div class="img-bg"><img class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/208257c1f24e08345a54d5cf96823eaa.png"></div></div><h3 id="搭建-EurekaServer-集群-实现负载均衡-amp-故障容错"><a href="#搭建-EurekaServer-集群-实现负载均衡-amp-故障容错" class="headerlink" title="搭建 EurekaServer 集群- 实现负载均衡&amp;故障容错"></a>搭建 EurekaServer 集群- 实现负载均衡&amp;故障容错</h3><h4 id="主要步骤"><a href="#主要步骤" class="headerlink" title="主要步骤"></a>主要步骤</h4><p>·多个EurekaServer之间相互注册,如果其中一个挂了后,保证其他的可以运行</p><h3 id="配置服务消费端-member-service-consumer-80-使用会员中心服务集群"><a href="#配置服务消费端-member-service-consumer-80-使用会员中心服务集群" class="headerlink" title="配置服务消费端 member-service-consumer-80 使用会员中心服务集群"></a>配置服务消费端 member-service-consumer-80 使用会员中心服务集群</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/942813b8384a6051644ff4efb2332aa9.png"></div></div><h4 id="代码修改"><a href="#代码修改" class="headerlink" title="代码修改"></a>代码修改</h4><p>·优于服务消费方调用多个服务提供方,所以要在RestTemplate上加入@LoadBlaced</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomizationBean</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@LoadBalanced</span>
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">getRestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>·交替访问member服务说明: 1. 注解@LoadBalanced 底层是Ribbon支持算法 2.Ribbon和Eureka<br>整合后 consumer 直接调用服务而不用再关心地址和端口号，且该服务还有负载功能。</p><h3 id="获取-Eureka-Server-服务注册信息-DiscoveryClient"><a href="#获取-Eureka-Server-服务注册信息-DiscoveryClient" class="headerlink" title="获取 Eureka Server 服务注册信息 -DiscoveryClient"></a>获取 Eureka Server 服务注册信息 -DiscoveryClient</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Resource</span>
<span class="token keyword">private</span> <span class="token class-name">DiscoveryClient</span> discoveryClient<span class="token punctuation">;</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/member/consumer/discovery"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">discovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> services <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> element <span class="token operator">:</span> services<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"======== 服 务 名 "</span> <span class="token operator">+</span> element <span class="token operator">+</span>
<span class="token string">"======================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceInstance</span><span class="token punctuation">></span></span> instances <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getInstances</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ServiceInstance</span> instance <span class="token operator">:</span> instances<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token function">getServiceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>discoveryClient<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
还要修改主启动类
<span class="token comment">//排除 DataSourceAutoConfiguration 自动配置</span>
<span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token comment">//@EnableEurekaClient 将该程序标识为 EurekaClient</span>
<span class="token annotation punctuation">@EnableEurekaClient</span>
<span class="token comment">//@EnableDiscoveryClient 注解启用服务发现</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberConsumerApplication</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MemberConsumerApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="SpringCloud-Ribbon"><a href="#SpringCloud-Ribbon" class="headerlink" title="SpringCloud Ribbon"></a>SpringCloud Ribbon</h2><h3 id="Ribbon-介绍"><a href="#Ribbon-介绍" class="headerlink" title="Ribbon 介绍"></a>Ribbon 介绍</h3><p>·Spring Cloud Ribbon 是基于 Netflix Ribbon 实现的一套客户端 负载均衡的工具。<br>·Ribbon 主要功能是提供客户端负载均衡算法和服务调用<br>·Ribbon 客户端组件提供一系列完善的配置项如连接超时，重试等。<br>·Ribbon 会基于某种规则（如简单轮询，随机连接等）去连接指定服务<br>·程序员很容易使用 Ribbon 的负载均衡算法实现负载均衡<br>·一句话: Ribbon: 负载均衡+RestTemplate 调用</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RibbonRule</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">IRule</span> <span class="token function">myRibbonRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RandomRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//随机负载均衡算法</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableEurekaClient</span>
<span class="token annotation punctuation">@RibbonClient</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"MEMBER_SERVICE_PROVIDER_URL"</span><span class="token punctuation">,</span>configuration <span class="token operator">=</span> <span class="token class-name">RibbonRule</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token comment">//@EnableDiscoveryClient 注解启用服务发现</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberConsumerApplication</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MemberConsumerApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>·Ribbon常见的负载算法<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/7e8a869d5ad5f079441dd6c8224d2a9e.png"></div></div><p></p><h2 id="SpringCloud-OpenFeign"><a href="#SpringCloud-OpenFeign" class="headerlink" title="SpringCloud OpenFeign"></a>SpringCloud OpenFeign</h2><h3 id="OpenFeign是什么"><a href="#OpenFeign是什么" class="headerlink" title="OpenFeign是什么"></a>OpenFeign是什么</h3><p>·OpenFeign是个声明式WebService客户端,使用OpenFeign让编写WebService客户端更简单<br>·OpenFeign也支持可拔插式的编码器和解码器<br>·SpringCloud 对 OpenFeign进行了封装使其支持了SpringMvc标准注解和HttpMessageConverters<br>·OpenFeign可以与Eureka和Ribbon组合使用以支持负载均衡</p><h3 id="我的理解"><a href="#我的理解" class="headerlink" title="我的理解"></a>我的理解</h3><p>·在服务消费方没有使用OpenFeign时,使用的RestTemplate发送的请求,而使用了OpenFeign后相当于在Service上就进行<br>了请求的发送<br>·例</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"MEMBER-SERVICE-PROVIDER"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MemberFeignService</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/**
     * 1.远程调用的方式为get
     * 2.远程调用的url为http://MEMBER-SERVICE-PROVIDER/member/get/&#123;id&#125;
     * 3.MEMBER-SERVICE-PROVIDER 是 注册中心服务
     * member-service-provider:10000/100002
     * 会根据OpenFeign的均衡算法来决定是调用10000还是100002
     * @param id
     * @return
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/member/get/&#123;id&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">></span></span> <span class="token function">getMemberById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>·然后在controller层继续使用注解的方式进行请求的接收</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberConsumerFeignController</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">MemberFeignService</span> memberFeignService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/member/consumer/openfeign/get/&#123;id&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">></span></span> <span class="token function">getMemberById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> memberFeignService<span class="token punctuation">.</span><span class="token function">getMemberById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="openFeign的使用"><a href="#openFeign的使用" class="headerlink" title="openFeign的使用"></a>openFeign的使用</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableEurekaClient</span>
<span class="token annotation punctuation">@EnableFeignClients</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberConsumerOpenfeignApplication80</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MemberConsumerOpenfeignApplication80</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>·openFeign的核心</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"MEMBER-SERVICE-PROVIDER"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MemberFeignService</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/**
     * 1.远程调用的方式为get
     * 2.远程调用的url为http://MEMBER-SERVICE-PROVIDER/member/get/&#123;id&#125;
     * 3.MEMBER-SERVICE-PROVIDER 是 注册中心服务
     * member-service-provider:10000/100002
     * 会根据OpenFeign的均衡算法来决定是调用10000还是100002
     * @param id
     * @return
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/member/get/&#123;id&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">></span></span> <span class="token function">getMemberById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="注意事项和细节"><a href="#注意事项和细节" class="headerlink" title="注意事项和细节"></a>注意事项和细节</h3><p>·配OpenFeign的使用特点时微服务调用接口+@FeignClient,使用接口进行解耦<br>·@FeignClient(value = “MEMBER-SERVICE-PROVIDER”),<br>这里MEMBER-SERVICE-PROVIDER就是Eureka Server服务提供方注册的名称, 不要写错了<br>·接口方法上： value是不能乱写, 远程调用的url 为<br><a target="_blank" rel="noopener" href="http://MEMBER-SERVICE-PROVIDER/member/get/{id}">http://MEMBER-SERVICE-PROVIDER/member/get/{id}</a></p><h3 id="日志配置"><a href="#日志配置" class="headerlink" title="日志配置"></a>日志配置</h3><p>·说明: Feign 提供了日志打印功能，可以通过配置来调整日志级别，从而对 Feign 接口的<br>调用情况进行监控和输出<br>·日志级别<br>1.NONE∶默认的，不显示任何日志<br>2.BASIC∶仅记录请求方法、URL、响应状态码及执行时间<br>3.HEADERS∶除了 BASIC中定义的信息之外，还有请求和响应的头信息<br>4.FULL∶除了HEADERS中定义的信息之外，还有请求和响应的正文及元数据</p><h3 id="OpenFeign超时"><a href="#OpenFeign超时" class="headerlink" title="OpenFeign超时"></a>OpenFeign超时</h3><p>·OpenFeign默认超时时间1秒钟,即等待返回结果1秒<br>·在某些情况下,一些服务调用时间可能要超过1秒,就需要重新设置超时时间</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">ribbon</span><span class="token punctuation">:</span>
  <span class="token comment">#设置feign客户端超时事件(openFeign默认支持ribbon)</span>
  <span class="token comment">#指的是建立连接后从服务器读取到可用资源所用的事件</span>
  <span class="token comment">#时间单位是毫秒</span>
  <span class="token key atrule">ReadTimeout</span><span class="token punctuation">:</span> <span class="token number">8000</span>
  <span class="token comment">#指的是建立连接所用的时间，适用于网络状况正常的情况下，</span>
  <span class="token comment">#两端连接所用的时间</span>
  <span class="token key atrule">ConnectTimeout</span><span class="token punctuation">:</span> <span class="token number">8000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="SpringCloud-Gateway"><a href="#SpringCloud-Gateway" class="headerlink" title="SpringCloud Gateway"></a>SpringCloud Gateway</h2><h3 id="看一个需求-引出网关服务"><a href="#看一个需求-引出网关服务" class="headerlink" title="看一个需求,引出网关服务"></a>看一个需求,引出网关服务</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1713772717696.jpg"></div></div><p>·其实就是一个服务一个端口,不好维护</p><h3 id="使用网关服务-重构项目架构"><a href="#使用网关服务-重构项目架构" class="headerlink" title="使用网关服务,重构项目架构"></a>使用网关服务,重构项目架构</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/1713772909087.jpg"></div></div><h3 id="Gateway是什么"><a href="#Gateway是什么" class="headerlink" title="Gateway是什么"></a>Gateway是什么</h3><p>·Gateway是在Spring生态系统上构建的API网关服务<br>·Gateway旨在提供一种简单而有效的方式来对API进行路由,以及提供一些强大<br>的过滤功能,如:熔断,限流,重试等</p><h3 id="Gateway特性"><a href="#Gateway特性" class="headerlink" title="Gateway特性"></a>Gateway特性</h3><p>·动态路由<br>·可以对路由指定Predicate(断言)和Filter(过滤器)<br>·集成Hystrix的断路由功能<br>·集成SpringCloud服务发现功能<br>·请求限流功能<br>·支持路径重写</p><h3 id="Gateway基本原理"><a href="#Gateway基本原理" class="headerlink" title="Gateway基本原理"></a>Gateway基本原理</h3><p>1.web 请求，通过一些匹配条件，定位到真正的服务节点/微服务模块，在这个转发过程的前后，进行一些精细化控制。<br>2.predicate: 就是匹配条件<br>3.filter: 可以理解为是网关的过滤机制。有了 predicate 和 filter，再加上目标URL就可以实现一个具体的路由<br>·Route(路由)<br>一句话: 路由是构建网关的基本模块，它由 ID，目标 URI，一系列的断言和过滤器组成如果断言为true则匹配该路由<br>简单举例, 比如配置路径, - Path=/member/get/** #断言,路径相匹配的进行路由转发 , 如果 Http 请求的路径不匹配, 则不进行路由转发<br>·Filter(过滤)<br>一句话: 使用过滤器，可以在请求被路由前或者之后对请求进行处理<br>可以理解成, 在对 Http 请求断言匹配成功后, 可以通过网关的过滤机制,对Http请求处理</p><h3 id="创建application-yml"><a href="#创建application-yml" class="headerlink" title="创建application.yml"></a>创建application.yml</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">20000</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> e<span class="token punctuation">-</span>commerce<span class="token punctuation">-</span>gateway
  <span class="token comment">#  cloud:</span>
  <span class="token comment">#    gateway:</span>
  <span class="token comment">#      routes:</span>
  <span class="token comment">#        - id: member_route01 #路由的ID,要求唯一</span>
  <span class="token comment">#          # gateway最终访问的url=uri+Path</span>
  <span class="token comment">#          uri: http://localhost:10000</span>
  <span class="token comment">#          predicates:</span>
  <span class="token comment">#            - Path=/member/get/** #断言,路径相匹配的进行路由</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">locator</span><span class="token punctuation">:</span>
          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment">#启用DiscoveryClient服务发现</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> member_routh01
          <span class="token comment"># 说明:lb 是协议名 member-service-provider 是服务名</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//member<span class="token punctuation">-</span>service<span class="token punctuation">-</span>provider
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/member/get/<span class="token important">**</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka9001.com<span class="token punctuation">:</span>9001/eureka/<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka9002.com<span class="token punctuation">:</span>9002/eureka/
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">instance-id</span><span class="token punctuation">:</span> $<span class="token punctuation">&#123;</span>spring.cloud.client.ip<span class="token punctuation">-</span>address<span class="token punctuation">&#125;</span><span class="token punctuation">:</span>$<span class="token punctuation">&#123;</span>spring.application.name<span class="token punctuation">&#125;</span><span class="token punctuation">:</span>$<span class="token punctuation">&#123;</span>server.port<span class="token punctuation">&#125;</span>
    <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="第二种方式-编写配置类注入"><a href="#第二种方式-编写配置类注入" class="headerlink" title="第二种方式:编写配置类注入"></a>第二种方式:编写配置类注入</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GateWayRoutesConfig</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">myRouterLocator01</span><span class="token punctuation">(</span><span class="token class-name">RouteLocatorBuilder</span> routeLocatorBuilder<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">/*
        参考:application.yml改写,理解容易
        gateway:
          routes: #配置路由, 可以有多个路由配置
           - id: member_routh01 #路由的 ID，程序员自己写,要求唯一
            #gateway 最终访问的 url = uri+Path 即: http://localhost:10000/memeber/get/
             uri: http://localhost:10000 #匹配后提供服务的路由地址
             predicates: - Path=/member/get/** #断言,路径相匹配的进行路由
           - id: member_routh02 #另外一组路由
             uri: http://localhost:10000
             predicates: - Path=/member/save
         */</span>
        <span class="token class-name">RouteLocatorBuilder<span class="token punctuation">.</span>Builder</span> routes <span class="token operator">=</span> routeLocatorBuilder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> routes<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">"member_routh03"</span><span class="token punctuation">,</span>r<span class="token operator">-></span>r<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/member/get/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">"http://localhost:10000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">cloud</span><span class="token punctuation">:</span>
<span class="token key atrule">gateway</span><span class="token punctuation">:</span>
<span class="token key atrule">discovery</span><span class="token punctuation">:</span>
<span class="token key atrule">locator</span><span class="token punctuation">:</span>
<span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#开启 Flag that enables DiscoveryClient gateway integration,即启用iscoveryClient 服务发现</span>
<span class="token key atrule">routes</span><span class="token punctuation">:</span> <span class="token comment">#配置路由, 可以有多个路由配置</span>
  <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> member_routh01 <span class="token comment">#路由的 ID，程序员自己写,要求唯一</span>
<span class="token comment">#gateway 最终访问的 url = uri+Path 即: http://localhost:10000/memeber/get/</span>
<span class="token comment">#uri: http://localhost:10000 #匹配后提供服务的路由地址</span>
<span class="token comment">#说明: lb 是协议名 member-service-provider 是服务名</span>
<span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//member<span class="token punctuation">-</span>service<span class="token punctuation">-</span>provider
<span class="token key atrule">predicates</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> Path=/member/get/<span class="token important">**</span> <span class="token comment">#断言,路径相匹配的进行路由</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>·注意事项和细节<br>1.配置好动态路由后Gateway会根据注册中心上微服务名,为请求创建动态路由,实现动他路由功能<br>2.使用lb协议支持负载均衡-轮询算法<br>3.也可以配置自己的负载均衡算法</p><h3 id="Predicate-断言"><a href="#Predicate-断言" class="headerlink" title="Predicate/断言"></a>Predicate/断言</h3><p>·Spring Cloud Gateway包括许多内置的Route Predicate工厂,所有这些Predicate都与HTTP<br>请求的不同属性匹配,可以组合使用<br>·实例</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">predicates</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> Path=/member/get/<span class="token important">**</span>  <span class="token comment">#断言,路径相匹配的进行路由</span>
  <span class="token punctuation">-</span> After=2023<span class="token punctuation">-</span>11<span class="token punctuation">-</span>22T10<span class="token punctuation">:</span>20<span class="token punctuation">:</span>50.387+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>
  <span class="token punctuation">-</span> Before=2023<span class="token punctuation">-</span>11<span class="token punctuation">-</span>23T10<span class="token punctuation">:</span>20<span class="token punctuation">:</span>50.387+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>
  <span class="token punctuation">-</span> Between=2012<span class="token punctuation">-</span>06<span class="token punctuation">-</span>14T13<span class="token punctuation">:</span>11<span class="token punctuation">:</span>33.899001600+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span><span class="token punctuation">,</span>2024<span class="token punctuation">-</span>06<span class="token punctuation">-</span>14T13<span class="token punctuation">:</span>11<span class="token punctuation">:</span>33.899001600+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>
  <span class="token punctuation">-</span> Cookie=user<span class="token punctuation">,</span>qgq
  <span class="token punctuation">-</span> Header=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Id<span class="token punctuation">,</span>hello
  <span class="token punctuation">-</span> Host=<span class="token important">**.qgq.**</span>
  <span class="token punctuation">-</span> Method=GET
  <span class="token punctuation">-</span> Query=email<span class="token punctuation">,</span><span class="token punctuation">[</span>\w<span class="token punctuation">-</span><span class="token punctuation">]</span>+@(<span class="token punctuation">[</span>a<span class="token punctuation">-</span>zA<span class="token punctuation">-</span>Z<span class="token punctuation">]</span>+\.)+<span class="token punctuation">[</span>a<span class="token punctuation">-</span>zA<span class="token punctuation">-</span>Z<span class="token punctuation">]</span>+
  <span class="token punctuation">-</span> RemoteAddr=127.0.0.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Filter-过滤器"><a href="#Filter-过滤器" class="headerlink" title="Filter/过滤器"></a>Filter/过滤器</h3><h3 id="基本介绍-1"><a href="#基本介绍-1" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>·路由过滤器可用于修改进入的HTTP请求和返回的HTTP响应<br>·Spring Cloud Gateway 内置了多种路由过滤器，他们都由GatewayFilter的工厂类来产生</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">filters</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> AddRequestParameter=color<span class="token punctuation">,</span> blue <span class="token comment">#过滤器工厂会在匹配的请求头加上一对请求头，名称为 color 值为 blue</span>
  <span class="token punctuation">-</span> AddRequestParameter=age<span class="token punctuation">,</span> <span class="token number">18</span> <span class="token comment">#过滤器工厂会在匹配的请求头加上一对请求头，名称为age值为18+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="自定义GlobalFilter"><a href="#自定义GlobalFilter" class="headerlink" title="自定义GlobalFilter"></a>自定义GlobalFilter</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomGateWayFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GlobalFilter</span><span class="token punctuation">,</span> <span class="token class-name">Ordered</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">></span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span>
            韩顺平 <span class="token class-name">Java</span> 工程师
                                     chain<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"==========CustomGateWayFilter=========== "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> uname <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> pwd <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">"pwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"hspedu"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>uname<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"123456"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>pwd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=========非法用户============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">NOT_ACCEPTABLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//回应</span>
            <span class="token keyword">return</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
<span class="token comment">//验证通过，放行</span>
        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">/**
     * order 表示该过滤器执行的顺序，数字越小，优先级越高. * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="SpringCloud-Sleuth-Zipkin"><a href="#SpringCloud-Sleuth-Zipkin" class="headerlink" title="SpringCloud Sleuth+Zipkin"></a>SpringCloud Sleuth+Zipkin</h2><h3 id="Sleuth-Zipkin"><a href="#Sleuth-Zipkin" class="headerlink" title="Sleuth/Zipkin"></a>Sleuth/Zipkin</h3><p>·在微服务框架中，一个由客户端发起的请求在后端系统中会经过多个不同的的服务节<br>点调用, 来协同产生最后的请求结果，每一个请求都会形成一条复杂的分布式服务调用链路<br>·在微服务框架中，一个由客户端发起的请求在后端系统中会经过多个不同的的服务节<br>点调用, 来协同产生最后的请求结果，每一个请求都会形成一条复杂的分布式服务调用链路<br>·一句话:Sleuth提供了一套完整的服务追踪解决方案 并兼容Zipkin<br>·Sleuth做链路追踪,Zipkin做数据搜集/存储/可视化</p><h3 id="Sleuth-Zipkin搭建链路监控实例"><a href="#Sleuth-Zipkin搭建链路监控实例" class="headerlink" title="Sleuth/Zipkin搭建链路监控实例"></a>Sleuth/Zipkin搭建链路监控实例</h3><p>·安装使用Zipkin<br>·修改pom.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-zipkin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>·修改application.yml文件</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">zipkin</span><span class="token punctuation">:</span>
<span class="token key atrule">base-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">9411</span>
<span class="token key atrule">sleuth</span><span class="token punctuation">:</span>
<span class="token key atrule">sampler</span><span class="token punctuation">:</span>
<span class="token comment">#采样率在 0-1 之间，1 表示全部采集</span>
<span class="token key atrule">probability</span><span class="token punctuation">:</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h2><h3 id="Nacos基础"><a href="#Nacos基础" class="headerlink" title="Nacos基础"></a>Nacos基础</h3><p>·一句话:Nacos就是注册中心【代替Eureka】+配置中心【替代Config】</p><h3 id="nacos使用"><a href="#nacos使用" class="headerlink" title="nacos使用"></a>nacos使用</h3><p>·下载nacos<br>·配置yml文件</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">cloud</span><span class="token punctuation">:</span>
  <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
    <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#指定yaml格式</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>·引入pom.xml文件</p><h3 id="nacos的配置"><a href="#nacos的配置" class="headerlink" title="nacos的配置"></a>nacos的配置</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
<span class="token key atrule">application</span><span class="token punctuation">:</span>
<span class="token comment">#这里的 name 需要参考 nacos 配置中心的 Data Id</span>
<span class="token key atrule">name</span><span class="token punctuation">:</span> e<span class="token punctuation">-</span>commerce<span class="token punctuation">-</span>nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>client<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RefreshScope</span> <span class="token comment">//@RefreshScope是springcloud的原生注解,实现配置信息自动刷新</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosConfigClientController</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;config.ip&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> configIp<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;config.name&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> configName<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/nacos/config/ip"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getConfigIp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> configIp<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/nacos/config/name"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getConfigName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> configName<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="注意事项和细节-1"><a href="#注意事项和细节-1" class="headerlink" title="注意事项和细节"></a>注意事项和细节</h3><p>·注意在 Nacos Server 的配置文件的后缀是 .yaml , 而不是 .yml<br>·在项目初始化时，要保证先从配置中心进行配置拉取，拉取配置之后，才能保证项目的正常启动, 也就是说如果项目不能正确的获取到<br>Nacos Server 的配置数据，项目是启动不了的<br>·springboot 中配置文件的加载是存在优先级顺序的，bootstrap.yml 优先级高于application.yml<br>·@RefreshScope 是 springcloud 原生注解，实现配置信息自动刷新, 如果在 Nacos Server 修改了配置数据，Client 端就会得到最新配置</p><h3 id="nacos配置隔离"><a href="#nacos配置隔离" class="headerlink" title="nacos配置隔离"></a>nacos配置隔离</h3><p>·通过Data方案</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
<span class="token key atrule">profiles</span><span class="token punctuation">:</span>
<span class="token comment">#active: dev #指定环境 dev/test/... </span>
<span class="token key atrule">active</span><span class="token punctuation">:</span> test <span class="token comment">#指定环境是 test</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>·Group方案</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token comment">#这里的name需要参考nacos配置中心的Data Id</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> e<span class="token punctuation">-</span>commerce<span class="token punctuation">-</span>nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>client
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#指定yaml格式</span>
        <span class="token key atrule">group</span><span class="token punctuation">:</span> older<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>·Namespace</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token comment">#这里的name需要参考nacos配置中心的Data Id</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> e<span class="token punctuation">-</span>commerce<span class="token punctuation">-</span>nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>client
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#指定yaml格式</span>
        <span class="token key atrule">group</span><span class="token punctuation">:</span> seckill
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> e0e2bcf7<span class="token punctuation">-</span>d15c<span class="token punctuation">-</span>46ca<span class="token punctuation">-</span>a910<span class="token punctuation">-</span>4784dc1573de<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Namespace-Group-DataId关系"><a href="#Namespace-Group-DataId关系" class="headerlink" title="Namespace/Group/DataId关系"></a>Namespace/Group/DataId关系</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/a9545e1f67ae36fffedfd75ed463ab46.png"></div></div><p>·Nacos默认的命名空间是public，Namespace主要用来实现配置隔离, 隔离范围大<br>·Group默认是DEFAULT GROUP，Group可以把不同的微服务划分到同一个分组里面去</p><h2 id="SpringCloud-Alibaba-Sentinel"><a href="#SpringCloud-Alibaba-Sentinel" class="headerlink" title="SpringCloud Alibaba Sentinel"></a>SpringCloud Alibaba Sentinel</h2><h3 id="Sentinel基础"><a href="#Sentinel基础" class="headerlink" title="Sentinel基础"></a>Sentinel基础</h3><p>·随着微服务的流行,服务与服务之间的稳定性变得越来越重要,Sentinel以流量为切入点,从流量控制,熔断降级,系统负载保护等多个维度<br>保护服务的稳定性</p><h3 id="Sentinel的主要特性"><a href="#Sentinel的主要特性" class="headerlink" title="Sentinel的主要特性"></a>Sentinel的主要特性</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/68e3cd42617a4895e29b68df37488d50.png"></div></div><p>·一句话:Sentinel:分布式系统的流量防卫兵,保护微服务</p><h3 id="Sentinel-核心功能"><a href="#Sentinel-核心功能" class="headerlink" title="Sentinel 核心功能"></a>Sentinel 核心功能</h3><p>·流量控制<br>·熔断降级<br>1.在调用系统的时候,如果调用链路中的某个资源出现了不稳定,最终会导致请求发生堆积<br>2.熔断降级可以解决这个问题，所谓的熔断降级就是当检测到调用链路中某个资源出现不<br>稳定的表现，例如请求响应时间长或异常比例升高的时候，则对这个资源的调用进行限<br>制，让请求快速失败，避免影响到其它的资源而导致级联故障<br>·系统负载保护<br>1.根据系统能够处理的请求，和允许进来的请求，来做平衡，追求的目标是在系统不被<br>拖垮的情况下, 提高系统的吞吐率<br>·消息削峰填谷<br>1.某瞬时来了大流量的请求, 而如果此时要处理所有请求，很可能会导致系统负载过高，<br>影响稳定性。但其实可能后面几秒之内都没有消息投递，若直接把多余的消息丢掉则没<br>有充分利用系统处理消息的能力</p><h3 id="Sentinel两个组成部分"><a href="#Sentinel两个组成部分" class="headerlink" title="Sentinel两个组成部分"></a>Sentinel两个组成部分</h3><p>·核心库:：（Java 客户端）不依赖任何框架/库，能够运行在所有 Java 运行时环境， 对 Spring Cloud 有较好的支持<br>·控制台：（Dashboard）基于 Spring Boot 开发，打包后可以直接运行， 不需要额外的 Tomcat 等应用容器</p><h3 id="Sentinel使用"><a href="#Sentinel使用" class="headerlink" title="Sentinel使用"></a>Sentinel使用</h3><p>·下载Sentinel<br>·引入pom.xml<br>·配置application.yml文件</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
  <span class="token key atrule">transport</span><span class="token punctuation">:</span>
    <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span> <span class="token comment">#这个师sentinel控制台的地址</span>
    <span class="token comment">#1.spring.cloud.sentinel.transport.port 端口配置会在被监控的微服务</span>
    <span class="token comment">#  对应的机器上启动一个Http Server</span>
    <span class="token comment">#2.该 Server 会与 Sentinel 控制台做交互</span>
    <span class="token comment">#3.比如 Sentinel 控制台添加了 1 个限流规则，会把规则数据 push 给</span>
    <span class="token comment"># Http Server 接收，Http Server 再将规则注册到 Sentinel 中</span>
    <span class="token comment"># 简单的说明: spring.cloud.sentinel.transport.port：指定被监控的微服务应用与</span>
    <span class="token comment"># Sentinel控制台交互的端口，微服务应用本地会起一个该端口占用的 Http Server</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8719</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>·QPS: Queries Per Second(每秒查询率)，是服务器每秒响应的查询次数<br>·Sentinel 采用的是懒加载， 只有调用了某个接口/服务，才能看到监控数据</p><h3 id="Sentinel-流量控制"><a href="#Sentinel-流量控制" class="headerlink" title="Sentinel 流量控制"></a>Sentinel 流量控制</h3><div class="img-wrap"><div class="img-bg"><img class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/e1f874577d8f95d8e330f3ce6016cd5a.png"></div></div><p>·对上图解析<br>1.资源名:唯一名称,默认请求路径<br>2.针对来源:Sentinel可以针对调用者进行限流,填写微服务名,默认default,不区分来源<br>3.阈值类型/单机阈值:<br>QPS(每秒钟的请求数量):当调用该api的QPS达到阈值,进行限流<br>线程数:∶当调用该 api 的线程数达到阈值的时候,进行限流</p><h4 id="QPS和线程数的区别-比如QPS和线程我们都设置阈值为1"><a href="#QPS和线程数的区别-比如QPS和线程我们都设置阈值为1" class="headerlink" title="QPS和线程数的区别:比如QPS和线程我们都设置阈值为1"></a>QPS和线程数的区别:比如QPS和线程我们都设置阈值为1</h4><p>·对于QPS而言,如果一秒内,客户端发出了2次请求,就达到阈值,从而限流<br>·对于线程数而言,如果在一秒内,客户端发出来2次请求,不一定达到线程限制的阈值<br>假设我们 1 次请求后台会创建一个线程, 但是这个请求完成时间是 0.1 秒(可以<br>视为该请求对应的线程存活 0.1 秒), 所以当客户端第 2 次请求时(比如客户端是在 0.3 秒发<br>出的), 这时第 1 个请求的线程就已经结束了, 因此就没有达到线程的阈值, 也不会限流<br>·如果一个请求对应的线程平均执行时间为0.1,那么,就相当于QPS为10<br>4.是否集群:不需要集群<br>5.流控模式<br>直接:api 达到限流条件时，直接限流<br>关联:当关联的资源达到阈值时，就限流自己<br>链路:当从某个接口过来的资源达到限流条件时，开启限流<br>6.流控效果<br>快速失败:直接失败,抛异常<br>Warm up:根据codeFactor(冷加载因子,默认3)的值,从阈值/codeFactor,经过预热时长,才达到设置的QPS阈值<br>排队等待:匀速排队，让请求以匀速的速度通过，阈值类型必须设置为 QPS，否则无效</p><h3 id="流量控制实例"><a href="#流量控制实例" class="headerlink" title="流量控制实例"></a>流量控制实例</h3><p>·在Sentinel配置流量规则时,如何配置通配符问题,比如/member/get/1,/member/get/2统一使用一个规则<br>1.方案1:在sentinel中 /member/get?id=1 和 /member/get?id=2 被统一认为是/member/get 所以只要对/member/get 限流就OK<br>2.方案2:URL资源清洗<br>·可以通过UrlCleaner接口来实现资源清洗,也就是对于/member/get/{id}这个URL,我们可以统一归集到/member/get/*资源下</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomUrlCleaner</span> <span class="token keyword">implements</span> <span class="token class-name">UrlCleaner</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">clean</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
           <span class="token keyword">return</span> s<span class="token punctuation">;</span>
       <span class="token punctuation">&#125;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"/member/get"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
           <span class="token keyword">return</span> <span class="token string">"/member/get/*"</span><span class="token punctuation">;</span>
       <span class="token punctuation">&#125;</span>
       <span class="token keyword">return</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>·如果sentinel流控规则没有持久化,当我们重启调用API所在微服务模块后,规则会丢失,需要重新加入</p><h4 id="注意事项和细节-2"><a href="#注意事项和细节-2" class="headerlink" title="注意事项和细节"></a>注意事项和细节</h4><p>阈值类型 QPS 和 线程数的区别讨论<br>·如果一个线程平均执行时间为0.05秒，就说明在1秒钟，可以执行20次(相当于 QPS为<br>·如果一个线程平均执行时间为1秒, 说明1秒钟，可以执行1次数(相当于 QPS为1)<br>·如果一个线程平均执行时间为2秒, 说明2秒钟内，才能执行1次</p><h3 id="流量控制实例-关联"><a href="#流量控制实例-关联" class="headerlink" title="流量控制实例-关联"></a>流量控制实例-关联</h3><p>·关联的含义:当关联的资源达到阈值时,就限流自己<br>·当调用 member-service-nacos-provider-10004 的 /t2 API 接口时，如果 QPS 超过 1，这时调用 /t1 API 接口 直接接失败，抛异常.<br>梳理 /t2 是关联的资源 , 限流的资源是/t1</p><h3 id="流量控制实例-Warm-up"><a href="#流量控制实例-Warm-up" class="headerlink" title="流量控制实例-Warm up"></a>流量控制实例-Warm up</h3><p>1.概述<br>·当流量突然增大的时候，我们常常会希望系统从空闲状态到繁忙状态的切换的时间长<br>一些。即如果系统在此之前长期处于空闲的状态，我们希望处理请求的数量是缓步的<br>增多，经过预期的时间以后，到达系统处理请求个数的最大值。Warm Up(冷启动，<br>预热)模式就是为了实现这个目的的。<br>·应用场景: 秒杀在开启瞬间，大流量很容易造成冲垮系统，Warmup 可慢慢的把流量放入，最终将阀值增长到设置阀值<br>2.需求分析<br>·调用 member-service-nacos-provider-10004 的 /t2 API 接口，将 QPS 设置为 9, 设置Warm up 值<br>·含义为 请求 /t2 的 QPS 从 threshold / 3( 9 /3 = 3) 开始，经预热时长(3 秒)逐渐升至设定的 QPS 阈值<br>·为什么是 9 / 3, 这个是 3 就是默认冷启动启动加载因子 coldFactor=3<br>·.测试预期效果: 在前 3 秒，如果访问 /t2 的 QPS 超过 3, 会直接报错，在 3 秒后 访问/t2 的 QPS 超过 3, 小于等于 9, 是正常访问</p><h3 id="流量控制实例-排队"><a href="#流量控制实例-排队" class="headerlink" title="流量控制实例-排队"></a>流量控制实例-排队</h3><p>·排队方式：这种方式严格控制了请求通过的间隔时间，也即是让请求以均匀的速度通过，对应的是漏桶算法<br>·需求分析<br>1.通过 Sentinel 实现 流量控制<br>2.调用 member-service-nacos-provider-10004 的 /t2 API 接口，将 QPS设置为1<br>3.当调用 /t2 的 QPS 超过 1 时，不拒绝请求，而是排队等待, 依次执行<br>4.当等待时间超过 10 秒，则为等待</p><h3 id="Sentinel-熔断降级"><a href="#Sentinel-熔断降级" class="headerlink" title="Sentinel 熔断降级"></a>Sentinel 熔断降级</h3><p>·我们对不稳定的服务进行熔断降级，让其快速返回结果，不要造成线程堆积<br>·现代微服务架构都是分布式的，由非常多的服务组成。不同服务之间相互调用，组成复杂的调用链路<br>·链路调用中会产生放大的效果。复杂链路上的某一环不稳定，就可能会层层级联，最终导致整个链路都不可用<br>·因此需要对不稳定的弱依赖服务调用进行熔断降级，暂时切断不稳定调用，避免局部不稳定因素导致整体的雪崩</p><h4 id="熔断-降级-限流三者的关系"><a href="#熔断-降级-限流三者的关系" class="headerlink" title="熔断,降级,限流三者的关系"></a>熔断,降级,限流三者的关系</h4><p>·熔断强调的是服务之间的调用能实现自我恢复的状态<br>·限流是从系统的流量入口考虑, 从进入的流量上进行限制, 达到保护系统的作用<br>·降级, 是从系统业务的维度考虑，流量大了或者频繁异常, 可以牺牲一些非核心业务，保护核心流程正常使用</p><h4 id="熔断策略"><a href="#熔断策略" class="headerlink" title="熔断策略"></a>熔断策略</h4><p>1.慢调用比例<br>·慢调用比例 (SLOW_REQUEST_RATIO)：选择以慢调用比例作为阈值，需要设置允许的慢调用 RT(即最大的响应时间)，请求的响应时间大于该值则统计为慢调用<br>·当单位统计时长(statIntervalMs)内请求数目大于设置的最小请求数目，并且慢调用的比例大于阈值，则接下来的熔断时长内请求会自动被熔断<br>·熔断时长后, 熔断器会进入探测恢复状态(HALF-OPEN 状态)，若接下来的一个请求响应时间小于设置的慢调用 RT 则结束熔断，若大于设置的慢调用<br>RT 则会再次被熔断<br>·实例:<br>当调用 member-service-nacos-provider-10004 的 /t3 API 接口时，如果在 1s 内持续进<br>入了 5 个请求，并且请求的平均响应时间超过 200ms, 那么就在未来 10 秒钟内，断路器<br>打开, 让 /t3 API 接口 微服务不可用，后面对/t3 API 接口 访问降到 1S 内 1 个请求，降低访问量了，断路器关闭，微服务恢复<br></p><div class="img-wrap"><div class="img-bg"><img class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://qgqliving-10000.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87/f1a6dcb008342cf5f9b316575ccfe4df.png"></div></div><br>2.异常比列<br>·异常比例 (ERROR_RATIO)：当单位统计时长(statIntervalMs)内请求数目大于设置的最小请求数目，并且异常的比例大于阈值，则接下来的熔断时长内请求会自动被熔断<br>·经过熔断时长后熔断器会进入探测恢复状态(HALF-OPEN 状态)<br>·若接下来的一个请求成功完成(没有错误)则结束熔断, 否则会再次被熔断<br>·异常比率的阈值范围是 [0.0, 1.0]，代表 0%-100%<br>·实例<br>当调用 member-service-nacos-provider-10004 的 /t4 API 接口时，当资源的每秒请求<br>量&gt;=5，并且每秒异常总数占通过量的比值超过 20%(即异常比例到 20%), 断路器打开(即:进入降级状态), 让 /t4 API 接口 微服务不可用<br>·异常数<br>1.异常数 (ERROR_COUNT)：当单位统计时长内的异常数目超过阈值之后会自动进行熔断<br>2.经过熔断时长后熔断器会进入探测恢复状态(HALF-OPEN 状态)<br>3.若接下来的一个请求成功完成(没有错误)则结束熔断，否则会再次被熔断<p></p><h3 id="Sentinel-热点规则"><a href="#Sentinel-热点规则" class="headerlink" title="Sentinel 热点规则"></a>Sentinel 热点规则</h3><p>·热点: 热点即经常访问的数据。很多时候我们希望统计热点数据中, 访问频次最高的Top K 数据，并对其访问进行限制。<br>·比如某条新闻上热搜 ，在某段时间内高频访问， 为了防止系统雪崩, 可以对该条新闻进行热点限流</p><h4 id="热点Key限流-实例"><a href="#热点Key限流-实例" class="headerlink" title="热点Key限流-实例"></a>热点Key限流-实例</h4><p>·对 member-service-nacos-provider-10004 的 /news?id=x&amp;type=x API 接口进行热点限流<br>·假定 id=10 这一条新闻是当前的热点新闻， 当查询新闻时，对通常的 id(非热点新闻)请求 QPS 限定为 2, 如果 id=10 QPS 限定为 1<br>·如果访问超出了规定的 QPS, 触发热点限流机制, 调用自定义的方法，给出提示信息</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
     *1.@SentinelResource:指定sentinel 限流资源
     *2.value="news" 表示sentinel限流资源,名字自己取
     *3.blockHandler = "newsBlockHandler":当出现限流时,由newsBlockHandler方法进行处理
     *
     */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/news"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"news"</span><span class="token punctuation">,</span>blockHandler <span class="token operator">=</span> <span class="token string">"newsBlockHandler"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">queryNews</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> id<span class="token punctuation">,</span>
                            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"type"</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"到 DB 查询数据库.... "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"返回 id= "</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">" 新闻 fromDB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="系统规则"><a href="#系统规则" class="headerlink" title="系统规则"></a>系统规则</h3><p>·如我们系统最大性能能抗 100QPS, 如何分配 /t1 /t2的QPS<br>·方案 1: /t1 分配 QPS=50 /t2 分配 QPS=50 , 问题, 如果/t1 当前 QPS 达到 50 , 而/t2 的 QPS 才 10, 会造成没有充分利用服务器性能<br>·方案 2: /t1 分配 QPS=100 /t2 分配 QPS=100 , 问题, 容易造成 系统没有流量保护，造成请求线程堆积，形成雪崩<br>·一句话: 系统规则作用, 在系统稳定的前提下，保持系统的吞吐量<br>·系统处理请求的过程想象为一个水管，到来的请求是往这个水管灌水，当系统处理顺畅的时候，请求不需要排队，直接从水管中穿过，这个请求的RT是最短的<br>·反之，当请求堆积的时候，那么处理请求的时间则会变为：排队时间 + 最短处理时</p><h4 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h4><p>·Load 自适应（仅对 Linux/Unix-like 机器生效）：系统的 load1 作为启发指标，进行自<br>适应系统保护。当系统 load1 超过设定的启发值，且系统当前的并发线程数超过估算<br>的系统容量时才会触发系统保护（BBR 阶段）。系统容量由系统的 maxQps <em>minRt估算得出。设定参考值一般是 CPU cores</em> 2.5<br>·CPU usage（1.5.0+ 版本）：当系统 CPU 使用率超过阈值即触发系统保护（取值范围 0.0-1.0），比较灵敏<br>·平均 RT：当单台机器上所有入口流量的平均 RT 达到阈值即触发系统保护，单位是毫秒。<br>·并发线程数：当单台机器上所有入口流量的并发线程数达到阈值即触发系统保护<br>·入口 QPS：当单台机器上所有入口流量的 QPS 达到阈值即触发系统保护。</p><h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><p>·对 member-service-nacos-provider-10004 的 所有 API 接口进行流量保护，不管访问哪个 API 接口, 系统入口总的 QPS 不能大于 2, 大于 2，就进行限流控制</p><h3 id="SentinelResource自定义全局限流处理类"><a href="#SentinelResource自定义全局限流处理类" class="headerlink" title="@SentinelResource自定义全局限流处理类"></a>@SentinelResource自定义全局限流处理类</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/t6"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"t6"</span><span class="token punctuation">,</span>
    blockHandlerClass <span class="token operator">=</span> <span class="token class-name">CustomGlobalBlockHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
    blockHandler <span class="token operator">=</span> <span class="token string">"handlerMethod1"</span><span class="token punctuation">,</span>
    fallbackClass <span class="token operator">=</span> <span class="token class-name">CustomGlobalFallbackHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
    fallback <span class="token operator">=</span> <span class="token string">"fallBackHandlerMethod1"</span><span class="token punctuation">,</span>
    exceptionsToIgnore <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">RuntimeException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">t6</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"执行 t6() 线程 id= "</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>num <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"num 的值异常 num= "</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"200"</span><span class="token punctuation">,</span> <span class="token string">"t6()执行成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomGlobalBlockHandler</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//提醒:创建的处理异常方法需要是static</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Result</span> <span class="token function">handlerMethod1</span><span class="token punctuation">(</span><span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"400"</span><span class="token punctuation">,</span> <span class="token string">"客户自定义异常处理 handlerm1()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Result</span> handlerMethod2 <span class="token punctuation">(</span><span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"401"</span><span class="token punctuation">,</span> <span class="token string">"客户自定义异常处理 handlerm2()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomGlobalFallbackHandler</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Result</span> <span class="token function">fallBackHandlerMethod1</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"400"</span><span class="token punctuation">,</span> <span class="token string">"java 异常信息= "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Result</span> <span class="token function">fallBackHandlerMethod2</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"401"</span><span class="token punctuation">,</span> <span class="token string">"java 异常信息= "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="fallback"><a href="#fallback" class="headerlink" title="fallback"></a>fallback</h3><p>·blockHandler 只负责 sentine 控制台配置违规<br>·fallback 负责 Java 异常/业务异常</p><h3 id="接入-Sentinel-的方式"><a href="#接入-Sentinel-的方式" class="headerlink" title="接入 Sentinel 的方式"></a>接入 Sentinel 的方式</h3><p>·代码方式(硬编码,侵入性强,不推荐)<br>·注解方式(低侵入性, 前面用过, 推荐)<br>·@SentinelResource 用于定义资源，并提供可选的异常处理和 fallback 配置项。<br>@SentinelResource 注解包含以下属性(我们再梳理一下)<br> value：资源名称，必需项（不能为空）<br> entryType：entry 类型，可选项（默认为 EntryType.OUT）<br> blockHandler / blockHandlerClass: blockHandler 对应处理 BlockException 的函数名<br>称，可选项。blockHandler 函数访问范围需要是 public，返回类型需要与原方法相匹<br>配，参数类型需要和原方法相匹配并且最后加一个额外的参数，类型为<br>BlockException。blockHandler 函数默认需要和原方法在同一个类中。若希望使用其<br>他类的函数，则可以指定 blockHandlerClass 为对应的类的 Class 对象，注意对应的<br>函数必需为 static 函数，否则无法解析。<br> fallback / fallbackClass：fallback 函数名称，可选项，用于在抛出异常的时候提供<br>fallback 处理逻辑。fallback 函数可以针对所有类型的异常（除了 exceptionsToIgnore<br>里面排除掉的异常类型）进行处理。fallback 函数签名和位置要求：<br>(1)返回值类型必须与原函数返回值类型一致；<br>(2)方法参数列表需要和原函数一致，或者可以额外多一个 Throwable 类型的参数<br>用于接收对应的异常。<br>(3)fallback 函数默认需要和原方法在同一个类中。若希望使用其他类的函数，则可<br>以指定 fallbackClass 为对应的类的 Class 对象，注意对应的函数必需为 static 函数，否<br>则无法解析。<br> defaultFallback（since 1.6.0）：默认的 fallback 函数名称，可选项，通常用于通用的<br>fallback 逻辑（即可以用于很多服务或方法）。默认 fallback 函数可以针对所有类型<br>的异常（除了 exceptionsToIgnore 里面排除掉的异常类型）进行处理。若同时配置了<br>fallback 和 defaultFallback，则只有 fallback 会生效。defaultFallback 函数签名要求：<br>(1)返回值类型必须与原函数返回值类型一致；<br>(2)方法参数列表需要为空，或者可以额外多一个 Throwable 类型的参数用于接收<br>对应的异常。<br>(3)defaultFallback 函数默认需要和原方法在同一个类中。若希望使用其他类的函数，<br>则可以指定 fallbackClass 为对应的类的 Class 对象，注意对应的函数必需为 static 函数，<br>否则无法解析。<br> exceptionsToIgnore（since 1.6.0）：用于指定哪些异常被排除掉，不会计入异常统计中，<br>也不会进入 fallback 逻辑中，而是会原样抛出</p><h3 id="openFeign-sentinel-对远程调用熔断降级"><a href="#openFeign-sentinel-对远程调用熔断降级" class="headerlink" title="openFeign+sentinel 对远程调用熔断降级"></a>openFeign+sentinel 对远程调用熔断降级</h3><p>·在 member-service-nacos-consumer-80 调用某个无效服务时，启动 Sentinel 的熔断降级机制 , 能够快速返回响应，而不是使用默认的超时机制(因为超时机制容易线程堆积, 从而导致雪崩)</p><h3 id="规则持久化-在Nacos-Server配置规则-完成持久化"><a href="#规则持久化-在Nacos-Server配置规则-完成持久化" class="headerlink" title="规则持久化,在Nacos Server配置规则,完成持久化"></a>规则持久化,在Nacos Server配置规则,完成持久化</h3><p>·在nacos中配置规则<br><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"resource"</span><span class="token operator">:</span> <span class="token string">"/member/openfeign/consumer/get/1"</span><span class="token punctuation">,</span>
    <span class="token property">"limitApp"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
    <span class="token property">"grade"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"count"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"strategy"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"controlBehavior"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"clusterMode"</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>·在application.yml中配置<br><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
  <span class="token key atrule">transport</span><span class="token punctuation">:</span>
    <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">9999</span> <span class="token comment">#指定sentinel控制台地址</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8719</span>  <span class="token comment">#设置端口默认为8719,如果该端口被占用了 就自动从8719+1进行扫描,直到找到一个没有被占用的端口</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">ds1</span><span class="token punctuation">:</span>
      <span class="token comment">#流控规则配置是从nacos server配置中心获取</span>
      <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#指定nacos server服务地址</span>
        <span class="token key atrule">data-id</span><span class="token punctuation">:</span> member<span class="token punctuation">-</span>service<span class="token punctuation">-</span>nacos<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span><span class="token number">80</span> <span class="token comment">#data-id</span>
        <span class="token key atrule">group-id</span><span class="token punctuation">:</span> DEFAULT_GROUP <span class="token comment">#指定组【nacos server配置中心】</span>
        <span class="token key atrule">data-type</span><span class="token punctuation">:</span> json <span class="token comment">#指定流控规则的数据类型</span>
        <span class="token key atrule">rule-type</span><span class="token punctuation">:</span> flow <span class="token comment">#表示规则的类型</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="seata-分布式事务管理"><a href="#seata-分布式事务管理" class="headerlink" title="seata 分布式事务管理"></a>seata 分布式事务管理</h2><h3 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h3><p>·一个微服务调用一个数据库,怎么样做到数据的统一<br>·这个时候就要用到seata,主要是配置<br>·下载安装seata<br>·配置seata<br>·创建对应的seata数据库和表,在seata安装目录有<br>·将seata注册到nacoa中<br>·对每个微服务对于的库创建undo_log表<br>·每个微服务的resource下创建两个配置文件</p><h3 id="最后是事务控制"><a href="#最后是事务控制" class="headerlink" title="最后是事务控制"></a>最后是事务控制</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderService</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderDao</span> orderDao<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">StorageService</span> storageService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AccountService</span> accountService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token comment">/**
     * 老师解读
     * 1. @GlobalTransactional : 分布式全局事务控制  io.seata.spring.annotation包
     * 2. name = "qgq-save-order" 名称，程序员自己指定,保证唯一即可
     * 3. rollbackFor = Exception.class 指定发送什么异常就回滚, 这里我们指定的是Exception.class
     *    即 只要发生了异常就回滚
     */</span>
    <span class="token annotation punctuation">@GlobalTransactional</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"qgq-save-order"</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token comment">//后面我们如果需要打印日志</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====创建订单 start====="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====本地生成订单 start==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//调用本地方法生成订单order</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====本地生成订单 end==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====扣减库存 start==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//远程调用storage微服务扣减库存</span>
        storageService<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getProductId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getNums</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====扣减库存 end==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====扣减用户余额 start==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//远程调用account微服务扣减用户money</span>
        accountService<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====扣减用户余额 end==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====本地修改订单状态 start==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用本地方法修改订单状态0->1</span>
        orderDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====本地修改订单状态 end==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"====创建订单 end====="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="https://100qin10086.github.io">秦三顺</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://100qin10086.github.io/posts/db1b69a.html">https://100qin10086.github.io/posts/db1b69a.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://100qin10086.github.io" target="_blank">秦家大胖's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%A1%86%E6%9E%B6/">框架</a><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%BE%AE%E6%9C%8D%E5%8A%A1/">分布式微服务</a></div><div class="post_share"><div class="social-share" data-image="/img/bj/no34.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/9c71d1d6.html" title="Netty 源码与优化"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/bj/no34.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Netty 源码与优化</div></div></a></div><div class="next-post pull-right"><a href="/posts/a8c3babf.html" title="SpringBoot复习"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/bj/no33.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SpringBoot复习</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/bfd15f47.html" title="NIO 基础"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/bj/no34.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-06</div><div class="title">NIO 基础</div></div></a></div><div><a href="/posts/a84f1c2b.html" title="Netty 入门"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/bj/no34.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-06</div><div class="title">Netty 入门</div></div></a></div><div><a href="/posts/922301ec.html" title="Netty 进阶"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/bj/no34.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-06</div><div class="title">Netty 进阶</div></div></a></div><div><a href="/posts/9c71d1d6.html" title="Netty 源码与优化"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/bj/no34.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-06</div><div class="title">Netty 源码与优化</div></div></a></div><div><a href="/posts/a8c3babf.html" title="SpringBoot复习"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/bj/no33.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-09</div><div class="title">SpringBoot复习</div></div></a></div><div><a href="/posts/d27b3349.html" title="MyBatis复习"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/bj/no32.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-05</div><div class="title">MyBatis复习</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/tx.jfif" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">秦三顺</div><div class="author-info__description">一个专注于技术的博客</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">42</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/100qin10086" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:3048413889@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="tencent://Message/?Uin=3048413889&amp;websiteName=www.oicqzone.com&amp;Menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="https://blog.csdn.net/m0_63639194?type=blog" target="_blank" title="CSDN"><i class="fa fa-address-card"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">小站新增留言板,文章评论功能，可以填写您的邮箱后再评论,不好的评论会删除！！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">SpringCloud &amp; SpringCloudAlibaba复习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Cloud-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">Spring Cloud 基本介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E7%9A%84%E6%BC%94%E5%8F%98%E8%BF%87%E7%A8%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">系统架构的演变过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E6%9C%BA%E6%9E%B6%E6%9E%84"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">单机架构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB%E6%9E%B6%E6%9E%84-%E9%9D%99%E6%80%81%E7%BC%93%E5%AD%98-%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">动静分离架构:静态缓存+文件存储</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84-%E4%B8%9A%E5%8A%A1%E6%8B%86%E5%88%86-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">分布式架构:业务拆分+负载均衡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Cloud-%E5%85%A8%E9%9D%A2%E8%AF%B4%E6%98%8E-%E9%87%8D%E8%A6%81"><span class="toc-number">1.1.2.</span> <span class="toc-text">Spring Cloud 全面说明(重要)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Cloud%E7%BB%84%E4%BB%B6%E9%80%89%E5%9E%8B"><span class="toc-number">1.1.3.</span> <span class="toc-text">Spring Cloud组件选型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Cloud-Alibaba-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.</span> <span class="toc-text">Spring Cloud Alibaba 基本介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">分布式微服务技术选型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RestTemplate"><span class="toc-number">1.3.</span> <span class="toc-text">RestTemplate</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.3.1.</span> <span class="toc-text">基本介绍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Eureka%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0"><span class="toc-number">1.4.</span> <span class="toc-text">Eureka服务注册与发现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"><span class="toc-number">1.4.1.</span> <span class="toc-text">问题分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E8%AF%BB%E4%B8%8A%E5%9B%BE"><span class="toc-number">1.4.2.</span> <span class="toc-text">解读上图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%8D%95%E6%9C%BAEureka"><span class="toc-number">1.4.3.</span> <span class="toc-text">创建单机Eureka</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86member-service-provider-10000%E4%BD%9C%E4%B8%BAEurekaClient%E6%B3%A8%E5%86%8C%E5%88%B0e-commerce-eureka-server-9001%E6%88%90%E4%B8%BA%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B"><span class="toc-number">1.4.4.</span> <span class="toc-text">将member-service-provider-10000作为EurekaClient注册到e-commerce-eureka-server-9001成为服务提供</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D-%E7%BD%AE-member-service-consumer-80%E4%BD%9C%E4%B8%BAEurekaClient%E5%8F%AF%E4%BB%A5%E6%8B%89%E5%8F%96-%E8%8E%B7%E5%8F%96e-commerce-eureka-server-9001-%E6%8F%90%E4%BE%9B%E7%9A%84%E6%9C%8D%E5%8A%A1%E4%BF%A1"><span class="toc-number">1.4.5.</span> <span class="toc-text">配 置 member-service-consumer-80作为EurekaClient可以拉取&#x2F;获取e-commerce-eureka-server-9001 提供的服务信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Service-Consumer-%E3%80%81Service-Provider-%E3%80%81EurekaServer-%E7%9A%84%E7%BB%B4%E6%8A%A4%E6%9C%BA%E5%88%B6"><span class="toc-number">1.4.5.1.</span> <span class="toc-text">Service Consumer 、Service Provider 、EurekaServer 的维护机制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA-EurekaServer-%E9%9B%86%E7%BE%A4-%E5%AE%9E%E7%8E%B0%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1-amp-%E6%95%85%E9%9A%9C%E5%AE%B9%E9%94%99"><span class="toc-number">1.4.6.</span> <span class="toc-text">搭建 EurekaServer 集群- 实现负载均衡&amp;故障容错</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.4.6.1.</span> <span class="toc-text">主要步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E7%AB%AF-member-service-consumer-80-%E4%BD%BF%E7%94%A8%E4%BC%9A%E5%91%98%E4%B8%AD%E5%BF%83%E6%9C%8D%E5%8A%A1%E9%9B%86%E7%BE%A4"><span class="toc-number">1.4.7.</span> <span class="toc-text">配置服务消费端 member-service-consumer-80 使用会员中心服务集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%BF%AE%E6%94%B9"><span class="toc-number">1.4.7.1.</span> <span class="toc-text">代码修改</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-Eureka-Server-%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%BF%A1%E6%81%AF-DiscoveryClient"><span class="toc-number">1.4.8.</span> <span class="toc-text">获取 Eureka Server 服务注册信息 -DiscoveryClient</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringCloud-Ribbon"><span class="toc-number">1.5.</span> <span class="toc-text">SpringCloud Ribbon</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ribbon-%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.5.1.</span> <span class="toc-text">Ribbon 介绍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringCloud-OpenFeign"><span class="toc-number">1.6.</span> <span class="toc-text">SpringCloud OpenFeign</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenFeign%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.6.1.</span> <span class="toc-text">OpenFeign是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%91%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">1.6.2.</span> <span class="toc-text">我的理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#openFeign%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.6.3.</span> <span class="toc-text">openFeign的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-number">1.6.4.</span> <span class="toc-text">注意事项和细节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.5.</span> <span class="toc-text">日志配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenFeign%E8%B6%85%E6%97%B6"><span class="toc-number">1.6.6.</span> <span class="toc-text">OpenFeign超时</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringCloud-Gateway"><span class="toc-number">1.7.</span> <span class="toc-text">SpringCloud Gateway</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9C%8B%E4%B8%80%E4%B8%AA%E9%9C%80%E6%B1%82-%E5%BC%95%E5%87%BA%E7%BD%91%E5%85%B3%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.7.1.</span> <span class="toc-text">看一个需求,引出网关服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%BD%91%E5%85%B3%E6%9C%8D%E5%8A%A1-%E9%87%8D%E6%9E%84%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84"><span class="toc-number">1.7.2.</span> <span class="toc-text">使用网关服务,重构项目架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gateway%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.7.3.</span> <span class="toc-text">Gateway是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gateway%E7%89%B9%E6%80%A7"><span class="toc-number">1.7.4.</span> <span class="toc-text">Gateway特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gateway%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc-number">1.7.5.</span> <span class="toc-text">Gateway基本原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAapplication-yml"><span class="toc-number">1.7.6.</span> <span class="toc-text">创建application.yml</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E5%BC%8F-%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE%E7%B1%BB%E6%B3%A8%E5%85%A5"><span class="toc-number">1.7.6.1.</span> <span class="toc-text">第二种方式:编写配置类注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1"><span class="toc-number">1.7.7.</span> <span class="toc-text">动态路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Predicate-%E6%96%AD%E8%A8%80"><span class="toc-number">1.7.8.</span> <span class="toc-text">Predicate&#x2F;断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Filter-%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">1.7.9.</span> <span class="toc-text">Filter&#x2F;过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">1.7.10.</span> <span class="toc-text">基本介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89GlobalFilter"><span class="toc-number">1.7.11.</span> <span class="toc-text">自定义GlobalFilter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringCloud-Sleuth-Zipkin"><span class="toc-number">1.8.</span> <span class="toc-text">SpringCloud Sleuth+Zipkin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Sleuth-Zipkin"><span class="toc-number">1.8.1.</span> <span class="toc-text">Sleuth&#x2F;Zipkin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sleuth-Zipkin%E6%90%AD%E5%BB%BA%E9%93%BE%E8%B7%AF%E7%9B%91%E6%8E%A7%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.8.2.</span> <span class="toc-text">Sleuth&#x2F;Zipkin搭建链路监控实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nacos"><span class="toc-number">1.9.</span> <span class="toc-text">Nacos</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nacos%E5%9F%BA%E7%A1%80"><span class="toc-number">1.9.1.</span> <span class="toc-text">Nacos基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nacos%E4%BD%BF%E7%94%A8"><span class="toc-number">1.9.2.</span> <span class="toc-text">nacos使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nacos%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">1.9.3.</span> <span class="toc-text">nacos的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82-1"><span class="toc-number">1.9.4.</span> <span class="toc-text">注意事项和细节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nacos%E9%85%8D%E7%BD%AE%E9%9A%94%E7%A6%BB"><span class="toc-number">1.9.5.</span> <span class="toc-text">nacos配置隔离</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Namespace-Group-DataId%E5%85%B3%E7%B3%BB"><span class="toc-number">1.9.6.</span> <span class="toc-text">Namespace&#x2F;Group&#x2F;DataId关系</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringCloud-Alibaba-Sentinel"><span class="toc-number">1.10.</span> <span class="toc-text">SpringCloud Alibaba Sentinel</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Sentinel%E5%9F%BA%E7%A1%80"><span class="toc-number">1.10.1.</span> <span class="toc-text">Sentinel基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sentinel%E7%9A%84%E4%B8%BB%E8%A6%81%E7%89%B9%E6%80%A7"><span class="toc-number">1.10.2.</span> <span class="toc-text">Sentinel的主要特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sentinel-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD"><span class="toc-number">1.10.3.</span> <span class="toc-text">Sentinel 核心功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sentinel%E4%B8%A4%E4%B8%AA%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86"><span class="toc-number">1.10.4.</span> <span class="toc-text">Sentinel两个组成部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sentinel%E4%BD%BF%E7%94%A8"><span class="toc-number">1.10.5.</span> <span class="toc-text">Sentinel使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.10.6.</span> <span class="toc-text">注意事项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sentinel-%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6"><span class="toc-number">1.10.7.</span> <span class="toc-text">Sentinel 流量控制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#QPS%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%95%B0%E7%9A%84%E5%8C%BA%E5%88%AB-%E6%AF%94%E5%A6%82QPS%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%88%91%E4%BB%AC%E9%83%BD%E8%AE%BE%E7%BD%AE%E9%98%88%E5%80%BC%E4%B8%BA1"><span class="toc-number">1.10.7.1.</span> <span class="toc-text">QPS和线程数的区别:比如QPS和线程我们都设置阈值为1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.10.8.</span> <span class="toc-text">流量控制实例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82-2"><span class="toc-number">1.10.8.1.</span> <span class="toc-text">注意事项和细节</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E5%AE%9E%E4%BE%8B-%E5%85%B3%E8%81%94"><span class="toc-number">1.10.9.</span> <span class="toc-text">流量控制实例-关联</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E5%AE%9E%E4%BE%8B-Warm-up"><span class="toc-number">1.10.10.</span> <span class="toc-text">流量控制实例-Warm up</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E5%AE%9E%E4%BE%8B-%E6%8E%92%E9%98%9F"><span class="toc-number">1.10.11.</span> <span class="toc-text">流量控制实例-排队</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sentinel-%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7"><span class="toc-number">1.10.12.</span> <span class="toc-text">Sentinel 熔断降级</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%86%94%E6%96%AD-%E9%99%8D%E7%BA%A7-%E9%99%90%E6%B5%81%E4%B8%89%E8%80%85%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.10.12.1.</span> <span class="toc-text">熔断,降级,限流三者的关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%86%94%E6%96%AD%E7%AD%96%E7%95%A5"><span class="toc-number">1.10.12.2.</span> <span class="toc-text">熔断策略</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sentinel-%E7%83%AD%E7%82%B9%E8%A7%84%E5%88%99"><span class="toc-number">1.10.13.</span> <span class="toc-text">Sentinel 热点规则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%83%AD%E7%82%B9Key%E9%99%90%E6%B5%81-%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.10.13.1.</span> <span class="toc-text">热点Key限流-实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E8%A7%84%E5%88%99"><span class="toc-number">1.10.14.</span> <span class="toc-text">系统规则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%84%E5%88%99"><span class="toc-number">1.10.14.1.</span> <span class="toc-text">规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.10.14.2.</span> <span class="toc-text">实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SentinelResource%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%A8%E5%B1%80%E9%99%90%E6%B5%81%E5%A4%84%E7%90%86%E7%B1%BB"><span class="toc-number">1.10.15.</span> <span class="toc-text">@SentinelResource自定义全局限流处理类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fallback"><span class="toc-number">1.10.16.</span> <span class="toc-text">fallback</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%85%A5-Sentinel-%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">1.10.17.</span> <span class="toc-text">接入 Sentinel 的方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#openFeign-sentinel-%E5%AF%B9%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7"><span class="toc-number">1.10.18.</span> <span class="toc-text">openFeign+sentinel 对远程调用熔断降级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96-%E5%9C%A8Nacos-Server%E9%85%8D%E7%BD%AE%E8%A7%84%E5%88%99-%E5%AE%8C%E6%88%90%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.10.19.</span> <span class="toc-text">规则持久化,在Nacos Server配置规则,完成持久化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#seata-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">1.11.</span> <span class="toc-text">seata 分布式事务管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.11.1.</span> <span class="toc-text">应用实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%90%8E%E6%98%AF%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6"><span class="toc-number">1.11.2.</span> <span class="toc-text">最后是事务控制</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/d32d37e5.html" title="Elasticsearch"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/bj/no37.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Elasticsearch"></a><div class="content"><a class="title" href="/posts/d32d37e5.html" title="Elasticsearch">Elasticsearch</a><time datetime="2025-01-11T11:39:48.000Z" title="发表于 2025-01-11 19:39:48">2025-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/664b7e30.html" title="mysql总结"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/bj/no9.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="mysql总结"></a><div class="content"><a class="title" href="/posts/664b7e30.html" title="mysql总结">mysql总结</a><time datetime="2024-11-26T06:25:05.000Z" title="发表于 2024-11-26 14:25:05">2024-11-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/628701a0.html" title="jvm基本总结"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/bj/no13.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="jvm基本总结"></a><div class="content"><a class="title" href="/posts/628701a0.html" title="jvm基本总结">jvm基本总结</a><time datetime="2024-11-25T06:44:23.000Z" title="发表于 2024-11-25 14:44:23">2024-11-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/16908cff.html" title="rebbitmq"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/bj/no17.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="rebbitmq"></a><div class="content"><a class="title" href="/posts/16908cff.html" title="rebbitmq">rebbitmq</a><time datetime="2024-11-17T04:24:58.000Z" title="发表于 2024-11-17 12:24:58">2024-11-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/bae4ff13.html" title="Redis"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/bj/no36.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Redis"></a><div class="content"><a class="title" href="/posts/bae4ff13.html" title="Redis">Redis</a><time datetime="2024-06-05T06:43:49.000Z" title="发表于 2024-06-05 14:43:49">2024-06-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By 秦三顺</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>function loadWaline () {
  function initWaline () {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://qgq.kuhehe.top/',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: false,
    }, null))
  }

  const walineCSSLoad = document.getElementById('waline-css')

  if (typeof Waline === 'object') {
    walineCSSLoad ? initWaline() : getCSS('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.css','waline-css').then(initWaline)
  }
  else {
    getCSS('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.css','waline-css').then(() => {
      getScript('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.js').then(initWaline)
    })
  }
}

if ('Waline' === 'Waline' || !true) {
  if (true) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
  else setTimeout(loadWaline, 0)
} else {
  function loadOtherComment () {
    loadWaline()
  }
}</script></div><script defer src="/js/cursor.js"></script><div class="aplayer no-destory" data-id="1708664797" data-server="tencent" data-type="playlist" data-order="list" data-fixed="true" data-preload="auto" data-autoplay="false" data-mutex="true"></div><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><div class="app-refresh" id="app-refresh" style="position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease"><div class="app-refresh-wrap" style="display:flex;color:#fff;height:100%;align-items:center;justify-content:center"><label>✨ 有新文章啦！ 👉</label><a href="javascript:void(0)" onclick="location.reload()"><span style="color:#fff;text-decoration:underline;cursor:pointer">🍗点击食用🍔</span></a></div></div><script>if ('serviceWorker' in navigator) {
    if (navigator.serviceWorker.controller) {
        navigator.serviceWorker.addEventListener('controllerchange', function() {
            showNotification()
        })
    }
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js')
    })
}
function showNotification() {
    if (GLOBAL_CONFIG.Snackbar) {
        var snackbarBg =
            document.documentElement.getAttribute('data-theme') === 'light' ?
                GLOBAL_CONFIG.Snackbar.bgLight :
                GLOBAL_CONFIG.Snackbar.bgDark
        var snackbarPos = GLOBAL_CONFIG.Snackbar.position
        Snackbar.show({
            text: '✨ 有新文章啦！ 👉',
            backgroundColor: snackbarBg,
            duration: 500000,
            pos: snackbarPos,
            actionText: '🍗点击食用🍔',
            actionTextColor: '#fff',
            onActionClick: function(e) {
                location.reload()
            },
        })
    } else {
        var showBg =
            document.documentElement.getAttribute('data-theme') === 'light' ?
                '#3b70fc' :
                '#1f1f1f'
        var cssText = `top: 0; background: ${showBg};`
        document.getElementById('app-refresh').style.cssText = cssText
    }
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div><script data-pjax>function butterfly_footer_beautify_injector_config(){var A=document.getElementById("footer-wrap");console.log("已挂载butterfly_footer_beautify"),A.insertAdjacentHTML("beforeend",'<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v4.2.2" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://www.jsdelivr.com/" style="margin-inline:5px" data-title="本站使用JsDelivr为静态资源提供CDN加速" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr" alt=""/></a><a class="github-badge" target="_blank" href="https://beian.miit.gov.cn/#/Integrated/index" style="margin-inline:5px" data-title="本站已在甘进行备案" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/甘ICP备-2022004213号-e1d492?style=flat&amp;logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAdCAYAAAC9pNwMAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+nhxg7wAACNlJREFUSInF1mmMVeUdx/Hv2e+5+519mJWBYQZkGxZZxLKJqBXGoLS1iXWrmihotFXaJiTWWlsbl6q1aetWd5u0VkKjNG4YEJSlOCibDLMwM8x679z9nnPP1jcVJUxf+7z6J8+LT37/Z4VvaQhfFS8+sBXbctCDGrVTKlBUH4mxAbI9Hfj0IJLsp6paJ5/tmn20N/D0wKDRMq9F/c3M2U1/V0vDfWMFh+tv/Ig1zYPMabDImPJ52OaXO87W580KggCiiOsJOJ6I3wcNFaaeNKxrt72f2fLGu4FpJ/sDQABRzD22fH7/Yze069vGc6mrDLNIJCDik10sxz2by3VdPM87xzkP9jwPTZFRVI1YUJKH+oy7n3tbvv/P2wW/UQxRWe6w4ZJRptYLHDoCuz8v5cP92XbI762O+h6UVWHnUFbPpU0fEb2A60mMJ7MUi9b/b7UgKhiZMaIxm8YLplLMDPz8hl/EH+rs8TNlUpFf32uyZJGLPDwCiTGUyTWodTN49eUCdz2YwXb9NNcObp1X98WDoufynzMVCEKGn27ayPTWBi5ad8P5iQUkJEnFLjqM9Z+hrVX0vfDe6K2dPRWsW2bwyp9EUifSJB84gdxrkR0eRgv1o/3I4fbbprJ6scqamzVO9pffec1S5ZWY2Nfz5qEy/FqOC2Y3s3j53HMSi18VRjFPwSwg+1RfVbl115vvJrsfej7UGIsYPPGgQ7JXoO+Xx5B3dHEomyJ9x1qiQozkr95h5937aFnVyouPlgJK+Ss7Fxz64OTSxSX+LHYxT2IsRW5kbGI4oHcR0jqoqTjV9se3I7/f8rS/ClS23GxSXhph6L5d9Akm7qqZhHWBQGUJ+CWGFzcg7e7m6D3/ZuW1Ea5YKdA3EojuONi813TqNi+YPYOKUhXDtCeGL26/hakLLiEcdsaHRkRAoLRc4fJrmhnekyF0apgZowWSwwkaa+rw3f8WA1GZZsPP5JEChX8dhZTN6iU6kAcs5s+dHd183SJ0VVKL57pfw6YdRQw23aeWTns47DPTALWlRTR7kMLew6hGgYqUhWXYFFUdPZ6lUBahLA8hVcOftckfi7No7VRAAQqsX1dybfvG1qwriM9mM5mJ4e4jO5Cc01dPqixbr8tWGBQUL4vjGigEEShi+xUmZ2RiR/sJ1pbS8NkgZrKAGw0TsgQsQyFaF/nfYTGprAlMFysbA1pI3mhkR6snhGsaymYGvPyFEb9IdbUE2AzFFTwpRqCtBY0wmdER+hZW4j63gcJj38V+/ErSUZXsYBfjIZHIRW0c2Z8BskCAqN+CbBJBFnyyKjR+Ez57nBxLqpfMUeSISElMBFz6x2Q6OxzWrYjyxWVzEewioU3LCS5vQY6nMUrLwNaxXvoQ59IloFSx54PPAZtQLExVZZDxsVE8J4dn6v4JYatgbSjk0owPw7RGH2ADMo88Z7L20ip8f7gC7fAo0q4+0rt7kEQDvaghVZbiPHUHcyeXcfLjT3jmpR7AYsnSScya3UR8bARVMck7Y/cB75/X6rDf3Fg2dw2jKZm5dXGm1LuAzO5DCo9v6aT0ibco5kzOvLOP+NGTFJtDpPYeZKijk/Rn3QxsfZV7txwhX7ABiZUXBsGvIvguQApNQQva9RMmTvZ2dpVUls+tX/UD7GN/Y8Ws05w6rQF+9vyzg1vZjbvMRJhXiRSU8DpTFFe0QE8S6SfPkOkZoktrB2oAhZWrwljxOPmchiSMYOWNoxNuruFU5vWeXdsojiUon345113dBBQBmTYlTimgdB8nfPo4WjaNFgN9OMEkJ02dnadVt5ki54Esqy+bzKJltVhSPbI3iN2zCyMTeXNCuG7Omm2Zok7PR2+R7jvD8ouruHhmCrB5jVZeYxLdrTP4sr4Vtd9g4MA4qc4c+6cu5NPamfw4P59t2WrA4YdXKkASf7SFivo6PDdEPmf1fRM++zp1bH/0r4I1dD1ODtOWaW4IsvPjL7nqXhloQiSPwjjgMYkMASyGEBkjhISCQwkwzve/18AbT+pk8pVY4UacQi9y+gyZ0eRAw4qHa89LXEx1LXMSPfhDJYRb59BtlLKg2WPT2l6qYl1svtGkrLYckyA1S+t5+2ATm37WCui0LSynsckDNH5zTxAchbQtkx08hDHYiW6NgC0enHBzEZ102UDH8QORdEckjEzZrNWkRydzyx17uGnDXqbUnGZ6dRPjSY91q2TqwjFuvTxLo5Zn5Qo/pumRSFcTLQtybEhGE0fQrDhhJ0VvH2lTnnHPhGtsmWan469apERjI2MH3qN7+7MEfH6ql29CbV7PvsMG32k6yU2XDhEKyZw66eJaRdrXR7CzCcqUNC3zwgymPJRCH4KRRLINimpL14A5Y4GDeOqbsPRVcfuN7Xj44pav/hFfrNT2kr2rsqf2Ibp5pEA14ZIImUyW3t5REkkTXRGQ/DGGhtLginhqCWknQDE5hKf5UFSF9Lj020Q2ul5V1AR2hr+8vuP8Vlc2zMPRxoSjnx7XBC14sDoydahSGq7KdO/HFyrBchxCVfX4fDKp4T7SCQejYODZLrYgIqgKFsNIgQqEYob8mW6yiUyb7Z64LVK/+B85xznnJ3AWzqTzuIX46mr5wLs+UUTyIriBCjRNxguHMJIFDLEEvXEOVRWnSJ0+jCd4CJoGjoedM1CLcXQziW3nMV2TSMBeOx7vWZvPt1r+cMPzE8KunaUkFn0vNrvtqXj34c1W6gzxlEQ6naIoBahtnkMwoFMwIVzSRNguMt53Aj2s4nkSlgPoGqLkICsRNF0gl8rYWuP8+11/w/OOJDEhHPKLCIpOXmi+M9AgP+maiesLifF2T1Rn5ZNj5Lo/Qc/GcPMmhdoqlEgIGzCK4PiCmJKK68p4KfF3qYGuF0qCRUkJTzleUbvQyWRTuE5xYthxQbBs7EISAbkzUFG3VfXXbK2YFi3X/eryfKKnqVBItNjJxDzH8erddC4SqWwcN5WyTtlyO1RP/Lh3eHD76MB40swmiDVJyDLYRhpc5+ub6tse/wWKbvSQEAw1awAAAABJRU5ErkJggg==" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>')}for(var elist="null".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;"all"===epage&&0==flag?butterfly_footer_beautify_injector_config():epage===cpage&&butterfly_footer_beautify_injector_config()</script><script async src="/js/runtime/runtime.min.js"></script><script async src="/js/ali_font.js"></script><div class="js-pjax"><script async>for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration","1.5s"),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset","30"),arr[i].setAttribute("data-wow-iteration","1")</script><script async>for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("flink-list-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInY"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("flink-list-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__animated"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("article-sort-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__slideInRight"),arr[i].setAttribute("data-wow-duration","1.5s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("site-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInY"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("site-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__animated"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script></div><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow_init.js"></script></body></html>